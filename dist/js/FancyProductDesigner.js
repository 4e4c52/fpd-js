(()=>{var e={221:function(){const e=(e,t,i,n,s,a,o=8,r=8)=>{n=n||{};let l=this.sizeX||n.cornerSize||s.cornerSize,c=this.sizeY||n.cornerSize||s.cornerSize,d=l/2,p=c/2;const u=.6*l,h=s.cornerIconColor||"#000000";e.save(),e.translate(t,i),e.rotate(fabric.util.degreesToRadians(s.angle)),e.fillStyle=n.cornerColor||s.cornerColor,e.beginPath(),e.roundRect(-d+o,-p+r,l,c,4),e.filter="drop-shadow(0px 0px 2px rgba(0,0,0, 0.3))",e.fill(),e.font=u+"px FontFPD",e.fillStyle=h,e.textAlign="left",e.textBaseline="top",e.filter="none",e.fillText(a,-.5*u+o,-.5*u+r),e.restore()},t=(e,t,i,n,s)=>{n=n||{},e.save(),e.translate(t,i),e.rotate(fabric.util.degreesToRadians(s.angle)),e.fillStyle=n.cornerColor||s.cornerColor,e.beginPath(),e.roundRect(-3,-7.5,6,15,4),e.filter="drop-shadow(0px 0px 2px rgba(0,0,0, 0.3))",e.fill(),e.restore()},i=(e,t,i,n,s)=>{n=n||{},e.save(),e.translate(t,i),e.rotate(fabric.util.degreesToRadians(s.angle)),e.fillStyle=n.cornerColor||s.cornerColor,e.beginPath(),e.roundRect(-7.5,-3,15,6,4),e.filter="drop-shadow(0px 0px 2px rgba(0,0,0, 0.3))",e.fill(),e.restore()};fabric.Object.prototype.transparentCorners=!1,fabric.Object.prototype.controls.tl.cursorStyleHandler=()=>"pointer",fabric.Object.prototype.controls.tl.mouseDownHandler=function(e,t){const i=t.target;i.canvas.duplicateElement(i)},fabric.Object.prototype.controls.tl.actionHandler=null,fabric.Object.prototype.controls.tl.render=function(t,i,n,s,a){a.canvas&&a.canvas.viewOptions&&"basic"===a.canvas.viewOptions.cornerControlsStyle?fabric.controlsUtils.renderCircleControl.call(this,t,i,n,s,a):e(t,i,n,s,a,String.fromCharCode("0xe942"),-8,-8)},fabric.Object.prototype.controls.tr.cursorStyleHandler=()=>"pointer",fabric.Object.prototype.controls.tr.mouseDownHandler=function(e,t){const i=t.target;i.canvas.removeElement(i)},fabric.Object.prototype.controls.tr.actionHandler=null,fabric.Object.prototype.controls.tr.render=function(t,i,n,s,a){a.canvas&&a.canvas.viewOptions&&"basic"===a.canvas.viewOptions.cornerControlsStyle?fabric.controlsUtils.renderCircleControl.call(this,t,i,n,s,a):e(t,i,n,s,a,String.fromCharCode("0xe926"),8,-8)},fabric.Object.prototype.controls.mtr.withConnection=!1,fabric.Object.prototype.controls.mtr.y=.5,fabric.Object.prototype.controls.mtr.offsetY=25,fabric.Object.prototype.controls.mtr.offsetX=-8,fabric.Object.prototype.controls.mtr.render=function(t,i,n,s,a){a.canvas&&a.canvas.viewOptions&&"basic"===a.canvas.viewOptions.cornerControlsStyle?fabric.controlsUtils.renderCircleControl.call(this,t,i,n,s,a):e(t,i,n,s,a,String.fromCharCode("0xe923"))},fabric.Object.prototype.controls.br.render=function(t,i,n,s,a){a.canvas&&a.canvas.viewOptions&&"basic"===a.canvas.viewOptions.cornerControlsStyle?fabric.controlsUtils.renderCircleControl.call(this,t,i,n,s,a):e(t,i,n,s,a,String.fromCharCode("0xe922"))},fabric.Object.prototype.controls.ml.render=t,fabric.Object.prototype.controls.mr.render=t,fabric.Object.prototype.controls.mt.render=i,fabric.Object.prototype.controls.mb.render=i,fabric.Textbox.prototype.controls.ml.render=t,fabric.Textbox.prototype.controls.mr.render=t,fabric.Object.prototype.controls.bl.visible=!1},295:()=>{fabric.Group.prototype.changeObjectColor=function(e,t){let i=[];return this.getObjects().forEach((e=>{const t=tinycolor(e.fill);i.push(t.toHexString())})),i[e]=t,this.changeColor(i),i}},859:()=>{var e;fabric.Text.prototype.initialize=(e=fabric.Text.prototype.initialize,function(...t){return e.call(this,...t),this._TextInit(),this}),fabric.Text.prototype._TextInit=function(){this.on({modified:e=>{(e=>{if(!e.curved&&!e.uniScalingUnlockable){let t=e.fontSize*e.scaleX;t=parseFloat(Number(t).toFixed(0)),e.scaleX=1,e.scaleY=1,e._clearCache(),e.set("fontSize",t)}})(this)}})}},431:()=>{var e;fabric.Textbox.prototype.initialize=(e=fabric.Textbox.prototype.initialize,function(...t){return e.call(this,...t),this._TextboxInit(),this}),fabric.Textbox.prototype._TextboxInit=function(){this.on({added:()=>{if(this._calcWidth){this.set("width",1e3);const e=this.calcTextWidth();this.set("width",e),delete this._calcWidth}}})}},561:()=>{class e extends HTMLElement{constructor(){super()}connectedCallback(){}}customElements.define("fpd-actions-bar",e)}},t={};function i(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,i),a.exports}(()=>{"use strict";const e=(e="",t=!1,i="",n=document.body)=>{n===document.body&&n.classList.add("fpd-overflow-hidden"),"prompt"===i?e=`\n            <input type="text" placeholder="${e}" />\n            <span class="fpd-btn"></span>\n        `:"confirm"===i&&(e=`\n            <div class="fpd-confirm-msg">${e}</div>\n            <span class="fpd-btn fpd-confirm"></span>\n        `);let s=`\n        <div class="fpd-modal-wrapper fpd-shadow-3">\n            <div class="fpd-modal-close">\n                <span class="fpd-icon-close"></span>\n            </div>\n            <div class="fpd-modal-content">${e}</div>\n        </div>\n    `;const a=document.createElement("div");return a.className="fpd-modal-internal fpd-modal-overlay "+(t?"fpd-fullscreen":""),a.innerHTML=s,a.dataset.type=i,n.append(a),l(a.querySelector(".fpd-modal-close"),["click"],(e=>{a.remove()})),a},t=e=>"[object Object]"===Object.prototype.toString.call(e),n=(e,t)=>{if(e&&"object"==typeof e){let s=!0;for(var i=0;i<t.length;++i){var n=t[i];if(!e.hasOwnProperty(n)){s=!1;break}}return s}return!1},s=(e,i)=>{const n={...e,...i};if(Object.keys(i).length)for(const a of Object.keys(n))t(n[a])&&e[a]&&i[a]&&(n[a]=s(e[a],i[a]));return n},a=(e,t,i)=>{if(!t)return;const n=(Array.isArray(t)?t:t.match(/([^[.\]])+/g)).reduce(((e,t)=>e&&e[t]),e);return void 0===n?i:n},o=e=>/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e),r=e=>0===e||"string"==typeof e&&"0"===e,l=(e,t=[],i=(()=>{}),n=!1)=>{(t="string"==typeof t?[t]:t).forEach((t=>{e instanceof HTMLElement?e.addEventListener(t,i,n):Array.from(e).length?e.forEach((e=>{e.addEventListener(t,i,n)})):e.addEventListener(t,i,n)}))},c=(e=[],t=[])=>(e&&(e instanceof HTMLElement?t.forEach((t=>{e.classList.add(t)})):e.forEach((e=>{t.forEach((t=>{e.classList.add(t)}))}))),e),d=(e=[],t=[])=>(e&&(e instanceof HTMLElement?t.forEach((t=>{e.classList.remove(t)})):e.forEach((e=>{t.forEach((t=>{e.classList.remove(t)}))}))),e),p=(e=[],t=[],i=!0)=>(e&&(e instanceof HTMLElement?t.forEach((t=>{e.classList.toggle(t,i)})):e.forEach((e=>{t.forEach((t=>{e.classList.toggle(t,i)}))}))),e),u=(e,t=null)=>{if(e){e.classList.add("fpd-on-loading");var i=new Image;i.src=t||e.dataset.img,i.onload=function(){e.dataset.originwidth=this.width,e.dataset.originheight=this.height,e.classList.remove("fpd-on-loading"),e.style.backgroundImage='url("'+this.src+'")'},i.onerror=function(){e.parentNode.remove()}}},h=e=>void 0===e||null==e||("string"==typeof e?!e.trim().length:Array.isArray(e)?!e.length:"object"==typeof e&&!Object.keys(e).length),g=()=>{var e=!0;try{window.localStorage.length,window.localStorage.setItem("fpd-storage","just-testing")}catch(t){e=!1}return e},f=(e={})=>{if(!e.url)return;const t=document.createElement("div");t.className="fpd-item",t.dataset.source=e.url,e.title&&(t.dataset.title=e.title,t.setAttribute("aria-label",e.title),t.classList.add("fpd-hover-thumbnail"));const i=document.createElement("picture");i.dataset.img=e.thumbnailUrl?e.thumbnailUrl:e.url,t.append(i);const n=document.createElement("span");if(n.className="fpd-price",n.innerHTML=e.price,t.append(n),e.removable){const e=document.createElement("span");e.className="fpd-delete fpd-icon-remove",t.append(e)}return t},m=(e,t,i=null)=>{if(!e.currentViewInstance)return"";let n=e.currentViewInstance.options;if(e.container.querySelector(".fpd-upload-zone-content").contains(t)&&e.currentViewInstance.currentUploadZone){const t=e.currentViewInstance.fabricCanvas.getUploadZone(e.currentViewInstance.currentUploadZone);t&&t.price&&(i=t.price)}return null==i&&(i=a(n,"customImageParameters.price",0)),i?e.formatPrice(i):""},v=(t,i,n)=>{const s=t.currentViewInstance;let a=s.options.customImageParameters;if(i>a.maxW||i<a.minW||n>a.maxH||n<a.minH){t.loadingCustomImage=!1,t.mainBar&&(t.mainBar.toggleContentDisplay(!1),s.currentUploadZone&&t.mainBar.toggleUploadZonePanel(!1));let i=t.translator.getTranslation("misc","uploaded_image_size_alert");return i=i.replace("%minW",a.minW).replace("%minH",a.minH).replace("%maxW",a.maxW).replace("%maxH",a.maxH),e(i),!1}return!0};class b{static defaults={imageLoadTimestamp:!1,stageWidth:900,stageHeight:600,editorMode:!1,editorBoxParameters:["left","top","angle","fill","width","height","fontSize","price"],fonts:[{name:"Arial"},{name:"Lobster",url:"google"}],facebookAppId:"",instagramClientId:"",instagramRedirectUri:"",instagramTokenUri:"",zoomStep:.2,maxZoom:3,hexNames:{},selectedColor:"#f5f5f5",boundingBoxColor:"#2185d0",outOfBoundaryColor:"#990000",replaceInitialElements:!1,customImageAjaxSettings:{url:"php/custom-image-handler.php",data:{saveOnServer:0,uploadsDir:"./uploads",uploadsDirURL:"http://yourdomain.com/uploads"}},responsive:!0,cornerIconColor:"#000000",langJSON:"lang/default.json",colorPickerPalette:[],actions:{top:[],right:[],bottom:[],left:[]},mainBarModules:["products","images","text","designs","manage-layers"],initialActiveModule:"",maxValues:{},watermark:!1,priceFormat:{currency:"&#36;%d",decimalSep:".",thousandSep:","},mainBarContainer:!1,modalMode:!1,keyboardControl:!0,deselectActiveOnOutside:!0,uploadZonesTopped:!0,loadFirstProductInStage:!0,unsavedProductAlert:!1,hideDialogOnAdd:!0,toolbarPlacement:"smart",snapGridSize:[50,50],fabricCanvasOptions:{},namesNumbersDropdown:[],namesNumbersEntryPrice:0,colorSelectionPlacement:"",colorSelectionDisplayType:"grid",bulkVariationsPlacement:"",bulkVariations:{},toolbarDynamicContext:"body",boundingBoxProps:{strokeWidth:1},fitImagesInCanvas:!1,maxPrice:-1,inCanvasTextEditing:!0,openTextInputOnSelect:!1,designCategories:[],optionalView:!1,saveActionBrowserStorage:!0,pricingRules:[],uploadAgreementModal:!1,imageEditorSettings:{masks:[]},printingBox:null,autoOpenInfo:!1,guidedTour:null,replaceColorsInColorGroup:!1,allowedImageTypes:["jpeg","png","svg","pdf"],pixabayApiKey:"",pixabayHighResImages:!1,pixabayLang:"en",openModalInDesigner:!1,imageSizeTooltip:!1,highlightEditableObjects:"",applyFillWhenReplacing:!0,layouts:[],dynamicViewsOptions:{unit:"mm",formats:[],pricePerArea:0,minWidth:0,minHeight:0,maxWidth:1e4,maxHeight:1e4},disableTextEmojis:!1,smartGuides:!1,usePrintingBoxAsBounding:!1,printingBox:{},productsJSON:null,designsJSON:null,customizationRequiredRule:"any",swapProductConfirmation:!1,textLinkGroupProps:[],textTemplates:[],multiSelection:!1,multiSelectionColor:"#54dfe6",canvasHeight:"auto",maxCanvasHeight:.8,mobileGesturesBehaviour:"none",imageQualityRatings:null,splitMultiSVG:!1,cornerControlsStyle:"advanced",downloadFilename:"Product",autoFillUploadZones:!1,dragDropImagesToUploadZones:!1,responsiveBreakpoints:{small:768,medium:1024},dynamicDesigns:{},elementParameters:{objectCaching:!1,z:-1,price:0,colors:!1,removable:!1,draggable:!1,rotatable:!1,resizable:!1,copyable:!1,zChangeable:!1,boundingBox:!1,boundingBoxMode:"clipping",autoCenter:!1,replace:"",replaceInAllViews:!1,autoSelect:!1,topped:!1,colorPrices:{},colorLinkGroup:!1,patterns:[],sku:"",excludeFromExport:!1,showInColorSelection:!1,locked:!1,uniScalingUnlockable:!1,fixed:!1,originX:"center",originY:"center",cornerSize:24,fill:!1,lockUniScaling:!0,pattern:!1,top:0,left:0,angle:0,flipX:!1,flipY:!1,opacity:1,scaleX:1,scaleY:1},textParameters:{maxLength:0,curved:!1,curvable:!1,curveRadius:80,curveReverse:!1,maxLines:0,textBox:!1,textPlaceholder:!1,numberPlaceholder:!1,letterSpacing:0,chargeAfterEditing:!1,minFontSize:1,textTransform:"none",widthFontSize:0,maxFontSize:200,shadowColor:"",shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,textLinkGroup:"",strokeColors:[],editable:!0,fontFamily:"Arial",fontSize:18,lineHeight:1,fontWeight:"normal",fontStyle:"normal",textDecoration:"normal",padding:10,textAlign:"left",stroke:null,strokeWidth:0,charSpacing:0},imageParameters:{uploadZone:!1,filter:null,scaleMode:"fit",resizeToW:0,resizeToH:0,advancedEditing:!1,uploadZoneMovable:!1,uploadZoneRemovable:!1,padding:0,minScaleLimit:.01},customImageParameters:{minW:100,minH:100,maxW:1e4,maxH:1e4,minDPI:72,maxSize:10},customTextParameters:{},customAdds:{designs:!0,uploads:!0,texts:!0,drawing:!0},qrCodeProps:{autoCenter:!0,draggable:!0,removable:!0,resizable:!0}};static merge(e={},t={}){return s(e,t)}static getParameterKeys(){var e=Object.keys(this.defaults.elementParameters),t=Object.keys(this.defaults.imageParameters),i=Object.keys(this.defaults.textParameters);return(e=e.concat(t)).concat(i)}}window&&(window.FPDOptions=b),i(221),i(295),i(859);const y=(e,t,i,n,s="fit")=>{let a=1,o=0!==(i="number"!=typeof i?0:i),r=0!==(n="number"!=typeof n?0:n);return a="cover"===s?i-e<n-t?o?Math.max(i/e,n/t):1:r?Math.max(i/e,n/t):1:e>t?o?Math.min(i/e,n/t):1:r?Math.min(i/e,n/t):1,parseFloat(a.toFixed(10))};var C;fabric.IText.prototype.initialize=(C=fabric.IText.prototype.initialize,function(...e){return C.call(this,...e),this._ITextInit(),this}),fabric.IText.prototype._ITextInit=function(){this.on({added:()=>{this.setCurvedTextPath()},"editing:entered":()=>{this.canvas.viewOptions.inCanvasTextEditing||this.exitEditing(),this.curved&&this.exitEditing()},scaling:()=>{},changed:()=>{if(0!=this.maxLines&&this.textLines.length>this.maxLines){let e=this.textLines.slice(0,this.maxLines);this.set("text",e.join("\n")),this.exitEditing()}if(0!=this.maxLength&&this.text.length>this.maxLength&&(this.set("text",this.text.substr(0,this.maxLength)),this.exitEditing()),this.canvas.viewOptions.disableTextEmojis){let e=this.text.replace(FPDEmojisRegex,"");e=e.replace(String.fromCharCode(65039),""),this.set("text",e)}}})},fabric.IText.prototype.setCurvedTextPath=function(){if(this.curved){const t=new fabric.Path((0,0,"M0,0m"+-(e=this.curveRadius)+",0a"+e+","+e+" 0 1,0 "+2*e+",0a"+e+","+e+" 0 1,0 "+2*-e+",0"),{fill:"transparent",strokeWidth:2,stroke:"rgba(0,0,0, 0.5)",visible:!1});this.set("path",t),this.setCurvedTextPosition()}var e},fabric.IText.prototype.setCurvedTextPosition=function(){if(this.curved&&this.path){this.pathSide=this.curveReverse?"left":"right";const e=this.curveReverse?Math.PI*this.curveRadius*2*.25:Math.PI*this.curveRadius/2;this.pathStartOffset=e-this.calcTextWidth()/2,this.pathAlign="center"}},i(431),fabric.Object.propertiesToInclude=["_isInitial","lockMovementX","lockMovementY","lockRotation","lockScalingX","lockScalingY","lockScalingFlip","lockUniScaling","resizeType","clipTo","clippingRect","boundingBox","boundingBoxMode","selectable","evented","title","editable","cornerColor","cornerIconColor","borderColor","isEditable","hasUploadZone","cornerSize"],fabric.Object.prototype.initialize=function(e){return function(...t){return e.call(this,...t),this._elementInit(),this}}(fabric.Object.prototype.initialize),fabric.Object.prototype._elementInit=function(){this.on({added:()=>{!this.isCustom||this.hasUploadZone||this.replace||(this.copyable=this.originParams.copyable=!0)},moving:()=>{this._checkContainment()},rotating:()=>{this._checkContainment()},scaling:()=>{this._checkContainment()},selected:()=>{let e=!this.lockUniScaling;this.textBox&&(e=!0),"basic"==this.canvas.viewOptions.cornerControlsStyle&&(this.controls.mtr.offsetX=0,this.cornerSize=16),this.setControlsVisibility({ml:e,mr:e,mt:!this.lockUniScaling,mb:!this.lockUniScaling,tr:this.removable,tl:this.copyable,mtr:this.rotatable,br:this.resizable&&!this.curved})}})},fabric.Object.prototype.getType=function(e){return"text"===(e=e||this.type)||"i-text"===e||"curvedText"===e||"textbox"===e?"text":"image"},fabric.Object.prototype.isSVG=function(){return"group"===this.type||"path"===this.type||this.source&&this.source.includes(".svg")},fabric.Object.prototype.isColorizable=function(){return"text"===this.getType()?"text":!!this.source&&(1==this.source.split(".").length?this.source.includes("data:image/png;")?"dataurl":(this.fill=this.colors=!1,!1):(e=>this.source.replace(/\?.*$/,""))().includes(".png")||this.isSVG()?this.isSVG()?"svg":"png":(this.fill=this.colors=!1,!1))},fabric.Object.prototype.hasColorSelection=function(){return(Array.isArray(this.colors)||Boolean(this.colors)||this.colorLinkGroup||this.__editorMode)&&!1!==this.isColorizable()},fabric.Object.prototype.checkEditable=function(e){return"object"==typeof(e=e||this).colors||!0===e.colors||1==e.colors||e.removable||e.draggable||e.resizable||e.rotatable||e.zChangeable||e.advancedEditing||e.editable||e.uploadZone||e.colorLinkGroup&&e.colorLinkGroup.length>0||e.__editorMode},fabric.Object.prototype.changeColor=function(e,t=!0){const i=this.isColorizable();if("string"==typeof e&&(e=tinycolor(e).toHexString()),"text"===this.getType())"object"==typeof e&&(e=e[0]),this.set("fill",e),this.canvas.renderAll(),this.pattern=null;else if("group"==this.type&&"object"==typeof e){const t=this.getObjects();e.forEach(((e,i)=>{t[i]&&t[i].set("fill",e)})),this.canvas.renderAll(),this.svgFill=e,delete this.fill}else"object"==typeof e&&(e=e[0]),"string"!=typeof e&&(e=!1),"png"==i||"dataurl"==i?(this.filters=[],e&&this.filters.push(new fabric.Image.filters.BlendColor({mode:"tint",color:e})),this.applyFilters(),this.canvas.renderAll(),this.canvas.fire("elementColorChange",{target:this,colorLinking:t}),this.fill=e):"svg"==i&&(this.set("fill",e),this.canvas.renderAll(),this.canvas.fire("elementColorChange",{target:this,colorLinking:t}))},fabric.Object.prototype.setPattern=function(e){FancyProductDesigner.proxyFileServer&&(e=FancyProductDesigner.proxyFileServer+e),e&&(fabric.util.loadImage(e,(e=>{if(this.isSVG())if(this.hasOwnProperty("getObjects")){const i=this.getObjects();for(var t=0;t<i.length;++t)i[t].set("fill",new fabric.Pattern({source:e,repeat:"repeat"}))}else this.set("fill",new fabric.Pattern({source:e,repeat:"repeat"}));else if("text"==this.getType())this.set("fill",new fabric.Pattern({source:e,repeat:"repeat"}));else{let e=this.fill?this.fill:this.colors[0];e=e||"#000000",this.set("fill",e)}this.canvas.renderAll()})),this.pattern=e)},fabric.Object.prototype.getZIndex=function(){return this.canvas.getObjects().indexOf(this)},fabric.Object.prototype.getBoundingBoxCoords=function(){if(this.boundingBox||this.uploadZone){if("object"==typeof this.boundingBox)return!!(this.boundingBox.hasOwnProperty("x")&&this.boundingBox.hasOwnProperty("y")&&this.boundingBox.width&&this.boundingBox.height)&&{left:this.boundingBox.x,top:this.boundingBox.y,width:this.boundingBox.width,height:this.boundingBox.height};for(var e=this.canvas.getObjects(),t=0;t<e.length;++t){var i=e[t];if(this.boundingBox==i.title){var n=i.getPointByOrigin("left","top");return{left:n.x,top:n.y,width:i.width*i.scaleX,height:i.height*i.scaleY,angle:i.angle||0,cp:i.getCenterPoint()}}}}return!1},fabric.Object.prototype.centerElement=function(e=!0,t=!0){let i=this.getBoundingBoxCoords(),n=this.left,s=this.top;e&&(n=i?i.cp?i.cp.x:i.left+.5*i.width:.5*this.canvas.viewOptions.stageWidth),t&&(s=i?i.cp?i.cp.y:i.top+.5*i.height:.5*this.canvas.viewOptions.stageHeight),this.setPositionByOrigin(new fabric.Point(n,s),"center","center"),this.canvas.renderAll(),this.setCoords(),this._checkContainment(),this.autoCenter=!1},fabric.Object.prototype._checkContainment=function(){if(this.canvas.currentBoundingObject&&!this.hasUploadZone)if(this.setCoords(),"limitModify"===this.boundingBoxMode){let e=this.getBoundingRect(),t=instance.currentBoundingObject.getBoundingRect(),i=t.left,n=t.left+t.width-e.width,s=t.top,a=t.top+t.height-e.height;this.isContainedWithinObject(instance.currentBoundingObject)?(limitModifyParameters={left:this.left,top:this.top,angle:this.angle,scaleX:this.scaleX,scaleY:this.scaleY},"text"==this.getType()&&(limitModifyParameters.fontSize=this.fontSize,limitModifyParameters.lineHeight=this.lineHeight,limitModifyParameters.charSpacing=this.charSpacing)):(0===this.__corner&&(e.left>i&&e.left<n&&(limitModifyParameters.left=this.left),e.top>s&&e.top<a&&(limitModifyParameters.top=this.top)),this.setOptions(limitModifyParameters))}else if("inside"===this.boundingBoxMode||"clipping"===this.boundingBoxMode){var e,t=this.isOut;(e=!this.isContainedWithinObject(this.canvas.currentBoundingObject))?("inside"===this.boundingBoxMode&&(this.borderColor=this.canvas.viewOptions.outOfBoundaryColor),this.isOut=!0):("inside"===this.boundingBoxMode&&(this.borderColor=this.canvas.viewOptions.selectedColor),this.isOut=!1),t!=this.isOut&&null!=t&&(e?this.canvas.fire("elementOut",{target:this}):this.canvas.fire("elementIn",{target:this})),this.canvas.fire("elementCheckContainemt",{target:this,boundingBoxMode:this.boundingBoxMode})}this.canvas.renderAll()},fabric.Object.prototype._clipElement=function(){var e=this.getBoundingBoxCoords()||this.clippingRect;if(e){this.clippingRect=e;const t=new fabric.Rect({originX:"left",originY:"top",angle:e.angle||0,left:e.left,top:e.top,width:e.width,height:e.height,fill:"#DDD",absolutePositioned:!0});this.clipPath=t}},fabric.Object.prototype.getElementJSON=function(e=!1,t=[]){this.canvas&&(t=Object.keys(this.canvas.viewOptions.elementParameters),t="text"===this.getType()?t.concat(Object.keys(this.canvas.viewOptions.textParameters)):t.concat(Object.keys(this.canvas.viewOptions.imageParameters))),e&&(t=t.concat(fabric.Object.propertiesToInclude)),this.uploadZone&&(t.push("customAdds"),t.push("designCategories"),t.push("designCategories[]")),"text"===this.getType()&&(t.push("text"),t.push("_initialText")),"group"===this.type&&t.push("svgFill"),t.push("width"),t.push("height"),t.push("isEditable"),t.push("hasUploadZone"),t.push("clippingRect"),t.push("evented"),t.push("isCustom"),t.push("currentColorPrice"),t.push("_isPriced"),t.push("originParams"),t.push("originSource"),t.push("_printingBox"),t=t.sort();let i={};return t.forEach((e=>{void 0!==this[e]&&(i[e]=this[e])})),i},fabric.Object.prototype.alignToPosition=function(e="left"){let t=this.getPointByOrigin("left","top"),i=this.getBoundingBoxCoords(),n="left",s="top";"left"===e?(t.x=i?i.left:0,t.x+=this.padding+1):"top"===e?(t.y=i?i.top:0,t.y+=this.padding+1):"right"===e?(t.x=i?i.left+i.width-this.padding:this.canvas.viewOptions.stageWidth-this.padding,n="right"):(t.y=i?i.top+i.height-this.padding:this.canvas.viewOptions.stageHeight,s="bottom"),this.setPositionByOrigin(t,n,s),this.setCoords(),this._checkContainment()},fabric.Object.prototype.toggleUploadZone=function(){if(this.hasUploadZone&&this.canvas){let i=this.canvas.getObjects(),n=!0;for(var e=0;e<i.lenth;++e)if(i[e].replace==this.replace){n=!1;break}var t=this.canvas.getUploadZone(this.replace);t&&(t.set("opacity",n?1:0),t.evented=n),this.canvas.renderAll()}},fabric.Canvas.prototype.initialize=function(e){return function(...t){return e.call(this,...t),this._historyInit(),this}}(fabric.Canvas.prototype.initialize),fabric.Canvas.prototype.dispose=function(e){return function(...t){return e.call(this,...t),this._historyDispose(),this}}(fabric.Canvas.prototype.dispose),fabric.Canvas.prototype._historyNext=function(){let e=b.getParameterKeys();e=e.concat(fabric.Object.propertiesToInclude);let t=this.toJSON(e);return t.objects.forEach((e=>{e.curved&&delete e.path})),JSON.stringify(t)},fabric.Canvas.prototype._historyEvents=function(){return{elementAdd:this._historySaveAction,elementRemove:this._historySaveAction,"object:modified":this._historySaveAction}},fabric.Canvas.prototype._historyInit=function(){this.historyUndo=[],this.historyRedo=[],this.historyNextState=this._historyNext(),this.on(this._historyEvents())},fabric.Canvas.prototype._historyDispose=function(){this.off(this._historyEvents())},fabric.Canvas.prototype._historySaveAction=function(){if(this.historyProcessing)return;const e=this.historyNextState;this.historyUndo.push(e),this.historyNextState=this._historyNext(),this.fire("history:append",{json:e})},fabric.Canvas.prototype.undo=function(e){this.historyProcessing=!0;const t=this.historyUndo.pop();t?(this.historyRedo.push(this._historyNext()),this.historyNextState=t,this._loadHistory(t,"history:undo",e)):this.historyProcessing=!1},fabric.Canvas.prototype.redo=function(e){this.historyProcessing=!0;const t=this.historyRedo.pop();t?(this.historyUndo.push(this._historyNext()),this.historyNextState=t,this._loadHistory(t,"history:redo",e)):this.historyProcessing=!1},fabric.Canvas.prototype._loadHistory=function(e,t,i){var n=this;this.loadFromJSON(e,(function(){n.renderAll(),n.fire(t),n.historyProcessing=!1,i&&"function"==typeof i&&i()}))},fabric.Canvas.prototype.clearHistory=function(){this.historyUndo=[],this.historyRedo=[],this.fire("history:clear")},fabric.Canvas.prototype.onHistory=function(){this.historyProcessing=!1,this._historySaveAction()},fabric.Canvas.prototype.offHistory=function(){this.historyProcessing=!0},fabric.Canvas.prototype.viewOptions={},fabric.Canvas.prototype.elements=[],fabric.Canvas.prototype.currentElement=null,fabric.Canvas.prototype.responsiveScale=1,fabric.Canvas.prototype.currentBoundingObject=null,fabric.Canvas.prototype.initialElementsLoaded=!1,fabric.Canvas.prototype.isCustomized=!1,fabric.Canvas.prototype.printingBoxObject=null,fabric.Canvas.prototype._canvasCreated=!1,fabric.Canvas.prototype.currentCurvedTextPath=!1,fabric.Canvas.prototype.initialize=function(e){return function(...t){return e.call(this,...t),this._fpdCanvasInit(),this}}(fabric.Canvas.prototype.initialize),fabric.Canvas.prototype._fpdCanvasInit=function(){this.on({"after:render":()=>{this._canvasCreated||this._onCreated(),this.viewOptions&&this.viewOptions.highlightEditableObjects.length>3&&(this.contextContainer.strokeStyle=this.viewOptions.highlightEditableObjects,this.forEachObject((e=>{if(e!==this.getActiveObject()&&!e.isMoving&&("text"===e.getType()&&e.editable||e.uploadZone)){const t=e.getBoundingRect();this.contextContainer.setLineDash([5,15]),this.contextContainer.strokeRect(t.left,t.top,t.width,t.height)}else this.contextContainer.setLineDash([])})))},"object:added":({target:e})=>{this._bringToppedElementsToFront()},"object:moving":({target:e})=>{this.fire("elementChange",{type:"moving",element:e})},"object:rotating":({target:e})=>{this.fire("elementChange",{type:"rotating",element:e})},"object:scaling":({target:e})=>{this.fire("elementChange",{type:"scaling",element:e})},"selection:created":({selected:e})=>{1==e.length?this._onSelected(e[0]):this._onMultiSelected(e)},"selection:updated":({selected:e})=>{1==e.length?this._onSelected(e[0]):this._onMultiSelected(e)},"selection:cleared":({deselected:e})=>{this.currentCurvedTextPath&&(this.currentCurvedTextPath.visible=!1,this.currentCurvedTextPath=null)},"mouse:down":function(e){e.target&&e.target.__corner&&"function"==typeof e.target.exitEditing&&e.target.exitEditing(),null==e.target&&this.deselectElement()}})},fabric.Canvas.prototype._onCreated=function(){this._canvasCreated=!0,this._renderPrintingBox()},fabric.Canvas.prototype._onSelected=function(e){if(this.deselectElement(!1),this.dragStage)return this.deselectElement(),!1;this.currentElement=e,this.currentCurvedTextPath&&(this.currentCurvedTextPath.visible=!1),this.currentCurvedTextPath=e.path,this.currentCurvedTextPath&&(this.currentCurvedTextPath.visible=!0),this.fire("elementSelect",{element:e}),this.hoverCursor=e.draggable?"move":"pointer",e.boundingBox&&!e.uploadZone&&this._renderElementBoundingBox(e)},fabric.Canvas.prototype._onMultiSelected=function(e){const t=this.getActiveObject();this.viewOptions.multiSelection&&(t.set({lockScalingX:!0,lockScalingY:!0,lockRotation:!0,hasControls:!1,borderDashArray:[8,8],cornerStyle:"circle",cornerSize:16,transparentCorners:!1,borderColor:this.viewOptions.multiSelectionColor,borderScaleFactor:3}),e.forEach((e=>{e.draggable&&!e.locked||t.removeWithUpdate(e)})))},fabric.Canvas.prototype._renderElementBoundingBox=function(e){if(this.currentBoundingObject&&(this.remove(this.currentBoundingObject),this.currentBoundingObject=null),e){var t=e.getBoundingBoxCoords();if(t&&"none"!=e.boundingBoxMode){let e={left:t.left,top:t.top,width:t.width,height:t.height,angle:t.angle||0,stroke:this.viewOptions.boundingBoxColor,strokeWidth:1,strokeLineCap:"square",strokeDashArray:[10,10],fill:!1,selectable:!1,evented:!1,originX:"left",originY:"top",name:"bounding-box",excludeFromExport:!0,_ignore:!0};e=s(e,this.viewOptions.boundingBoxProps),this.currentBoundingObject=new fabric.Rect(e),this.add(this.currentBoundingObject),this.currentBoundingObject.bringToFront(),this.fire("boundingBoxToggle",{currentBoundingObject:this.currentBoundingObject,state:!0})}e._checkContainment()}},fabric.Canvas.prototype._renderPrintingBox=function(){if(this.printingBoxObject&&(this.remove(this.printingBoxObject),this.printingBoxObject=null),n(this.viewOptions.printingBox,["left","top","width","height"])){const e=new fabric.Rect({left:100,top:100,width:this.viewOptions.printingBox.width,height:this.viewOptions.printingBox.height,stroke:this.viewOptions.printingBox.visibility||this.viewOptions.editorMode?"#db2828":"transparent",strokeWidth:1,strokeLineCap:"square",fill:!1,originX:"left",originY:"top",name:"printing-box",excludeFromExport:!0,_ignore:!0});this.printingBoxObject=new fabric.Group([e],{left:this.viewOptions.printingBox.left,top:this.viewOptions.printingBox.top,evented:!1,resizable:!0,uniformScaling:!1,lockRotation:!0,borderColor:"transparent",transparentCorners:!0,cornerColor:this.viewOptions.selectedColor,cornerIconColor:this.viewOptions.cornerIconColor,cornerSize:24,originX:"left",originY:"top",name:"printing-boxes",excludeFromExport:!0,selectable:!1,_ignore:!0}),this.add(this.printingBoxObject),this.printingBoxObject.setCoords(),this.renderAll()}},fabric.Canvas.prototype._bringToppedElementsToFront=function(){let e=this.getObjects(),t=[];e.forEach((e=>{(e.topped||e.uploadZone&&this.viewOptions.uploadZonesTopped)&&t.push(e)})),t.forEach((e=>{e.bringToFront()})),this.currentBoundingObject&&this.currentBoundingObject.bringToFront(),this.printingBoxObject&&this.printingBoxObject.bringToFront(),this.renderAll()},fabric.Canvas.prototype.addElements=function(e,t){let i=-1;const n=()=>{if(i++,i<e.length){const t=e[i];s(t)||this.addElement(t.type,t.source,t.title,t.parameters)}else this.off("elementAdd",n),void 0!==t&&t.call(t,this),this.initialElementsLoaded=!0},s=t=>{if(void 0===t.type||void 0===t.source||void 0===t.title){const i=e.indexOf(t);if(-1!==i)return console.log("Element index "+i+" from elements removed, its not a valid element object!","info"),n(),!0}else this.elements.push(t);return!1};e[0]?(this.on("elementAdd",n),n()):(void 0!==t&&t.call(t,instance),this.initialElementsLoaded=!0)},fabric.Canvas.prototype.addElement=function(e,t,i,a={}){if(void 0===e||void 0===t||void 0===i)return;let r;if(this.fire("beforeElementAdd",{type:e,source:t,title:i,params:a}),"text"===e&&(t=(t=t.replace(/(<([^>]+)>)/gi,"")).replace(FancyProductDesigner.forbiddenTextChars,""),i=i.replace(/(<([^>]+)>)/gi,"")),"string"==typeof a.fill||Array.isArray(a.fill)||(a.fill=!1),r=e.toLowerCase().includes("text")?s(this.viewOptions.elementParameters,this.viewOptions.textParameters):s(this.viewOptions.elementParameters,this.viewOptions.imageParameters),!0!==(a=s(r,a)).colors&&1!=a.colors||(a.colors=a.fill?a.fill:"#000"),a.colors&&"string"==typeof a.colors&&0==a.colors.indexOf("#")){var l=a.colors.replace(/\s+/g,"").split(",");a.colors=l}if(a._isInitial=!this.initialElementsLoaded,e.toLowerCase().includes("text")){var c=a.colors[0]?a.colors[0]:"#000000";a.fill=a.fill?a.fill:c}let d={source:t,title:i,id:String((new Date).getTime())};if(this.viewOptions.editorMode?(a.__editorMode=this.viewOptions.editorMode,d.selectable=d.evented=!0):d=s(d,{selectable:!1,lockRotation:!0,hasRotatingPoint:!1,lockScalingX:!0,lockScalingY:!0,lockMovementX:!0,lockMovementY:!0,hasControls:!1,evented:!1,lockScalingFlip:!0}),d=s(a,d),d.isCustom&&(this.isCustomized=!0),this.viewOptions.usePrintingBoxAsBounding&&!d.boundingBox&&n(this.viewOptions.printingBox,["left","top","width","height"])&&(d.boundingBox={x:this.viewOptions.printingBox.left-1,y:this.viewOptions.printingBox.top-1,width:this.viewOptions.printingBox.width+1,height:this.viewOptions.printingBox.height+1},d._printingBox=d.boundingBox),"image"==e||"path"==e||"group"==e){if(-1===t.search("<svg ")){var p=t.split("?");t=d.source=p[0]}const e=(e,t,i,n={})=>{e?(t.originParams=s(t,n),e.setOptions(t),this.add(e),this.setElementOptions(t,e),e.originParams.angle=e.angle,e.originParams.z=e.getZIndex()):this.fire("imageFail",{url:t.source}),this.fire("elementAdd",{element:e})};if(void 0===t||0===t.length)return void console.log("No image source set for: "+i);if(-1!==t.search("<svg"))fabric.loadSVGFromString(t,((t,i)=>{var n=fabric.util.groupSVGElements(t,i);if(d.fill)d.svgFill||(d.svgFill=d.fill),delete d.fill;else if(!d.fill&&!d.svgFill){if(t){a.colors=[];for(var s=0;s<t.length;++s){var o=t[s].fill.length>0?tinycolor(t[s].fill).toHexString():"transparent";a.colors.push(o)}a.svgFill=a.colors}d.svgFill=a.svgFill}delete d.clippingRect,delete d.boundingBox,delete d.originParams,delete d.colors,delete d.svgFill,delete d.width,delete d.height,delete d.originX,delete d.originY,delete d.objectCaching,e(n,d,!0,{svgFill:a.svgFill})}));else if(t.split(".").includes("svg")){let i=Date.now().toString(),n=o(t)?new URL(FancyProductDesigner.proxyFileServer+t):t;!t.includes(".cloudfront.net/")&&!this.viewOptions.imageLoadTimestamp||FancyProductDesigner.proxyFileServer||n.searchParams.append("t",i),"object"==typeof n&&(n=n.toString()),fabric.loadSVGFromURL(n,((t,i)=>{var n=t?fabric.util.groupSVGElements(t,i):null;if(d.fill)d.svgFill||(d.svgFill=d.fill),delete d.fill;else if(!d.fill&&!d.svgFill){if(t){a.colors=[];for(var s=0;s<t.length;++s){var o=t[s].fill.length>0?tinycolor(t[s].fill).toHexString():"transparent";a.colors.push(o)}a.svgFill=a.colors}d.svgFill=a.svgFill}e(n,d,!0,{svgFill:a.svgFill})}))}else{let i,n=Date.now().toString();t.includes("data:image/")?i=t:(i=o(t)?new URL(FancyProductDesigner.proxyFileServer+t):t,this.viewOptions.imageLoadTimestamp&&!FancyProductDesigner.proxyFileServer&&i.searchParams.append("t",n),"object"==typeof i&&(i=i.toString())),new fabric.Image.fromURL(i,(function(t){t=""===t.getSrc()?null:t,e(t,d,!1)}),{crossOrigin:"anonymous"})}}else if(e.toLowerCase().includes("text")){var u;t=t.replace(/\\n/g,"\n"),a.text=a.text?a.text:t,d._initialText=a.hasOwnProperty("_initialText")?a._initialText:a.text,d.originParams={...a},a.originParams&&a.originParams.text&&(d.originParams.text=d._initialText),u=a.curved?new fabric.IText(t.replace(/(?:\r\n|\r|\n)/g,""),d):a.textBox?new fabric.Textbox(t,d):new fabric.IText(t,d),(d.textPlaceholder||d.numberPlaceholder)&&(d.textPlaceholder&&(this.textPlaceholder=u,d.removable=!1,d.editable=!1),d.numberPlaceholder&&(this.numberPlaceholder=u,d.removable=!1,d.editable=!1)),this.add(u),this.setElementOptions(d,u),u.originParams=s(u.toJSON(),u.originParams),delete u.originParams.clipTo,u.originParams.z=u.getZIndex(),this.fire("elementAdd",{element:u})}},fabric.Canvas.prototype.deselectElement=function(e=!0){this.currentBoundingObject&&(this.remove(this.currentBoundingObject),this.fire("boudingBoxToggle",{boundingBox:this.currentBoundingObject,state:!1}),this.currentBoundingObject=null),e&&this.discardActiveObject(),this.currentElement=null,this.renderAll().calcOffset(),this.fire("elementSelect",{element:null})},fabric.Canvas.prototype.resetSize=function(){const e=this.wrapperEl.parentNode.clientWidth;let t=e<this.viewOptions.stageWidth?e/this.viewOptions.stageWidth:1,i=t;this.responsiveScale=t;let n=this.viewOptions.stageHeight;if("auto"!==this.viewOptions.canvasHeight&&this.viewOptions.canvasHeight.includes("px")&&(n=parseInt(this.viewOptions.canvasHeight),this.responsiveScale=t*(n/this.viewOptions.stageHeight),i=1),!isNaN(this.viewOptions.maxCanvasHeight)&&1!==this.viewOptions.maxCanvasHeight){const e=window.innerHeight*parseFloat(this.viewOptions.maxCanvasHeight);n*i>e&&(this.responsiveScale=t*(e/this.viewOptions.stageHeight),n=e)}return this.responsiveScale=parseFloat(Number(this.responsiveScale.toFixed(7))),this.responsiveScale=Math.min(this.responsiveScale,1),this.viewOptions.responsive||(this.responsiveScale=1),this.setDimensions({width:t*this.viewOptions.stageWidth,height:this.viewOptions.stageHeight*this.responsiveScale}).setZoom(this.responsiveScale).calcOffset().renderAll(),this.fire("sizeUpdate",{responsiveScale:this.responsiveScale,canvasHeight:n*i}),this.responsiveScale},fabric.Canvas.prototype.resetZoom=function(){this.deselectElement(),this.zoomToPoint(new fabric.Point(0,0),this.responsiveScale),this.absolutePan(new fabric.Point(0,0))},fabric.Canvas.prototype.getElementByTitle=function(e){const t=this.getObjects();for(var i=0;i<t.length;++i)if(t[i].title===e)return t[i]},fabric.Canvas.prototype.getElementByID=function(e){const t=this.getObjects();for(var i=0;i<t.length;++i)if(t[i].id==e)return t[i];return!1},fabric.Canvas.prototype.reset=function(e=!0){this.elements=[],this.clear(),e&&this.wrapperEl.remove(),this.fire("clear")},fabric.Canvas.prototype.removeElement=function(e){"string"==typeof e&&(e=this.getElementByTitle(e)),this.deselectElement(),e.toggleUploadZone&&e.toggleUploadZone(),this.remove(e),this.fire("elementRemove",{element:e})},fabric.Canvas.prototype.getElementByReplace=function(e){const t=this.getObjects();for(var i=0;i<t.length;++i){const n=t[i];if(n.replace===e)return n}return null},fabric.Canvas.prototype.setElementOptions=function(e,t){if(!(t=void 0===t?this.getActiveObject():t)||void 0===e)return!1;"string"==typeof t&&(t=this.getElementByTitle(t));const i=t.getType();if("image"==i&&!t._isInitial&&!t._addToUZ&&1===t.scaleX){let i=null;if(r(t.resizeToW)&&r(t.resizeToH)){if(t.boundingBox){const e=t.getBoundingBoxCoords();i=y(t.width,t.height,e.width,e.height,t.scaleMode)}else if(this.viewOptions.fitImagesInCanvas){const e=3*t.cornerSize;(t.width*t.scaleX+e>this.viewOptions.stageWidth||t.height*t.scaleY+e>this.viewOptions.stageHeight)&&(i=y(t.width,t.height,this.viewOptions.stageWidth-e,this.viewOptions.stageHeight-e))}}else{let e=t.resizeToW,n=t.resizeToH;e=isNaN(e)?parseFloat(e)/100*this.viewOptions.stageWidth:parseInt(e),n=isNaN(n)?parseFloat(n)/100*this.viewOptions.stageHeight:parseInt(n),i=y(t.width,t.height,e,n,t.scaleMode)}null!==i&&(e=s(e,{scaleX:i,scaleY:i}))}if(Boolean(t._addToUZ)){e.z=-1;let i=this.getElementByTitle(t._addToUZ),n=1;"image"==t.getType()&&(n=y(t.width,t.height,i.width*i.scaleX,i.height*i.scaleY,i.scaleMode)),(e=s(e,{boundingBox:t._addToUZ,boundingBoxMode:"clipping",scaleX:n,scaleY:n,autoCenter:!0,removable:!0,zChangeable:!1,autoSelect:!1,copyable:!1,hasUploadZone:!0,z:this.getElementByTitle(t._addToUZ).getZIndex(),rotatable:i.rotatable,draggable:i.draggable,resizable:i.resizable,price:i.price?i.price:e.price,replace:t._addToUZ,lockUniScaling:i.lockUniScaling,uniScalingUnlockable:i.uniScalingUnlockable,advancedEditing:i.advancedEditing,originX:i.originX,originY:i.originY,angle:i.angle})).originParams=s(e.originParams,{boundingBox:e.boundingBox,replace:e.replace,rotatable:e.rotatable,draggable:e.draggable,resizable:e.resizable,lockUniScaling:e.lockUniScaling,uniScalingUnlockable:e.uniScalingUnlockable,price:e.price,scaleX:e.scaleX,scaleY:e.scaleY,hasUploadZone:!0,autoCenter:!0,originX:e.originX,originY:e.originY,angle:e.angle}),delete e[""],delete t._addToUZ}if(e.topped&&(e.zChangeable=!1),t.checkEditable(e)&&(e.isEditable=e.evented=e.selectable=!0),e.uploadZone&&!this.viewOptions.editorMode||(e.draggable&&(e.lockMovementX=e.lockMovementY=!1),e.rotatable&&(e.lockRotation=!1,e.hasRotatingPoint=!0),e.resizable&&(e.lockScalingX=e.lockScalingY=!1),(e.resizable||e.rotatable||e.removable)&&(e.hasControls=!0)),e.uploadZone&&(this.viewOptions.editorMode||(e.uploadZoneMovable&&(e.lockMovementX=e.lockMovementY=!1),e.uploadZoneRemovable&&(e.removable=!0,e.copyable=!1,e.hasControls=!0)),e.borderColor="transparent",e.excludeFromExport=!0),e.fixed&&h(e.replace)&&(e.replace=t.title),e.replace&&""!=e.replace){let i=this.getElementByReplace(e.replace);null!==i&&i!==t&&(e.z=i.getZIndex(),e.left=t.originParams.left=i.left,e.top=t.originParams.top=i.top,e.autoCenter=!1,this.viewOptions.applyFillWhenReplacing&&(e.fill=i.fill),this.removeElement(i))}if("string"==typeof e.text){let i=e.text;i=i.replace(FancyProductDesigner.forbiddenTextChars,""),this.initialElementsLoaded&&t.chargeAfterEditing&&(t._isPriced||(t._isPriced=!0),t._initialText===i&&t._isPriced&&(t._isPriced=!1))}if("text"===i){if(e.hasOwnProperty("textDecoration")&&(e.underline="underline"===e.textDecoration),void 0!==e.letterSpacing&&(e.charSpacing=100*e.letterSpacing),e.fontSize&&e.fontSize<t.minFontSize?e.fontSize=t.minFontSize:e.fontSize&&e.fontSize>t.maxFontSize&&(e.fontSize=t.maxFontSize),e.text){let e=t.text;"uppercase"===t.textTransform?e=e.toUpperCase():"lowercase"===t.textTransform&&(e=e.toLowerCase()),t.set("text",e)}if(e.textTransform){let i=t.text;"uppercase"===e.textTransform?i=i.toUpperCase():"lowercase"===e.textTransform&&(i=i.toLowerCase()),t.set("text",i)}if((e.shadowColor||e.shadowBlur||e.shadowOffsetX||e.shadowOffsetY)&&!t.shadow){let i={color:e.shadowColor?e.shadowColor:"rgba(0,0,0,0)"};t.setShadow(i)}t.shadow&&e.hasOwnProperty("shadowColor")&&(e.shadowColor?t.shadow.color=e.shadowColor:t.setShadow(null)),t.shadow&&(e.shadowBlur&&(t.shadow.blur=e.shadowBlur),e.shadowOffsetX&&(t.shadow.offsetX=e.shadowOffsetX),e.shadowOffsetY&&(t.shadow.offsetY=e.shadowOffsetY))}if(delete e.paths,t.setOptions(e),"i-text"==t.type&&t.widthFontSize&&t.text.length>0){let e;e=t.width>t.widthFontSize?t.fontSize*(t.widthFontSize/(t.width+1)):t.fontSize*(t.widthFontSize/(t.width-1)),e<t.minFontSize?e=t.minFontSize:e>t.maxFontSize&&(e=t.maxFontSize),e=parseInt(e),t.set("fontSize",e)}if((t.boundingBox&&"clipping"===e.boundingBoxMode||e.hasUploadZone)&&t._clipElement(),e.autoCenter&&t.centerElement(),void 0!==e.fill||void 0!==e.svgFill){const i=void 0!==e.svgFill?e.svgFill:e.fill;t.changeColor(i),t.pattern=void 0}void 0!==e.pattern&&t.setPattern(e.pattern),e.filter,t.canvas&&e.z>=0&&(t.moveTo(e.z),this._bringToppedElementsToFront()),t.curved&&(e.curveRadius&&t.setCurvedTextPath(),e.text&&(t.set("text",t.text.replace(/(?:\r\n|\r|\n)/g,"")),t.setCurvedTextPosition())),t.uploadZone?t.evented=0!==t.opacity:t.isEditable&&!this.viewOptions.editorMode&&(t.evented=!e.locked);for(var n=this.getObjects(),a=0;a<n.length;++a){var o=n[a];o.uploadZone&&o.title==e.replace&&(o.opacity=0,o.evented=!1)}t.setCoords(),this.renderAll().calcOffset(),t._checkContainment(),e.autoSelect&&t.isEditable&&!this.editorMode&&this.wrapperEl.offsetParent&&setTimeout((()=>{this.setActiveObject(t)}),200)},fabric.Canvas.prototype.duplicateElement=function(e){var t=e.getElementJSON();t.top=t.top+30,t.left=t.left+30,this.viewOptions.editorMode||(t.autoSelect=!0),this.addElement(e.getType(),e.source,"Copy "+e.title,t)},fabric.Canvas.prototype.getUploadZone=function(e){const t=this.getObjects();for(var i=0;i<t.length;++i)if(t[i].uploadZone&&t[i].title==e)return t[i]};class x extends EventTarget{static relevantOptions=["stageWidth","stageHeight","selectedColor","boundingBoxColor","outOfBoundaryColor","cornerIconColor","customAdds","elementParameters","imageParameters","textParameters","customImageParameters","customTextParameters","maxPrice","optionalView","designCategories","printingBox","output","layouts","usePrintingBoxAsBounding","threeJsPreviewModel","editorMode","imageLoadTimestamp","fitImagesInCanvas","inCanvasTextEditing","applyFillWhenReplacing","disableTextEmojis","cornerControlsStyle","responsive","canvasHeight","maxCanvasHeight","boundingBoxProps","highlightEditableObjects","multiSelection","multiSelectionColor"];totalPrice=0;truePrice=0;additionalPrice=0;viewData;onCreatedCallback;title;thumbnail;options;canvasElem=null;fabricCanvas=null;constructor(t,i={},n,a={}){super(),this.viewData=i,this.onCreatedCallback=n,this.title=i.title,this.thumbnail=i.thumbnail,this.options=i.options;const o=this.options.selectedColor;fabric.Object.prototype.borderColor=o,fabric.Object.prototype.cornerColor=o,fabric.Object.prototype.cornerIconColor=this.options.cornerIconColor,a=s({containerClass:"fpd-view-stage fpd-hidden",selection:this.options.multiSelection,selectionBorderColor:this.options.multiSelectionColor,selectionColor:tinycolor(this.options.multiSelectionColor).setAlpha(.1).toRgbString(),hoverCursor:"pointer",controlsAboveOverlay:!0,centeredScaling:!0,allowTouchScrolling:!0,preserveObjectStacking:!0},a),this.fabricOptions=a,this.canvasElem=document.createElement("canvas"),t.append(this.canvasElem),this.fabricCanvas=new fabric.Canvas(this.canvasElem,a),this.fabricCanvas.viewOptions=this.options,this.fabricCanvas.setDimensions({width:this.options.stageWidth,height:this.options.stageHeight}),this.fabricCanvas.on({imageFail:({url:t})=>{e(`\n                    <p>The image with the URL<br /><i style='font-size: 10px;'>${t}</i><br />can not be loaded into the canvas.</p>\n                    <p><b>Troubleshooting</b>\n                        <ul>\n                            <li>The URL is not correct!</li>\n                            <li>The image has been blocked by <a href='https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS' target='_blank'>CORS policy</a>. You need to host the image under the same protocol and domain or enable 'Access-Control-Allow-Origin' on the server where you host the image. <a href='http://enable-cors.org/' target='_blank'>Read more about it here.</a><\n                            /li>\n                        </ul>\n                    </p>\n                `)}})}init(){this.loadElements(this.viewData.elements,this.#e.bind(this))}loadElements(e,t){this.fabricCanvas.initialElementsLoaded&&this.fabricCanvas.reset(!1),this.fabricCanvas.offHistory(),this.fabricCanvas.addElements(e,t)}#e(){this.onCreatedCallback(this);let e=null;this.fabricCanvas.on({"mouse:up":e=>{},"object:moving":t=>{e="moving",t.target.lockMovementX&&t.target.lockMovementY||this.options.smartGuides},"object:modified":t=>{const i=t.target;if(null!==e){let t={};switch(e){case"moving":t.left=Number(i.left),t.top=Number(i.top);break;case"scaling":"text"!==i.getType()||"curvedText"===i.type||i.uniScalingUnlockable?(t.scaleX=parseFloat(i.scaleX),t.scaleY=parseFloat(i.scaleY)):t.fontSize=parseInt(i.fontSize);break;case"rotating":t.angle=i.angle}this.dispatchEvent(new CustomEvent("elementModify",{detail:{element:i,properties:t}}))}e=null}}),this.dispatchEvent(new CustomEvent("priceChange",{detail:{elementPrice:0,truePrice:this.truePrice}}))}}window.FancyProductDesigner=x;class E{static parseFontsToEmbed(e){var t="";if(e.hasOwnProperty("url")){e.name;var i=-1!==e.url.search(".woff")?"woff":"TrueType",n=FancyProductDesigner.proxyFileServer+e.url;if(t+='@font-face {font-family:"'+e.name+'"; font-style: normal; font-weight: normal; src:url("'+n+'") format("'+i+'");}\n',e.variants){for(const s in e.variants)n=FancyProductDesigner.proxyFileServer+e.variants[s],t+='@font-face {font-family:"'+e.name+'"; '+{n7:"font-style: normal; font-weight: bold;",i4:"font-style: italic; font-weight: normal;",i7:"font-style: italic; font-weight: bold;"}[s]+' src:url("'+n+'") format("'+i+'");}\n';Object.keys(e.variants).toString()}}return t}static load(e,t){const i=e.mainOptions.fonts;if(i&&i.length>0&&"object"==typeof i[0]){i.sort(((e,t)=>{let i=e.name.toUpperCase(),n=t.name.toUpperCase();return i<n?-1:i>n?1:0}));let a=[],o=[],r=0;const l=document.createElement("style");l.id="fpd-fonts",e.container.before(l),i.forEach((e=>{if(e.hasOwnProperty("url"))if("google"==e.url)a.push(e.name+":400,400i,700,700i");else{var t=e.name;t+=":n4",e.variants&&(t+=","+Object.keys(e.variants).toString()),o.push(t),l.append(this.parseFontsToEmbed(e))}}));var n=function(e,i,n){"inactive"==e&&console.log(i+" font could not be loaded."),r==a.length+o.length-1&&t(),r++},s={fontactive:function(e,t){n("active",e)},fontinactive:function(e,t){n("inactive",e)},timeout:3e3};a.length>0&&(s.google={families:a}),o.length>0&&(s.custom={families:o}),"undefined"!=typeof WebFont&&(a.length>0||o.length>0)?WebFont.load(s):t()}else t()}}const w=e=>{let t=e.url;e.params&&(t+="?"+new URLSearchParams(e.params).toString());const i=new XMLHttpRequest;return i.responseType="json",i.open("GET",t),i.onreadystatechange=t=>{4==i.readyState&&200==i.status?e.onSuccess&&e.onSuccess(i.response):200!==i.status&&e.onError&&e.onError(i)},i.send(),i};class I extends EventTarget{langJSON=null;constructor(){super()}loadLangJSON(e=null,t=(()=>{})){!1!==e?"object"==typeof e?(this.langJSON=e,t.call(this)):w({url:e,onSuccess:e=>{this.langJSON=e,t.call(this)},onError:i=>{alert('Language JSON "'+e+'" could not be loaded or is not valid. Make sure you set the correct URL in the options and the JSON is valid!'),t.call(this)}}):t.call(this)}translateElement(e){let t="";if(this.langJSON){let s="";s=e.getAttribute("placeholder")?e.getAttribute("placeholder"):e.getAttribute("title")?e.getAttribute("title"):e.dataset.title?e.dataset.title:e.innerText;var i=s.split("."),n=this.langJSON[i[0]];n?(t=n[i[1]],void 0===t&&(t=e.dataset.defaulttext)):t=e.dataset.defaulttext}else t=e.dataset.defaulttext;return e.getAttribute("placeholder")?(e.setAttribute("placeholder",t),e.innerText=""):e.getAttribute("title")?e.setAttribute("title",t):e.dataset.title?e.dataset.title=t:e.innerText=t,t}getTranslation(e,t,i=""){return this.langJSON&&(e=this.langJSON[e])&&e[t]?e[t]:i}}class D extends HTMLElement{placeholder="";value="";searchable=!1;constructor(){super(),this.innerHTML='<input type="text" class="fpd-dropdown-current"/> <div class="fpd-dropdown-arrow"><span class="fpd-icon-arrow-dropdown"></span></div> <div class="fpd-dropdown-list"> <div class="fpd-scroll-area"></div> </div> '}connectedCallback(){this.addEventListener("click",(()=>{this.classList.toggle("fpd-active")})),this.querySelector(".fpd-dropdown-arrow").addEventListener("click",(e=>{e.stopPropagation(),this.classList.toggle("fpd-active")})),this.querySelector("input.fpd-dropdown-current").addEventListener("keyup",(e=>{if(this.searchable){const t=e.currentTarget.value;this.querySelectorAll(".fpd-dropdown-list .fpd-item").forEach((e=>{0==t.length?e.classList.remove("fpd-hidden"):e.classList.toggle("fpd-hidden",!e.innerText.toLowerCase().includes(t.toLowerCase()))}))}}))}static get observedAttributes(){return["searchable","placeholder","value"]}attributeChangedCallback(e,t,i){t!==i&&("placeholder"===e?this.querySelector("input.fpd-dropdown-current").setAttribute("placeholder",i):"value"===e?this.querySelector("input.fpd-dropdown-current").value=i:"searchable"===e&&(this.searchable=this.hasAttribute("searchable")))}}customElements.define("fpd-dropdown",D);class S extends HTMLElement{constructor(){super()}connectedCallback(){const e=document.createElement("template");e.innerHTML='<div class="fpd-navigation fpd-scrollbar-hidden"></div> <div class="fpd-module-content"></div> <div class="fpd-secondary-content"> <div class="fpd-upload-zone-panel"> <div class="fpd-upload-zone-content"></div> <div class="fpd-bottom-nav fpd-module-tabs"> <div class="fpd-add-image" data-module="images"> <span class="fpd-icon-photo"></span> </div> <div class="fpd-add-text" data-module="text"> <span class="fpd-icon-text-secondary"></span> </div> <div class="fpd-add-design" data-module="designs"> <span class="fpd-icon-design-library"></span> </div> </div> </div> </div> <div class="fpd-close-off-canvas"> <span class="fpd-icon-close"></span> </div> <div class="fpd-draggable-dialog fpd-container fpd-shadow-2"> <div class="fpd-dialog-head"> <div class="fpd-dialog-drag-handle"> <div> <span class="fpd-icon-drag"></span><span class="fpd-dialog-title"></span> </div> </div> <div class="fpd-close-dialog"> <span class="fpd-icon-close"></span> </div> </div> </div> ',this.append(e.content.cloneNode(!0))}}customElements.define("fpd-main-bar",S);class O extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-grid" data-defaulttext="Swap Product" data-title="modules.products"> <fpd-dropdown class="fpd-product-categories" searchable></fpd-dropdown> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-contain fpd-padding"> </div> </div> </div>'}}customElements.define("fpd-module-products",O);class T extends EventTarget{currentCategoryIndex=0;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-products"),t.append(this.container),e.addEventListener("productsSet",(e=>{const t=this.container.querySelector(".fpd-dropdown-list > .fpd-scroll-area");t.innerHTML="",this.fpdInstance.products&&this.fpdInstance.products.length>0&&(void 0!==this.fpdInstance.products[0].category&&this.fpdInstance.products.length>1&&(this.container.classList.add("fpd-categories-enabled"),this.fpdInstance.products.forEach(((e,i)=>{const n=document.createElement("span");n.className="fpd-item",n.dataset.index=i,n.innerText=e.category,n.addEventListener("click",(e=>{this.selectCategory(e.currentTarget.dataset.index)})),t.append(n)}))),this.#t(),this.selectCategory(0))})),e.addEventListener("productAdd",((e,t,i,n)=>{n==this.currentCategoryIndex&&this.#i(t)}))}#t(){if(this.fpdInstance.mainOptions.editorMode)return;let e=this.fpdInstance.products[0],t=void 0===e;void 0!==e&&(t=!!(!e.hasOwnProperty("category")&&this.fpdInstance.products.length<2||e.hasOwnProperty("category")&&e.products.length<2&&this.fpdInstance.products.length<2)),this.fpdInstance.container.classList.toggle("fpd-products-module-hidden",t)}#i(t,i){let n=t[0].productThumbnail?t[0].productThumbnail:t[0].thumbnail,s=t[0].productTitle?t[0].productTitle:t[0].title;const a=document.createElement("div");a.className="fpd-item fpd-hover-thumbnail",a.dataset.title=s,a.dataset.source=n,a.dataset.index=i,a.addEventListener("click",(t=>{if(t.preventDefault(),this.fpdInstance.mainOptions.swapProductConfirmation){var n=e(this.fpdInstance.translator.getTranslation("modules","products_confirm_replacement"),!1,"confirm",this.fpdInstance.container);const t=n.querySelector(".fpd-confirm");t.innerText=this.fpdInstance.translator.getTranslation("modules","products_confirm_button"),l(t,["click"],(()=>{this.fpdInstance.selectProduct(i,this.currentCategoryIndex),n.remove()}))}else this.fpdInstance.selectProduct(Number(t.currentTarget.dataset.index),this.currentCategoryIndex)})),this.container.querySelector(".fpd-grid").append(a);const o=document.createElement("picture");o.dataset.img=n,a.append(o),this.fpdInstance.lazyBackgroundObserver.observe(o)}selectCategory(e=0){if(this.currentCategoryIndex=e,this.container.querySelector(".fpd-grid").innerHTML="",this.fpdInstance.products&&this.fpdInstance.products.length>0){let t;void 0!==this.fpdInstance.products[0].category?(t=this.fpdInstance.products[e].products,this.container.querySelector(".fpd-dropdown-current").value=this.fpdInstance.products[e].category):t=this.fpdInstance.products.products,t.forEach(((e,t)=>{this.#i(e,t)}))}}}class L extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-text-secondary" data-defaulttext="Add Text" data-title="modules.text"> <div class="fpd-add-text"> <textarea data-defaulttext="Enter some text" placeholder="modules.text_input_placeholder"></textarea> <div class="fpd-btn"> <span data-defaulttext="Add Text">modules.text_add_btn</span> <span class="fpd-price"></span> </div> </div> <div class="fpd-text-templates fpd-scroll-area"> <div class="fpd-grid"></div> </div> </div>'}}customElements.define("fpd-module-text",L);class k extends EventTarget{constructor(e,t){if(super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-text"),t.append(this.container),this.container.querySelector(".fpd-btn").addEventListener("click",(t=>{let i=this.container.querySelector("textarea"),n=i.value;if(e.currentViewInstance&&n.length>0){const t=e.currentViewInstance.options;let i=s(t.customTextParameters,{textBox:!0,resizable:!0,isCustom:!0,_addToUZ:e.currentViewInstance.currentUploadZone,_calcWidth:!0});e.currentViewInstance.fabricCanvas.addElement("text",n,n,i)}i.value=""})),l(this.container.querySelector("textarea"),["input","change"],(t=>{const i=e.currentViewInstance.options;let n=t.currentTarget.value,s=i.customTextParameters.maxLength,a=i.customTextParameters.maxLines;n=n.replace(FancyProductDesigner.forbiddenTextChars,""),e.mainOptions.disableTextEmojis&&(n=n.replace(FPDEmojisRegex,""),n=n.replace(String.fromCharCode(65039),"")),0!=s&&n.length>s&&(n=n.substr(0,s)),0!=a&&n.split("\n").length>a&&(n=n.replace(/([\s\S]*)\n/,"$1")),t.currentTarget.value=n})),l(e,["viewSelect","secondaryModuleCalled"],(t=>{if(!e.currentViewInstance)return;const i=e.currentViewInstance.options;let n=null;if(e.currentViewInstance.currentUploadZone&&this.container.parentNode.classList.contains("fpd-upload-zone-content")){const t=e.currentViewInstance.fabricCanvas.getUploadZone(e.currentViewInstance.currentUploadZone);a(t,"price")&&(n=t.price)}const s=a(i,"customTextParameters.price",0);null==n&&s&&(n=s);const o=this.container.querySelector(".fpd-btn > .fpd-price");o&&(o.innerHTML=n?" - "+e.formatPrice(n):"")})),Array.isArray(e.mainOptions.textTemplates)){var i=this.container.querySelector(".fpd-text-templates .fpd-grid");e.mainOptions.textTemplates.forEach((t=>{var n=t.properties,a="font-family:"+(n.fontFamily?n.fontFamily:"Arial");a+="; text-align:"+(n.textAlign?n.textAlign:"left");const o=document.createElement("div");o.className="fpd-item",o.addEventListener("click",(i=>{if(e.currentViewInstance){const i=e.currentViewInstance.options;let n={...t.properties};n.isCustom=!0,n.textBox=!0,n.resizable=!0,n._addToUZ=e.currentViewInstance.currentUploadZone,n._calcWidth=!0;let a=s(i.customTextParameters,n);e.currentViewInstance.fabricCanvas.addElement("text",t.text,t.text,a)}}));const r=document.createElement("div");r.setAttribute("style",a),r.innerHTML=t.text.replace(/(?:\r\n|\r|\n)/g,"<br>"),o.append(r),i.append(o)}))}}}class P extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-design-library" data-defaulttext="Add Designs" data-title="modules.designs"> <div class="fpd-head"> <div class="fpd-input-back-search"> <div class="fpd-back fpd-btn"> <span class="fpd-icon-back"></span> </div> <div class="fpd-input-search"> <input type="text"/> <span class="fpd-icon-magnify"></span> </div> </div> </div> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-contain"></div> </div> </div>'}}customElements.define("fpd-module-designs",P);class F extends EventTarget{#n="";#s=!1;#a=[];#o=null;#r=null;constructor(e,t,i=null){super(),this.#n=e.translator.getTranslation("modules","designs_search_in").toUpperCase(),this.fpdInstance=e,this.#r=i,this.container=document.createElement("fpd-module-designs"),t.append(this.container),i&&(this.container.dataset.dynamicDesignsId=i),this.headElem=this.container.querySelector(".fpd-head"),this.gridElem=this.container.querySelector(".fpd-grid"),this.headElem.querySelector(".fpd-input-search input").addEventListener("keyup",(e=>{const t=e.currentTarget,i=this.gridElem.querySelectorAll(".fpd-item");if(""==t.value)for(let e of i)e.classList.remove("fpd-hidden");else{const e=t.value.toLowerCase().trim();for(let t of i)t.classList.add("fpd-hidden"),t.dataset.search.includes(e)&&t.classList.remove("fpd-hidden")}})),l(this.headElem.querySelector(".fpd-back"),"click",(e=>{this.gridElem.querySelectorAll(".fpd-category").length>0&&this.#a.pop();let t,i=this.fpdInstance.designs;this.#a.forEach((e=>{t=i[e],i=t.category})),this.#o=i,i&&this.#l(this.#o,t),void 0===t&&this.toggleCategories()})),l(e,"designsSet",(t=>{const i=e.designs;Array.isArray(i)&&0!==i.length&&(i[0].hasOwnProperty("source")?(this.container.classList.add("fpd-single-cat"),this.#c(i)):i.length>1||i[0].category?(this.#s=!0,this.toggleCategories()):1===i.length&&i[0].designs&&(this.container.classList.add("fpd-single-cat"),this.#c(i[0].designs)))})),l(e,"viewSelect",(()=>{this.toggleCategories()}))}#l(e,t){this.gridElem.innerHTML="",this.gridElem.classList.remove("fpd-padding"),this.headElem.querySelector(".fpd-input-search input").value="",this.container.classList.remove("fpd-designs-active"),this.container.classList.add("fpd-categories-active"),e.forEach(((e,t)=>{this.#d(e)})),t&&(this.headElem.querySelector(".fpd-input-search input").setAttribute("placeholder",this.#n+" "+t.title.toUpperCase()),this.container.classList.add("fpd-head-visible"))}#d(e){const t=document.createElement("div");if(t.className="fpd-category fpd-item",t.dataset.title=e.title,t.dataset.search=e.title.toLowerCase(),e.thumbnail){const i=document.createElement("picture");i.dataset.img=e.thumbnail,t.append(i),this.fpdInstance.lazyBackgroundObserver.observe(i);const n=document.createElement("span");n.innerText=e.title,t.append(n)}else t.innerHTML="<span>"+e.title+"</span>";t.addEventListener("click",(e=>{let t=e.currentTarget,i=Array.from(this.gridElem.querySelectorAll(".fpd-item")).indexOf(t),n=this.#o[i];n.category?(this.#a.push(i),this.#o=n.category,this.#l(this.#o,n)):this.#c(n.designs,n.parameters),this.headElem.querySelector(".fpd-input-search input").setAttribute("placeholder",this.#n+" "+t.dataset.search.toUpperCase())})),this.gridElem.append(t)}#c(e,t={}){this.gridElem.innerHTML="",this.gridElem.classList.add("fpd-padding"),this.headElem.querySelector(".fpd-input-search input").value="",this.container.classList.remove("fpd-categories-active"),this.container.classList.add("fpd-designs-active","fpd-head-visible"),e.forEach((e=>{e.parameters=s(t,e.parameters),this.#p(e)}))}#p(e){e.thumbnail=void 0===e.thumbnail?e.source:e.thumbnail;const t=f({url:e.source,thumbnailUrl:e.thumbnail,title:e.title,price:m(this.fpdInstance,this.container,e.parameters.price)});t.dataset.search=e.title.toLowerCase(),t.parameters=e.parameters,t.addEventListener("click",(e=>{const t=e.currentTarget;this.fpdInstance.addCanvasDesign(t.dataset.source,t.dataset.title,t.parameters)})),this.gridElem.append(t),this.fpdInstance.lazyBackgroundObserver.observe(t.querySelector("picture"))}toggleCategories(){if(!this.#s)return;this.#a=[],this.container.classList.remove("fpd-head-visible","fpd-single-cat"),this.#o=this.fpdInstance.designs,this.#l(this.#o);let e=[];if(this.#r&&(e=this.fpdInstance.mainOptions.dynamicDesigns[this.#r].categories),this.fpdInstance.currentViewInstance){const t=this.fpdInstance.currentElement;e=t&&t.uploadZone&&t.designCategories?this.fpdInstance.currentElement.designCategories:this.fpdInstance.currentViewInstance.options.designCategories}var t=this.container.querySelectorAll(".fpd-category");if(e.length>0){let i=[];for(let n of t)e.includes(n.dataset.title)?(n.classList.remove("fpd-hidden"),i.push(n)):n.classList.add("fpd-hidden");1===i.length&&(this.container.classList.add("fpd-single-cat"),i[0].click())}else for(let e of t)e.classList.remove("fpd-hidden")}}class A extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-design-library" data-defaulttext="Text to Image" data-title="modules.text_to_image"> <div class="fpd-head"> <textarea></textarea> <div class="fpd-btn"> <span data-defaulttext="Generate">modules.text_to_image_generate</span> </div> </div> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover"></div> </div> </div>'}}customElements.define("fpd-module-text-to-image",A);class _ extends EventTarget{#u="https://radykal.dep/fpd-js/server/php/sd-api.php";#h=!1;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-text-to-image"),t.append(this.container),this.inputElem=this.container.querySelector(".fpd-head textarea"),this.gridElem=this.container.querySelector(".fpd-grid"),this.container.querySelector(".fpd-head .fpd-btn").addEventListener("click",(e=>{const t=e.currentTarget;if(!h(this.inputElem.value)&&!this.#h){this.#h=!0,t.classList.add("fpd-loading");let e={action:"text2img",prompt:this.inputElem.value,numOfImg:2};fetch(this.#u,{method:"POST",redirect:"follow",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{(e=JSON.parse(e))&&e.output&&this.#g(e.output),this.#h=!1,t.classList.remove("fpd-loading")})).catch((e=>{this.#h=!1,t.classList.remove("fpd-loading")}))}}))}#g(e=[]){e.forEach((e=>{const t=document.createElement("div");t.className="fpd-item",t.dataset.source=e,t.innerHTML='<picture data-img="'+e+'"></picture><span class="fpd-price"></span>',this.gridElem.append(t),t.addEventListener("click",(e=>{const t=e.currentTarget;this.fpdInstance._addCanvasDesign(t.dataset.source,t.dataset.title,t.dataset.parameters)})),this.fpdInstance.lazyBackgroundObserver.observe(t.querySelector("picture"))}))}}class B extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-photo" data-defaulttext="Add Image" data-title="modules.images"> <div class="fpd-module-tabs"> <div data-context="upload" class="fpd-active"> <span class="fpd-icon-cloud-upload"></span> </div> <div data-context="facebook" class="fpd-hidden" title="Facebook"> <span class="fpd-icon-facebook"></span> </div> <div data-context="instagram" class="fpd-hidden" title="Instagram"> <span class="fpd-icon-instagram"></span> </div> <div data-context="pixabay" class="fpd-hidden" title="Pixabay"> <span class="fpd-icon-pixabay"></span> </div> <div data-context="qr-code" title="QR-Code"> <span class="fpd-icon-qrcode"></span> </div> </div> <div class="fpd-module-tabs-content"> <div data-context="upload" class="fpd-active"></div> <div data-context="facebook"></div> <div data-context="instagram"></div> <div data-context="pixabay"></div> <div data-context="qr-code"></div> </div> </div>'}}customElements.define("fpd-module-images",B);class M extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-upload-image"> <div> <span class="fpd-icon-file-upload"></span> <span data-defaulttext="Click or drop images here">modules.upload_zone</span> <span class="fpd-price"></span> </div> </div> <input type="file" multiple="multiple" class="fpd-upload-input fpd-hidden" name="files[]" accept="image/jpeg,image/jpg,image/png,image/svg+xml,application/pdf"/> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover fpd-photo-grid"></div> </div>'}}customElements.define("fpd-module-uploads",M);const j=(e="",t=!0)=>{let i=document.body.querySelector(".fpd-snackbar-wrapper");i||(i=document.createElement("div"),i.className="fpd-snackbar-wrapper",document.body.append(i));const n=document.createElement("div");return n.className="fpd-snackbar fpd-shadow-1",n.innerHTML="<p>"+e+"</p>",n.addEventListener("click",(e=>{n.remove()})),i.append(n),t&&setTimeout((function(){n.remove()}),5e3),n};class U extends EventTarget{#f;#m=0;#v=!1;#b=[];#y=0;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-uploads"),t.append(this.container),this.gridElem=this.container.querySelector(".fpd-grid");const i=this.container.querySelector(".fpd-upload-image");this.#f=e.mainOptions.allowedImageTypes,this.#f.includes("jpeg")&&!this.#f.includes("jpg")&&this.#f.push("jpg");const n=this.container.querySelector(".fpd-upload-input");let s=[];if(this.#f.forEach((e=>{"pdf"==e?s.push("application/pdf"):("svg"==e&&(e+="+xml"),s.push("image/"+e))})),n.setAttribute("accept",s.join()),l(i,"click",(async e=>{e.preventDefault(),n.click()})),l(n,"change",(e=>{this.#C(e.currentTarget.files)})),l(i,["dragover","dragleave"],(e=>{e.stopPropagation(),e.preventDefault(),e.currentTarget.classList.toggle("fpd-hover","dragover"===e.type)})),l(i,"drop",(e=>{e.stopPropagation(),e.preventDefault();const t=e.target.files||e.dataTransfer.files;this.#C(t)})),l(e,"productCreate",(e=>{this.#v=!1})),g&&window.localStorage.getItem("fpd_uploaded_images")){const e=JSON.parse(window.localStorage.getItem("fpd_uploaded_images"));e.forEach((t=>{this.#x(t.url,t.title);var i=new Image;i.src=t.url,i.onerror=function(){var t=null;e.forEach((function(e,n){e.url==i.src&&(t=n)})),null!=t&&(e.splice(t,1),window.localStorage.setItem("fpd_uploaded_images",JSON.stringify(e)))}}))}}#C(t){if(this.fpdInstance.mainOptions.uploadAgreementModal){var i=e(this.fpdInstance.translator.getTranslation("modules","images_agreement"),!1,"confirm",this.fpdInstance.container);const n=i.querySelector(".fpd-confirm");n.innerText=this.fpdInstance.translator.getTranslation("modules","images_confirm_button"),l(n,["click"],(()=>{this.#E(t),i.remove()}))}else this.#E(t)}#E(e){this.#m=0,this.#y=e.length,this.fpdInstance.loadingCustomImage=!0,Array.from(e).forEach(((e,t)=>{this.#f.includes(e.name.split(".").pop().toLowerCase().split("?")[0])&&this.#w(e,0==t)})),this.container.querySelector(".fpd-upload-image").classList.remove("fpd-hover")}#w(e,t){const i=1024*this.fpdInstance.mainOptions.customImageParameters.maxSize*1024;if(e.size>i)return j(this.fpdInstance.translator.getTranslation("misc","maximum_size_info").replace("%filename",e.name).replace("%mb",this.fpdInstance.mainOptions.customImageParameters.maxSize)),void(this.fpdInstance.loadingCustomImage=!1);"application/pdf"===e.type?this.#I(e,t):this.#D(e,t)}#D(t,i=!1){const n=this.fpdInstance.mainOptions,s=new FileReader;s.onload=s=>{const a=s.currentTarget.result;if("image/jpeg"===t.type&&n.customImageParameters.minDPI){const i=new JpegMeta.JpegFile(atob(a.replace(/^.*?,/,"")),t.name);let s=null;if(i.tiff&&i.tiff.XResolution&&i.tiff.XResolution.value){var o=i.tiff.XResolution.value.den;s=i.tiff.XResolution.value.num/o}else i.jfif&&i.jfif.Xdensity&&i.jfif.Xdensity.value&&(s=i.jfif.Xdensity.value);if(null!==s){if(console.log(t.name+" Real Resolution: "+s),s<n.customImageParameters.minDPI){let t=this.fpdInstance.translator.getTranslation("misc","minimum_dpi_info");return t=t.replace("%dpi",n.customImageParameters.minDPI),e(t,!1,"",this.fpdInstance.container),this.fpdInstance.loadingCustomImage=!1,!1}}else console.log(t.name+": Resolution is not accessible.")}const r=this.#x(a,t.name);this.fpdInstance.uploadsToServer&&(r.classList.add("fpd-loading"),r.insertAdjacentHTML("beforeend",'<div class="fpd-loading-bar"><div class="fpd-loading-progress"></div></div>'));var l=new Image;l.onload=e=>{const n=e.currentTarget;let s=n.height,a=n.width;if(this.fpdInstance.currentViewInstance.options.customImageParameters,v(this.fpdInstance,a,s))if(this.fpdInstance.uploadsToServer){var o=new FormData;o.append("uploadsDir",this.fpdInstance.uploadsDir),o.append("uploadsDirURL",this.fpdInstance.uploadsDirURL),o.append("images[]",t);const e=new XMLHttpRequest;e.responseType="json",e.onreadystatechange=t=>{if(e.readyState===XMLHttpRequest.DONE){const t=e.status;if(0===t||t>=200&&t<400){const t=e.response;t.image_src&&(this.#S(t.image_src,t.filename),r.dataset.source=t.image_src,r.classList.remove("fpd-loading"),r.querySelector(".fpd-loading-bar").remove(),this.#O(r,i),this.#m++,r.xhr=null),this.fpdInstance.loadingCustomImage=!1}}},e.upload.onprogress=e=>{let t=e.total,i=e.loaded,n=parseInt(100*i/t);r.querySelector(".fpd-loading-progress").style.width=n+"%"},e.upload.onerror=e=>{this.fpdInstance.loadingCustomImage=!1,r.remove(),j("Upload failed. Please try again or check your web console!")},e.open("POST",this.fpdInstance.uploadsURL),e.send(o),r.xhr=e}else this.#S(n,t.name),this.#O(r,i),this.#m++;else r.remove(),this.fpdInstance.currentViewInstance.currentUploadZone=null},l.src=a},s.readAsDataURL(t)}#I(e,t=!1){this.fpdInstance.mainOptions;const i=j(this.fpdInstance.translator.getTranslation("modules","images_pdf_upload_info"),!1),n=new FormData;n.append("uploadsDir",this.fpdInstance.uploadsDir),n.append("uploadsDirURL",this.fpdInstance.uploadsDirURL),n.append("pdf",e);const s=new XMLHttpRequest;s.responseType="json",s.onreadystatechange=e=>{if(s.readyState===XMLHttpRequest.DONE){const e=s.status;if(0===e||e>=200&&e<400){const e=s.response;this.#y--,e.pdf_images.forEach(((e,t)=>{const i=this.#x(e.image_url,e.filename);this.#O(i,0==t),this.#S(e.image_url,e.filename),this.#m++})),i.remove(),this.#y++,this.fpdInstance.loadingCustomImage=!1}}},s.upload.onerror=()=>{this.fpdInstance.loadingCustomImage=!1,i.remove(),j("Upload failed. Please try again or check your web console!")},s.open("POST",this.fpdInstance.uploadsURL),s.send(n)}#S(e,t){if(g){var i=window.localStorage.getItem("fpd_uploaded_images")?JSON.parse(window.localStorage.getItem("fpd_uploaded_images")):[],n={url:e,title:t};i.push(n),window.localStorage.setItem("fpd_uploaded_images",JSON.stringify(i))}}#x(e,t){const i=f({url:e,title:t,price:m(this.fpdInstance,this.container),removable:!0});return this.#T(i,e),this.gridElem.append(i),this.fpdInstance.lazyBackgroundObserver.observe(i.querySelector("picture")),l(i,["click"],(e=>{this.fpdInstance.loadingCustomImage||this.fpdInstance._addGridItemToCanvas(e.currentTarget)})),l(i.querySelector(".fpd-delete"),"click",(e=>{e.stopPropagation(),e.preventDefault();const t=Array.from(this.gridElem.children).indexOf(i);if(!i.classList.contains("fpd-loading")){var n=JSON.parse(window.localStorage.getItem("fpd_uploaded_images"));n.splice(t,1),window.localStorage.setItem("fpd_uploaded_images",JSON.stringify(n)),i.xhr&&i.xhr.abort(),i.remove()}})),i}#O(e,t){if(!this.#v&&this.fpdInstance.mainOptions.autoFillUploadZones){const t=this.#b[this.#m]?this.#b[this.#m]:null;t&&this.fpdInstance._addGridItemToCanvas(e,{_addToUZ:t.uz},t.viewIndex)}else t&&this.fpdInstance._addGridItemToCanvas(e);this.#m==this.#y-1&&(this.#v=!0)}#T(e,t){const i=this.fpdInstance.mainOptions.imageQualityRatings;if(i&&"object"==typeof i){let n=i.low?i.low:null,s=i.mid?i.mid:null,a=i.high?i.high:null,o="fpd-icon-star",r="fpd-icon-star-outline";const l=new Image;l.onload=()=>{const t=document.createElement("div");let i;if(t.className="fpd-image-quality-ratings",e.append(t),n&&2==n.length){const e=l.width<Number(n[0])||l.height<Number(n[1])?r:o,s=document.createElement("span");s.className=e,t.append(s),e==o&&(i=this.fpdInstance.translator.getTranslation("misc","image_quality_rating_low"))}if(s&&2==s.length){const e=l.width<Number(s[0])||l.height<Number(s[1])?r:o,n=document.createElement("span");n.className=e,t.append(n),e==o&&(i=this.fpdInstance.translator.getTranslation("misc","image_quality_rating_mid"))}if(a&&2==a.length){const e=l.width<Number(a[0])||l.height<Number(a[1])?r:o,n=document.createElement("span");n.className=e,t.append(n),e==o&&(i=this.fpdInstance.translator.getTranslation("misc","image_quality_rating_high"))}i&&(t.dataset.qualityLabel=i)},l.src=t}}}class q extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-head"> <div class="fpd-facebook-login"> <fb:login-button data-max-rows="1" data-show-faces="false" data-scope="user_photos"> </fb:login-button> </div> <fpd-dropdown class="fpd-facebook-albums" placeholder="Select An Album" searchable></fpd-dropdown> </div> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover fpd-photo-grid"></div> </div>'}}customElements.define("fpd-module-facebook-images",q);class N extends EventTarget{constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-facebook-images"),t.append(this.container),this.dropdown=this.container.querySelector("fpd-dropdown"),this.dropdownList=this.container.querySelector(".fpd-dropdown-list"),this.gridElem=this.container.querySelector(".fpd-grid"),this.#L()}#L(){const e=document.createElement("script");e.src="//connect.facebook.com/en_US/sdk.js",e.addEventListener("load",(()=>{FB.init({appId:this.fpdInstance.mainOptions.facebookAppId,autoLogAppEvents:!0,xfbml:!0,version:"v16.0"}),FB.getLoginStatus(this.#k.bind(this)),FB.Event.subscribe("auth.statusChange",this.#k.bind(this))})),document.body.appendChild(e)}#k(e){"connected"===e.status&&(c(this.container,["fpd-facebook-logged-in"]),FB.api("/me/albums?fields=name,count,id",(e=>{const t=e.data;t&&t.forEach((e=>{const t=document.createElement("span");t.className="fpd-item",t.dataset.albumid=e.id,t.innerText=e.name,t.addEventListener("click",(e=>{this.dropdown.setAttribute("value",e.currentTarget.innerText),this.#P(e.currentTarget.dataset.albumid)})),this.dropdownList.append(t)})),d(this.dropdown,["fpd-on-loading"])})))}#P(e){this.gridElem.innerHTML="",c(this.dropdown,["fpd-on-loading"]),FB.api("/"+e+"?fields=count",(t=>{const i=t.count;FB.api("/"+e+"?fields=photos.limit("+i+").fields(source,images)",(e=>{d(this.dropdown,["fpd-on-loading"]),e.error||e.photos.data.forEach((e=>{const t=e.images[0]?e.images[0].source:e.source,i=e.images[e.images.length-1]?e.images[e.images.length-1].source:e.source,n=f({url:t,thumbnailUrl:i,title:e.id,price:m(this.fpdInstance,this.container)});l(n,["click"],(e=>{this.fpdInstance.loadingCustomImage||this.fpdInstance._addGridItemToCanvas(e.currentTarget)})),this.gridElem.append(n),this.fpdInstance.lazyBackgroundObserver.observe(n.querySelector("picture"))})),this.fpdInstance.toggleSpinner(!1)}))}))}}class H extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover fpd-photo-grid"></div> </div>'}}customElements.define("fpd-module-instagram-images",H);class z extends EventTarget{accessToken=null;nextStack=null;loadingStack=!1;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-instagram-images"),t.append(this.container),this.gridElem=this.container.querySelector(".fpd-grid");const i=this.container.querySelector(".fpd-scroll-area");i.addEventListener("scroll",(e=>{let t=i.scrollHeight;i.clientHeight+i.scrollTop+100>t&&(null===this.nextStack||this.loadingStack||this.#F(this.nextStack,!1))}))}authenticate(){const e=this.fpdInstance.mainOptions;if(g()){const e=window.localStorage.getItem("fpd_insta_access_token");if(!h(e))return this.accessToken=e,void this.#F()}let t=(window.screen.width-700)/2,i=(window.screen.height-500)/2,n={app_id:e.instagramClientId,redirect_uri:e.instagramRedirectUri,scope:"user_profile,user_media",response_type:"code"},s=new URLSearchParams(n).toString();var a=window.open("https://api.instagram.com/oauth/authorize?"+s,"","width=700,height=500,left="+t+",top="+i),o=setInterval((()=>{a.closed&&clearInterval(o);try{if(a.location&&a.location.href){var e=new URL(a.location.href).searchParams.get("code");e&&(e=e.replace("#_",""),this.#A(e),a.close())}}catch(e){}}),500)}#A(e){const t=this.fpdInstance.mainOptions;this.fpdInstance.toggleSpinner(!0),w({url:t.instagramTokenUri,params:{code:e,client_app_id:t.instagramClientId,redirect_uri:t.instagramRedirectUri},onSuccess:e=>{e.access_token?(g()&&window.localStorage.setItem("fpd_insta_access_token",e.access_token),this.accessToken=e.access_token,this.#F()):e.error_message&&this.fpdInstance.toggleSpinner(!1)},onError:e=>{this.fpdInstance.toggleSpinner(!1)}})}#F(e="https://graph.instagram.com/me/media",t=!0){this.loadingStack=!0,this.fpdInstance.toggleSpinner(!0);let i={url:e,onSuccess:e=>{e.data&&(this.nextStack=e.paging&&e.paging.next?e.paging.next:null,e.data.forEach((e=>{if("VIDEO"!==e.media_type){const t=f({url:e.media_url,thumbnailUrl:e.thumbnail_url?e.thumbnail_url:e.media_url,title:e.id,price:m(this.fpdInstance,this.container)});l(t,["click"],(e=>{this.fpdInstance.loadingCustomImage||this.fpdInstance._addGridItemToCanvas(e.currentTarget)})),this.gridElem.append(t),this.fpdInstance.lazyBackgroundObserver.observe(t.querySelector("picture"))}}))),this.fpdInstance.toggleSpinner(!1),this.loadingStack=!1},onError:e=>{e.response&&e.response.error&&e.response.error.code&&g()&&190==e.response.error.code&&(window.localStorage.removeItem("fpd_insta_access_token"),this.accessToken=null,this.authenticate()),this.fpdInstance.toggleSpinner(!1),this.loadingStack=!1}};t&&(this.gridElem.innerHTML="",i.params={fields:"id,caption,media_url,media_type",access_token:this.accessToken}),w(i)}}class R extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-loader-wrapper"> <div class="fpd-loader"> <div class="fpd-loader-circle"></div> </div> </div> <div class="fpd-head"> <a href="https://pixabay.com/" target="_blank" class="fpd-pixabay-logo"> </a> <div class="fpd-input-search"> <input type="text" data-defaulttext="Search in Pixabay library" placeholder="modules.pixabay_search"/> <span class="fpd-icon-magnify"></span> </div> </div> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover fpd-photo-grid"></div> </div>'}}customElements.define("fpd-module-pixabay-images",R);class V extends EventTarget{loadingStack=!1;currentQuery="";pixabayPage=1;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-pixabay-images"),t.append(this.container),this.gridElem=this.container.querySelector(".fpd-grid"),this.loader=this.container.querySelector(".fpd-loader-wrapper");const i=this.container.querySelector(".fpd-scroll-area");i.addEventListener("scroll",(e=>{let t=i.scrollHeight;i.clientHeight+i.scrollTop+100>t&&(this.loadingStack||(this.pixabayPage++,this.loadImages(void 0,!1)))})),l(this.container.querySelector("input"),["keypress"],(e=>{13==e.which&&(this.pixabayPage=1,this.loadImages(e.currentTarget.value))}))}loadImages(e,t=!0){if(this.currentQuery===e)return!1;const i=this.fpdInstance.mainOptions;this.loadingStack=!0,this.currentQuery=void 0===e?this.currentQuery:e;var n=i.pixabayHighResImages?"&response_group=high_resolution":"",s="https://pixabay.com/api/?safesearch=true&key="+i.pixabayApiKey+"&page="+this.pixabayPage+"&per_page=40&min_width="+i.customImageParameters.minW+"&min_height="+i.customImageParameters.minH+n+"&q="+encodeURIComponent(this.currentQuery)+"&lang="+i.pixabayLang;t&&(this.gridElem.innerHTML=""),d(this.loader,["fpd-hidden"]),w({url:s,onSuccess:e=>{c(this.loader,["fpd-hidden"]),e.hits.length>0&&e.hits.forEach((e=>{const t=f({url:e.imageURL?e.imageURL:e.webformatURL,thumbnailUrl:e.webformatURL,title:e.id?e.id:e.id_hash,price:m(this.fpdInstance,this.container)});l(t,["click"],(e=>{this.fpdInstance.loadingCustomImage||this.fpdInstance._addGridItemToCanvas(e.currentTarget)})),this.gridElem.append(t),this.fpdInstance.lazyBackgroundObserver.observe(t.querySelector("picture"))})),this.loadingStack=!1},onError:e=>{c(this.loader,["fpd-hidden"])}})}}class Z extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-scroll-area"> <input type="text" data-defaulttext="Enter a URL, some text..." placeholder="actions.qr_code_input"/> <div class="fpd-qr-code-colors"> <div class="fpd-qr-code-color-dark"></div> <div class="fpd-qr-code-color-light"></div> </div> <span class="fpd-add-qr-code fpd-btn" data-defaulttext="Add QR-Code"> actions.qr_code_add_btn </span> <div class="fpd-qr-code-wrapper fpd-hidden"></div> </div> '}}customElements.define("fpd-module-qr-code",Z);class W extends EventTarget{constructor(e,t){super(),this.fpdInstance=e,this.darkColor="#000",this.lightColor="#fff",this.container=document.createElement("fpd-module-qr-code"),t.append(this.container);const i=this.container.querySelector(".fpd-qr-code-color-dark");i.style.backgroundColor="#000",new Picker({parent:i,popup:"bottom",alpha:!1,color:this.darkColor,onChange:e=>{this.darkColor=tinycolor(e.rgbaString).toHexString(),i.style.backgroundColor=this.darkColor}});const n=this.container.querySelector(".fpd-qr-code-color-light");n.style.backgroundColor=this.lightColor,new Picker({parent:n,popup:"bottom",alpha:!1,color:this.lightColor,onChange:e=>{this.lightColor=tinycolor(e.rgbaString).toHexString(),n.style.backgroundColor=this.lightColor}});const s=this.container.querySelector(".fpd-qr-code-wrapper");l(this.container.querySelector(".fpd-btn"),"click",(t=>{s.innerHTML="";const i=this.container.querySelector('input[type="text"]').value;i&&i.length>0&&(new QRCode(s,{text:this.container.querySelector('input[type="text"]').value,width:256,height:256,colorDark:this.darkColor,colorLight:this.lightColor,correctLevel:QRCode.CorrectLevel.H}),s.querySelector("img").onload=t=>{const n={_addToUZ:e.currentViewInstance.currentUploadZone};e._addCanvasImage(t.currentTarget.src,"QR-Code: "+i,n),this.container.querySelector('input[type="text"]').value=""})}))}}class G extends EventTarget{constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-images"),t.append(this.container);const i=Array.from(this.container.querySelectorAll(".fpd-module-tabs > div")),n=Array.from(this.container.querySelectorAll(".fpd-module-tabs-content > div"));let s=null,a=null;l(i,"click",(e=>{const t=e.currentTarget;d(i,["fpd-active"]),d(n,["fpd-active"]),c(t,["fpd-active"]),c(n.find((e=>e.dataset.context==t.dataset.context)),["fpd-active"]),"instagram"==t.dataset.context&&s&&!s.accessToken?s.authenticate():"pixabay"==t.dataset.context&&a&&a.loadImages()}));const o=e.mainOptions;new U(e,n.find((e=>"upload"==e.dataset.context))),l(e,["viewSelect","secondaryModuleCalled"],(t=>{const i=m(e,this.container),n=this.container.querySelectorAll(".fpd-price");n&&(p(n,["fpd-hidden"],!Boolean(i)),n.forEach((e=>{e.innerHTML=i})))})),h(o.facebookAppId)||(new N(e,n.find((e=>"facebook"==e.dataset.context))),i.find((e=>"facebook"==e.dataset.context)).classList.remove("fpd-hidden")),h(o.instagramClientId)||(s=new z(e,n.find((e=>"instagram"==e.dataset.context))),i.find((e=>"instagram"==e.dataset.context)).classList.remove("fpd-hidden")),h(o.pixabayApiKey)||(a=new V(e,n.find((e=>"pixabay"==e.dataset.context))),i.find((e=>"pixabay"==e.dataset.context)).classList.remove("fpd-hidden")),new W(e,n.find((e=>"qr-code"==e.dataset.context))),i.filter((e=>!e.classList.contains("fpd-hidden"))).length<2&&this.container.classList.add("fpd-hide-tabs")}}class X extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-layers" data-defaulttext="Manage Layers" data-title="modules.manage_layers"> <div class="fpd-scroll-area"> <div class="fpd-list"></div> </div> </div>'}}customElements.define("fpd-module-manage-layers",X);const Y=e=>{const t=document.createElement("div");t.className="fpd-scroll-area",(e.enablePicker||e.subPalette)&&c(t,["fpd-has-subpanel"]);const i=document.createElement("div");let n;return i.className="fpd-color-palette",t.append(i),e.colors&&Array.isArray(e.colors)&&e.colors.forEach(((t,s)=>{let a=t;if(e.colorNames){const i=e.colorNames[t.replace("#","").toLowerCase()];i&&(a=i.toUpperCase())}const o=document.createElement("span");o.className="fpd-item",o.style.backgroundColor=t,o.setAttribute("aria-label",a),i.append(o),e.enablePicker||e.subPalette||c(o,["fpd-tooltip"]),l(o,"click",(a=>{if(a.stopPropagation(),e.enablePicker||e.subPalette){n&&(n.remove(),n=null);const a=o.classList.contains("fpd-active");a||(n=e.enablePicker?$({initialColor:t,colorNames:e.colorNames,palette:e.palette,onMove:t=>{e.onMove&&e.onMove(t,s)},onChange:t=>{o.style.backgroundColor=t,e.onChange&&e.onChange(t,s)}}):Y({colors:e.palette,colorNames:e.colorNames,onChange:t=>{o.style.backgroundColor=t,e.onChange&&e.onChange(t,s)}}),i.append(n)),d(i,["fpd-sub-show"]),d(i.querySelectorAll(".fpd-item"),["fpd-active"]),a||(c(i,["fpd-sub-show"]),c(o,["fpd-active"]))}else e.onChange&&e.onChange(t)}))})),t},J=Y,$=e=>{let t=!1,i=null;const n=document.createElement("div");n.className="fpd-colorpicker-wrapper";const s=new Picker({parent:n,popup:!1,alpha:!1,color:e.initialColor?e.initialColor:"#fff",onChange:n=>{const s=tinycolor(n.rgbaString).toHexString();t&&e.onMove&&e.onMove(s),"number"==typeof i&&clearTimeout(i),i=setTimeout((()=>{t&&e.onChange&&e.onChange(s),t=!0}),500)}});if(void 0!==window.EyeDropper){const e=s.domElement.querySelector(".picker_sample"),t=document.createElement("span");t.className="fpd-icon-color",e.append(t),l(e,"click",(e=>{(new EyeDropper).open().then((e=>{s.setColor(e.sRGBHex)})).catch((e=>{console.log(e)}))}))}if(e.palette&&Array.isArray(e.palette)){const t=J({colors:e.palette,colorNames:e.colorNames,onChange:t=>{e.onChange&&e.onChange(t)}});n.append(t)}return n};class Q extends EventTarget{#_=null;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-manage-layers"),t.append(this.container),this.listElem=this.container.querySelector(".fpd-list"),l(e,"viewSelect",(()=>{this.#B()})),l(e,["elementAdd","elementRemove"],(t=>{e.productCreated&&this.#B()}))}#B(){this.listElem.innerHTML="",this.fpdInstance.getElements(this.fpdInstance.currentViewIndex).forEach((e=>{e.checkEditable()&&this.#M(e)})),this.#_&&this.#_.dispose();let e=0;this.#_=AreaSortable("vertical",{container:this.listElem,handle:"fpd-icon-reorder",item:"fpd-list-row",placeholder:"fpd-sortable-placeholder",activeItem:"fpd-sortable-dragged",closestItem:"fpd-sortable-closest",autoscroll:!0,animationMs:0,onStart:t=>{const i=window.pageYOffset||document.documentElement.scrollTop||0;window.onscroll=()=>{window.scrollTo({top:i})},e=t.offsetTop},onChange:e=>{const t=this.fpdInstance.currentViewInstance.fabricCanvas,i=t.getElementByID(e.id);let n=this.listElem.querySelector(".fpd-sortable-closest"),s=t.getElementByID(n?n.id:e.id).getZIndex();n||s++,t.setElementOptions({z:s},i)},onEnd:e=>{window.onscroll=()=>{}}})}#M(e){const t=document.createElement("div");t.className="fpd-list-row",t.id=e.id;let i=document.createElement("span"),n=null;if(!e.uploadZone&&e.hasColorSelection()){n=((e,t)=>{var i=[];if("group"==e.type){const t=e.getObjects();1===t.length?i=e.colors:(i=[],t.forEach((e=>{const t=tinycolor(e.fill);i.push(t.toHexString())})))}else i=e.colorLinkGroup&&t.colorLinkGroups[e.colorLinkGroup]?t.colorLinkGroups[e.colorLinkGroup].colors:e.colors;return i})(e,this.fpdInstance);const s=(e=>{let t=e.fill;return"string"==typeof t?t:"object"==typeof t?t.source?(t=t.source.src,"url("+t+")"):t[0]:!0===e.colors&&"group"===e.type?tinycolor(e.getObjects()[0].fill):!1===t&&e.colors&&e.colors[0]?e.colors[0]:void 0})(e);i.style.background=s,i.className="fpd-current-color",t.colors=n}const s=document.createElement("div");s.className="fpd-cell-0",s.append(i),t.append(s);let a=e.title;"text"===e.getType()&&e.editable&&(a=document.createElement("textarea"),a.innerText=e.text,l(a,"keyup",(t=>{t.stopPropagation();let i=t.target.value;i=i.replace(FancyProductDesigner.forbiddenTextChars,""),this.fpdInstance.mainOptions.disableTextEmojis&&(i=i.replace(FPDEmojisRegex,""),i=i.replace(String.fromCharCode(65039),"")),this.fpdInstance.currentViewInstance.fabricCanvas.setElementOptions({text:i},e)})),e.on({"editing:exited":()=>{a.value=e.text}}));const o=document.createElement("div");o.className="fpd-cell-1",o.append(a),t.append(o);const r=document.createElement("div");if(r.className="fpd-cell-2",t.append(r),e.uploadZone){c(t,["fpd-add-layer"]);const e=document.createElement("span");e.className="fpd-icon-add",r.append(e)}else{if(e.zChangeable){const e=document.createElement("span");e.className="fpd-icon-reorder",r.append(e)}const i=e.locked?"fpd-icon-locked-full":"fpd-icon-unlocked",n=document.createElement("span");n.className="fpd-lock-element",n.innerHTML=`<span class="${i}"></span>`,r.append(n),l(n,"click",(i=>{i.stopPropagation(),d(t,["fpd-show-colors"]),e.evented=!e.evented,e.locked=!e.evented;const n=i.currentTarget.querySelector("span");p(n,["fpd-icon-unlocked"],e.evented),p(n,["fpd-icon-locked-full"],!e.evented),p(t,["fpd-locked"],!e.evented)})),p(t,["fpd-locked"],e.locked)}let u=e.removable||e.__editorMode;if(e.uploadZone&&(u=e.uploadZoneRemovable),u){const t=document.createElement("span");t.className="fpd-remove-element",t.innerHTML='<span class="fpd-icon-remove"></span>',r.append(t),l(t,"click",(t=>{t.stopPropagation(),this.fpdInstance.currentViewInstance.fabricCanvas.removeElement(e)}))}if(this.listElem.append(t),n){const i=document.createElement("div");if(i.className="fpd-cell-full",t.append(i),"group"===e.type&&e.getObjects().length>1){let t;t=Array.isArray(e.colors)&&e.colors.length>1?J({colors:n,colorNames:this.fpdInstance.mainOptions.hexNames,palette:e.colors,subPalette:!0,onChange:(t,i)=>{this.#j(e,i,t)}}):J({colors:n,enablePicker:!0,colorNames:this.fpdInstance.mainOptions.hexNames,palette:this.fpdInstance.mainOptions.colorPickerPalette,onMove:(t,i)=>{e.changeObjectColor(i,t)},onChange:(t,i)=>{this.#j(e,i,t)}}),i.append(t)}else if(1===n.length){const s=$({initialColor:n[0],colorNames:this.fpdInstance.mainOptions.hexNames,palette:this.fpdInstance.mainOptions.colorPickerPalette,onMove:t=>{this.#U(e,t)},onChange:i=>{this.#q(e,t,i)}});i.append(s)}else{const s=J({colors:n,colorNames:this.fpdInstance.mainOptions.hexNames,palette:this.fpdInstance.mainOptions.colorPickerPalette,onChange:i=>{this.#q(e,t,i)}});if(i.append(s),Array.isArray(e.patterns)&&(e.isSVG()||"text"===e.getType())){const n=(e=>{const t=document.createElement("div");t.className="fpd-scroll-area";const i=document.createElement("div");return i.className="fpd-patterns-wrapper",t.append(i),e.images&&Array.isArray(e.images)&&e.images.forEach(((t,n)=>{const s=t.replace(/^.*[\\\/]/,"").replace(/\.[^/.]+$/,"").replace("_"," ").toUpperCase(),a=document.createElement("span");a.className="fpd-item fpd-tooltip",a.style.backgroundImage=`url("${t}")`,a.setAttribute("aria-label",s),i.append(a),l(a,"click",(i=>{e.onChange&&e.onChange(t)}))})),t})({images:e.patterns,onChange:i=>{t.querySelector(".fpd-current-color").style.backgroundImage=`url("${i}")`,this.fpdInstance.currentViewInstance.fabricCanvas.setElementOptions({pattern:i},e)}});i.append(n)}}l(t.querySelector(".fpd-current-color"),"click",(e=>{const i=!t.classList.contains("fpd-show-colors");d(this.listElem.querySelectorAll(".fpd-list-row"),["fpd-show-colors"]),p(t,["fpd-show-colors"],i)}))}l(t,"click",(e=>{const t=e.currentTarget;if(t.classList.contains("fpd-locked")||"TEXTAREA"==e.target.nodeName)return;const i=this.fpdInstance.getElementByID(t.id);i&&i.canvas.setActiveObject(i).renderAll()}))}#U(e,t){"png"!==e.isColorizable()&&e.changeColor(t)}#q(e,t,i){t.querySelector(".fpd-current-color").style.backgroundColor=i,this.fpdInstance.currentViewInstance.fabricCanvas.setElementOptions({fill:i},e)}#j(e,t,i){const n=e.changeObjectColor(t,i);this.fpdInstance.currentViewInstance.fabricCanvas.setElementOptions({fill:n},e)}}class K extends EventTarget{constructor(e,t,i){let n;if(super(),"products"===i)n=new T(e,t);else if("text"===i)n=new k(e,t);else if("text-to-image"===i)n=new _(e,t);else if(i.includes("designs")){let a=null;if(i.includes("designs_")&&!h(e.mainOptions.dynamicDesigns)){if(a=i.split("_").pop(),!a||!e.mainOptions.dynamicDesigns[a])return;{var s=e.mainOptions.dynamicDesigns[a];const t={};t["data-dynamic-designs-id"]=a,!h(s.icon)&&s.icon.includes(".svg")&&(this.configs={icon:s.icon,defaultText:s.name,attrs:t})}}n=new F(e,t,a)}else"images"===i?n=new G(e,t):"manage-layers"===i&&(n=new Q(e,t));if(FancyProductDesigner.additionalModules&&!n){const s=FancyProductDesigner.additionalModules[i];s&&(n=new s(e,t))}if(n&&(this.moduleInstance=n,e["moduleInstance_"+i]=n,!i.includes("designs_"))){const e=n.container.querySelector("div");this.configs={icon:e.dataset.moduleicon,langId:e.dataset.title,langKeys:e.dataset.title.split("."),defaultText:e.dataset.defaulttext}}}}class ee extends EventTarget{#N=null;#H=null;#z=!1;#R=0;#V=0;#Z=0;#W=0;#G=!1;#X=!1;contentElem=null;navElem=null;currentModuleKey="";constructor(e){super(),this.fpdInstance=e;const t=e.container;if(this.container=document.createElement("fpd-main-bar"),t.append(this.container),this.contentElem=this.container.querySelector(".fpd-module-content"),this.navElem=this.container.querySelector(".fpd-navigation"),this.secContent=this.container.querySelector(".fpd-secondary-content"),this.currentModules=e.mainOptions.mainBarModules,this.#N=document.querySelector(this.fpdInstance.mainOptions.modalMode?".fpd-modal-product-designer":"body"),this.#H=document.querySelector(".fpd-draggable-dialog"),this.#N.append(this.#H),l(this.#H,["mousedown","touchstart"],this.#Y.bind(this)),l(this.#H,["mouseup","touchend"],this.#J.bind(this)),l(document,["mousemove","touchmove"],this.#$.bind(this)),l(this.#H.querySelector(".fpd-close-dialog"),["click","touchstart"],this.#Q.bind(this)),l(this.container.querySelector(".fpd-close-off-canvas"),"click",this.#Q.bind(this)),l(e,"viewSelect",this.#K.bind(this)),t.classList.contains("fpd-off-canvas")){let e=0,t=0;this.contentElem.addEventListener("touchstart",(t=>{e=t.touches[0].pageX,c(this.container,["fpd-is-dragging"])})),this.contentElem.addEventListener("touchmove",(i=>{i.preventDefault();let n=i.touches[0].pageX;t=e-n,t=Math.abs(t)<0?0:Math.abs(t),this.contentElem.style.left=-t+"px",this.contentElem.previousElementSibling.style.left=this.contentElem.clientWidth-t+"px"})),this.contentElem.addEventListener("touchend",(e=>{Math.abs(t)>100?this.toggleContentDisplay(!1):(this.contentElem.style.left="0px",this.contentElem.previousElementSibling.style.left=this.contentElem.clientWidth+"px"),t=0,d(this.container,["fpd-is-dragging"])}))}this.updateContentWrapper(),this.setup(this.currentModules)}#Y(e){this.#H.querySelector(".fpd-dialog-drag-handle").contains(e.target)&&(e.preventDefault(),this.#z=!0,this.#R=e.touches?event.touches[0].clientX:e.clientX,this.#V=e.touches?event.touches[0].clientY:e.clientY,this.#Z=this.#R-this.#H.offsetLeft,this.#W=this.#V-this.#H.offsetTop)}#$(e){if(!this.#z)return;const t=this.#N.clientWidth<window.innerWidth?window.innerWidth:this.#N.clientWidth,i=this.#N.clientHeight<window.innerHeight?window.innerHeight:this.#N.clientHeight,n=t-this.#H.clientWidth,s=i-this.#H.clientHeight,a=e.touches?event.touches[0].clientX:e.clientX;let o=(e.touches?event.touches[0].clientY:e.clientY)-this.#W,r=a-this.#Z;r<0&&(r=0),o<0&&(o=0),r>n&&(r=n),o>s&&(o=s),this.#H.style.top=o+"px",this.#H.style.left=r+"px"}#J(e){this.#z=!1}#ee(e){e.stopPropagation(),this.fpdInstance.deselectElement(),this.fpdInstance.currentViewInstance&&(this.fpdInstance.currentViewInstance.currentUploadZone=null),e.currentTarget.classList.contains("fpd-active")&&this.contentClosable?this.toggleContentDisplay(!1):this.callModule(e.currentTarget.dataset.module,e.currentTarget.dataset.dynamicDesignsId)}#Q(){this.fpdInstance.currentViewInstance&&this.fpdInstance.currentViewInstance.currentUploadZone&&this.fpdInstance.currentViewInstance.deselectElement(),this.toggleContentDisplay(!1)}#K(){const e=this.fpdInstance.currentViewInstance,t=e.options.customAdds;p(document.querySelectorAll('.fpd-nav-item[data-module^="designs"]'),["fpd-disabled"],!t.designs),p(document.querySelectorAll('.fpd-nav-item[data-module="images"]'),["fpd-disabled"],!t.uploads),p(document.querySelectorAll('.fpd-nav-item[data-module="text-to-image"]'),["fpd-disabled"],!t.uploads),p(document.querySelectorAll('.fpd-nav-item[data-module="drawing"]'),["fpd-disabled"],!t.drawing),p(document.querySelectorAll('.fpd-nav-item[data-module="text"]'),["fpd-disabled"],!t.texts),p(document.querySelectorAll('.fpd-nav-item[data-module="names-numbers"]'),["fpd-disabled"],!e.textPlaceholder&&!e.numberPlaceholder),this.toggleContentDisplay(!1)}callModule(e,t=null){let i;if(d(this.secContent,["fpd-active"]),d(this.contentElem,["fpd-hidden"]),d(this.navElem.querySelectorAll(".fpd-nav-item"),["fpd-active"]),d(Array.from(this.contentElem.children),["fpd-active"]),t)i=c(this.navElem.querySelector('.fpd-nav-item[data-dynamic-designs-id="'+t+'"]'),["fpd-active"]),c(this.contentElem.querySelector('[data-dynamic-designs-id="'+t+'"]'),["fpd-active"]);else{i=c(this.navElem.querySelector('.fpd-nav-item[data-module="'+e+'"]'),["fpd-active"]);const t=this.contentElem.querySelector("fpd-module-"+e);c(t,["fpd-active"]),"text"==e&&t.querySelector("textarea").focus()}this.toggleContentDisplay(),this.currentModuleKey=e}callSecondary(e){d(this.navElem.querySelectorAll(".fpd-nav-item"),["fpd-active"]),c(this.contentElem,["fpd-hidden"]),c(this.secContent,["fpd-active"]),c(this.secContent.querySelector(".fpd-"+e),["fpd-active"]),this.fpdInstance.dispatchEvent(new CustomEvent("secondaryModuleCalled",{detail:{moduleName:e}}))}get contentClosable(){const e=this.fpdInstance.container;return this.#X||this.#G||e.classList.contains("fpd-layout-small")}toggleContentDisplay(e=!0){const t=this.fpdInstance.container;p(t,["fpd-module-visible"],e),this.contentClosable&&(e||d(this.navElem.querySelectorAll(".fpd-nav-item"),["fpd-active"])),this.#X?(!e&&this.currentModuleKey.length&&this.fpdInstance.deselectElement(),this.contentElem.style.removeProperty("left"),this.contentElem.previousElementSibling.style.removeProperty("left"),this.contentElem.style.height=this.fpdInstance.mainWrapper.container.clientHeight+"px",this.container.classList.toggle("fpd-show",e)):this.#G&&(e&&(this.#H.querySelector(".fpd-dialog-title").innerText=this.navElem.querySelector(".fpd-nav-item.fpd-active .fpd-label").innerText),this.#H.classList.toggle("fpd-show",e)),e||(this.currentModuleKey="")}updateContentWrapper(){const e=this.fpdInstance.container;this.toggleContentDisplay(!1),this.#X=!1,this.#G=!1,d(this.navElem.querySelectorAll(".fpd-nav-item"),["fpd-active"]),e.classList.contains("fpd-off-canvas")?(this.#X=!0,this.container.append(this.contentElem)):e.classList.contains("fpd-sidebar")?this.container.append(this.contentElem):(this.#G=!0,this.#H.append(this.contentElem))}toggleUploadZonePanel(e=!0,t={}){if(!this.fpdInstance.loadingCustomImage)if(p(this.secContent,["fpd-active"],e),e){p(this.uploadZoneNavItems.find((e=>e.classList.contains("fpd-add-image"))),["fpd-hidden"],!Boolean(t.uploads)),p(this.uploadZoneNavItems.find((e=>e.classList.contains("fpd-add-text"))),["fpd-hidden"],!Boolean(t.texts)),p(this.uploadZoneNavItems.find((e=>e.classList.contains("fpd-add-design"))),["fpd-hidden"],!Boolean(t.designs)),this.fpdInstance.UZmoduleInstance_designs&&this.fpdInstance.UZmoduleInstance_designs.toggleCategories();const e=this.uploadZoneNavItems.find((e=>!e.classList.contains("fpd-hidden")));e&&e.click(),this.callSecondary("upload-zone-panel")}else this.fpdInstance.currentViewInstance.currentUploadZone=null}setup(e=[]){let t=this.fpdInstance.mainOptions.initialActiveModule?this.fpdInstance.mainOptions.initialActiveModule:"";const i=this.container.querySelector(".fpd-navigation");this.currentModules.length<=1&&!this.fpdInstance.container.classList.contains("fpd-topbar")?(t=this.currentModules[0]?this.currentModules[0]:"",i.classList.add("fpd-hidden")):this.fpdInstance.container.classList.contains("fpd-sidebar")&&""==t?t=this.currentModules[0]?this.currentModules[0]:"":i.classList.remove("fpd-hidden"),i.innerHTML=this.contentElem.innerHTML="",FancyProductDesigner.additionalModules&&Object.keys(FancyProductDesigner.additionalModules).forEach((t=>{e.push(t)})),e.forEach((e=>{let t="";const n=new K(this.fpdInstance,this.contentElem,e);if(!n.moduleInstance)return;const s=document.createElement("div");s.classList.add("fpd-nav-item"),s.dataset.module=e,s.addEventListener("click",this.#ee.bind(this)),i.appendChild(s);let a=document.createElement("span");if(n.configs.icon.includes(".svg")?(o={url:n.configs.icon,onSuccess:e=>{a.innerHTML=e},onError:e=>{console.log(e)}},fetch(o.url).then((e=>{e.ok?e.text().then((e=>{o.onSuccess&&o.onSuccess(e)})):e.text().then((e=>{o.onError&&o.onError(e)}))}))):(a.classList.add("fpd-nav-icon"),a.classList.add(n.configs.icon)),s.append(a),n.configs.langKeys){const e=n.configs.langKeys;t=this.fpdInstance.translator.getTranslation(e[0],e[1],this.fpdInstance.mainOptions.langJson,n.configs.defaultText)}else n.configs.defaultText&&(t=n.configs.defaultText);var o;const r=document.createElement("span");if(r.className="fpd-label",r.innerText=t,s.append(r),n.configs.attrs)for(const[e,t]of Object.entries(n.configs.attrs))s.setAttribute(e,t)})),this.contentClosable||i.querySelector(`[data-module="${t}"]`).click(),this.uploadZoneContent=this.secContent.querySelector(".fpd-upload-zone-content"),this.uploadZoneNavItems=Array.from(this.secContent.querySelectorAll(".fpd-upload-zone-panel .fpd-bottom-nav > div"));const n=new K(this.fpdInstance,this.uploadZoneContent,"images");this.fpdInstance.UZmoduleInstance_images=n.moduleInstance;const s=new K(this.fpdInstance,this.uploadZoneContent,"text");this.fpdInstance.UZmoduleInstance_text=s.moduleInstance;const a=new K(this.fpdInstance,this.uploadZoneContent,"designs");this.fpdInstance.UZmoduleInstance_designs=a.moduleInstance,l(this.uploadZoneNavItems,"click",(e=>{d(this.uploadZoneNavItems,["fpd-active"]),c(e.currentTarget,["fpd-active"]),d(Array.from(this.uploadZoneContent.children),["fpd-active"]),c(this.uploadZoneContent.querySelector("fpd-module-"+e.currentTarget.dataset.module),["fpd-active"])}))}}class te extends HTMLElement{constructor(){super()}connectedCallback(){const e=document.createElement("template");e.innerHTML='<div class="fpd-snap-line-h"></div> <div class="fpd-snap-line-v"></div> <div class="fpd-product-stage"></div>',this.append(e.content.cloneNode(!0))}}customElements.define("fpd-main-wrapper",te);class ie{constructor(e){this.container=document.createElement("fpd-main-wrapper"),e.container.append(this.container)}}i(561);class ne extends EventTarget{constructor(e){super(),this.container=document.createElement("fpd-actions-bar"),e.container.append(this.container)}}class se extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<span class="fpd-view-prev"> <span class="fpd-icon-forward"></span> </span> <div class="fpd-views-selection"></div> <span class="fpd-view-next"> <span class="fpd-icon-forward"></span> </span> '}}customElements.define("fpd-views-wrapper",se);class ae extends EventTarget{constructor(e){super(),this.container=document.createElement("fpd-views-wrapper"),e.container.classList.contains("fpd-views-outside")||e.mainOptions.modalMode?e.container.after(this.container):e.mainWrapper.container.append(this.container)}}class oe extends EventTarget{#te=0;constructor(e){super(),this.fpdInstance=e}init(){this.#ie(),this.#ne(),this.#se(),this.fpdInstance.container.classList.add("fpd-container"),this.fpdInstance.container.classList.add("fpd-wrapper");const e=document.createElement("div");e.innerHTML='<div class="fpd-loader-wrapper"> <div class="fpd-loader"> <div class="fpd-loader-circle"></div> <span class="fpd-loader-text" data-defaulttext="Initializing Product Designer">misc.initializing</span> </div> </div>',this.fpdInstance.container.appendChild(e.firstChild.cloneNode(!0)),this.fpdInstance.mainLoader=this.fpdInstance.container.querySelector(".fpd-loader-wrapper"),this.fpdInstance.actionsBar=new ne(this.fpdInstance),this.fpdInstance.mainBar=new ee(this.fpdInstance),this.fpdInstance.mainWrapper=new ie(this.fpdInstance),this.fpdInstance.productStage=this.fpdInstance.mainWrapper.container.querySelector(".fpd-product-stage"),this.fpdInstance.viewsWrapper=new ae(this.fpdInstance),Array.from(this.fpdInstance.container.querySelectorAll("[data-defaulttext]")).forEach((e=>{this.fpdInstance.translator.translateElement(e,this.fpdInstance.mainOptions.langJson)})),this.dispatchEvent(new CustomEvent("ready")),window.addEventListener("resize",this.#ie.bind(this))}#ie(){const e=this.fpdInstance.mainOptions.responsiveBreakpoints;this.#te=window.innerWidth,this.#te<e.small?(this.fpdInstance.container.classList.remove("fpd-layout-medium"),this.fpdInstance.container.classList.remove("fpd-layout-large"),this.fpdInstance.container.classList.add("fpd-layout-small")):this.#te<e.medium?(this.fpdInstance.container.classList.remove("fpd-layout-small"),this.fpdInstance.container.classList.remove("fpd-layout-large"),this.fpdInstance.container.classList.add("fpd-layout-medium")):(this.fpdInstance.container.classList.remove("fpd-layout-medium"),this.fpdInstance.container.classList.remove("fpd-layout-small"),this.fpdInstance.container.classList.add("fpd-layout-large"))}#ne(){const e=document.body;let t;t=document.createElement("div"),t.className="fpd-thumbnail-preview fpd-shadow-1 fpd-hidden",t.innerHTML="<picture></picture>";const i=document.createElement("div");i.className="fpd-preview-title",t.append(i),e.append(t),l(e,["mouseover","mouseout","mousemove","click"],(e=>{const n=e.target;if(n.classList.contains("fpd-hover-thumbnail")&&t.classList.contains("fpd-hidden")&&"mouseover"===e.type&&n.dataset.source){t.querySelector(".fpd-price")&&t.querySelector(".fpd-price").remove(),t.querySelector(".fpd-image-quality-ratings")&&t.querySelector(".fpd-image-quality-ratings").remove(),t.querySelector("picture").style.backgroundImage=`url("${n.dataset.source}")`,n.dataset.title&&(i.innerText=n.dataset.title),p(i,["fpd-hidden"],!n.dataset.title),p(t,["fpd-title-enabled"],n.dataset.title);const e=n.querySelector(".fpd-price");e&&t.append(e.cloneNode(!0));const s=n.querySelector(".fpd-image-quality-ratings");console.log(s),s&&t.append(s.cloneNode(!0)),t.classList.remove("fpd-hidden")}if(t.classList.contains("fpd-hidden")||"mousemove"!==e.type&&"mouseover"!==e.type)"mouseout"!==e.type&&"click"!=e.type||t.classList.add("fpd-hidden");else{const i=e.pageX+10+t.offsetWidth>window.innerWidth?window.innerWidth-t.offsetWidth:e.pageX+10;t.style.left=i+"px",t.style.top=e.pageY+10+"px"}}))}#se(){const e=document.body,t=document.createElement("div");t.className="fpd-main-tooltip",e.append(t),this.fpdInstance.mainTooltip=t,e.addEventListener("mouseover",(e=>{const i=e.target;if(i.classList.contains("fpd-tooltip")){const e=i.getAttribute("aria-label");t.innerHTML=e;const n=5,{x:s,y:a,width:o,height:r}=i.getBoundingClientRect();let l=Math.floor(a-t.clientHeight-n),c=Math.floor(s+o/2-t.clientWidth/2);l<0&&(l=Math.floor(a+r+n)),c<0?c=0:c>window.outerWidth-t.clientWidth&&(c=window.outerWidth-t.clientWidth-n),t.style.left=`${c}px`,t.style.top=`${l}px`,t.classList.add("fpd-show")}else t.classList.remove("fpd-show")})),e.addEventListener("touchstart",(e=>{t.classList.remove("fpd-show")}))}}class re{constructor(e){const t=document.querySelector(e.mainOptions.editorMode);t&&(c(t,["fpd-editor-box-wrapper","fpd-container"]),this.titleElem=document.createElement("div"),this.titleElem.className="fpd-eb-title",t.append(this.titleElem),this.gridElem=document.createElement("div"),this.gridElem.className="fpd-eb-grid",t.append(this.gridElem),e.mainOptions.editorBoxParameters.forEach((e=>{const t=document.createElement("div");t.innerHTML="<span>"+e+'</span><input type="text" readonly data-prop="'+e+'" />',this.gridElem.append(t)}))),l(e,["elementSelect","elementChange"],(i=>{t&&(e.currentElement?(this.titleElem.innerText=e.currentElement.title,e.mainOptions.editorBoxParameters.forEach((t=>{let i=e.currentElement[t];if(void 0!==i){i="number"==typeof i?i.toFixed(2):i,i="object"==typeof i&&i.source?i.source.src:i,"fill"===t&&"group"===e.currentElement.type&&(i=e.currentElement.svgFill);const n=this.gridElem.querySelector('input[data-prop="'+t+'"]');n&&(n.value=i)}}))):this.titleElem.innerText="",p(this.gridElem,["fpd-hidden"],!e.currentElement))}))}}class le extends EventTarget{static forbiddenTextChars=/<|>/g;static proxyFileServer="";static additionalModules={};container=null;mainOptions={};currentViewInstance=null;currentViewIndex=0;products=[];designs=[];modalContainer=document.body;currentCategoryIndex=0;currentProductIndex=0;viewInstances=[];currentViews=null;currentElement=null;productCreated=!1;colorLinkGroups={};globalCustomElements=[];doUnsavedAlert=!1;currentPrice=0;singleProductPrice=0;pricingRulesPrice=0;loadingCustomImage=!1;lazyBackgroundObserver=null;#ae=0;#oe=0;#re=!1;constructor(e,t={}){super(),this.lazyBackgroundObserver=new IntersectionObserver(((e,t)=>{e.forEach((e=>{e.isIntersecting&&(u(e.target),this.lazyBackgroundObserver.unobserve(e.target))}))})),this.container=e,this.container.instance=this,this.mainOptions=b.merge(b.defaults,t);const i=this.mainOptions.customImageAjaxSettings;this.uploadsURL=i.url,this.uploadsDir=i.data&&i.data.uploadsDir?i.data.uploadsDir:"",this.uploadsDirURL=i.data&&i.data.uploadsDirURL?i.data.uploadsDirURL:"",this.uploadsToServer=i.data&&i.data.saveOnServer?1:0;let n={};Object.keys(this.mainOptions.hexNames).forEach((e=>{n[e.toLowerCase()]=this.mainOptions.hexNames[e]})),this.mainOptions.hexNames=n,this.translator=new I,this.translator.loadLangJSON(this.mainOptions.langJson,this.#le.bind(this))}#le(){this.uiManager=new oe(this),this.uiManager.addEventListener("ready",(e=>{this.#ce()})),this.uiManager.init()}#ce(){E.load(this,(()=>{this.#de()}))}#de(){setTimeout((()=>{this.dispatchEvent(new CustomEvent("uiSet"))}),1),this.#pe()}#pe(){this.dispatchEvent(new CustomEvent("ready")),this.mainOptions.productsJSON&&("object"==typeof this.mainOptions.productsJSON?this.setupProducts(this.mainOptions.productsJSON):w({url:this.mainOptions.productsJSON,onSuccess:e=>{this.setupProducts(e)},onError:()=>{alert("Products JSON could not be loaded. Please check that your URL is correct! URL: "+this.mainOptions.productsJSON)}})),this.mainOptions.designsJSON&&("object"==typeof this.mainOptions.productsJSON?this.setupDesigns(this.mainOptions.designsJSON):w({url:this.mainOptions.designsJSON,onSuccess:e=>{this.setupDesigns(e)},onError:()=>{alert("Design JSON could not be loaded. Please check that your URL is correct! URL: "+this.mainOptions.designsJSON)}})),this.mainOptions.keyboardControl&&l(document,"keydown",(e=>{if(this.currentViewInstance&&this.currentViewInstance.fabricCanvas){const t=this.currentViewInstance,i=e.target.nodeName,n=t.fabricCanvas.getActiveObject();if(n&&!["TEXTAREA","INPUT"].includes(i)){switch(e.which){case 8:n.removable&&t.fabricCanvas.removeElement(n);break;case 37:n.draggable&&t.fabricCanvas.setElementParameters({left:n.left-1});break;case 38:n.draggable&&t.fabricCanvas.setElementParameters({top:n.top-1});break;case 39:n.draggable&&t.fabricCanvas.setElementParameters({left:n.left+1});break;case 40:n.draggable&&t.fabricCanvas.setElementParameters({top:n.top+1});break;default:return}e.preventDefault()}}}));let e=0;l(window,"resize",(t=>{window.innerWidth===e||this.#re||(e=window.innerWidth,this.currentViewInstance&&this.currentViewInstance.fabricCanvas.resetSize(),this.currentElement&&!["INPUT","TEXTAREA"].includes(document.activeElement)&&this.deselectElement())})),l(this,"productCreate",this.#ue.bind(this));let t=!1;l(document.body,"mousedown",(e=>{})),l(document.body,["focusin","blur"],(e=>{["TEXTAREA","INPUT"].includes(e.target.nodeName)&&(this.#re="focusin"==e.type)}),!0),l(document.body,["mouseup","touchend"],(e=>{let i=Array.from(document.querySelectorAll(".fpd-container"));Boolean(i.find((t=>t.contains(e.target))))||!this.mainOptions.deselectActiveOnOutside||t||this.deselectElement(),t=!1}),!0),"string"==typeof this.mainOptions.editorMode&&new re(this)}#ue(){const e=this.globalCustomElements.concat(this.fixedElements);if(!e.length)return;let t=0;const i=e=>{const t=this.viewInstances[e.viewIndex];if(t){const i=e.element;let n=Object.keys(this.mainOptions.elementParameters);n="text"===i.getType()?n.concat(Object.keys(this.mainOptions.textParameters)):n.concat(Object.keys(this.mainOptions.imageParameters));let s=i.getElementJSON(!1,n);s._printingBox&&delete s.boundingBox,t.fabricCanvas.addElement(i.getType(),i.source,i.title,s)}else n()},n=()=>{t++,t<e.length?i(e[t]):this.removeEventListener("elementAdd",n)};l(this,"elementAdd",n),e[0]&&i(e[0])}#he(e){var t=this.products.findIndex((t=>t.category===e));return-1!==t&&t}setupProducts(e=[]){this.products=[],e.forEach((e=>{e.hasOwnProperty("category")?e.products.forEach((t=>{this.addProduct(t,e.category)})):this.addProduct(e)})),this.mainOptions.loadFirstProductInStage&&e.length>0?this.selectProduct(0):this.toggleSpinner(!1),this.dispatchEvent(new CustomEvent("productsSet"))}setupDesigns(e){this.designs=e,this.dispatchEvent(new CustomEvent("designsSet"))}addProduct(e,t){var i=this.#he(t);void 0===t?this.products.push(e):(!1===i&&(i=this.products.length,this.products[i]={category:t,products:[]}),this.products[i].products.push(e)),this.dispatchEvent(new CustomEvent("productAdd",{detail:{views:e,category:t,catIndex:i}}))}selectProduct(e,t){let i;this.currentCategoryIndex=void 0===t?this.currentCategoryIndex:t,i=this.products&&this.products.length&&this.products[0].category?this.products[this.currentCategoryIndex].products:instance.products,this.currentProductIndex=e,e<0?this.currentProductIndex=0:e>i.length-1&&(this.currentProductIndex=i.length-1);const n=i[this.currentProductIndex];this.dispatchEvent(new CustomEvent("productSelect",{detail:{product:n}})),this.loadProduct(n,this.mainOptions.replaceInitialElements)}loadProduct(e,t=!1,i=!1){e&&(this.toggleSpinner(!0),this.productCreated=!1,this.colorLinkGroups={},this.globalCustomElements=[],t?this.globalCustomElements=this.getCustomElements():this.doUnsavedAlert=!1,this.fixedElements=this.getFixedElements(),this.reset(),i&&e.forEach(((e,t)=>{e.options=b.merge(this.mainOptions,e.options)})),this.currentViews=e,this.#ae=this.#oe=0,e.forEach(((e,t)=>{this.#ae+=e.elements.length})),l(this,"viewCreate",this.#ge),e&&this.addView(e[0]))}addView(e){const i=le.proxyFileServer?le.proxyFileServer+e.thumbnail:e.thumbnail,n=document.createElement("div");n.className="fpd-shadow-1 fpd-item",n.title=e.title,n.innerHTML='<picture style="background-image: url('+i+');"></picture>',this.viewsWrapper.container.querySelector(".fpd-views-selection").append(n),l(n,"click",(e=>{const t=Array.from(this.viewsWrapper.container.querySelectorAll(".fpd-views-selection > div")).indexOf(n);this.selectView(t)}));let a={};x.relevantOptions.forEach((e=>{let i=this.mainOptions[e];a[e]=t(i)?{...i}:i})),e.options=t(e.options)?s(a,e.options):a;let o=new x(this.productStage,e,this.#fe.bind(this),this.mainOptions.fabricCanvasOptions);o.fabricCanvas.on({beforeElementAdd:e=>{if(!this.productCreated){this.#oe++;const t=e.title+"<br>"+String(this.#oe)+"/"+this.#ae;this.mainLoader.querySelector(".fpd-loader-text").innerHTML=t}},elementAdd:({element:e})=>{if(e){if(this.productCreated&&"image"==e.getType()&&e.isCustom&&(this.toggleSpinner(!1),j(this.translator.getTranslation("misc","image_added"))),e.colorLinkGroup&&e.colorLinkGroup.length>0&&!this.mainOptions.editorMode){var t=this.getViewIndexByWrapper(o.fabricCanvas.wrapperEl);if(this.colorLinkGroups.hasOwnProperty(e.colorLinkGroup)){if(this.colorLinkGroups[e.colorLinkGroup].elements.push({id:e.id,viewIndex:t}),"object"==typeof e.colors){const t=this.mainOptions.replaceColorsInColorGroup?e.colors:this.colorLinkGroups[e.colorLinkGroup].colors.concat(e.colors);this.colorLinkGroups[e.colorLinkGroup].colors=(e=>{for(var t=e.concat(),i=0;i<t.length;++i)for(var n=i+1;n<t.length;++n)t[i]===t[n]&&t.splice(n--,1);return t})(t)}}else this.colorLinkGroups[e.colorLinkGroup]={elements:[{id:e.id,viewIndex:t}],colors:[]},"object"==typeof e.colors&&(this.colorLinkGroups[e.colorLinkGroup].colors=e.colors)}this.dispatchEvent(new CustomEvent("elementAdd",{detail:{element:e}})),this.dispatchEvent(new CustomEvent("viewCanvasUpdate",{detail:{viewInstance:o}}))}else this.toggleSpinner(!1)},elementRemove:({element:e})=>{this.dispatchEvent(new CustomEvent("elementRemove",{detail:{element:e}})),this.dispatchEvent(new CustomEvent("viewCanvasUpdate",{detail:{viewInstance:o}}))},elementSelect:({element:e})=>{if(this.currentElement=e,this.#me(),e&&!e._ignore&&this.currentViewInstance){if(e.uploadZone&&!this.mainOptions.editorMode){let t=s(this.currentViewInstance.options.customAdds,e.customAdds||{});return void setTimeout((()=>{this.currentViewInstance.currentUploadZone=e.title,this.mainBar.toggleUploadZonePanel(!0,t)}),100)}this.currentViewInstance.currentUploadZone&&this.mainBar.toggleUploadZonePanel(!1)}this.dispatchEvent(new CustomEvent("elementSelect"))},elementCheckContainemt:({target:e,boundingBoxMode:t})=>{"inside"===t&&this.#me()},elementColorChange:({target:e,colorLinking:t})=>{if(this.productCreated&&t&&e.colorLinkGroup&&e.colorLinkGroup.length>0){const t=this.colorLinkGroups[e.colorLinkGroup];t&&t.elements&&t.elements.forEach((t=>{e.id,t.id&&this.viewInstances[t.viewIndex].fabricCanvas.getElementByID(t.id).changeColor(e.fill,!1)}))}new CustomEvent("elementColorChange",{detail:{target:e,colorLinking:t}}),this.dispatchEvent(new CustomEvent("viewCanvasUpdate",{detail:{viewInstance:o}}))},elementChange:({element:e,type:t})=>{this.dispatchEvent(new CustomEvent("elementChange",{detail:{type:t,element:e}}))}}),o.init()}#ge(){if(this.viewInstances.length<this.currentViews.length)this.addView(this.currentViews[this.viewInstances.length]);else{if(this.removeEventListener("viewCreate",this.#ge),this.toggleSpinner(!1),this.selectView(0),!this.mainOptions.editorMode&&this.currentViewInstance&&this.currentViewInstance.fabricCanvas.wrapperEl.offsetParent){let e=null;this.currentViewInstance.fabricCanvas.getObjects().forEach((t=>{t.autoSelect&&!t.hasUploadZone&&(e=t)})),e&&setTimeout((()=>{this.currentViewInstance.fabricCanvas.setActiveObject(e)}),500)}this.productCreated=!0,this.dispatchEvent(new CustomEvent("productCreate"))}}#fe(e){this.viewInstances.push(e),e.fabricCanvas.on("sizeUpdate",(({canvasHeight:e})=>{let t=e+"px";this.productStage.style.height=t,this.container.classList.contains("fpd-sidebar")&&(this.mainBar.container.style.height=t)})),this.dispatchEvent(new CustomEvent("viewCreate",{detail:{viewInstance:e}})),e.fabricCanvas.onHistory(),e.fabricCanvas.clearHistory()}#me(){const e=this.currentElement;if(this.productCreated&&e&&!e.uploadZone&&!e.__editorMode){if(e.isOut&&"inside"===e.boundingBoxMode){const e=this.translator.getTranslation("misc","out_of_bounding_box");this.mainTooltip.innerHTML=e,this.mainTooltip.classList.add("fpd-show")}else this.mainOptions.imageSizeTooltip&&"image"===e.getType()?this.mainTooltip.classList.add("fpd-show"):this.mainTooltip.classList.remove("fpd-show");if(this.mainTooltip.classList.contains("fpd-show")){const t=e.oCoords,i=this.currentViewInstance.fabricCanvas.wrapperEl.getBoundingClientRect();this.mainTooltip.style.left=i.left+t.mt.x-this.mainTooltip.clientWidth/2+"px",this.mainTooltip.style.top=i.top+t.mt.y-this.mainTooltip.clientHeight-20+"px"}}else this.mainTooltip.classList.remove("fpd-show")}getViewIndexByWrapper(e){return Array.from(this.productStage.querySelectorAll(".fpd-view-stage")).indexOf(e)}toggleSpinner(e=!0,t=""){return this.mainLoader.querySelector(".fpd-loader-text").innerText=t,this.mainLoader.classList.toggle("fpd-hidden",!e),this.mainLoader}selectView(e=0){if(this.viewInstances.length<=0)return;this.currentViewInstance&&this.currentViewInstance.fabricCanvas&&this.currentViewInstance.fabricCanvas.resetZoom(),this.currentViewIndex=e,e<0?this.currentViewIndex=0:e>this.viewInstances.length-1&&(this.currentViewIndex=this.viewInstances.length-1),this.currentViewInstance&&this.currentViewInstance.fabricCanvas&&this.currentViewInstance.fabricCanvas.clearHistory(),this.currentViewInstance=this.viewInstances[this.currentViewIndex],this.deselectElement();const t=this.productStage.querySelectorAll(".fpd-view-stage");c(t,["fpd-hidden"]),d(t.item(this.currentViewIndex),["fpd-hidden"]),this.currentViewInstance.fabricCanvas.resetSize(),this.dispatchEvent(new CustomEvent("viewSelect"))}getElements(e,t="all",i=!0){e=void 0===e||isNaN(e)?-1:e,i&&this.deselectElement();let n=[];if(-1===e)for(var s=0;s<this.viewInstances.length;++s)n=n.concat(this.viewInstances[s].fabricCanvas.getObjects());else{if(!this.viewInstances[e])return[];n=this.viewInstances[e].fabricCanvas.getObjects()}if(n=n.filter((e=>!e._ignore)),"text"===t){let e=[];return n.forEach((t=>{"text"===t.getType(t)&&e.push(t)})),e}if("image"===t){let e=[];return n.forEach((function(t){"image"===t.getType()&&e.push(t)})),e}return n}getCustomElements(e="all",t=-1,i=!0){let n=[];return this.getElements(t,e,i).forEach((e=>{if(e.isCustom){const t=this.getViewIndexByWrapper(e.canvas.wrapperEl);n.push({element:e,viewIndex:t})}})),n}getFixedElements(e="all",t=-1,i=!0){let n=[];return this.getElements(t,e,i).forEach((e=>{if(e.fixed){const t=this.getViewIndexByWrapper(e.canvas.wrapperEl);n.push({element:e,viewIndex:t})}})),n}getElementByID(e,t){return t=void 0===t?this.currentViewIndex:t,this.viewInstances[t]?this.viewInstances[t].fabricCanvas.getElementByID(e):null}reset(){null!==this.currentViews&&(this.removeEventListener("viewCreate",this.#ge),this.deselectElement(),this.currentViewInstance.fabricCanvas.resetZoom(),this.currentViewIndex=this.currentPrice=this.singleProductPrice=this.pricingRulesPrice=0,this.currentViewInstance=this.currentViews=this.currentElement=null,this.viewInstances.forEach((e=>{e.fabricCanvas.clear()})),this.productStage.innerHTML="",this.viewsWrapper.container.querySelector(".fpd-views-selection").innerHTML="",this.viewInstances=[],this.dispatchEvent(new CustomEvent("clear")),this.dispatchEvent(new CustomEvent("priceChange")))}deselectElement(){this.currentViewInstance&&this.currentViewInstance.fabricCanvas&&(this.currentViewInstance.fabricCanvas.deselectElement(),this.currentElement=null)}formatPrice(e){const t=this.mainOptions.priceFormat;if(e&&"object"==typeof t){const n=t.thousandSep,s=t.decimalSep;let a=e.toString().split("."),o=a[0],r=a[1],l="";if(void 0!==o){for(var i=o.length-1;i>=0;i--)l+=o.charAt(i);for(l=l.replace(/(\d{3})/g,"$1"+n),l.slice(-n.length)==n&&(l=l.slice(0,-n.length)),o="",i=l.length-1;i>=0;i--)o+=l.charAt(i);void 0!==r&&r.length>0&&(1==r.length&&(r+="0"),o+=s+r)}return o=t.currency.replace("%d",o.toString()),o}return e&&(e=t.priceFormat.replace("%d",e)),e}addCustomImage(e,t,i={},n){n=void 0===n?this.currentViewIndex:n;const a=new Image;a.crossOrigin="anonymous",a.src=e,this.toggleSpinner(!0,this.translator.getTranslation("misc","loading_image")),c(this.viewsWrapper.container,["fpd-disabled"]),a.onload=()=>{this.loadingCustomImage=!1;let o=a.height,r=a.width,l=this.currentViewInstance.options.customImageParameters;if(!v(this,r,o))return this.toggleSpinner(!1),!1;let c={isCustom:!0};a.src.includes(".svg")&&!l.colors&&(c.colors=!0);let p=s(l,c);p=s(p,i),this.viewInstances[n].fabricCanvas.addElement("image",e,t,p,n),d(this.viewsWrapper.container,["fpd-disabled"])},a.onerror=()=>{j("Image could not be loaded!")}}_addGridItemToCanvas(e,t={},i){if(!this.currentViewInstance)return;i=void 0===i?this.currentViewIndex:i;const n=s({_addToUZ:this.currentViewInstance.currentUploadZone},t);this._addCanvasImage(e.dataset.source,e.dataset.title,n,i)}_addCanvasImage(e,t,i={},n){if(!this.currentViewInstance)return;n=void 0===n?this.currentViewIndex:n;let s=!e.includes(window.location.origin);this.uploadsToServer&&s?this._downloadRemoteImage(e,t,i):(this.loadingCustomImage=!0,this.addCustomImage(e,t,i,n)),this.productCreated&&this.mainOptions.hideDialogOnAdd&&this.mainBar&&this.mainBar.toggleContentDisplay(!1)}_downloadRemoteImage(e,t,i={}){this.loadingCustomImage=!0,this.toggleSpinner(!0,this.translator.getTranslation("misc","loading_image")),c(this.viewsWrapper.container,["fpd-disabled"]);const n=new FormData;n.append("uploadsDir",this.uploadsDir),n.append("uploadsDirURL",this.uploadsDirURL),n.append("saveOnServer",this.uploadsToServer),n.append("url",e),(e=>{let t=e.url,i={Accept:"application/json"};!e.body instanceof FormData&&(i["Content-Type"]="application/json"),fetch(t,{method:"POST",redirect:"follow",headers:i,body:e.body instanceof FormData?e.body:JSON.stringify(e.body)}).then((e=>e.json())).then((t=>{e.onSuccess&&e.onSuccess(t)})).catch((t=>{e.onError&&e.onError(t)}))})({url:this.uploadsURL,body:n,onSuccess:e=>{e&&e.image_src?this.addCustomImage(e.image_src,e.filename?e.filename:t,i):(this.toggleSpinner(!1),j(e.error))},onError:e=>{this.loadingCustomImage=!1,this.toggleSpinner(!1),j(data.error)}}),this.productCreated&&this.mainOptions.hideDialogOnAdd&&this.mainBar&&this.mainBar.toggleContentDisplay(!1)}addCanvasDesign(e,t,i={},n){this.currentViewInstance&&(this.toggleSpinner(!0,this.translator.getTranslation("misc","loading_image")),(i=s(this.currentViewInstance.options.customImageParameters,i)).isCustom=!0,this.currentViewInstance.currentUploadZone&&(i._addToUZ=this.currentViewInstance.currentUploadZone),this.currentViewInstance.fabricCanvas.addElement("image",e,t,i,n),this.productCreated&&this.mainOptions.hideDialogOnAdd&&this.mainBar&&this.mainBar.toggleContentDisplay(!1))}}window.FancyProductDesigner=le,window.FPDEmojisRegex=/(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC69\uDC6E\uDC70-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD26\uDD30-\uDD39\uDD3D\uDD3E\uDDD1-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])?|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDEEB\uDEEC\uDEF4-\uDEF8]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD4C\uDD50-\uDD6B\uDD80-\uDD97\uDDC0\uDDD0-\uDDE6])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267B\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEF8]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD4C\uDD50-\uDD6B\uDD80-\uDD97\uDDC0\uDDD0-\uDDE6])\uFE0F/g})()})();