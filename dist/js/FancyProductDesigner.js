(()=>{var e={423:()=>{var e;fabric.Canvas.prototype.initialize=(e=fabric.Canvas.prototype.initialize,function(...t){return e.call(this,...t),this._historyInit(),this}),fabric.Canvas.prototype.dispose=function(e){return function(...t){return e.call(this,...t),this._historyDispose(),this}}(fabric.Canvas.prototype.dispose),fabric.Canvas.prototype._historyNext=function(){return JSON.stringify(this.toDatalessJSON(this.extraProps))},fabric.Canvas.prototype._historyEvents=function(){return{"object:added":this._historySaveAction,"object:removed":this._historySaveAction,"object:modified":this._historySaveAction,"object:skewing":this._historySaveAction}},fabric.Canvas.prototype._historyInit=function(){this.historyUndo=[],this.historyRedo=[],this.extraProps=["selectable","editable"],this.historyNextState=this._historyNext(),this.on(this._historyEvents())},fabric.Canvas.prototype._historyDispose=function(){this.off(this._historyEvents())},fabric.Canvas.prototype._historySaveAction=function(){if(this.historyProcessing)return;const e=this.historyNextState;this.historyUndo.push(e),this.historyNextState=this._historyNext(),this.fire("history:append",{json:e})},fabric.Canvas.prototype.undo=function(e){this.historyProcessing=!0;const t=this.historyUndo.pop();t?(this.historyRedo.push(this._historyNext()),this.historyNextState=t,this._loadHistory(t,"history:undo",e)):this.historyProcessing=!1},fabric.Canvas.prototype.redo=function(e){this.historyProcessing=!0;const t=this.historyRedo.pop();t?(this.historyUndo.push(this._historyNext()),this.historyNextState=t,this._loadHistory(t,"history:redo",e)):this.historyProcessing=!1},fabric.Canvas.prototype._loadHistory=function(e,t,i){var s=this;this.loadFromJSON(e,(function(){s.renderAll(),s.fire(t),s.historyProcessing=!1,i&&"function"==typeof i&&i()}))},fabric.Canvas.prototype.clearHistory=function(){this.historyUndo=[],this.historyRedo=[],this.fire("history:clear")},fabric.Canvas.prototype.onHistory=function(){this.historyProcessing=!1,this._historySaveAction()},fabric.Canvas.prototype.offHistory=function(){this.historyProcessing=!0}},561:()=>{class e extends HTMLElement{constructor(){super()}connectedCallback(){}}customElements.define("fpd-actions-bar",e)}},t={};function i(s){var n=t[s];if(void 0!==n)return n.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,i),a.exports}(()=>{"use strict";const e=(e="",t=!1,i="",s=document.body)=>{s===document.body&&s.classList.add("fpd-overflow-hidden"),"prompt"===i?e=`\n            <input type="text" placeholder="${e}" />\n            <span class="fpd-btn"></span>\n        `:"confirm"===i&&(e=`\n            <div class="fpd-confirm-msg">${e}</div>\n            <span class="fpd-btn fpd-confirm"></span>\n        `);let n=`\n        <div class="fpd-modal-wrapper fpd-shadow-3">\n            <div class="fpd-modal-close">\n                <span class="fpd-icon-close"></span>\n            </div>\n            <div class="fpd-modal-content">${e}</div>\n        </div>\n    `;const a=document.createElement("div");return a.className="fpd-modal-internal fpd-modal-overlay "+(t?"fpd-fullscreen":""),a.innerHTML=n,a.dataset.type=i,s.append(a),o(a.querySelector(".fpd-modal-close"),["click"],(e=>{a.remove()})),a},t=e=>"[object Object]"===Object.prototype.toString.call(e),s=(e,i)=>{const n={...e,...i};if(Object.keys(i).length)for(const a of Object.keys(n))t(n[a])&&e[a]&&i[a]&&(n[a]=s(e[a],i[a]));return n},n=e=>/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e),a=e=>0===e||"string"==typeof e&&"0"===e,o=(e,t=[],i=(()=>{}))=>{(t="string"==typeof t?[t]:t).forEach((t=>{e instanceof HTMLElement?e.addEventListener(t,i):Array.from(e).length?e.forEach((e=>{e.addEventListener(t,i)})):e.addEventListener(t,i)}))},r=(e=[],t=[])=>(e&&(e instanceof HTMLElement?t.forEach((t=>{e.classList.add(t)})):e.forEach((e=>{t.forEach((t=>{e.classList.add(t)}))}))),e),d=(e=[],t=[])=>(e&&(e instanceof HTMLElement?t.forEach((t=>{e.classList.remove(t)})):e.forEach((e=>{t.forEach((t=>{e.classList.remove(t)}))}))),e),l=(e,t=null)=>{if(e){e.classList.add("fpd-on-loading");var i=new Image;i.src=t||e.dataset.img,i.onload=function(){e.dataset.originwidth=this.width,e.dataset.originheight=this.height,e.classList.remove("fpd-on-loading"),e.style.backgroundImage='url("'+this.src+'")'},i.onerror=function(){e.parentNode.remove()}}},c=e=>void 0===e||null==e||("string"==typeof e?!e.trim().length:Array.isArray(e)?!e.length:"object"==typeof e&&!Object.keys(e).length),p=()=>{var e=!0;try{window.localStorage.length,window.localStorage.setItem("fpd-storage","just-testing")}catch(t){e=!1}return e},h=(e={})=>{if(!e.url)return;const t=document.createElement("div");t.className="fpd-item",t.dataset.source=e.url,e.title&&(t.dataset.title=e.title);const i=document.createElement("picture");if(i.dataset.img=e.thumbnailUrl?e.thumbnailUrl:e.url,t.append(i),e.price){const i=document.createElement("span");i.className="fpd-price",i.innerHTML=e.price,t.append(i)}if(e.removable){const e=document.createElement("span");e.className="fpd-delete fpd-icon-remove",t.append(e)}return t};class u{static defaults={imageLoadTimestamp:!1,stageWidth:900,stageHeight:600,editorMode:!1,editorBoxParameters:["left","top","angle","fill","width","height","fontSize","price"],fonts:[{name:"Arial"},{name:"Lobster",url:"google"}],facebookAppId:"",instagramClientId:"",instagramRedirectUri:"",instagramTokenUri:"",zoomStep:.2,maxZoom:3,hexNames:{},selectedColor:"#f5f5f5",boundingBoxColor:"#2185d0",outOfBoundaryColor:"#990000",replaceInitialElements:!1,customImageAjaxSettings:{url:"php/custom-image-handler.php",data:{saveOnServer:0,uploadsDir:"./uploads",uploadsDirURL:"http://yourdomain.com/uploads"}},improvedResizeQuality:!1,responsive:!0,cornerIconColor:"#000000",langJSON:"lang/default.json",colorPickerPalette:[],actions:{top:[],right:[],bottom:[],left:[]},mainBarModules:["products","images","text","designs","manage-layers"],initialActiveModule:"",maxValues:{},watermark:!1,priceFormat:{currency:"&#36;%d",decimalSep:".",thousandSep:","},mainBarContainer:!1,modalMode:!1,keyboardControl:!0,deselectActiveOnOutside:!0,uploadZonesTopped:!0,loadFirstProductInStage:!0,unsavedProductAlert:!1,hideDialogOnAdd:!0,toolbarPlacement:"smart",snapGridSize:[50,50],fabricCanvasOptions:{},namesNumbersDropdown:[],namesNumbersEntryPrice:0,colorSelectionPlacement:"",colorSelectionDisplayType:"grid",bulkVariationsPlacement:"",bulkVariations:{},toolbarDynamicContext:"body",boundingBoxProps:{strokeWidth:1},fitImagesInCanvas:!1,maxPrice:-1,inCanvasTextEditing:!0,openTextInputOnSelect:!1,designCategories:[],optionalView:!1,saveActionBrowserStorage:!0,pricingRules:[],uploadAgreementModal:!1,imageEditorSettings:{masks:[]},printingBox:null,autoOpenInfo:!1,guidedTour:null,replaceColorsInColorGroup:!1,allowedImageTypes:["jpeg","png","svg","pdf"],pixabayApiKey:"",pixabayHighResImages:!1,pixabayLang:"en",openModalInDesigner:!1,imageSizeTooltip:!1,highlightEditableObjects:"",applyFillWhenReplacing:!0,layouts:[],dynamicViewsOptions:{unit:"mm",formats:[],pricePerArea:0,minWidth:0,minHeight:0,maxWidth:1e4,maxHeight:1e4},disableTextEmojis:!1,smartGuides:!1,usePrintingBoxAsBounding:!1,printingBox:{},productsJSON:null,designsJSON:null,customizationRequiredRule:"any",swapProductConfirmation:!1,setTextboxWidth:!1,textLinkGroupProps:[],textTemplates:[],multiSelection:!1,maxCanvasHeight:.8,mobileGesturesBehaviour:"none",imageQualityRatings:null,splitMultiSVG:!1,cornerControlsStyle:"advanced",downloadFilename:"Product",autoFillUploadZones:!1,dragDropImagesToUploadZones:!1,responsiveBreakpoints:{small:768,medium:1024},dynamicDesigns:{},elementParameters:{objectCaching:!1,z:-1,price:0,colors:!1,removable:!1,draggable:!1,rotatable:!1,resizable:!1,copyable:!1,zChangeable:!1,boundingBox:!1,boundingBoxMode:"clipping",autoCenter:!1,replace:"",replaceInAllViews:!1,autoSelect:!1,topped:!1,colorPrices:{},colorLinkGroup:!1,patterns:[],sku:"",excludeFromExport:!1,showInColorSelection:!1,locked:!1,uniScalingUnlockable:!1,fixed:!1,originX:"center",originY:"center",cornerSize:24,fill:!1,lockUniScaling:!0,pattern:!1,top:0,left:0,angle:0,flipX:!1,flipY:!1,opacity:1,scaleX:1,scaleY:1},textParameters:{maxLength:0,curved:!1,curvable:!1,curveSpacing:10,curveRadius:80,curveReverse:!1,maxLines:0,textBox:!1,textPlaceholder:!1,numberPlaceholder:!1,letterSpacing:0,chargeAfterEditing:!1,minFontSize:1,textTransform:"none",widthFontSize:0,maxFontSize:200,shadowColor:"",shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,textLinkGroup:"",strokeColors:[],editable:!0,fontFamily:"Arial",fontSize:18,lineHeight:1,fontWeight:"normal",fontStyle:"normal",textDecoration:"normal",padding:10,textAlign:"left",stroke:null,strokeWidth:0,charSpacing:0},imageParameters:{uploadZone:!1,filter:null,scaleMode:"fit",resizeToW:0,resizeToH:0,advancedEditing:!1,uploadZoneMovable:!1,uploadZoneRemovable:!1,padding:0,minScaleLimit:.01},customImageParameters:{minW:100,minH:100,maxW:1500,maxH:1500,minDPI:72,maxSize:10},customTextParameters:{},customAdds:{designs:!0,uploads:!0,texts:!0,drawing:!0},qrCodeProps:{autoCenter:!0,draggable:!0,removable:!0,resizable:!0}};static merge(e={},t={}){return s(e,t)}static getParameterKeys(){var e=Object.keys(this.defaults.elementParameters),t=Object.keys(this.defaults.imageParameters),i=Object.keys(this.defaults.textParameters);return(e=e.concat(t)).concat(i)}}window.FPDOptions=u,i(423);const g=e=>"text"===e||"i-text"===e||"curvedText"===e||"textbox"===e?"text":"image",m=(e,t,i,s,n="fit")=>{let a=1,o=0!==(i="number"!=typeof i?0:i),r=0!==(s="number"!=typeof s?0:s);return a="cover"===n?i-e<s-t?o?Math.max(i/e,s/t):1:r?Math.max(i/e,s/t):1:e>t?o?Math.min(i/e,s/t):1:r?Math.min(i/e,s/t):1,parseFloat(a.toFixed(10))};class f extends EventTarget{fabricOptions={};options={};canvasElem=null;fabricCanvas=null;elements=[];initialElementsLoaded=!1;undos=[];redos=[];responsiveScale=1;isCustomized=!1;constructor(e,t={},i={}){super(),this.fabricOptions=t,this.options=i,this.canvasElem=document.createElement("canvas"),e.append(this.canvasElem),this.fabricCanvas=new fabric.Canvas(this.canvasElem,t),this.fabricCanvas.setDimensions({width:this.options.stageWidth,height:this.options.stageHeight})}addElements(e,t){let i=0;const s=()=>{if(i++,i<e.length){const t=e[i];n(t)||this.addElement(t.type,t.source,t.title,t.parameters)}else this.undos=[],this.redos=[],this.dispatchEvent(new CustomEvent("undoRedoSet")),this.removeEventListener("elementAdd",s),void 0!==t&&t.call(t,this),this.initialElementsLoaded=!0},n=t=>{if(void 0===t.type||void 0===t.source||void 0===t.title){const i=e.indexOf(t);if(-1!==i)return console.log("Element index "+i+" from elements removed, its not a valid element object!","info"),s(),!0}else this.elements.push(t);return!1};let a=e[0];a?(o(this,"elementAdd",s),n(a)||this.addElement(a.type,a.source,a.title,a.parameters)):(void 0!==t&&t.call(t,instance),this.initialElementsLoaded=!0)}addElement(e,t,i,a={}){if(void 0===e||void 0===t||void 0===i)return;let o;if(this.dispatchEvent(new CustomEvent("beforeElementAdd",{detail:{type:e,source:t,title:i,params:a}})),"text"===e&&(t=(t=t.replace(/(<([^>]+)>)/gi,"")).replace(FancyProductDesigner.forbiddenTextChars,""),i=i.replace(/(<([^>]+)>)/gi,"")),"string"==typeof a.fill||Array.isArray(a.fill)||(a.fill=!1),o="text"===g(e)?s(this.options.elementParameters,this.options.textParameters):s(this.options.elementParameters,this.options.imageParameters),(a=s(o,a)).colors&&"string"==typeof a.colors&&0==a.colors.indexOf("#")){var r=a.colors.replace(/\s+/g,"").split(",");a.colors=r}if(a._isInitial=!this.initialElementsLoaded,"text"===g(e)){var d=a.colors[0]?a.colors[0]:"#000000";a.fill=a.fill?a.fill:d}let l={source:t,title:i,id:String((new Date).getTime()),cornerColor:this.options.selectedColor,cornerIconColor:this.options.cornerIconColor};if(this.options.editorMode?(a.__editorMode=this.options.editorMode,l.selectable=l.evented=!0):l=s(l,{selectable:!1,lockRotation:!0,hasRotatingPoint:!1,lockScalingX:!0,lockScalingY:!0,lockMovementX:!0,lockMovementY:!0,hasControls:!1,evented:!1,lockScalingFlip:!0}),l=s(a,l),l.isCustom&&(this.isCustomized=!0),this.options.usePrintingBoxAsBounding&&!l.boundingBox&&((e,t)=>{if(e&&"object"==typeof e){let n=!0;for(var i=0;i<t.length;++i){var s=t[i];if(!e.hasOwnProperty(s)){n=!1;break}}return n}return!1})(this.options.printingBox,["left","top","width","height"])&&(l.boundingBox={x:this.options.printingBox.left-1,y:this.options.printingBox.top-1,width:this.options.printingBox.width+1,height:this.options.printingBox.height+1}),"image"==e||"path"==e||"group"==e){if(l.crossOrigin="",l.lockUniScaling=!this.options.editorMode&&!l.uniScalingUnlockable,-1===t.search("<svg ")){var c=t.split("?");t=l.source=c[0]}const e=(e,t,i,n={})=>{e?(t.originParams=s(t,n),e.setOptions(t),this.fabricCanvas.add(e),this.setElementParameters(t,e,!1),e.originParams.angle=e.angle,e.originParams.z=this.getZIndex(e),e._isInitial||e._ignore||this.#e({element:e,parameters:t,interaction:"add"})):this.dispatchEvent(new CustomEvent("imageFail",{detail:{url:t.source}})),this.dispatchEvent(new CustomEvent("elementAdd",{detail:{element:e}}))};if(void 0===t||0===t.length)return void console.log("No image source set for: "+i);if(-1!==t.search("<svg"))fabric.loadSVGFromString(t,((t,i)=>{var s=fabric.util.groupSVGElements(t,i);if(l.fill)l.svgFill||(l.svgFill=l.fill),delete l.fill;else if(!l.fill&&!l.svgFill){if(t){a.colors=[];for(var n=0;n<t.length;++n){var o=t[n].fill.length>0?tinycolor(t[n].fill).toHexString():"transparent";a.colors.push(o)}a.svgFill=a.colors}l.svgFill=a.svgFill}delete l.clippingRect,delete l.boundingBox,delete l.originParams,delete l.colors,delete l.svgFill,delete l.width,delete l.height,delete l.originX,delete l.originY,delete l.objectCaching,e(s,l,!0,{svgFill:a.svgFill})}));else if(t.split(".").includes("svg")){let i=Date.now().toString(),s=this.options._loadFromScript?this.options._loadFromScript:"",o=n(t)?new URL(s+t):t;!t.includes(".cloudfront.net/")&&!this.options.imageLoadTimestamp||this.options._loadFromScript||o.searchParams.append("t",i),"object"==typeof o&&(o=o.toString()),fabric.loadSVGFromURL(o,((t,i)=>{var s=t?fabric.util.groupSVGElements(t,i):null;if(l.fill)l.svgFill||(l.svgFill=l.fill),delete l.fill;else if(!l.fill&&!l.svgFill){if(t){a.colors=[];for(var n=0;n<t.length;++n){var o=t[n].fill.length>0?tinycolor(t[n].fill).toHexString():"transparent";a.colors.push(o)}a.svgFill=a.colors}l.svgFill=a.svgFill}e(s,l,!0,{svgFill:a.svgFill})}))}else{var p,h=Date.now().toString(),u=this.options._loadFromScript?this.options._loadFromScript:"";-1==t.indexOf("data:image/")?(p=n(t)?new URL(u+t):t,this.options.imageLoadTimestamp&&!this.options._loadFromScript&&p.searchParams.append("t",h),"object"==typeof p&&(p=p.toString())):p=t,new fabric.Image.fromURL(p,(function(t){t=""===t.getSrc()?null:t,e(t,l,!1)}),{crossOrigin:"anonymous"})}}else if("text"===g(e)){var m;if(t=t.replace(/\\n/g,"\n"),a.text=a.text?a.text:t,l._initialText=a.hasOwnProperty("_initialText")?a._initialText:a.text,l=s(l,{spacing:a.curveSpacing,radius:a.curveRadius,reverse:a.curveReverse,originParams:{...a}}),a.originParams&&a.originParams.text&&(l.originParams.text=l._initialText),a.curved&&void 0!==fabric.CurvedText){var f=l.text;m=new fabric.CurvedText(t,l),l.text=f}else a.textBox?(l.lockUniScaling=!this.options.editorMode,this.options.setTextboxWidth&&(l.lockUniScaling=!1,l.lockScalingX=!1),l.lockScalingY=!0,(m=new fabric.Textbox(t,l)).setControlVisible("bl",!0),this.options.inCanvasTextEditing||m.on({"editing:entered":function(){this.exitEditing()}})):(m=new fabric.IText(t,l),this.options.inCanvasTextEditing||m.on({"editing:entered":function(){this.exitEditing()}}));(l.textPlaceholder||l.numberPlaceholder)&&(l.textPlaceholder&&(this.textPlaceholder=m,l.removable=!1,l.editable=!1),l.numberPlaceholder&&(this.numberPlaceholder=m,l.removable=!1,l.editable=!1)),this.fabricCanvas.add(m),this.setElementParameters(l,m,!1),m.originParams=s(m.toJSON(),m.originParams),delete m.originParams.clipTo,m.originParams.z=this.getZIndex(m),m._isInitial||m._ignore||this.#e({element:m,parameters:l,interaction:"add"}),this.dispatchEvent(new CustomEvent("elementAdd",{detail:{element:m}}))}else console.log("Sorry. This type of element is not allowed!")}setElementParameters(e,t,i=!0){if(!(t=void 0===t?this.fabricCanvas.getActiveObject():t)||void 0===e)return!1;"string"==typeof t&&(t=this.getElementByTitle(t));var n,o=g(t.type);if(i&&this.initialElementsLoaded){var r=this.getElementJSON();t._tempFill&&(r.fill=t._tempFill,t._tempFill=void 0),t._ignore||this.#e({element:t,parameters:r,interaction:"modify"})}if("image"==g(t.type)&&!t._isInitial&&!t._addToUZ&&1===t.scaleX){var d=null;if(a(t.resizeToW)&&a(t.resizeToH)){if(t.boundingBox){var l=this.getBoundingBoxCoords(t);d=m(t.width,t.height,l.width,l.height,t.scaleMode)}else if(this.options.fitImagesInCanvas){var p=3*t.cornerSize;(t.width*t.scaleX+p>this.options.stageWidth||t.height*t.scaleY+p>this.options.stageHeight)&&(d=m(t.width,t.height,this.options.stageWidth-p,this.options.stageHeight-p))}}else{var h=t.resizeToW,u=t.resizeToH;h=isNaN(h)?parseFloat(h)/100*this.options.stageWidth:parseInt(h),u=isNaN(u)?parseFloat(u)/100*this.options.stageHeight:parseInt(u),d=m(t.width,t.height,h,u,t.scaleMode)}null!==d&&(e=s(e,{scaleX:d,scaleY:d}))}if(t._addToUZ&&""!=t._addToUZ){e.z=-1;var f=this.getElementByTitle(t._addToUZ);d=1,"image"==g(t.type)&&(d=m(t.width,t.height,f.width*f.scaleX,f.height*f.scaleY,f.scaleMode)),(e=s(e,{boundingBox:t._addToUZ,boundingBoxMode:"clipping",scaleX:d,scaleY:d,autoCenter:!0,removable:!0,zChangeable:!1,autoSelect:!1,copyable:!1,hasUploadZone:!0,z:this.getZIndex(this.getElementByTitle(t._addToUZ)),rotatable:f.rotatable,draggable:f.draggable,resizable:f.resizable,price:f.price?f.price:e.price,replace:t._addToUZ,lockUniScaling:f.lockUniScaling,uniScalingUnlockable:f.uniScalingUnlockable,advancedEditing:f.advancedEditing,originX:f.originX,originY:f.originY,angle:f.angle})).originParams=s(e.originParams,{boundingBox:e.boundingBox,replace:e.replace,rotatable:e.rotatable,draggable:e.draggable,resizable:e.resizable,lockUniScaling:e.lockUniScaling,uniScalingUnlockable:e.uniScalingUnlockable,price:e.price,scaleX:e.scaleX,scaleY:e.scaleY,hasUploadZone:!0,autoCenter:!0,originX:e.originX,originY:e.originY,angle:e.angle}),delete e[""],delete t._addToUZ}if(e.topped&&(e.zChangeable=!1),(e=>e&&("object"==typeof e.colors||!0===e.colors||1==e.colors||e.removable||e.draggable||e.resizable||e.rotatable||e.zChangeable||e.advancedEditing||e.editable||e.uploadZone||e.colorLinkGroup&&e.colorLinkGroup.length>0||e.__editorMode))(e)&&(e.isEditable=e.evented=e.selectable=!0),e.uploadZone&&!this.options.editorMode||(e.draggable&&(e.lockMovementX=e.lockMovementY=!1),e.rotatable&&(e.lockRotation=!1,e.hasRotatingPoint=!0),e.resizable&&(e.lockScalingX=e.lockScalingY=!1),(e.resizable||e.rotatable||e.removable)&&(e.hasControls=!0)),e.uploadZone&&(this.options.editorMode||(e.uploadZoneMovable&&(e.lockMovementX=e.lockMovementY=!1),e.uploadZoneRemovable&&(e.removable=!0,e.copyable=!1,e.hasControls=!0)),"3.0.0"!==fabric.version&&(e.lockRotation=!0,e.hasRotatingPoint=!1),e.excludeFromExport=!0),e.fixed&&c(e.replace)&&(e.replace=t.title),e.replace&&""!=e.replace){var v=this.getElementByReplace(e.replace);null!==v&&v!==t&&(e.z=this.getZIndex(v),e.left=t.originParams.left=v.left,e.top=t.originParams.top=v.top,e.autoCenter=!1,this.options.applyFillWhenReplacing&&(e.fill=v.fill),this.removeElement(v))}if("string"==typeof e.text&&(b=(b=e.text).replace(FancyProductDesigner.forbiddenTextChars,""),this.options.disableTextEmojis&&(b=(b=b.replace(FPDEmojisRegex,"")).replace(String.fromCharCode(65039),"")),0!=t.maxLength&&b.length>t.maxLength&&(b=b.substr(0,t.maxLength),t.selectionStart=t.maxLength),0!=t.maxLines&&("textbox"==t.type&&t.__lineHeights?b=_maxTextboxLines(t,b):b.split("\n").length>t.maxLines&&(b=b.replace(/([\s\S]*)\n/,"$1"),t.exitEditing())),t.set("text",b),e.text=b,this.initialElementsLoaded&&t.chargeAfterEditing&&(t._isPriced||(t._isPriced=!0),t._initialText===b&&t._isPriced&&(t._isPriced=!1))),"text"===o){if(e.hasOwnProperty("textDecoration")&&(e.underline="underline"===e.textDecoration),void 0!==e.letterSpacing&&(e.charSpacing=100*e.letterSpacing),e.fontSize&&e.fontSize<t.minFontSize?e.fontSize=t.minFontSize:e.fontSize&&e.fontSize>t.maxFontSize&&(e.fontSize=t.maxFontSize),e.text&&("uppercase"===t.textTransform?b=b.toUpperCase():"lowercase"===t.textTransform&&(b=b.toLowerCase()),t.set("text",b),e.text=b),e.textTransform){var b=t.text;"uppercase"===e.textTransform?b=b.toUpperCase():"lowercase"===e.textTransform&&(b=b.toLowerCase()),t.set("text",b),e.text=b}if((e.shadowColor||e.shadowBlur||e.shadowOffsetX||e.shadowOffsetY)&&!t.shadow){var y={color:e.shadowColor?e.shadowColor:"rgba(0,0,0,0)"};t.setShadow(y)}t.shadow&&e.hasOwnProperty("shadowColor")&&(e.shadowColor?t.shadow.color=e.shadowColor:t.setShadow(null)),t.shadow&&(e.shadowBlur&&(t.shadow.blur=e.shadowBlur),e.shadowOffsetX&&(t.shadow.offsetX=e.shadowOffsetX),e.shadowOffsetY&&(t.shadow.offsetY=e.shadowOffsetY))}delete e.paths,t.setOptions(e),"i-text"==t.type&&t.widthFontSize&&t.text.length>0&&((n=t.width>t.widthFontSize?t.fontSize*(t.widthFontSize/(t.width+1)):t.fontSize*(t.widthFontSize/(t.width-1)))<t.minFontSize?n=t.minFontSize:n>t.maxFontSize&&(n=t.maxFontSize),n=parseInt(n),e.fontSize=n,t.set("fontSize",n)),t.boundingBox&&"clipping"===e.boundingBoxMode||e.hasUploadZone,e.autoCenter,(void 0!==e.fill||void 0!==e.svgFill)&&(void 0!==e.svgFill?e.svgFill:e.fill,t.pattern=void 0),e.pattern,e.filter,t.canvas&&e.z>=0&&t.moveTo(e.z),t.curved&&(e.curveRadius&&t.set("radius",e.curveRadius),e.curveSpacing&&t.set("spacing",e.curveSpacing),void 0!==e.curveReverse&&t.set("reverse",e.curveReverse)),t.uploadZone?t.evented=0!==t.opacity:t.isEditable&&!this.options.editorMode&&(t.evented=!e.locked),"basic"==this.options.cornerControlsStyle&&t.lockScalingX&&t.lockScalingY;for(var x=this.fabricCanvas.getObjects(),w=0;w<x.length;++w){var I=x[w];I.uploadZone&&I.title==e.replace&&(I.opacity=0,I.evented=!1)}t.setCoords(),this.fabricCanvas.renderAll().calcOffset(),e.autoSelect&&t.isEditable&&!this.options.editorMode&&$(this.fabricCanvas.getElement()).is(":visible")&&setTimeout((function(){this.stage.setActiveObject(t),this.fabricCanvas.renderAll()}),350)}removeElement(e){if("string"==typeof e&&(e=instance.getElementByTitle(e)),!e._ignore){var t=instance.getElementJSON(e);t.z=instance.getZIndex(e),this.#e({element:e,parameters:t,interaction:"remove"})}this.deselectElement(),setTimeout((function(){this.fabricCanvas.remove(e),_elementHasUploadZone(e),$this.trigger("elementRemove",[e])}),1)}getElementByReplace(e){const t=this.fabricCanvas.getObjects();for(var i=0;i<t.length;++i){var s=t[i];if(s.replace===e)return s}return null}getBoundingBoxCoords(e){if(e.boundingBox||e.uploadZone){if("object"==typeof e.boundingBox)return!!(e.boundingBox.hasOwnProperty("x")&&e.boundingBox.hasOwnProperty("y")&&e.boundingBox.width&&e.boundingBox.height)&&{left:e.boundingBox.x,top:e.boundingBox.y,width:e.boundingBox.width,height:e.boundingBox.height};for(var t=this.fabricCanvas.getObjects(),i=0;i<t.length;++i){var s=t[i];if(e.boundingBox==s.title){var n=s.getPointByOrigin("left","top");return{left:n.x,top:n.y,width:s.width*s.scaleX,height:s.height*s.scaleY,angle:s.angle||0,cp:s.getCenterPoint()}}}}return!1}getZIndex(e){return e=void 0===e?this.fabricCanvas.getActiveObject():e,this.fabricCanvas.getObjects().indexOf(e)}getElementByTitle(e){const t=this.fabricCanvas.getObjects();for(var i=0;i<t.length;++i)if(t[i].title===e)return t[i]}getElementByID(e){const t=this.fabricCanvas.getObjects();for(var i=0;i<t.length;++i)if(t[i].id==e)return t[i];return!1}reset(e=!0){this.undos=[],this.redos=[],instance.elements=[],instance.totalPrice=instance.truePrice=instance.additionalPrice=0,instance.stage.clear(),e&&instance.stage.wrapperEl.remove(),$this.trigger("clear"),$this.trigger("priceChange",[0,0])}#e(e,t,i=!0){}}class v extends EventTarget{static relevantOptions=["stageWidth","stageHeight","customAdds","elementParameters","imageParameters","textParameters","customImageParameters","customTextParameters","maxPrice","optionalView","designCategories","printingBox","output","layouts","usePrintingBoxAsBounding","threeJsPreviewModel","editorMode","imageLoadTimestamp","_loadFromScript","fitImagesInCanvas","setTextboxWidth","inCanvasTextEditing","applyFillWhenReplacing","disableTextEmojis","cornerControlsStyle","responsive","maxCanvasHeight"];viewData;onCreatedCallback;title;thumbnail;options;fpdCanvas=null;canvasElem=null;fabricCanvas=null;responsiveScale=1;constructor(t,i={},n,a={}){super(),this.viewData=i,this.onCreatedCallback=n,this.title=i.title,this.thumbnail=i.thumbnail,this.options=i.options;const r="rgba(84,223,230,1.00)",d=s({containerClass:"fpd-view-stage fpd-hidden",selection:this.options.multiSelection,selectionBorderColor:r,selectionColor:r,hoverCursor:"pointer",controlsAboveOverlay:!0,centeredScaling:!0,allowTouchScrolling:!0,preserveObjectStacking:!0},a);this.fpdCanvas=new f(t,d,this.options),o(this.fpdCanvas,"imageFail",(t=>{e(`\n                    <p>The image with the URL<br /><i style='font-size: 10px;'>${t.detail.url}</i><br />can not be loaded into the canvas.</p>\n                    <p><b>Troubleshooting</b>\n                        <ul>\n                            <li>The URL is not correct!</li>\n                            <li>The image has been blocked by <a href='https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS' target='_blank'>CORS policy</a>. You need to host the image under the same protocol and domain or enable 'Access-Control-Allow-Origin' on the server where you host the image. <a href='http://enable-cors.org/' target='_blank'>Read more about it here.</a><\n                            /li>\n                        </ul>\n                    </p>\n                `)})),this.canvasElem=this.fpdCanvas.canvasElem,this.fabricCanvas=this.fpdCanvas.fabricCanvas}init(){this.loadElements(this.viewData.elements,this.#t.bind(this))}loadElements(e,t){this.fpdCanvas.initialElementsLoaded&&this.fpdCanvas.reset(!1),this.fpdCanvas.addElements(e,t)}resetSize(){const e=this.fabricCanvas.wrapperEl.clientWidth;if(this.responsiveScale=e<this.options.stageWidth?e/this.options.stageWidth:1,!isNaN(this.options.maxCanvasHeight)&&1!==this.options.maxCanvasHeight){const e=window.innerHeight*parseFloat(this.options.maxCanvasHeight);this.options.stageHeight>this.options.stageWidth&&this.options.stageHeight*this.responsiveScale>e&&(this.responsiveScale=e/this.options.stageHeight)}return this.responsiveScale=parseFloat(Number(this.responsiveScale.toFixed(7))),this.responsiveScale=Math.min(this.responsiveScale,1),this.options.responsive||(this.responsiveScale=1),this.fabricCanvas.setDimensions({width:e,height:this.options.stageHeight*this.responsiveScale}).setZoom(this.responsiveScale).calcOffset().renderAll(),this.dispatchEvent(new CustomEvent("sizeUpdate",{detail:{}})),this.responsiveScale}#t(){this.onCreatedCallback(this)}}window.FancyProductDesigner=v;class b{static parseFontsToEmbed(e,t=""){var i="";if(e.hasOwnProperty("url")){e.name;var s=-1!==e.url.search(".woff")?"woff":"TrueType",n=t?t+e.url:e.url;if(i+='@font-face {font-family:"'+e.name+'"; font-style: normal; font-weight: normal; src:url("'+n+'") format("'+s+'");}\n',e.variants){for(const a in e.variants)n=t+e.variants[a],i+='@font-face {font-family:"'+e.name+'"; '+{n7:"font-style: normal; font-weight: bold;",i4:"font-style: italic; font-weight: normal;",i7:"font-style: italic; font-weight: bold;"}[a]+' src:url("'+n+'") format("'+s+'");}\n';Object.keys(e.variants).toString()}}return i}static load(e,t){const i=e.mainOptions.fonts;if(i&&i.length>0&&"object"==typeof i[0]){i.sort(((e,t)=>{let i=e.name.toUpperCase(),s=t.name.toUpperCase();return i<s?-1:i>s?1:0}));let a=[],o=[],r=0;const d=document.createElement("style");d.id="fpd-fonts",e.container.before(d),i.forEach((t=>{if(t.hasOwnProperty("url"))if("google"==t.url)a.push(t.name+":400,400i,700,700i");else{var i=t.name;i+=":n4",t.variants&&(i+=","+Object.keys(t.variants).toString()),o.push(i),d.append(this.parseFontsToEmbed(t,e.mainOptions._loadFromScript))}}));var s=function(e,i,s){"inactive"==e&&console.log(i+" font could not be loaded."),r==a.length+o.length-1&&t(),r++},n={fontactive:function(e,t){s("active",e)},fontinactive:function(e,t){s("inactive",e)},timeout:3e3};a.length>0&&(n.google={families:a}),o.length>0&&(n.custom={families:o}),"undefined"!=typeof WebFont&&(a.length>0||o.length>0)?WebFont.load(n):t()}else t()}}const y=e=>{let t=e.url;e.params&&(t+="?"+new URLSearchParams(e.params).toString());const i=new XMLHttpRequest;return i.responseType="json",i.open("GET",t),i.onreadystatechange=t=>{4==i.readyState&&200==i.status?e.onSuccess&&e.onSuccess(i.response):200!==i.status&&e.onError&&e.onError(i)},i.send(),i};class x extends EventTarget{langJSON=null;constructor(){super()}loadLangJSON(e=null,t=(()=>{})){!1!==e?"object"==typeof e?(this.langJSON=e,t.call(this)):y({url:e,onSuccess:e=>{this.langJSON=e,t.call(this)},onError:i=>{alert('Language JSON "'+e+'" could not be loaded or is not valid. Make sure you set the correct URL in the options and the JSON is valid!'),t.call(this)}}):t.call(this)}translateElement(e){let t="";if(this.langJSON){let n="";n=e.getAttribute("placeholder")?e.getAttribute("placeholder"):e.getAttribute("title")?e.getAttribute("title"):e.dataset.title?e.dataset.title:e.innerText;var i=n.split("."),s=this.langJSON[i[0]];s?(t=s[i[1]],void 0===t&&(t=e.dataset.defaulttext)):t=e.dataset.defaulttext}else t=e.dataset.defaulttext;return e.getAttribute("placeholder")?(e.setAttribute("placeholder",t),e.innerText=""):e.getAttribute("title")?e.setAttribute("title",t):e.dataset.title?e.dataset.title=t:e.innerText=t,t}getTranslation(e,t,i=""){return this.langJSON&&(e=this.langJSON[e])&&e[t]?e[t]:i}}class w extends HTMLElement{placeholder="";value="";searchable=!1;constructor(){super(),this.innerHTML='<input type="text" class="fpd-dropdown-current"/> <div class="fpd-dropdown-arrow"><span class="fpd-icon-arrow-dropdown"></span></div> <div class="fpd-dropdown-list"> <div class="fpd-scroll-area"></div> </div> '}connectedCallback(){this.addEventListener("click",(()=>{this.classList.toggle("fpd-active")})),this.querySelector("input.fpd-dropdown-current").addEventListener("keyup",(e=>{if(this.searchable){const t=e.currentTarget.value;this.querySelectorAll(".fpd-dropdown-list .fpd-item").forEach((e=>{0==t.length?e.classList.remove("fpd-hidden"):e.classList.toggle("fpd-hidden",!e.innerText.toLowerCase().includes(t.toLowerCase()))}))}}))}static get observedAttributes(){return["searchable","placeholder","value"]}attributeChangedCallback(e,t,i){t!==i&&("placeholder"===e?this.querySelector("input.fpd-dropdown-current").setAttribute("placeholder",i):"value"===e?this.querySelector("input.fpd-dropdown-current").value=i:"searchable"===e&&(this.searchable=this.hasAttribute("searchable")))}}customElements.define("fpd-dropdown",w);class I extends HTMLElement{constructor(){super()}connectedCallback(){const e=document.createElement("template");e.innerHTML='<div class="fpd-navigation fpd-scrollbar-hidden"></div> <div class="fpd-module-content"></div> <div class="fpd-close-off-canvas"> <span class="fpd-icon-close"></span> </div> <div class="fpd-draggable-dialog fpd-container fpd-shadow-2"> <div class="fpd-dialog-head"> <div class="fpd-dialog-drag-handle"> <div> <span class="fpd-icon-drag"></span><span class="fpd-dialog-title"></span> </div> </div> <div class="fpd-close-dialog"> <span class="fpd-icon-close"></span> </div> </div> </div> ',this.append(e.content.cloneNode(!0))}}customElements.define("fpd-main-bar",I);class E extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-grid" data-defaulttext="Swap Product" data-title="modules.products"> <fpd-dropdown class="fpd-product-categories" searchable></fpd-dropdown> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-contain fpd-padding"> </div> </div> </div>'}}customElements.define("fpd-module-products",E);class S extends EventTarget{currentCategoryIndex=0;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-products"),t.append(this.container),e.addEventListener("productsSet",(e=>{const t=this.container.querySelector(".fpd-dropdown-list > .fpd-scroll-area");t.innerHTML="",this.fpdInstance.products&&this.fpdInstance.products.length>0&&(void 0!==this.fpdInstance.products[0].category&&this.fpdInstance.products.length>1&&(this.container.classList.add("fpd-categories-enabled"),this.fpdInstance.products.forEach(((e,i)=>{const s=document.createElement("span");s.className="fpd-item",s.dataset.index=i,s.innerText=e.category,s.addEventListener("click",(e=>{this.selectCategory(e.currentTarget.dataset.index)})),t.append(s)}))),this.#i(),this.selectCategory(0))})),e.addEventListener("productAdd",((e,t,i,s)=>{s==this.currentCategoryIndex&&this.#s(t)}))}#i(){if(this.fpdInstance.mainOptions.editorMode)return;let e=this.fpdInstance.products[0],t=void 0===e;void 0!==e&&(t=!!(!e.hasOwnProperty("category")&&this.fpdInstance.products.length<2||e.hasOwnProperty("category")&&e.products.length<2&&this.fpdInstance.products.length<2)),this.fpdInstance.container.classList.toggle("fpd-products-module-hidden",t)}#s(t,i){let s=t[0].productThumbnail?t[0].productThumbnail:t[0].thumbnail,n=t[0].productTitle?t[0].productTitle:t[0].title;const a=document.createElement("div");a.className="fpd-item",a.dataset.title=n,a.dataset.source=s,a.dataset.index=i,a.addEventListener("click",(t=>{if(t.preventDefault(),this.fpdInstance.mainOptions.swapProductConfirmation){var s=e(this.fpdInstance.translator.getTranslation("modules","products_confirm_replacement"),!1,"confirm",this.fpdInstance.container);const t=s.querySelector(".fpd-confirm");t.innerText=this.fpdInstance.translator.getTranslation("modules","products_confirm_button"),o(t,["click"],(()=>{this.fpdInstance.selectProduct(i,this.currentCategoryIndex),s.remove()}))}else this.fpdInstance.selectProduct(Number(t.currentTarget.dataset.index),this.currentCategoryIndex)})),this.container.querySelector(".fpd-grid").append(a);const r=document.createElement("picture");r.dataset.img=s,a.append(r),this.fpdInstance.lazyBackgroundObserver.observe(r)}selectCategory(e=0){if(this.currentCategoryIndex=e,this.container.querySelector(".fpd-grid").innerHTML="",this.fpdInstance.products&&this.fpdInstance.products.length>0){let t;void 0!==this.fpdInstance.products[0].category?(t=this.fpdInstance.products[e].products,this.container.querySelector(".fpd-dropdown-current").value=this.fpdInstance.products[e].category):t=this.fpdInstance.products.products,t.forEach(((e,t)=>{this.#s(e,t)}))}}}class C extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-text-secondary" data-defaulttext="Add Text" data-title="modules.text"> <div class="fpd-add-text"> <textarea data-defaulttext="Enter some text" placeholder="modules.text_input_placeholder"></textarea> <div class="fpd-textbox-wrapper"> <span class="fpd-section-title" data-defaulttext="Optional: Enter a fixed width"> modules.enter_textbox_width </span> <input type="number" class="fpd-textbox-width" value="" step="1" min="0"> </div> <div class="fpd-btn"> <span data-defaulttext="Add Text">modules.text_add_btn</span> <span class="fpd-price"></span> </div> </div> <div class="fpd-text-templates fpd-scroll-area"> <div class="fpd-grid"></div> </div> </div>'}}customElements.define("fpd-module-text",C);class T extends EventTarget{#n;constructor(e,t){if(super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-text"),t.append(this.container),Boolean(e.mainOptions.setTextboxWidth)||this.container.querySelector(".fpd-textbox-wrapper").classList.add("fpd-hidden"),this.container.querySelector(".fpd-btn").addEventListener("click",(t=>{let i=this.container.querySelector("textarea"),n=i.value;if(e.currentViewInstance&&n.length>0){const t=this.container.querySelector(".fpd-textbox-width"),i=parseInt(t.value);t.value="";let a=s(currentViewOptions.customTextParameters,{isCustom:!0,_addToUZ:e.currentViewInstance.currentUploadZone});isNaN(i)||(a.textBox=!0,a.width=i,a.resizable=!0),e.addElement("text",n,n,a)}i.value=""})),o(this.container.querySelector("textarea"),["input","change"],(t=>{let i=t.currentTarget.value,s=this.#n?this.#n.customTextParameters.maxLength:0,n=this.#n?this.#n.customTextParameters.maxLines:0;i=i.replace(FancyProductDesigner.forbiddenTextChars,""),e.mainOptions.disableTextEmojis&&(i=i.replace(FPDEmojisRegex,""),i=i.replace(String.fromCharCode(65039),"")),0!=s&&i.length>s&&(i=i.substr(0,s)),0!=n&&i.split("\n").length>n&&(i=i.replace(/([\s\S]*)\n/,"$1")),t.currentTarget.value=i})),Array.isArray(e.mainOptions.textTemplates)){var i=this.container.querySelector(".fpd-text-templates .fpd-grid");e.mainOptions.textTemplates.forEach((t=>{var n=t.properties,a="font-family:"+(n.fontFamily?n.fontFamily:"Arial");a+="; text-align:"+(n.textAlign?n.textAlign:"left");const o=document.createElement("div");o.className="fpd-item",o.dataset.props=JSON.stringify(t.properties),o.dataset.text=t.text,o.addEventListener("click",(t=>{if(e.currentViewInstance){let i=JSON.parse(t.currentTarget.dataset.props);i.isCustom=!0,i._addToUZ=e.currentViewInstance.currentUploadZone;let n=s(currentViewOptions.customTextParameters,i);e.addElement("text",this.dataset.text,this.dataset.text,n)}}));const r=document.createElement("div");r.setAttribute("style",a),r.innerHTML=t.text.replace(/(?:\r\n|\r|\n)/g,"<br>"),o.append(r),i.append(o)}))}e.addEventListener("viewSelect",(e=>{}))}}class L extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-design-library" data-defaulttext="Add Designs" data-title="modules.designs"> <div class="fpd-head"> <div class="fpd-input-back-search"> <div class="fpd-back fpd-btn"> <span class="fpd-icon-back"></span> </div> <div class="fpd-input-search"> <input type="text"/> <span class="fpd-icon-magnify"></span> </div> </div> </div> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-contain"></div> </div> </div>'}}customElements.define("fpd-module-designs",L);class O extends EventTarget{#a="";#o=!1;#r=[];#d=null;#l=null;constructor(e,t,i=null){super(),this.#a=e.translator.getTranslation("modules","designs_search_in").toUpperCase(),this.fpdInstance=e,this.#l=i,this.container=document.createElement("fpd-module-designs"),t.append(this.container),i&&(this.container.dataset.dynamicDesignsId=i),this.headElem=this.container.querySelector(".fpd-head"),this.gridElem=this.container.querySelector(".fpd-grid"),this.headElem.querySelector(".fpd-input-search input").addEventListener("keyup",(e=>{const t=e.currentTarget,i=this.gridElem.querySelectorAll(".fpd-item");if(""==t.value)for(let e of i)e.classList.remove("fpd-hidden");else{const e=t.value.toLowerCase().trim();for(let t of i)t.classList.add("fpd-hidden"),t.dataset.search.includes(e)&&t.classList.remove("fpd-hidden")}})),this.headElem.querySelector(".fpd-back").addEventListener("click",(e=>{this.gridElem.querySelectorAll(".fpd-category").length>0&&this.#r.pop();let t,i=this.fpdInstance.designs;this.#r.forEach((e=>{t=i[e],i=t.category})),this.#d=i,i&&this.#c(this.#d,t),void 0===t&&this.toggleCategories()})),e.addEventListener("designsSet",(t=>{const i=e.designs;Array.isArray(i)&&0!==i.length&&(i[0].hasOwnProperty("source")?(this.container.classList.add("fpd-single-cat"),this.#p(i)):i.length>1||i[0].category?(this.#o=!0,this.toggleCategories()):1===i.length&&i[0].designs&&(this.container.classList.add("fpd-single-cat"),this.#p(i[0].designs)))}))}#c(e,t){this.gridElem.innerHTML="",this.gridElem.classList.remove("fpd-padding"),this.headElem.querySelector(".fpd-input-search input").value="",this.container.classList.remove("fpd-designs-active"),this.container.classList.add("fpd-categories-active"),e.forEach(((e,t)=>{this.#h(e)})),t&&(this.headElem.querySelector(".fpd-input-search input").setAttribute("placeholder",this.#a+" "+t.title.toUpperCase()),this.container.classList.add("fpd-head-visible"))}#h(e){const t=document.createElement("div");if(t.className="fpd-category fpd-item",t.dataset.search=e.title.toLowerCase(),e.thumbnail){const i=document.createElement("picture");i.dataset.img=e.thumbnail,t.append(i),this.fpdInstance.lazyBackgroundObserver.observe(i);const s=document.createElement("span");s.innerText=e.title,t.append(s)}else t.innerHTML="<span>"+e.title+"</span>";t.addEventListener("click",(e=>{let t=e.currentTarget,i=Array.from(this.gridElem.querySelectorAll(".fpd-item")).indexOf(t),s=this.#d[i];s.category?(this.#r.push(i),this.#d=s.category,this.#c(this.#d,s)):this.#p(s.designs,s.parameters),this.headElem.querySelector(".fpd-input-search input").setAttribute("placeholder",this.#a+" "+t.dataset.search.toUpperCase())})),this.gridElem.append(t)}#p(e,t={}){this.gridElem.innerHTML="",this.gridElem.classList.add("fpd-padding"),this.headElem.querySelector(".fpd-input-search input").value="",this.container.classList.remove("fpd-categories-active"),this.container.classList.add("fpd-designs-active","fpd-head-visible"),e.forEach((e=>{e.parameters=s(t,e.parameters),this.#u(e)}))}#u(e){e.thumbnail=void 0===e.thumbnail?e.source:e.thumbnail;const t=h({url:e.source,thumbnailUrl:e.thumbnail,title:e.title,price:this.fpdInstance.formatPrice(e.parameters.price)});t.dataset.search=e.title.toLowerCase(),t.dataset.parameters=e.parameters,t.addEventListener("click",(e=>{const t=e.currentTarget;this.fpdInstance._addCanvasDesign(t.dataset.source,t.dataset.title,t.dataset.parameters)})),this.gridElem.append(t),this.fpdInstance.lazyBackgroundObserver.observe(t.querySelector("picture"))}toggleCategories(){if(!this.#o)return;this.#r=[],this.container.classList.remove("fpd-head-visible","fpd-single-cat"),this.#d=this.fpdInstance.designs,this.#c(this.#d);let e=[];if(this.#l&&(e=this.fpdInstance.mainOptions.dynamicDesigns[this.#l].categories),this.fpdInstance.currentViewInstance){var t=this.fpdInstance.currentViewInstance.currentElement;e=t&&t.uploadZone&&t.designCategories?this.fpdInstance.currentViewInstance.currentElement.designCategories:this.fpdInstance.currentViewInstance.options.designCategories}var i=this.container.querySelectorAll(".fpd-category");if(e.length>0){const t=[];for(let s of i)e.includes(s.dataset.search)?(s.classList.remove("fpd-hidden"),t.push(s)):s.classList.add("fpd-hidden");1===t.length&&(this.container.classList.add("fpd-single-cat"),t[0].click())}else for(let e of i)e.classList.remove("fpd-hidden")}}class P extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-design-library" data-defaulttext="Text to Image" data-title="modules.text_to_image"> <div class="fpd-head"> <textarea></textarea> <div class="fpd-btn"> <span data-defaulttext="Generate">modules.text_to_image_generate</span> </div> </div> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover"></div> </div> </div>'}}customElements.define("fpd-module-text-to-image",P);class k extends EventTarget{#g="https://radykal.dep/fpd-js/server/php/sd-api.php";#m=!1;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-text-to-image"),t.append(this.container),this.inputElem=this.container.querySelector(".fpd-head textarea"),this.gridElem=this.container.querySelector(".fpd-grid"),this.container.querySelector(".fpd-head .fpd-btn").addEventListener("click",(e=>{const t=e.currentTarget;if(!c(this.inputElem.value)&&!this.#m){this.#m=!0,t.classList.add("fpd-loading");let e={action:"text2img",prompt:this.inputElem.value,numOfImg:2};fetch(this.#g,{method:"POST",redirect:"follow",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{e=JSON.parse(e),console.log(e),e&&e.output&&this.#f(e.output),this.#m=!1,t.classList.remove("fpd-loading")})).catch((e=>{this.#m=!1,t.classList.remove("fpd-loading")}))}}))}#f(e=[]){e.forEach((e=>{const t=document.createElement("div");t.className="fpd-item",t.dataset.source=e,t.innerHTML='<picture data-img="'+e+'"></picture><span class="fpd-price"></span>',this.gridElem.append(t),t.addEventListener("click",(e=>{const t=e.currentTarget;this.fpdInstance._addCanvasDesign(t.dataset.source,t.dataset.title,t.dataset.parameters)})),this.fpdInstance.lazyBackgroundObserver.observe(t.querySelector("picture"))}))}}class _ extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-photo" data-defaulttext="Add Image" data-title="modules.images"> <div class="fpd-module-tabs"> <div data-context="upload" class="fpd-active"> <span class="fpd-icon-cloud-upload"></span> </div> <div data-context="facebook" class="fpd-hidden" title="Facebook"> <span class="fpd-icon-facebook"></span> </div> <div data-context="instagram" class="fpd-hidden" title="Instagram"> <span class="fpd-icon-instagram"></span> </div> <div data-context="pixabay" class="fpd-hidden" title="Pixabay"> <span class="fpd-icon-pixabay"></span> </div> </div> <div class="fpd-module-tabs-content"> <div data-context="upload" class="fpd-active"></div> <div data-context="facebook"></div> <div data-context="instagram"></div> <div data-context="pixabay"></div> </div> </div>'}}customElements.define("fpd-module-images",_);class D extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-upload-zone"> <div> <span class="fpd-icon-file-upload"></span> <span data-defaulttext="Click or drop images here">modules.upload_zone</span> <span class="fpd-price"></span> </div> </div> <input type="file" multiple="multiple" class="fpd-upload-input fpd-hidden" name="files[]" accept="image/jpeg,image/jpg,image/png,image/svg+xml,application/pdf"/> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover fpd-photo-grid"></div> </div>'}}customElements.define("fpd-module-uploads",D);const U=(e="",t=!0)=>{let i=document.body.querySelector(".fpd-snackbar-wrapper");i||(i=document.createElement("div"),i.className="fpd-snackbar-wrapper",document.body.append(i));const s=document.createElement("div");return s.className="fpd-snackbar fpd-shadow-1",s.innerHTML="<p>"+e+"</p>",s.addEventListener("click",(e=>{s.remove()})),i.append(s),t&&setTimeout((function(){s.remove()}),5e3),s};class M extends EventTarget{#v;#b=0;#y=!1;#x=[];#w=0;constructor(e,t){super(),this.fpdInstance=e;const i=e.mainOptions.customImageAjaxSettings;this.postUrl=i.url,this.uploadsDir=i.data&&i.data.uploadsDir?i.data.uploadsDir:"",this.uploadsDirURL=i.data&&i.data.uploadsDirURL?i.data.uploadsDirURL:"",this.container=document.createElement("fpd-module-uploads"),t.append(this.container),this.gridElem=this.container.querySelector(".fpd-grid");const s=this.container.querySelector(".fpd-upload-zone");this.#v=e.mainOptions.allowedImageTypes,this.#v.includes("jpeg")&&!this.#v.includes("jpg")&&this.#v.push("jpg");const n=this.container.querySelector(".fpd-upload-input");let a=[];if(this.#v.forEach((e=>{"pdf"==e?a.push("application/pdf"):("svg"==e&&(e+="+xml"),a.push("image/"+e))})),n.setAttribute("accept",a.join()),o(s,"click",(async e=>{e.preventDefault(),n.click()})),o(n,"change",(e=>{this.#I(e.currentTarget.files)})),o(s,["dragover","dragleave"],(e=>{e.stopPropagation(),e.preventDefault(),e.currentTarget.classList.toggle("fpd-hover","dragover"===e.type)})),o(s,"drop",(e=>{e.stopPropagation(),e.preventDefault();const t=e.target.files||e.dataTransfer.files;this.#I(t)})),o(e,"productCreate",(e=>{this.#y=!1})),p&&window.localStorage.getItem("fpd_uploaded_images")){const e=JSON.parse(window.localStorage.getItem("fpd_uploaded_images"));e.forEach((t=>{this.#E(t.url,t.title);var i=new Image;i.src=t.url,i.onerror=function(){var t=null;e.forEach((function(e,s){e.url==i.src&&(t=s)})),null!=t&&(e.splice(t,1),window.localStorage.setItem("fpd_uploaded_images",JSON.stringify(e)))}}))}}#I(t){if(this.fpdInstance.mainOptions.uploadAgreementModal){var i=e(this.fpdInstance.translator.getTranslation("modules","images_agreement"),!1,"confirm",this.fpdInstance.container);const s=i.querySelector(".fpd-confirm");s.innerText=this.fpdInstance.translator.getTranslation("modules","images_confirm_button"),o(s,["click"],(()=>{this.#S(t),i.remove()}))}else this.#S(t)}#S(e){this.#b=0,this.#w=e.length,this.fpdInstance.loadingCustomImage=!0,Array.from(e).forEach(((e,t)=>{this.#v.includes(e.name.split(".").pop().toLowerCase().split("?")[0])&&this.#C(e,0==t)})),this.container.querySelector(".fpd-upload-zone").classList.remove("fpd-hover")}#C(e,t){const i=1024*this.fpdInstance.mainOptions.customImageParameters.maxSize*1024;if(e.size>i)return U(this.fpdInstance.translator.getTranslation("misc","maximum_size_info").replace("%filename",e.name).replace("%mb",this.fpdInstance.mainOptions.customImageParameters.maxSize)),void(this.fpdInstance.loadingCustomImage=!1);"application/pdf"===e.type?this.#T(e,t):this.#L(e,t)}#L(t,i=!1){const s=this.fpdInstance.mainOptions,n=s.customImageAjaxSettings,a=n.data&&n.data.saveOnServer?1:0,o=new FileReader;o.onload=n=>{const o=n.currentTarget.result;if("image/jpeg"===t.type&&s.customImageParameters.minDPI){const i=new JpegMeta.JpegFile(atob(o.replace(/^.*?,/,"")),t.name);let n=null;if(i.tiff&&i.tiff.XResolution&&i.tiff.XResolution.value){var r=i.tiff.XResolution.value.den;n=i.tiff.XResolution.value.num/r}else i.jfif&&i.jfif.Xdensity&&i.jfif.Xdensity.value&&(n=i.jfif.Xdensity.value);if(null!==n){if(console.log(t.name+" Real Resolution: "+n),n<s.customImageParameters.minDPI){let t=this.fpdInstance.translator.getTranslation("misc","minimum_dpi_info");return t=t.replace("%dpi",s.customImageParameters.minDPI),e(t,!1,"",this.fpdInstance.container),this.fpdInstance.loadingCustomImage=!1,!1}}else console.log(t.name+": Resolution is not accessible.")}const d=this.#E(o,t.name);a&&(d.classList.add("fpd-loading"),d.insertAdjacentHTML("beforeend",'<div class="fpd-loading-bar"><div class="fpd-loading-progress"></div></div>'));var l=new Image;l.onload=s=>{const n=s.currentTarget;let o=n.height,r=n.width;if(this.fpdInstance.currentViewInstance.options.customImageParameters,((t,i,s)=>{console.log(i);const n=t.currentViewInstance;let a=n.options.customImageParameters;if(i>a.maxW||i<a.minW||s>a.maxH||s<a.minH){t.loadingCustomImage=!1,console.log(t.mainBar),t.mainBar&&(t.mainBar.toggleContentDisplay(!1),n.currentUploadZone&&t.mainBar.toggleUploadZonePanel(!1));let i=t.translator.getTranslation("misc","uploaded_image_size_alert");return i=i.replace("%minW",a.minW).replace("%minH",a.minH).replace("%maxW",a.maxW).replace("%maxH",a.maxH),e(i),!1}return!0})(this.fpdInstance,r,o))if(a){var l=new FormData;l.append("uploadsDir",this.uploadsDir),l.append("uploadsDirURL",this.uploadsDirURL),l.append("images[]",t);const e=new XMLHttpRequest;e.responseType="json",e.onreadystatechange=t=>{if(e.readyState===XMLHttpRequest.DONE){const t=e.status;if(0===t||t>=200&&t<400){const t=e.response;t.image_src&&(this.#O(t.image_src,t.filename),d.dataset.source=t.image_src,d.classList.remove("fpd-loading"),d.querySelector(".fpd-loading-bar").remove(),this.#P(d,i),this.#b++,d.xhr=null),this.fpdInstance.loadingCustomImage=!1}}},e.upload.onprogress=e=>{let t=e.total,i=e.loaded,s=parseInt(100*i/t);d.querySelector(".fpd-loading-progress").style.width=s+"%"},e.upload.onerror=e=>{this.fpdInstance.loadingCustomImage=!1,d.remove(),U("Upload failed. Please try again or check your web console!")},e.open("POST",this.postUrl),e.send(l),d.xhr=e}else this.#O(n,t.name),this.#P(d,i),this.#b++;else d.remove(),this.fpdInstance.currentViewInstance.currentUploadZone=null},l.src=o},o.readAsDataURL(t)}#T(e,t=!1){this.fpdInstance.mainOptions;const i=U(this.fpdInstance.translator.getTranslation("modules","images_pdf_upload_info"),!1),s=new FormData;s.append("uploadsDir",this.uploadsDir),s.append("uploadsDirURL",this.uploadsDirURL),s.append("pdf",e);const n=new XMLHttpRequest;n.responseType="json",n.onreadystatechange=e=>{if(n.readyState===XMLHttpRequest.DONE){const e=n.status;if(0===e||e>=200&&e<400){const e=n.response;this.#w--,e.pdf_images.forEach(((e,t)=>{const i=this.#E(e.image_url,e.filename);this.#P(i,0==t),this.#O(e.image_url,e.filename),this.#b++})),i.remove(),this.#w++,this.fpdInstance.loadingCustomImage=!1}}},n.upload.onerror=()=>{this.fpdInstance.loadingCustomImage=!1,i.remove(),U("Upload failed. Please try again or check your web console!")},n.open("POST",this.postUrl),n.send(s)}#O(e,t){if(p){var i=window.localStorage.getItem("fpd_uploaded_images")?JSON.parse(window.localStorage.getItem("fpd_uploaded_images")):[],s={url:e,title:t};i.push(s),window.localStorage.setItem("fpd_uploaded_images",JSON.stringify(i))}}#E(e,t){const i=h({url:e,title:t,price:this.fpdInstance.formatPrice(this.fpdInstance.currentViewInstance.options.customImageParameters.price),removable:!0});return this.gridElem.append(i),this.fpdInstance.lazyBackgroundObserver.observe(i.querySelector("picture")),o(i,["click"],(e=>{this.fpdInstance.loadingCustomImage||this.fpdInstance._addGridItemToCanvas(e.currentTarget)})),o(i.querySelector(".fpd-delete"),"click",(e=>{e.stopPropagation(),e.preventDefault();const t=Array.from(this.gridElem.children).indexOf(i);if(!i.classList.contains("fpd-loading")){var s=JSON.parse(window.localStorage.getItem("fpd_uploaded_images"));s.splice(t,1),window.localStorage.setItem("fpd_uploaded_images",JSON.stringify(s)),i.xhr&&i.xhr.abort(),i.remove()}})),i}#P(e,t){if(!this.#y&&this.fpdInstance.mainOptions.autoFillUploadZones){const t=this.#x[this.#b]?this.#x[this.#b]:null;t&&this.fpdInstance._addGridItemToCanvas(e,{_addToUZ:t.uz},t.viewIndex)}else t&&this.fpdInstance._addGridItemToCanvas(e);this.#b==this.#w-1&&(this.#y=!0)}#k(e,t){const i=this.fpdInstance.mainOptions.imageQualityRatings;if(i&&"object"==typeof i){var s=i.low?i.low:null,n=i.mid?i.mid:null,a=i.high?i.high:null,o="fpd-icon-star",r="fpd-icon-star-outline",d=new Image;d.onload=function(){var t,i=e.append('<div class="fpd-image-quality-ratings"></div>').children(".fpd-image-quality-ratings");if(s&&2==s.length){var d=this.width<Number(s[0])||this.height<Number(s[1])?r:o;i.append('<span class="'+d+'"></span>'),d==o&&(t=fpdInstance.getTranslation("misc","image_quality_rating_low"))}if(n&&2==n.length){var l=this.width<Number(n[0])||this.height<Number(n[1])?r:o;i.append('<span class="'+l+'"></span>'),l==o&&(t=fpdInstance.getTranslation("misc","image_quality_rating_mid"))}if(a&&2==a.length){var c=this.width<Number(a[0])||this.height<Number(a[1])?r:o;i.append('<span class="'+c+'"></span>'),c==o&&(t=fpdInstance.getTranslation("misc","image_quality_rating_high"))}t&&i.data("quality-label",t)},d.src=t}}}class A extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-head"> <div class="fpd-facebook-login"> <fb:login-button data-max-rows="1" data-show-faces="false" data-scope="user_photos"> </fb:login-button> </div> <fpd-dropdown class="fpd-facebook-albums" placeholder="Select An Album" searchable></fpd-dropdown> </div> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover fpd-photo-grid"></div> </div>'}}customElements.define("fpd-module-facebook-images",A);class F extends EventTarget{constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-facebook-images"),t.append(this.container),this.dropdown=this.container.querySelector("fpd-dropdown"),this.dropdownList=this.container.querySelector(".fpd-dropdown-list"),this.gridElem=this.container.querySelector(".fpd-grid"),this.#_()}#_(){const e=document.createElement("script");e.src="//connect.facebook.com/en_US/sdk.js",e.addEventListener("load",(()=>{FB.init({appId:this.fpdInstance.mainOptions.facebookAppId,autoLogAppEvents:!0,xfbml:!0,version:"v16.0"}),FB.getLoginStatus(this.#D.bind(this)),FB.Event.subscribe("auth.statusChange",this.#D.bind(this))})),document.body.appendChild(e)}#D(e){"connected"===e.status&&(r(this.container,["fpd-facebook-logged-in"]),FB.api("/me/albums?fields=name,count,id",(e=>{e.data.forEach((e=>{const t=document.createElement("span");t.className="fpd-item",t.dataset.albumid=e.id,t.innerText=e.name,t.addEventListener("click",(e=>{this.dropdown.setAttribute("value",e.currentTarget.innerText),this.#U(e.currentTarget.dataset.albumid)})),this.dropdownList.append(t)})),d(this.dropdown,["fpd-on-loading"])})))}#U(e){this.gridElem.innerHTML="",r(this.dropdown,["fpd-on-loading"]),FB.api("/"+e+"?fields=count",(t=>{const i=t.count;FB.api("/"+e+"?fields=photos.limit("+i+").fields(source,images)",(e=>{d(this.dropdown,["fpd-on-loading"]),e.error||e.photos.data.forEach((e=>{const t=e.images[0]?e.images[0].source:e.source,i=e.images[e.images.length-1]?e.images[e.images.length-1].source:e.source,s=h({url:t,thumbnailUrl:i,title:e.id,price:this.fpdInstance.formatPrice(this.fpdInstance.currentViewInstance.options.customImageParameters.price)});o(s,["click"],(e=>{this.fpdInstance.loadingCustomImage||this.fpdInstance._addGridItemToCanvas(e.currentTarget)})),this.gridElem.append(s),this.fpdInstance.lazyBackgroundObserver.observe(s.querySelector("picture"))})),this.fpdInstance.toggleSpinner(!1)}))}))}}class H extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover fpd-photo-grid"></div> </div>'}}customElements.define("fpd-module-instagram-images",H);class z extends EventTarget{accessToken=null;nextStack=null;loadingStack=!1;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-instagram-images"),t.append(this.container),this.gridElem=this.container.querySelector(".fpd-grid");const i=this.container.querySelector(".fpd-scroll-area");i.addEventListener("scroll",(e=>{let t=i.scrollHeight;i.clientHeight+i.scrollTop+100>t&&(null===this.nextStack||this.loadingStack||this.#M(this.nextStack,!1))}))}authenticate(){const e=this.fpdInstance.mainOptions;if(p()){const e=window.localStorage.getItem("fpd_insta_access_token");if(!c(e))return this.accessToken=e,void this.#M()}let t=(window.screen.width-700)/2,i=(window.screen.height-500)/2,s={app_id:e.instagramClientId,redirect_uri:e.instagramRedirectUri,scope:"user_profile,user_media",response_type:"code"},n=new URLSearchParams(s).toString();var a=window.open("https://api.instagram.com/oauth/authorize?"+n,"","width=700,height=500,left="+t+",top="+i),o=setInterval((()=>{a.closed&&clearInterval(o);try{if(a.location&&a.location.href){var e=new URL(a.location.href).searchParams.get("code");e&&(e=e.replace("#_",""),this.#A(e),a.close())}}catch(e){}}),500)}#A(e){const t=this.fpdInstance.mainOptions;this.fpdInstance.toggleSpinner(!0),y({url:t.instagramTokenUri,params:{code:e,client_app_id:t.instagramClientId,redirect_uri:t.instagramRedirectUri},onSuccess:e=>{e.access_token?(p()&&window.localStorage.setItem("fpd_insta_access_token",e.access_token),this.accessToken=e.access_token,this.#M()):e.error_message&&(console.log(e),this.fpdInstance.toggleSpinner(!1))},onError:e=>{console.log(e),this.fpdInstance.toggleSpinner(!1)}})}#M(e="https://graph.instagram.com/me/media",t=!0){this.loadingStack=!0,this.fpdInstance.toggleSpinner(!0);let i={url:e,onSuccess:e=>{e.data&&(this.nextStack=e.paging&&e.paging.next?e.paging.next:null,e.data.forEach((e=>{if("VIDEO"!==e.media_type){const t=h({url:e.media_url,thumbnailUrl:e.thumbnail_url?e.thumbnail_url:e.media_url,title:e.id,price:this.fpdInstance.formatPrice(this.fpdInstance.currentViewInstance.options.customImageParameters.price)});o(t,["click"],(e=>{this.fpdInstance.loadingCustomImage||this.fpdInstance._addGridItemToCanvas(e.currentTarget)})),this.gridElem.append(t),this.fpdInstance.lazyBackgroundObserver.observe(t.querySelector("picture"))}}))),this.fpdInstance.toggleSpinner(!1),this.loadingStack=!1},onError:e=>{e.response&&e.response.error&&e.response.error.code&&p()&&190==e.response.error.code&&(window.localStorage.removeItem("fpd_insta_access_token"),this.accessToken=null,this.authenticate()),this.fpdInstance.toggleSpinner(!1),this.loadingStack=!1}};t&&(this.gridElem.innerHTML="",i.params={fields:"id,caption,media_url,media_type",access_token:this.accessToken}),y(i)}}class q extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-loader-wrapper"> <div class="fpd-loader"> <div class="fpd-loader-circle"></div> </div> </div> <div class="fpd-head"> <a href="https://pixabay.com/" target="_blank" class="fpd-pixabay-logo"> </a> <div class="fpd-input-search"> <input type="text" data-defaulttext="Search in Pixabay library" placeholder="modules.pixabay_search"/> <span class="fpd-icon-magnify"></span> </div> </div> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover fpd-photo-grid"></div> </div>'}}customElements.define("fpd-module-pixabay-images",q);class B extends EventTarget{loadingStack=!1;currentQuery="";pixabayPage=1;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-pixabay-images"),t.append(this.container),this.gridElem=this.container.querySelector(".fpd-grid"),this.loader=this.container.querySelector(".fpd-loader-wrapper");const i=this.container.querySelector(".fpd-scroll-area");i.addEventListener("scroll",(e=>{let t=i.scrollHeight;i.clientHeight+i.scrollTop+100>t&&(this.loadingStack||(this.pixabayPage++,this.loadImages(void 0,!1)))})),o(this.container.querySelector("input"),["keypress"],(e=>{13==e.which&&(this.pixabayPage=1,this.loadImages(e.currentTarget.value))}))}loadImages(e,t=!0){if(this.currentQuery===e)return!1;const i=this.fpdInstance.mainOptions;this.loadingStack=!0,this.currentQuery=void 0===e?this.currentQuery:e;var s=i.pixabayHighResImages?"&response_group=high_resolution":"",n="https://pixabay.com/api/?safesearch=true&key="+i.pixabayApiKey+"&page="+this.pixabayPage+"&per_page=40&min_width="+i.customImageParameters.minW+"&min_height="+i.customImageParameters.minH+s+"&q="+encodeURIComponent(this.currentQuery)+"&lang="+i.pixabayLang;t&&(this.gridElem.innerHTML=""),d(this.loader,["fpd-hidden"]),y({url:n,onSuccess:e=>{r(this.loader,["fpd-hidden"]),e.hits.length>0&&e.hits.forEach((e=>{const t=h({url:e.imageURL?e.imageURL:e.webformatURL,thumbnailUrl:e.webformatURL,title:e.id?e.id:e.id_hash,price:this.fpdInstance.formatPrice(this.fpdInstance.currentViewInstance.options.customImageParameters.price)});o(t,["click"],(e=>{this.fpdInstance.loadingCustomImage||this.fpdInstance._addGridItemToCanvas(e.currentTarget)})),this.gridElem.append(t),this.fpdInstance.lazyBackgroundObserver.observe(t.querySelector("picture"))})),this.loadingStack=!1},onError:e=>{r(this.loader,["fpd-hidden"])}})}}class R extends EventTarget{constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-images"),t.append(this.container);const i=Array.from(this.container.querySelectorAll(".fpd-module-tabs > div")),s=Array.from(this.container.querySelectorAll(".fpd-module-tabs-content > div"));let n=null,a=null;o(i,"click",(e=>{const t=e.currentTarget;d(i,["fpd-active"]),d(s,["fpd-active"]),r(t,["fpd-active"]),r(s.find((e=>e.dataset.context==t.dataset.context)),["fpd-active"]),"instagram"==t.dataset.context&&n&&!n.accessToken?n.authenticate():"pixabay"==t.dataset.context&&a&&a.loadImages()}));const l=e.mainOptions;new M(e,s.find((e=>"upload"==e.dataset.context))),o(e,["viewSelect","secondaryModuleCalled"],(t=>{if(!e.currentViewInstance)return;let i=e.currentViewInstance.options,s=null;if(e.currentViewInstance.currentUploadZone){const t=e.currentViewInstance.getUploadZone(e.currentViewInstance.currentUploadZone);t&&t.price&&(s=t.price)}null==s&&i.customImageParameters&&i.customImageParameters.price&&(s=e.formatPrice(i.customImageParameters.price));const n=this.container.querySelector(".fpd-upload-zone .fpd-price");n&&(n.innerHTML=s||"")})),c(l.facebookAppId)||(new F(e,s.find((e=>"facebook"==e.dataset.context))),i.find((e=>"facebook"==e.dataset.context)).classList.remove("fpd-hidden")),c(l.instagramClientId)||(n=new z(e,s.find((e=>"instagram"==e.dataset.context))),i.find((e=>"instagram"==e.dataset.context)).classList.remove("fpd-hidden")),c(l.pixabayApiKey)||(a=new B(e,s.find((e=>"pixabay"==e.dataset.context))),i.find((e=>"pixabay"==e.dataset.context)).classList.remove("fpd-hidden")),i.filter((e=>!e.classList.contains("fpd-hidden"))).length<2&&this.container.classList.add("fpd-hide-tabs")}}class N extends EventTarget{constructor(e,t,i){let s;if(super(),"products"===i)s=new S(e,t);else if("text"===i)s=new T(e,t);else if("text-to-image"===i)s=new k(e,t);else if(i.includes("designs")){let a=null;if(i.includes("designs_")&&!c(e.mainOptions.dynamicDesigns)){if(a=i.split("_").pop(),!a||!e.mainOptions.dynamicDesigns[a])return;{var n=e.mainOptions.dynamicDesigns[a];const t={};t["data-dynamic-designs-id"]=a,!c(n.icon)&&n.icon.includes(".svg")&&(this.configs={icon:n.icon,defaultText:n.name,attrs:t})}}s=new O(e,t,a)}else"images"===i&&(s=new R(e,t));if(s&&(this.moduleInstance=s,e["moduleInstance_"+i]=s,!i.includes("designs_"))){const e=s.container.querySelector("div");this.configs={icon:e.dataset.moduleicon,langId:e.dataset.title,langKeys:e.dataset.title.split("."),defaultText:e.dataset.defaulttext}}}}class j extends EventTarget{#F=null;#H=null;#z=!1;#q=0;#B=0;#R=0;#N=0;#j=!1;#V=!1;contentElem=null;navElem=null;currentModuleKey="";constructor(e){super(),this.fpdInstance=e;const t=e.container;if(this.container=document.createElement("fpd-main-bar"),t.append(this.container),this.contentElem=this.container.querySelector(".fpd-module-content"),this.navElem=this.container.querySelector(".fpd-navigation"),this.currentModules=e.mainOptions.mainBarModules,this.#F=document.querySelector(this.fpdInstance.mainOptions.modalMode?".fpd-modal-product-designer":"body"),this.#H=document.querySelector(".fpd-draggable-dialog"),this.#F.append(this.#H),o(this.#H,["mousedown","touchstart"],this.#W.bind(this)),o(this.#H,["mouseup","touchend"],this.#Z.bind(this)),o(document,["mousemove","touchmove"],this.#X.bind(this)),o(this.#H.querySelector(".fpd-close-dialog"),["click","touchstart"],this.#J.bind(this)),o(this.container.querySelector(".fpd-close-off-canvas"),"click",this.#J.bind(this)),o(e,"viewSelect",(()=>{this.toggleContentDisplay(!1)})),t.classList.contains("fpd-off-canvas")){let e=0,t=0;this.contentElem.addEventListener("touchstart",(t=>{e=t.touches[0].pageX,r(this.container,["fpd-is-dragging"])})),this.contentElem.addEventListener("touchmove",(i=>{i.preventDefault();let s=i.touches[0].pageX;t=e-s,t=Math.abs(t)<0?0:Math.abs(t),this.contentElem.style.left=-t+"px",this.contentElem.previousElementSibling.style.left=this.contentElem.clientWidth-t+"px"})),this.contentElem.addEventListener("touchend",(e=>{Math.abs(t)>100?this.toggleContentDisplay(!1):(this.contentElem.style.left="0px",this.contentElem.previousElementSibling.style.left=this.contentElem.clientWidth+"px"),t=0,d(this.container,["fpd-is-dragging"])}))}this.updateContentWrapper(),this.setup(this.currentModules)}#W(e){this.#H.querySelector(".fpd-dialog-drag-handle").contains(e.target)&&(e.preventDefault(),this.#z=!0,this.#q=e.touches?event.touches[0].clientX:e.clientX,this.#B=e.touches?event.touches[0].clientY:e.clientY,this.#R=this.#q-this.#H.offsetLeft,this.#N=this.#B-this.#H.offsetTop)}#X(e){if(!this.#z)return;const t=this.#F.clientWidth<window.innerWidth?window.innerWidth:this.#F.clientWidth,i=this.#F.clientHeight<window.innerHeight?window.innerHeight:this.#F.clientHeight,s=t-this.#H.clientWidth,n=i-this.#H.clientHeight,a=e.touches?event.touches[0].clientX:e.clientX;let o=(e.touches?event.touches[0].clientY:e.clientY)-this.#N,r=a-this.#R;r<0&&(r=0),o<0&&(o=0),r>s&&(r=s),o>n&&(o=n),this.#H.style.top=o+"px",this.#H.style.left=r+"px"}#Z(e){this.#z=!1}#Y(e){e.stopPropagation(),this.fpdInstance.deselectElement(),this.fpdInstance.currentViewInstance&&(this.fpdInstance.currentViewInstance.currentUploadZone=null),e.currentTarget.classList.contains("fpd-active")&&this.contentClosable?this.toggleContentDisplay(!1):this.callModule(e.currentTarget.dataset.module,e.currentTarget.dataset.dynamicDesignsId)}#J(){this.fpdInstance.currentViewInstance&&this.fpdInstance.currentViewInstance.currentUploadZone&&this.fpdInstance.currentViewInstance.deselectElement(),this.toggleContentDisplay(!1)}callModule(e,t=null){let i;d(this.navElem.querySelectorAll(".fpd-nav-item"),["fpd-active"]),d(Array.from(this.contentElem.children),["fpd-active"]),t?(i=r(this.navElem.querySelector('.fpd-nav-item[data-dynamic-designs-id="'+t+'"]'),["fpd-active"]),r(this.contentElem.querySelector('[data-dynamic-designs-id="'+t+'"]'),["fpd-active"])):(i=r(this.navElem.querySelector('.fpd-nav-item[data-module="'+e+'"]'),["fpd-active"]),r(this.contentElem.querySelector("fpd-module-"+e),["fpd-active"])),this.toggleContentDisplay(),this.currentModuleKey=e}get contentClosable(){const e=this.fpdInstance.container;return this.#V||this.#j||e.classList.contains("fpd-layout-small")}callSecondary(){this.callModule("secondary")}toggleContentDisplay(e=!0){((e=[],t=[],i=!0)=>{e&&(e instanceof HTMLElement?t.forEach((t=>{e.classList.toggle(t,i)})):e.forEach((e=>{t.forEach((t=>{e.classList.toggle(t,i)}))})))})(this.fpdInstance.container,["fpd-module-visible"],e),this.contentClosable&&(e||d(this.navElem.querySelectorAll(".fpd-nav-item"),["fpd-active"])),this.#V?(!e&&this.currentModuleKey.length&&this.fpdInstance.deselectElement(),this.contentElem.style.removeProperty("left"),this.contentElem.previousElementSibling.style.removeProperty("left"),this.contentElem.style.height=this.fpdInstance.mainWrapper.container.clientHeight+"px",this.container.classList.toggle("fpd-show",e)):this.#j&&(e&&(this.#H.querySelector(".fpd-dialog-title").innerText=this.navElem.querySelector(".fpd-nav-item.fpd-active .fpd-label").innerText),this.#H.classList.toggle("fpd-show",e)),e||(this.currentModuleKey="")}updateContentWrapper(){const e=this.fpdInstance.container;this.toggleContentDisplay(!1),this.#V=!1,this.#j=!1,d(this.navElem.querySelectorAll(".fpd-nav-item"),["fpd-active"]),e.classList.contains("fpd-off-canvas")?(this.#V=!0,this.container.append(this.contentElem)):e.classList.contains("fpd-sidebar")?this.container.append(this.contentElem):(this.#j=!0,this.#H.append(this.contentElem))}toggleUploadZonePanel(e=!0){this.fpdInstance.loadingCustomImage||(e?this.callSecondary("fpd-upload-zone-adds-panel"):(this.fpdInstance.currentViewInstance.currentUploadZone=null,this.toggleContentDisplay(!1)))}toggleUploadZoneAdds(e){}setup(e=[]){let t=this.fpdInstance.mainOptions.initialActiveModule?this.fpdInstance.mainOptions.initialActiveModule:"";const i=this.container.querySelector(".fpd-navigation");this.currentModules.length<=1&&!this.fpdInstance.container.classList.contains("fpd-topbar")?(t=this.currentModules[0]?this.currentModules[0]:"",i.classList.add("fpd-hidden")):this.fpdInstance.container.classList.contains("fpd-sidebar")&&""==t?t=this.currentModules[0]?this.currentModules[0]:"":i.classList.remove("fpd-hidden"),i.innerHTML=this.contentElem.innerHTML="",e.forEach((e=>{let t="";const s=new N(this.fpdInstance,this.contentElem,e);if(!s.moduleInstance)return;const n=document.createElement("div");n.classList.add("fpd-nav-item"),n.dataset.module=e,n.addEventListener("click",this.#Y.bind(this)),i.appendChild(n);let a=document.createElement("span");if(s.configs.icon.includes(".svg")?fetch(s.configs.icon).then((e=>e.text())).then((e=>{a.innerHTML=e})).catch((e=>{})):(a.classList.add("fpd-nav-icon"),a.classList.add(s.configs.icon)),n.append(a),s.configs.langKeys){const e=s.configs.langKeys;t=this.fpdInstance.translator.getTranslation(e[0],e[1],this.fpdInstance.mainOptions.langJson,s.configs.defaultText)}else s.configs.defaultText&&(t=s.configs.defaultText);const o=document.createElement("span");if(o.className="fpd-label",o.innerText=t,n.append(o),s.configs.attrs)for(const[e,t]of Object.entries(s.configs.attrs))n.setAttribute(e,t)})),this.contentClosable||i.querySelector(`[data-module="${t}"]`).click()}}class V extends HTMLElement{constructor(){super()}connectedCallback(){const e=document.createElement("template");e.innerHTML='<div class="fpd-snap-line-h"></div> <div class="fpd-snap-line-v"></div> <div class="fpd-product-stage"></div>',this.append(e.content.cloneNode(!0))}}customElements.define("fpd-main-wrapper",V);class W{constructor(e){this.container=document.createElement("fpd-main-wrapper"),e.container.append(this.container)}}i(561);class Z extends EventTarget{constructor(e){super(),this.container=document.createElement("fpd-actions-bar"),e.container.append(this.container)}}class X extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<span class="fpd-view-prev"> <span class="fpd-icon-forward"></span> </span> <div class="fpd-views-selection"></div> <span class="fpd-view-next"> <span class="fpd-icon-forward"></span> </span> '}}customElements.define("fpd-views-wrapper",X);class J extends EventTarget{constructor(e){super(),this.container=document.createElement("fpd-views-wrapper"),e.container.classList.contains("fpd-views-outside")||e.mainOptions.modalMode?e.container.after(this.container):e.mainWrapper.container.append(this.container)}}class Y extends EventTarget{#G=0;constructor(e){super(),this.fpdInstance=e}init(){this.#$(),this.fpdInstance.container.classList.add("fpd-container"),this.fpdInstance.container.classList.add("fpd-wrapper");const e=document.createElement("div");e.innerHTML='<div class="fpd-loader-wrapper"> <div class="fpd-loader"> <div class="fpd-loader-circle"></div> <span class="fpd-loader-text" data-defaulttext="Initializing Product Designer">misc.initializing</span> </div> </div>',this.fpdInstance.container.appendChild(e.firstChild.cloneNode(!0)),this.fpdInstance.mainLoader=this.fpdInstance.container.querySelector(".fpd-loader-wrapper"),this.fpdInstance.actionsBar=new Z(this.fpdInstance),this.fpdInstance.mainBar=new j(this.fpdInstance),this.fpdInstance.mainWrapper=new W(this.fpdInstance),this.fpdInstance.productStage=this.fpdInstance.mainWrapper.container.querySelector(".fpd-product-stage"),this.fpdInstance.viewsWrapper=new J(this.fpdInstance),Array.from(this.fpdInstance.container.querySelectorAll("[data-defaulttext]")).forEach((e=>{this.fpdInstance.translator.translateElement(e,this.fpdInstance.mainOptions.langJson)})),this.dispatchEvent(new CustomEvent("ready")),window.addEventListener("resize",this.#$.bind(this))}#$(){const e=this.fpdInstance.mainOptions.responsiveBreakpoints;this.#G=window.innerWidth,this.#G<e.small?(this.fpdInstance.container.classList.remove("fpd-layout-medium"),this.fpdInstance.container.classList.remove("fpd-layout-large"),this.fpdInstance.container.classList.add("fpd-layout-small")):this.#G<e.medium?(this.fpdInstance.container.classList.remove("fpd-layout-small"),this.fpdInstance.container.classList.remove("fpd-layout-large"),this.fpdInstance.container.classList.add("fpd-layout-medium")):(this.fpdInstance.container.classList.remove("fpd-layout-medium"),this.fpdInstance.container.classList.remove("fpd-layout-small"),this.fpdInstance.container.classList.add("fpd-layout-large"))}}class G extends EventTarget{static forbiddenTextChars=/<|>/g;container=null;mainOptions={};currentViewInstance=null;currentViewIndex=0;products=[];designs=[];modalContainer=document.body;currentCategoryIndex=0;currentProductIndex=0;viewInstances=[];currentViews=null;productCreated=!1;colorLinkGroups={};globalCustomElements=[];doUnsavedAlert=!1;loadingCustomImage=!1;lazyBackgroundObserver=null;#K=[];#Q=0;#ee=0;#te=!1;constructor(e,t={}){super(),this.lazyBackgroundObserver=new IntersectionObserver(((e,t)=>{e.forEach((e=>{e.isIntersecting&&(l(e.target),this.lazyBackgroundObserver.unobserve(e.target))}))})),this.container=e,this.container.instance=this,this.mainOptions=u.merge(u.defaults,t),this.currentViewInstance={options:{...this.mainOptions}},this.translator=new x,this.translator.loadLangJSON(this.mainOptions.langJson,this.#ie.bind(this))}#ie(){this.uiManager=new Y(this),this.uiManager.addEventListener("ready",(e=>{this.#se()})),this.uiManager.init()}#se(){b.load(this,(()=>{this.#ne()}))}#ne(){setTimeout((()=>{this.dispatchEvent(new CustomEvent("uiSet"))}),1),this.#ae()}#ae(){this.dispatchEvent(new CustomEvent("ready")),this.mainOptions.productsJSON&&("object"==typeof this.mainOptions.productsJSON?this.setupProducts(this.mainOptions.productsJSON):y({url:this.mainOptions.productsJSON,onSuccess:e=>{this.setupProducts(e)},onError:()=>{alert("Products JSON could not be loaded. Please check that your URL is correct! URL: "+this.mainOptions.productsJSON)}})),this.mainOptions.designsJSON&&("object"==typeof this.mainOptions.productsJSON?this.setupDesigns(this.mainOptions.designsJSON):y({url:this.mainOptions.designsJSON,onSuccess:e=>{this.setupDesigns(e)},onError:()=>{alert("Design JSON could not be loaded. Please check that your URL is correct! URL: "+this.mainOptions.designsJSON)}}));let e=0;o(window,"resize",(t=>{window.innerWidth===e||this.#te||(e=window.innerWidth,this.currentViewInstance&&this.currentViewInstance.resetSize())}))}#oe(e){var t=this.products.findIndex((t=>t.category===e));return-1!==t&&t}setupProducts(e=[]){this.products=[],e.forEach((e=>{e.hasOwnProperty("category")?e.products.forEach((t=>{this.addProduct(t,e.category)})):this.addProduct(e)})),this.mainOptions.loadFirstProductInStage&&e.length>0?this.selectProduct(0):this.toggleSpinner(!1),this.toggleSpinner(!1),this.dispatchEvent(new CustomEvent("productsSet"))}setupDesigns(e){this.designs=e,this.dispatchEvent(new CustomEvent("designsSet"))}addProduct(e,t){var i=this.#oe(t);void 0===t?this.products.push(e):(!1===i&&(i=this.products.length,this.products[i]={category:t,products:[]}),this.products[i].products.push(e)),this.dispatchEvent(new CustomEvent("productAdd",{detail:{views:e,category:t,catIndex:i}}))}selectProduct(e,t){let i;this.currentCategoryIndex=void 0===t?this.currentCategoryIndex:t,i=this.products&&this.products.length&&this.products[0].category?this.products[this.currentCategoryIndex].products:instance.products,this.currentProductIndex=e,e<0?this.currentProductIndex=0:e>i.length-1&&(this.currentProductIndex=i.length-1);const s=i[this.currentProductIndex];this.dispatchEvent(new CustomEvent("productSelect",{detail:{product:s}})),this.loadProduct(s,this.mainOptions.replaceInitialElements)}loadProduct(e,t=!1,i=!1){e&&(this.toggleSpinner(!0),this.#K=[],this.viewInstances.forEach((e=>{})),this.productCreated=!1,this.colorLinkGroups={},this.globalCustomElements=[],t?this.globalCustomElements=this.getCustomElements():this.doUnsavedAlert=!1,this.fixedElements=this.getFixedElements(),this.reset(),i&&e.forEach(((e,t)=>{e.options=u.merge(this.mainOptions,e.options)})),this.currentViews=e,this.#Q=this.#ee=0,e.forEach(((e,t)=>{this.#Q+=e.elements.length})),o(this,"viewCreate",this.#re),e&&this.addView(e[0]))}addView(e){const i=this.mainOptions._loadFromScript?this.mainOptions._loadFromScript+e.thumbnail:e.thumbnail,n=document.createElement("div");n.className="fpd-shadow-1 fpd-item fpd-tooltip",n.title=e.title,n.innerHTML='<picture style="background-image: url('+i+');"></picture>',this.viewsWrapper.container.querySelector(".fpd-views-selection").append(n),o(n,"click",(e=>{const t=Array.from(this.viewsWrapper.container.querySelectorAll(".fpd-views-selection > div")).indexOf(n);this.selectView(t)}));let a={};v.relevantOptions.forEach((e=>{let i=this.mainOptions[e];a[e]=t(i)?{...i}:i})),e.options=t(e.options)?s(a,e.options):a,new v(this.productStage,e,(e=>{this.viewInstances.length,this.viewInstances.push(e),o(e,"sizeUpdate",(e=>{const t=e.currentTarget.fabricCanvas.height+"px";this.productStage.style.height=t,this.container.classList.contains("fpd-sidebar")&&(this.mainBar.container.style.height=t)})),this.dispatchEvent(new CustomEvent("viewCreate",{detail:{viewInstance:e}}))}),this.mainOptions.fabricCanvasOptions).init()}toggleSpinner(e=!0,t=""){return this.mainLoader.querySelector(".fpd-loader-text").innerText=t,this.mainLoader.classList.toggle("fpd-hidden",!e),this.mainLoader}selectView(e=0){if(this.viewInstances.length<=0)return;this.currentViewIndex=e,this.currentViewInstance,this.currentViewInstance=this.viewInstances[this.currentViewIndex],this.deselectElement();const t=this.productStage.querySelectorAll(".fpd-view-stage");r(t,["fpd-hidden"]),d(t.item(this.currentViewIndex),["fpd-hidden"]),this.currentViewInstance.resetSize(),this.dispatchEvent(new CustomEvent("viewSelect"))}getCustomElements(e="all",t=-1,i=!0){return[]}getFixedElements(e="all",t=-1,i=!0){return[]}reset(){this.currentViews}deselectElement(){}formatPrice(e){const t=this.mainOptions.priceFormat;if(e&&"object"==typeof t){const s=t.thousandSep,n=t.decimalSep;let a=e.toString().split("."),o=a[0],r=a[1],d="";if(void 0!==o){for(var i=o.length-1;i>=0;i--)d+=o.charAt(i);for(d=d.replace(/(\d{3})/g,"$1"+s),d.slice(-s.length)==s&&(d=d.slice(0,-s.length)),o="",i=d.length-1;i>=0;i--)o+=d.charAt(i);void 0!==r&&r.length>0&&(1==r.length&&(r+="0"),o+=n+r)}return o=t.currency.replace("%d",o.toString()),o}return e&&(e=t.priceFormat.replace("%d",e)),e}#re(){if(!(this.viewInstances.length<this.currentViews.length))return this.removeEventListener("viewCreate",this.#re),this.toggleSpinner(!1),void this.selectView(0);this.addView(this.currentViews[this.viewInstances.length])}_addGridItemToCanvas(e,t={},i){i=void 0===i?this.currentViewIndex:i,this.currentViewInstance}_addCanvasImage(e,t,i={},s=!1,n){if(n=void 0===n?this.currentViewIndex:n,!this.currentViewInstance)return;let a=this.mainOptions.customImageAjaxSettings;!a.data||!a.data.saveOnServer||!s?(this.loadingCustomImage=!0,this.addCustomImage(e,t,i,n)):_downloadRemoteImage(e,t,i),this.productCreated&&this.mainOptions.hideDialogOnAdd&&this.mainBar&&this.mainBar.toggleDialog(!1)}}window.FancyProductDesigner=G})()})();