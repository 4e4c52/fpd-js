(()=>{var e={221:function(){const e=(e,t,n,i,s,a,o=8,r=8)=>{i=i||{};let l=this.sizeX||i.cornerSize||s.cornerSize,c=this.sizeY||i.cornerSize||s.cornerSize,d=l/2,p=c/2;const u=.6*l,h=s.cornerIconColor||"#000000";e.save(),e.translate(t,n),e.rotate(fabric.util.degreesToRadians(s.angle)),e.fillStyle=i.cornerColor||s.cornerColor,e.beginPath(),e.roundRect(-d+o,-p+r,l,c,4),e.filter="drop-shadow(0px 0px 2px rgba(0,0,0, 0.3))",e.fill(),e.font=u+"px FontFPD",e.fillStyle=h,e.textAlign="left",e.textBaseline="top",e.filter="none",e.fillText(a,-.5*u+o,-.5*u+r),e.restore()},t=(e,t,n,i,s)=>{i=i||{},e.save(),e.translate(t,n),e.rotate(fabric.util.degreesToRadians(s.angle)),e.fillStyle=i.cornerColor||s.cornerColor,e.beginPath(),e.roundRect(-3,-7.5,6,15,4),e.filter="drop-shadow(0px 0px 2px rgba(0,0,0, 0.3))",e.fill(),e.restore()},n=(e,t,n,i,s)=>{i=i||{},e.save(),e.translate(t,n),e.rotate(fabric.util.degreesToRadians(s.angle)),e.fillStyle=i.cornerColor||s.cornerColor,e.beginPath(),e.roundRect(-7.5,-3,15,6,4),e.filter="drop-shadow(0px 0px 2px rgba(0,0,0, 0.3))",e.fill(),e.restore()};fabric.Control.prototype.touchSizeX=60,fabric.Control.prototype.touchSizeY=60,fabric.Object.prototype.transparentCorners=!1,fabric.Object.prototype.controls.tl.cursorStyleHandler=()=>"pointer",fabric.Object.prototype.controls.tl.mouseDownHandler=function(e,t){const n=t.target;n.canvas.duplicateElement(n)},fabric.Object.prototype.controls.tl.actionHandler=null,fabric.Object.prototype.controls.tl.render=function(t,n,i,s,a){a.canvas&&a.canvas.viewOptions&&"basic"===a.canvas.viewOptions.cornerControlsStyle?fabric.controlsUtils.renderCircleControl.call(this,t,n,i,s,a):e(t,n,i,s,a,String.fromCharCode("0xe942"),-8,-8)},fabric.Object.prototype.controls.tr.cursorStyleHandler=()=>"pointer",fabric.Object.prototype.controls.tr.mouseDownHandler=function(e,t){const n=t.target;n.canvas.removeElement(n)},fabric.Object.prototype.controls.tr.actionHandler=null,fabric.Object.prototype.controls.tr.render=function(t,n,i,s,a){a.canvas&&a.canvas.viewOptions&&"basic"===a.canvas.viewOptions.cornerControlsStyle?fabric.controlsUtils.renderCircleControl.call(this,t,n,i,s,a):e(t,n,i,s,a,String.fromCharCode("0xe926"),8,-8)},fabric.Object.prototype.controls.mtr.withConnection=!1,fabric.Object.prototype.controls.mtr.y=.5,fabric.Object.prototype.controls.mtr.offsetY=25,fabric.Object.prototype.controls.mtr.offsetX=-8,fabric.Object.prototype.controls.mtr.render=function(t,n,i,s,a){a.canvas&&a.canvas.viewOptions&&"basic"===a.canvas.viewOptions.cornerControlsStyle?fabric.controlsUtils.renderCircleControl.call(this,t,n,i,s,a):e(t,n,i,s,a,String.fromCharCode("0xe923"))},fabric.Object.prototype.controls.br.render=function(t,n,i,s,a){a.canvas&&a.canvas.viewOptions&&"basic"===a.canvas.viewOptions.cornerControlsStyle?fabric.controlsUtils.renderCircleControl.call(this,t,n,i,s,a):e(t,n,i,s,a,String.fromCharCode("0xe922"))},fabric.Object.prototype.controls.ml.render=t,fabric.Object.prototype.controls.mr.render=t,fabric.Object.prototype.controls.mt.render=n,fabric.Object.prototype.controls.mb.render=n,fabric.Textbox.prototype.controls.ml.render=t,fabric.Textbox.prototype.controls.mr.render=t,fabric.Object.prototype.controls.bl.visible=!1},295:()=>{fabric.Group.prototype.changeObjectColor=function(e,t){let n=[];return this.getObjects().forEach((e=>{const t=tinycolor(e.fill);n.push(t.toHexString())})),n[e]=t,this.changeColor(n),n}},859:()=>{var e;fabric.Text.prototype.initialize=(e=fabric.Text.prototype.initialize,function(...t){return e.call(this,...t),this._TextInit(),this}),fabric.Text.prototype._constrainScale=function(e){return function(t){return t=e.call(this,t),void 0!==this.minFontSize&&parseFloat(Number(t*this.fontSize).toFixed(0))<this.minFontSize?this.minFontSize/this.fontSize:void 0!==this.maxFontSize&&parseFloat(Number(t*this.fontSize).toFixed(0))>this.maxFontSize?this.maxFontSize/this.fontSize:t}}(fabric.Text.prototype._constrainScale),fabric.Text.prototype._TextInit=function(){this.on({modified:e=>{(e=>{if(!e.curved&&!e.uniScalingUnlockable){let t=e.fontSize*e.scaleX;t=parseFloat(Number(t).toFixed(0)),e.scaleX=1,e.scaleY=1,e._clearCache(),e.set("fontSize",t),e.canvas&&e.canvas.fire("elementModify",{element:e,options:{fontSize:t}})}})(this)}})}},431:()=>{var e;fabric.Textbox.prototype.initialize=(e=fabric.Textbox.prototype.initialize,function(...t){return e.call(this,...t),this._TextboxInit(),this}),fabric.Textbox.prototype._TextboxInit=function(){this.on({added:()=>{if(this._calcWidth){this.set("width",1e3);const e=this.calcTextWidth();this.set("width",e),delete this._calcWidth}}})}},561:()=>{class e extends HTMLElement{constructor(){super()}connectedCallback(){}}customElements.define("fpd-actions-bar",e)}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,n),a.exports}(()=>{"use strict";const e=(e="",t=!1,n="",i=document.body)=>{i===document.body&&i.classList.add("fpd-overflow-hidden"),"prompt"===n?e=`\n            <input type="text" placeholder="${e}" />\n            <span class="fpd-btn"></span>\n        `:"confirm"===n&&(e=`\n            <div class="fpd-confirm-msg">${e}</div>\n            <span class="fpd-btn fpd-confirm"></span>\n        `);let s=`\n        <div class="fpd-modal-inner fpd-shadow-3">\n            <div class="fpd-modal-close">\n                <span class="fpd-icon-close"></span>\n            </div>\n            <div class="fpd-modal-content">${e}</div>\n        </div>\n    `;const a=document.createElement("div");return a.className="fpd-modal-internal fpd-modal-overlay "+(t?"fpd-fullscreen":""),a.innerHTML=s,a.dataset.type=n,i.append(a),l(a.querySelector(".fpd-modal-close"),["click"],(e=>{a.remove()})),a},t=e=>"[object Object]"===Object.prototype.toString.call(e),i=(e,t)=>{if(e&&"object"==typeof e){let s=!0;for(var n=0;n<t.length;++n){var i=t[n];if(!e.hasOwnProperty(i)){s=!1;break}}return s}return!1},s=(e,n)=>{const i={...e,...n};if(Object.keys(n).length)for(const a of Object.keys(i))t(i[a])&&e[a]&&n[a]&&(i[a]=s(e[a],n[a]));return i},a=(e,t,n)=>{if(!t)return;const i=(Array.isArray(t)?t:t.match(/([^[.\]])+/g)).reduce(((e,t)=>e&&e[t]),e);return void 0===i?n:i},o=e=>/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e),r=e=>0===e||"string"==typeof e&&"0"===e,l=(e,t=[],n=(()=>{}),i=!1)=>{(t="string"==typeof t?[t]:t).forEach((t=>{e instanceof HTMLElement?e.addEventListener(t,n,i):Array.from(e).length?e&&e.forEach((e=>{e.addEventListener(t,n,i)})):e.addEventListener(t,n,i)}))},c=(e=[],t=[])=>(e&&(e instanceof HTMLElement?t.forEach((t=>{e.classList.add(t)})):e.forEach((e=>{t.forEach((t=>{e.classList.add(t)}))}))),e),d=(e=[],t=[])=>(e&&(e instanceof HTMLElement?t.forEach((t=>{e.classList.remove(t)})):e.forEach((e=>{t.forEach((t=>{e.classList.remove(t)}))}))),e),p=(e=[],t=[],n=!0)=>(e&&(e instanceof HTMLElement?t.forEach((t=>{e.classList.toggle(t,n)})):e.forEach((e=>{t.forEach((t=>{e.classList.toggle(t,n)}))}))),e),u=(e,t=null)=>{if(e){e.classList.add("fpd-on-loading");var n=new Image;n.src=t||e.dataset.img,n.onload=function(){e.dataset.originwidth=this.width,e.dataset.originheight=this.height,e.classList.remove("fpd-on-loading"),e.style.backgroundImage='url("'+this.src+'")'},n.onerror=function(){e.parentNode.remove()}}},h=e=>void 0===e||null==e||("string"==typeof e?!e.trim().length:Array.isArray(e)?!e.length:"object"==typeof e&&!Object.keys(e).length),f=()=>{var e=!0;try{window.localStorage.length,window.localStorage.setItem("fpd-storage","just-testing")}catch(t){e=!1}return e},g=(e={})=>{if(!e.url)return;const t=document.createElement("div");t.className="fpd-item fpd-hover-thumbnail",t.dataset.source=e.url,e.disableDraggable||t.classList.add("fpd-draggable"),e.title&&(t.dataset.title=e.title,t.setAttribute("aria-label",e.title));const n=document.createElement("picture");if(n.dataset.img=e.thumbnailUrl?e.thumbnailUrl:e.url,t.append(n),!e.disablePrice){const n=document.createElement("span");n.className="fpd-price",n.innerHTML=e.price,t.append(n)}if(e.removable){const e=document.createElement("span");e.className="fpd-delete fpd-icon-remove",t.append(e)}return t},m=(e,t,n=null)=>{if(!e.currentViewInstance)return"";let i=e.currentViewInstance.options;if(e.mainBar.container.querySelector(".fpd-upload-zone-content").contains(t)&&e.currentViewInstance.currentUploadZone){const t=e.currentViewInstance.fabricCanvas.getUploadZone(e.currentViewInstance.currentUploadZone);t&&t.price&&(n=t.price)}return null==n&&(n=a(i,"customImageParameters.price",0)),n?e.formatPrice(n):""},v=(t,n,i)=>{const a=t.currentViewInstance;let o=a.options.customImageParameters;const r=a.fabricCanvas.getUploadZone(a.currentUploadZone);if(r&&(o=s(o,r)),n>o.maxW||n<o.minW||i>o.maxH||i<o.minH){t.loadingCustomImage=!1,t.mainBar&&(t.mainBar.toggleContentDisplay(!1),a.currentUploadZone&&t.mainBar.toggleUploadZonePanel(!1));let n=t.translator.getTranslation("misc","uploaded_image_size_alert");return n=n.replace("%minW",o.minW).replace("%minH",o.minH).replace("%maxW",o.maxW).replace("%maxH",o.maxH),e(n),!1}return!0},b=(e,t)=>{var n=[];if("group"==e.type){const t=e.getObjects();1===t.length?n=e.colors:(n=[],t.forEach((e=>{const t=tinycolor(e.fill);n.push(t.toHexString())})))}else n=e.colorLinkGroup&&t.colorLinkGroups[e.colorLinkGroup]?t.colorLinkGroups[e.colorLinkGroup].colors:e.colors;return n};class y{static defaults={imageLoadTimestamp:!1,stageWidth:900,stageHeight:600,editorMode:!1,editorBoxParameters:["left","top","angle","fill","width","height","fontSize","price"],fonts:[{name:"Arial"},{name:"Lobster",url:"google"}],facebookAppId:"",instagramClientId:"",instagramRedirectUri:"",instagramTokenUri:"",zoomStep:.2,maxZoom:3,hexNames:{},selectedColor:"#f5f5f5",boundingBoxColor:"#2185d0",outOfBoundaryColor:"#990000",replaceInitialElements:!1,fileServerURL:null,responsive:!0,cornerIconColor:"#000000",langJSON:"lang/default.json",colorPickerPalette:[],actions:{top:[],right:[],bottom:[],left:[]},mainBarModules:["products","images","text","designs","manage-layers"],initialActiveModule:"",maxValues:{},watermark:!1,priceFormat:{currency:"&#36;%d",decimalSep:".",thousandSep:","},mainBarContainer:!1,modalMode:!1,keyboardControl:!0,deselectActiveOnOutside:!0,uploadZonesTopped:!0,loadFirstProductInStage:!0,unsavedProductAlert:!1,hideDialogOnAdd:!0,toolbarPlacement:"smart",snapGridSize:[50,50],fabricCanvasOptions:{},namesNumbersDropdown:[],namesNumbersEntryPrice:0,colorSelectionPlacement:"",colorSelectionDisplayType:"grid",bulkVariationsPlacement:"",bulkVariations:{},toolbarDynamicContext:"body",boundingBoxProps:{strokeWidth:1},fitImagesInCanvas:!1,maxPrice:-1,inCanvasTextEditing:!0,openTextInputOnSelect:!1,designCategories:[],optionalView:!1,saveActionBrowserStorage:!0,pricingRules:[],uploadAgreementModal:!1,imageEditorSettings:{masks:[]},printingBox:null,autoOpenInfo:!1,guidedTour:null,replaceColorsInColorGroup:!1,allowedImageTypes:["jpeg","png","svg","pdf"],pixabayApiKey:"",pixabayHighResImages:!1,pixabayLang:"en",openModalInDesigner:!1,imageSizeTooltip:!1,highlightEditableObjects:"",applyFillWhenReplacing:!0,layouts:[],dynamicViewsOptions:{unit:"mm",formats:[],pricePerArea:0,minWidth:0,minHeight:0,maxWidth:1e4,maxHeight:1e4},disableTextEmojis:!1,smartGuides:!1,usePrintingBoxAsBounding:!1,printingBox:{},productsJSON:null,designsJSON:null,customizationRequiredRule:"any",swapProductConfirmation:!1,textLinkGroupProps:[],textTemplates:[],multiSelection:!1,multiSelectionColor:"#54dfe6",canvasHeight:"auto",maxCanvasHeight:.8,mobileGesturesBehaviour:"none",imageQualityRatings:null,splitMultiSVG:!1,cornerControlsStyle:"advanced",downloadFilename:"Product",autoFillUploadZones:!1,dragDropImagesToUploadZones:!1,responsiveBreakpoints:{small:768,medium:1024},dynamicDesigns:{},elementParameters:{objectCaching:!1,z:-1,price:0,colors:!1,removable:!1,draggable:!1,rotatable:!1,resizable:!1,copyable:!1,zChangeable:!1,boundingBox:!1,boundingBoxMode:"clipping",autoCenter:!1,replace:"",replaceInAllViews:!1,autoSelect:!1,topped:!1,colorPrices:{},colorLinkGroup:!1,patterns:[],sku:"",excludeFromExport:!1,showInColorSelection:!1,locked:!1,uniScalingUnlockable:!1,fixed:!1,originX:"center",originY:"center",cornerSize:24,fill:!1,lockUniScaling:!0,pattern:!1,top:0,left:0,angle:0,flipX:!1,flipY:!1,opacity:1,scaleX:1,scaleY:1},textParameters:{maxLength:0,curved:!1,curvable:!1,curveRadius:80,curveReverse:!1,maxLines:0,textBox:!1,textPlaceholder:!1,numberPlaceholder:!1,letterSpacing:0,chargeAfterEditing:!1,minFontSize:1,textTransform:"none",widthFontSize:0,maxFontSize:200,shadowColor:"",shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,textLinkGroup:"",strokeColors:[],editable:!0,fontFamily:"Arial",fontSize:18,lineHeight:1,fontWeight:"normal",fontStyle:"normal",textDecoration:"normal",padding:10,textAlign:"left",stroke:null,strokeWidth:0,charSpacing:0},imageParameters:{uploadZone:!1,filter:null,scaleMode:"fit",resizeToW:0,resizeToH:0,advancedEditing:!1,uploadZoneMovable:!1,uploadZoneRemovable:!1,padding:0,minScaleLimit:.01},customImageParameters:{minW:100,minH:100,maxW:1e4,maxH:1e4,minDPI:72,maxSize:10},customTextParameters:{},customAdds:{designs:!0,uploads:!0,texts:!0,drawing:!0},qrCodeProps:{autoCenter:!0,draggable:!0,removable:!0,resizable:!0}};static merge(e={},t={}){return s(e,t)}static getParameterKeys(){var e=Object.keys(this.defaults.elementParameters),t=Object.keys(this.defaults.imageParameters),n=Object.keys(this.defaults.textParameters);return(e=e.concat(t)).concat(n)}}window&&(window.FPDOptions=y),n(221),n(295),n(859);const E=(e,t,n,i,s="fit")=>{let a=1,o=0!==(n="number"!=typeof n?0:n),r=0!==(i="number"!=typeof i?0:i);return a="cover"===s?n-e<i-t?o?Math.max(n/e,i/t):1:r?Math.max(n/e,i/t):1:e>t?o?Math.min(n/e,i/t):1:r?Math.min(n/e,i/t):1,parseFloat(a.toFixed(10))};var x;fabric.IText.prototype.initialize=(x=fabric.IText.prototype.initialize,function(...e){return x.call(this,...e),this._ITextInit(),this}),fabric.IText.prototype._ITextInit=function(){this.on({added:()=>{this.setCurvedTextPath()},"editing:entered":()=>{this.canvas.viewOptions.inCanvasTextEditing||this.exitEditing(),this.curved&&this.exitEditing()},scaling:()=>{},changed:()=>{if(0!=this.maxLines&&this.textLines.length>this.maxLines){let e=this.textLines.slice(0,this.maxLines);this.set("text",e.join("\n")),this.exitEditing()}if(0!=this.maxLength&&this.text.length>this.maxLength&&(this.set("text",this.text.substr(0,this.maxLength)),this.exitEditing()),this.canvas.viewOptions.disableTextEmojis){let e=this.text.replace(FPDEmojisRegex,"");e=e.replace(String.fromCharCode(65039),""),this.set("text",e)}}})},fabric.IText.prototype.setCurvedTextPath=function(){if(this.curved){const t=new fabric.Path((0,0,"M0,0m"+-(e=this.curveRadius)+",0a"+e+","+e+" 0 1,0 "+2*e+",0a"+e+","+e+" 0 1,0 "+2*-e+",0"),{fill:"transparent",strokeWidth:2,stroke:"rgba(0,0,0, 0.5)",visible:!1});this.set("path",t),this.setCurvedTextPosition()}var e},fabric.IText.prototype.setCurvedTextPosition=function(){if(this.curved&&this.path){this.pathSide=this.curveReverse?"left":"right";const e=this.curveReverse?Math.PI*this.curveRadius*2*.25:Math.PI*this.curveRadius/2;this.pathStartOffset=e-this.calcTextWidth()/2,this.pathAlign="center"}},n(431),fabric.Object.propertiesToInclude=["_isInitial","lockMovementX","lockMovementY","lockRotation","lockScalingX","lockScalingY","lockScalingFlip","lockUniScaling","resizeType","boundingBox","boundingBoxMode","selectable","evented","title","editable","cornerColor","cornerIconColor","borderColor","isEditable","hasUploadZone","cornerSize"],fabric.Object.prototype.initialize=function(e){return function(...t){return e.call(this,...t),this._elementInit(),this}}(fabric.Object.prototype.initialize),fabric.Object.prototype._elementInit=function(){this.on({added:()=>{!this.isCustom||this.hasUploadZone||this.replace||(this.copyable=this.originParams.copyable=!0)},moving:()=>{this._checkContainment()},rotating:()=>{this._checkContainment()},scaling:()=>{this._checkContainment()},selected:()=>{let e=!this.lockUniScaling;this.textBox&&(e=!0),this.canvas&&"basic"==this.canvas.viewOptions.cornerControlsStyle&&(this.controls.mtr.offsetX=0,this.cornerSize=16),this.setControlsVisibility({ml:e,mr:e,mt:!this.lockUniScaling,mb:!this.lockUniScaling,tr:this.removable,tl:this.copyable,mtr:this.rotatable,br:this.resizable&&!this.curved})}})},fabric.Object.prototype.getType=function(e){return"text"===(e=e||this.type)||"i-text"===e||"curvedText"===e||"textbox"===e?"text":"image"},fabric.Object.prototype.isSVG=function(){return"group"===this.type||"path"===this.type||this.source&&this.source.includes(".svg")},fabric.Object.prototype.isColorizable=function(){return"text"===this.getType()?"text":!!this.source&&(1==this.source.split(".").length?this.source.includes("data:image/png;")?"dataurl":(this.fill=this.colors=!1,!1):(e=>this.source.replace(/\?.*$/,""))().includes(".png")||this.isSVG()?this.isSVG()?"svg":"png":(this.fill=this.colors=!1,!1))},fabric.Object.prototype.hasColorSelection=function(){return(Array.isArray(this.colors)||Boolean(this.colors)||this.colorLinkGroup||this.__editorMode)&&!1!==this.isColorizable()},fabric.Object.prototype.checkEditable=function(e){return"object"==typeof(e=e||this).colors||!0===e.colors||1==e.colors||e.removable||e.draggable||e.resizable||e.rotatable||e.zChangeable||e.advancedEditing||e.editable||e.uploadZone||e.colorLinkGroup&&e.colorLinkGroup.length>0||e.__editorMode},fabric.Object.prototype.changeColor=function(e,t=!0){const n=this.isColorizable();if("string"==typeof e&&(e=tinycolor(e).toHexString()),"text"===this.getType())"object"==typeof e&&(e=e[0]),this.set("fill",e),this.canvas.renderAll(),this.pattern=null;else if("group"==this.type&&"object"==typeof e){const t=this.getObjects();e.forEach(((e,n)=>{t[n]&&t[n].set("fill",e)})),this.canvas.renderAll(),this.svgFill=e,delete this.fill}else"object"==typeof e&&(e=e[0]),"string"!=typeof e&&(e=!1),"png"==n||"dataurl"==n?(this.filters=[],e&&this.filters.push(new fabric.Image.filters.BlendColor({mode:"tint",color:e})),this.applyFilters(),this.canvas.renderAll(),this.canvas.fire("elementColorChange",{element:this,colorLinking:t}),this.fill=e):"svg"==n&&(this.set("fill",e),this.canvas.renderAll(),this.canvas.fire("elementColorChange",{element:this,colorLinking:t}))},fabric.Object.prototype.setPattern=function(e){FancyProductDesigner.proxyFileServer&&(e=FancyProductDesigner.proxyFileServer+e),e&&(fabric.util.loadImage(e,(e=>{if(this.isSVG())if(this.hasOwnProperty("getObjects")){const n=this.getObjects();for(var t=0;t<n.length;++t)n[t].set("fill",new fabric.Pattern({source:e,repeat:"repeat"}))}else this.set("fill",new fabric.Pattern({source:e,repeat:"repeat"}));else if("text"==this.getType())this.set("fill",new fabric.Pattern({source:e,repeat:"repeat"}));else{let e=this.fill?this.fill:this.colors[0];e=e||"#000000",this.set("fill",e)}this.canvas.renderAll()})),this.pattern=e)},fabric.Object.prototype.getZIndex=function(){return this.canvas.getObjects().indexOf(this)},fabric.Object.prototype.centerElement=function(e=!0,t=!0){let n=this.getBoundingBoxCoords(),i=this.left,s=this.top;e&&(i=n?n.cp?n.cp.x:n.left+.5*n.width:.5*this.canvas.viewOptions.stageWidth),t&&(s=n?n.cp?n.cp.y:n.top+.5*n.height:.5*this.canvas.viewOptions.stageHeight),this.setPositionByOrigin(new fabric.Point(i,s),"center","center"),this.canvas.renderAll(),this.setCoords(),this._checkContainment(),this.autoCenter=!1},fabric.Object.prototype._checkContainment=function(){if(this.canvas&&this.canvas.currentBoundingObject&&!this.hasUploadZone)if(this.setCoords(),"limitModify"===this.boundingBoxMode){let e=this.getBoundingRect(),t=instance.currentBoundingObject.getBoundingRect(),n=t.left,i=t.left+t.width-e.width,s=t.top,a=t.top+t.height-e.height;this.isContainedWithinObject(instance.currentBoundingObject)?(limitModifyParameters={left:this.left,top:this.top,angle:this.angle,scaleX:this.scaleX,scaleY:this.scaleY},"text"==this.getType()&&(limitModifyParameters.fontSize=this.fontSize,limitModifyParameters.lineHeight=this.lineHeight,limitModifyParameters.charSpacing=this.charSpacing)):(0===this.__corner&&(e.left>n&&e.left<i&&(limitModifyParameters.left=this.left),e.top>s&&e.top<a&&(limitModifyParameters.top=this.top)),this.setOptions(limitModifyParameters))}else if("inside"===this.boundingBoxMode||"clipping"===this.boundingBoxMode){var e,t=this.isOut;(e=!this.isContainedWithinObject(this.canvas.currentBoundingObject))?("inside"===this.boundingBoxMode&&(this.borderColor=this.canvas.viewOptions.outOfBoundaryColor),this.isOut=!0):("inside"===this.boundingBoxMode&&(this.borderColor=this.canvas.viewOptions.selectedColor),this.isOut=!1),t!=this.isOut&&null!=t&&(e?this.canvas.fire("elementOut",{target:this}):this.canvas.fire("elementIn",{target:this})),this.canvas.fire("elementCheckContainemt",{target:this,boundingBoxMode:this.boundingBoxMode})}},fabric.Object.prototype.getBoundingBoxCoords=function(){if(this.boundingBox||this.uploadZone){if("object"==typeof this.boundingBox)return!!(this.boundingBox.hasOwnProperty("x")&&this.boundingBox.hasOwnProperty("y")&&this.boundingBox.width&&this.boundingBox.height)&&{left:this.boundingBox.x,top:this.boundingBox.y,width:this.boundingBox.width,height:this.boundingBox.height};{const e=this.canvas.getElementByTitle(this.boundingBox);if(e){const t=e.getPointByOrigin("left","top");return{left:t.x,top:t.y,width:e.width*e.scaleX,height:e.height*e.scaleY,angle:e.angle||0,cp:e.getCenterPoint()}}}}return!1},fabric.Object.prototype.getClippingObject=function(){if(this.boundingBox||this.uploadZone){if("object"==typeof this.boundingBox)return this.getBoundingBoxCoords();{const e=this.canvas.getElementByTitle(this.boundingBox);if(e)return"image"==e.type?this.getBoundingBoxCoords():e}}return!1},fabric.Object.prototype._clipElement=function(){var e=this.getClippingObject();if(e)if(e.type)e.clone((e=>{e.set({absolutePositioned:!0,opacity:1}),this.clipPath=e}));else{const t=new fabric.Rect({originX:"left",originY:"top",angle:e.angle||0,left:e.left,top:e.top,width:e.width,height:e.height,fill:"#DDD",absolutePositioned:!0});this.clipPath=t}},fabric.Object.prototype.getElementJSON=function(e=!1,t=[]){this.canvas&&(t=Object.keys(this.canvas.viewOptions.elementParameters),t="text"===this.getType()?t.concat(Object.keys(this.canvas.viewOptions.textParameters)):t.concat(Object.keys(this.canvas.viewOptions.imageParameters))),e&&(t=t.concat(fabric.Object.propertiesToInclude)),this.uploadZone&&(t.push("customAdds"),t.push("designCategories"),t.push("designCategories[]")),"text"===this.getType()&&(t.push("text"),t.push("_initialText")),"group"===this.type&&t.push("svgFill"),t.push("width"),t.push("height"),t.push("isEditable"),t.push("hasUploadZone"),t.push("evented"),t.push("isCustom"),t.push("currentColorPrice"),t.push("_isPriced"),t.push("originParams"),t.push("originSource"),t.push("_printingBox"),t=t.sort();let n={};return t.forEach((e=>{void 0!==this[e]&&(n[e]=this[e])})),n},fabric.Object.prototype.alignToPosition=function(e="left"){let t=this.getPointByOrigin("left","top"),n=this.getBoundingBoxCoords(),i="left",s="top";"left"===e?(t.x=n?n.left:0,t.x+=this.padding+1):"top"===e?(t.y=n?n.top:0,t.y+=this.padding+1):"right"===e?(t.x=n?n.left+n.width-this.padding:this.canvas.viewOptions.stageWidth-this.padding,i="right"):(t.y=n?n.top+n.height-this.padding:this.canvas.viewOptions.stageHeight,s="bottom"),this.setPositionByOrigin(t,i,s),this.setCoords(),this._checkContainment()},fabric.Object.prototype.toggleUploadZone=function(){if(this.hasUploadZone&&this.canvas){let n=this.canvas.getObjects(),i=!0;for(var e=0;e<n.lenth;++e)if(n[e].replace==this.replace){i=!1;break}var t=this.canvas.getUploadZone(this.replace);t&&(t.set("opacity",i?1:0),t.evented=i),this.canvas.renderAll()}},fabric.Canvas.prototype.initialize=function(e){return function(...t){return e.call(this,...t),this._historyInit(),this}}(fabric.Canvas.prototype.initialize),fabric.Canvas.prototype.dispose=function(e){return function(...t){return e.call(this,...t),this._historyDispose(),this}}(fabric.Canvas.prototype.dispose),fabric.Canvas.prototype._historyNext=function(){let e=y.getParameterKeys();e=e.concat(fabric.Object.propertiesToInclude);let t=this.toJSON(e);return t.objects.forEach((e=>{e.curved&&delete e.path})),JSON.stringify(t)},fabric.Canvas.prototype._historyEvents=function(){return{elementAdd:this._historySaveAction,elementRemove:this._historySaveAction,"object:modified":this._historySaveAction}},fabric.Canvas.prototype._historyInit=function(){this.historyUndo=[],this.historyRedo=[],this.historyNextState=this._historyNext(),this.on(this._historyEvents())},fabric.Canvas.prototype._historyDispose=function(){this.off(this._historyEvents())},fabric.Canvas.prototype._historySaveAction=function(){if(this.historyProcessing)return;const e=this.historyNextState;this.historyUndo.push(e),this.historyNextState=this._historyNext(),this.fire("history:append",{json:e})},fabric.Canvas.prototype.undo=function(e){this.historyProcessing=!0;const t=this.historyUndo.pop();t?(this.historyRedo.push(this._historyNext()),this.historyNextState=t,this._loadHistory(t,"history:undo",e)):this.historyProcessing=!1},fabric.Canvas.prototype.redo=function(e){this.historyProcessing=!0;const t=this.historyRedo.pop();t?(this.historyUndo.push(this._historyNext()),this.historyNextState=t,this._loadHistory(t,"history:redo",e)):this.historyProcessing=!1},fabric.Canvas.prototype._loadHistory=function(e,t,n){var i=this;this.loadFromJSON(e,(function(){i.renderAll(),i.fire(t),i.historyProcessing=!1,n&&"function"==typeof n&&n()}))},fabric.Canvas.prototype.clearHistory=function(){this.historyUndo=[],this.historyRedo=[],this.fire("history:clear")},fabric.Canvas.prototype.onHistory=function(){this.historyProcessing=!1,this._historySaveAction()},fabric.Canvas.prototype.offHistory=function(){this.historyProcessing=!0},fabric.Canvas.prototype.panCanvas=!1;fabric.Canvas.prototype.snapToObjects=!1,fabric.Canvas.prototype.snapToGrid=!1,fabric.Canvas.prototype.snapGridSize=[50,50];fabric.Canvas.prototype.viewOptions={},fabric.Canvas.prototype.elements=[],fabric.Canvas.prototype.currentElement=null,fabric.Canvas.prototype.responsiveScale=1,fabric.Canvas.prototype.currentBoundingObject=null,fabric.Canvas.prototype.initialElementsLoaded=!1,fabric.Canvas.prototype.isCustomized=!1,fabric.Canvas.prototype.printingBoxObject=null,fabric.Canvas.prototype._canvasCreated=!1,fabric.Canvas.prototype.currentCurvedTextPath=!1,fabric.Canvas.prototype.initialize=function(e){return function(...t){return e.call(this,...t),this._fpdCanvasInit(),this}}(fabric.Canvas.prototype.initialize),fabric.Canvas.prototype._onTouchStart=function(e){return function(t){const n=this.findTarget(t);(!this.allowTouchScrolling||n||this.isDrawingMode)&&e.call(this,t)}}(fabric.Canvas.prototype._onTouchStart),fabric.Canvas.prototype._fpdCanvasInit=function(){let e=null;this.on({"after:render":()=>{this._canvasCreated||this._onCreated(),this.viewOptions&&this.viewOptions.highlightEditableObjects.length>3&&(this.contextContainer.strokeStyle=this.viewOptions.highlightEditableObjects,this.forEachObject((e=>{if(e!==this.getActiveObject()&&!e.isMoving&&("text"===e.getType()&&e.editable||e.uploadZone)){const t=e.getBoundingRect();this.contextContainer.setLineDash([5,15]),this.contextContainer.strokeRect(t.left,t.top,t.width,t.height)}else this.contextContainer.setLineDash([])})))},"object:added":({target:e})=>{this._bringToppedElementsToFront()},"object:moving":({target:t})=>{e="moving",this.fire("elementChange",{type:"moving",element:t})},"object:rotating":({target:t})=>{e="rotating",this.fire("elementChange",{type:"rotating",element:t})},"object:scaling":({target:t})=>{e="scaling",this.fire("elementChange",{type:"scaling",element:t})},"object:modified":({target:t})=>{const n=t;if(null!==e){let t={};switch(e){case"moving":t.left=Number(n.left),t.top=Number(n.top);break;case"scaling":"text"!==n.getType()||n.curved||n.uniScalingUnlockable?(t.scaleX=parseFloat(n.scaleX),t.scaleY=parseFloat(n.scaleY)):t.fontSize=parseInt(n.fontSize);break;case"rotating":t.angle=n.angle}this.fire("elementModify",{element:n,options:t})}e=null},"selection:created":({selected:e})=>{1==e.length?this._onSelected(e[0]):this._onMultiSelected(e)},"selection:updated":({selected:e})=>{1==e.length?this._onSelected(e[0]):this._onMultiSelected(e)},"selection:cleared":({deselected:e})=>{this.currentCurvedTextPath&&(this.currentCurvedTextPath.visible=!1,this.currentCurvedTextPath=null)},"mouse:down":e=>{e.target&&e.target.__corner&&"function"==typeof e.target.exitEditing&&e.target.exitEditing(),null==e.target&&this.deselectElement()},elementAdd:()=>{this.forEachObject((e=>{!e.clipPath&&(e.boundingBox&&"clipping"===e.boundingBoxMode||e.hasUploadZone)&&e._clipElement()}))}})},fabric.Canvas.prototype._onCreated=function(){this._canvasCreated=!0,"none"!=this.viewOptions.mobileGesturesBehaviour&&((e,t)=>{let n,i,s,a,o=!1;e.on({"mouse:down":t=>{o=!0,t.e.touches&&(n=t.e.touches[0].clientX,i=t.e.touches[0].clientY,e.currentElement&&(s=e.currentElement.scaleX,a=e.currentElement.scaleY))},"mouse:up":function(e){o=!1},"mouse:move":function(r){if("pinchImageScale"==t&&r.e.touches&&2==r.e.touches.length&&e.currentElement&&"image"==e.currentElement.getType()&&e.currentElement.resizable)e.setElementOptions({scaleX:s*r.e.scale,scaleY:a*r.e.scale},e.currentElement);else if("pinchPanCanvas"==t&&e.panCanvas)if(r.e.touches)if(1==r.e.touches.length){let t=r.e.touches[0].clientX,s=r.e.touches[0].clientY;e.relativePan(new fabric.Point(t-n,s-i)),n=t,i=s}else 2==r.e.touches.length&&e.setResZoom(r.e.scale);else o&&e.relativePan(new fabric.Point(r.e.movementX,r.e.movementY))}})})(this,this.viewOptions.mobileGesturesBehaviour),(e=>{let t,n=e.getSelectionContext(),i=4,s=.5,a="rgba(255,0,241,0.5)",o=1;function r(t){c(t-s,0,t-s,e.getHeight()/o)}function l(t){c(0,t-s,e.getWidth()/o,t-s)}function c(i,r,l,c){n.save(),n.lineWidth=s,n.strokeStyle=a,n.beginPath(),e.snapToGrid||n.setLineDash([5,10]),n.moveTo((i+t[4])*o,(r+t[5])*o),n.lineTo((l+t[4])*o,(c+t[5])*o),n.stroke(),n.restore()}function d(e,t){e=Math.round(e),t=Math.round(t);for(var n=e-i,s=e+i;n<=s;n++)if(n===t)return!0;return!1}var p=[],u=[];e.on("mouse:down",(function(){t=e.viewportTransform,o=e.getZoom()})),e.on("object:moving",(function(n){let i=n.target,s=e.getObjects(),a=i.getCenterPoint(),o=a.x,r=a.y,l=i.getBoundingRect(),c=l.height/t[3],h=l.width/t[0],f=!1,g=!1,m=e._currentTransform;if(e.snapToGrid,e.snapToObjects&&!e.snapToGrid&&m){for(var v=s.length;v--;)if(s[v]!==i){var b=s[v].getCenterPoint(),y=b.x,E=b.y,x=s[v].getBoundingRect(),C=x.height/t[3],w=x.width/t[0];d(y,o)&&(g=!0,p.push({x:y,y1:E<r?E-C/2-1:E+C/2+1,y2:r>E?r+c/2+1:r-c/2-1}),i.setPositionByOrigin(new fabric.Point(y,r),"center","center")),d(y-w/2,o-h/2)&&(g=!0,p.push({x:y-w/2,y1:E<r?E-C/2-1:E+C/2+1,y2:r>E?r+c/2+1:r-c/2-1}),i.setPositionByOrigin(new fabric.Point(y-w/2+h/2,r),"center","center")),d(y+w/2,o+h/2)&&(g=!0,p.push({x:y+w/2,y1:E<r?E-C/2-1:E+C/2+1,y2:r>E?r+c/2+1:r-c/2-1}),i.setPositionByOrigin(new fabric.Point(y+w/2-h/2,r),"center","center")),d(E,r)&&(f=!0,u.push({y:E,x1:y<o?y-w/2-1:y+w/2+1,x2:o>y?o+h/2+1:o-h/2-1}),i.setPositionByOrigin(new fabric.Point(o,E),"center","center")),d(E-C/2,r-c/2)&&(f=!0,u.push({y:E-C/2,x1:y<o?y-w/2-1:y+w/2+1,x2:o>y?o+h/2+1:o-h/2-1}),i.setPositionByOrigin(new fabric.Point(o,E-C/2+c/2),"center","center")),d(E+C/2,r+c/2)&&(f=!0,u.push({y:E+C/2,x1:y<o?y-w/2-1:y+w/2+1,x2:o>y?o+h/2+1:o-h/2-1}),i.setPositionByOrigin(new fabric.Point(o,E+C/2-c/2),"center","center"))}f||(u.length=0),g||(p.length=0)}})),e.on("before:render",(()=>{e.contextTop&&e.clearContext(e.contextTop)})),e.on("after:render",(()=>{if(e.snapToGrid){if(t=e.viewportTransform,o=e.getZoom(),e.snapGridSize){const t=Math.round(e.width/o/e.snapGridSize[0]);for(let n=0;n<t;++n)r(n*e.snapGridSize[0]);const n=Math.round(e.height/o/e.snapGridSize[1]);for(let t=0;t<n;++t)l(t*e.snapGridSize[1])}}else{for(var n=p.length;n--;)r(p[n].x);for(n=u.length;n--;)l(u[n].y);p.length=u.length=0}})),e.on("mouse:up",(()=>{p.length=u.length=0,e.renderAll()}))})(this),this._renderPrintingBox()},fabric.Canvas.prototype._onSelected=function(e){if(this.deselectElement(!1),this.dragStage)return this.deselectElement(),!1;this.currentElement=e,this.currentCurvedTextPath&&(this.currentCurvedTextPath.visible=!1),this.currentCurvedTextPath=e.path,this.currentCurvedTextPath&&(this.currentCurvedTextPath.visible=!0),this.fire("elementSelect",{element:e}),this.hoverCursor=e.draggable?"move":"pointer",e.boundingBox&&!e.uploadZone&&this._renderElementBoundingBox(e)},fabric.Canvas.prototype._onMultiSelected=function(e){const t=this.getActiveObject();this.viewOptions.multiSelection&&(t.set({lockScalingX:!0,lockScalingY:!0,lockRotation:!0,hasControls:!1,borderDashArray:[8,8],cornerStyle:"circle",cornerSize:16,transparentCorners:!1,borderColor:this.viewOptions.multiSelectionColor,borderScaleFactor:3}),e.forEach((e=>{e.draggable&&!e.locked||t.removeWithUpdate(e)})))},fabric.Canvas.prototype._renderElementBoundingBox=function(e){if(this.currentBoundingObject&&(this.remove(this.currentBoundingObject),this.currentBoundingObject=null),e){var t=e.getBoundingBoxCoords();if(t&&"none"!=e.boundingBoxMode){let e={left:t.left,top:t.top,width:t.width,height:t.height,angle:t.angle||0,stroke:this.viewOptions.boundingBoxColor,strokeWidth:1,strokeLineCap:"square",strokeDashArray:[10,10],fill:!1,selectable:!1,evented:!1,originX:"left",originY:"top",name:"bounding-box",excludeFromExport:!0,_ignore:!0};e=s(e,this.viewOptions.boundingBoxProps),this.currentBoundingObject=new fabric.Rect(e),this.add(this.currentBoundingObject),this.currentBoundingObject.bringToFront(),this.fire("boundingBoxToggle",{currentBoundingObject:this.currentBoundingObject,state:!0})}e._checkContainment()}},fabric.Canvas.prototype._renderPrintingBox=function(){if(this.printingBoxObject&&(this.remove(this.printingBoxObject),this.printingBoxObject=null),i(this.viewOptions.printingBox,["left","top","width","height"])){const e=new fabric.Rect({left:100,top:100,width:this.viewOptions.printingBox.width,height:this.viewOptions.printingBox.height,stroke:this.viewOptions.printingBox.visibility||this.viewOptions.editorMode?"#db2828":"transparent",strokeWidth:1,strokeLineCap:"square",fill:!1,originX:"left",originY:"top",name:"printing-box",excludeFromExport:!0,_ignore:!0});this.printingBoxObject=new fabric.Group([e],{left:this.viewOptions.printingBox.left,top:this.viewOptions.printingBox.top,evented:!1,resizable:!0,uniformScaling:!1,lockRotation:!0,borderColor:"transparent",transparentCorners:!0,cornerColor:this.viewOptions.selectedColor,cornerIconColor:this.viewOptions.cornerIconColor,cornerSize:24,originX:"left",originY:"top",name:"printing-boxes",excludeFromExport:!0,selectable:!1,_ignore:!0}),this.add(this.printingBoxObject),this.printingBoxObject.setCoords(),this.renderAll()}},fabric.Canvas.prototype._bringToppedElementsToFront=function(){let e=this.getObjects(),t=[];e.forEach((e=>{(e.topped||e.uploadZone&&this.viewOptions.uploadZonesTopped)&&t.push(e)})),t.forEach((e=>{e.bringToFront()})),this.currentBoundingObject&&this.currentBoundingObject.bringToFront(),this.printingBoxObject&&this.printingBoxObject.bringToFront(),this.renderAll()},fabric.Canvas.prototype.addElements=function(e,t){let n=-1;const i=()=>{if(n++,n<e.length){const t=e[n];s(t)||this.addElement(t.type,t.source,t.title,t.parameters)}else this.off("elementAdd",i),void 0!==t&&t.call(t,this),this.initialElementsLoaded=!0},s=t=>{if(void 0===t.type||void 0===t.source||void 0===t.title){const n=e.indexOf(t);if(-1!==n)return console.log("Element index "+n+" from elements removed, its not a valid element object!","info"),i(),!0}else this.elements.push(t);return!1};e[0]?(this.on("elementAdd",i),i()):(void 0!==t&&t.call(t,instance),this.initialElementsLoaded=!0)},fabric.Canvas.prototype.addElement=function(e,t,n,a={}){if(void 0===e||void 0===t||void 0===n)return;let r;if(this.fire("beforeElementAdd",{type:e,source:t,title:n,params:a}),"text"===e&&(t=(t=t.replace(/(<([^>]+)>)/gi,"")).replace(FancyProductDesigner.forbiddenTextChars,""),n=n.replace(/(<([^>]+)>)/gi,"")),"string"==typeof a.fill||Array.isArray(a.fill)||(a.fill=!1),r=e.toLowerCase().includes("text")?s(this.viewOptions.elementParameters,this.viewOptions.textParameters):s(this.viewOptions.elementParameters,this.viewOptions.imageParameters),!0!==(a=s(r,a)).colors&&1!=a.colors||(a.colors=a.fill?a.fill:"#000"),a.colors&&"string"==typeof a.colors&&0==a.colors.indexOf("#")){var l=a.colors.replace(/\s+/g,"").split(",");a.colors=l}if(a._isInitial=!this.initialElementsLoaded,e.toLowerCase().includes("text")){var c=a.colors[0]?a.colors[0]:"#000000";a.fill=a.fill?a.fill:c}let d={source:t,title:n,id:String((new Date).getTime())};if(this.viewOptions.editorMode?(a.__editorMode=this.viewOptions.editorMode,d.selectable=d.evented=!0):d=s(d,{selectable:!1,lockRotation:!0,hasRotatingPoint:!1,lockScalingX:!0,lockScalingY:!0,lockMovementX:!0,lockMovementY:!0,hasControls:!1,evented:!1,lockScalingFlip:!0}),d=s(a,d),d.isCustom&&(this.isCustomized=!0),this.viewOptions.usePrintingBoxAsBounding&&!d.boundingBox&&i(this.viewOptions.printingBox,["left","top","width","height"])&&(d.boundingBox={x:this.viewOptions.printingBox.left-1,y:this.viewOptions.printingBox.top-1,width:this.viewOptions.printingBox.width+1,height:this.viewOptions.printingBox.height+1},d._printingBox=d.boundingBox),"image"==e||"path"==e||"group"==e){if(-1===t.search("<svg ")){var p=t.split("?");t=d.source=p[0]}const e=(e,t,n,i={})=>{e?(t.originParams=s(t,i),e.setOptions(t),this.add(e),this.setElementOptions(t,e),e.originParams.angle=e.angle,e.originParams.z=e.getZIndex()):this.fire("imageFail",{url:t.source}),this.fire("elementAdd",{element:e})};if(void 0===t||0===t.length)return void console.log("No image source set for: "+n);if(-1!==t.search("<svg"))fabric.loadSVGFromString(t,((t,n)=>{var i=fabric.util.groupSVGElements(t,n);if(d.fill)d.svgFill||(d.svgFill=d.fill),delete d.fill;else if(!d.fill&&!d.svgFill){if(t){a.colors=[];for(var s=0;s<t.length;++s){var o=t[s].fill.length>0?tinycolor(t[s].fill).toHexString():"transparent";a.colors.push(o)}a.svgFill=a.colors}d.svgFill=a.svgFill}delete d.boundingBox,delete d.originParams,delete d.colors,delete d.svgFill,delete d.width,delete d.height,delete d.originX,delete d.originY,delete d.objectCaching,e(i,d,!0,{svgFill:a.svgFill})}));else if(t.split(".").includes("svg")){let n=Date.now().toString(),i=o(t)?new URL(FancyProductDesigner.proxyFileServer+t):t;!t.includes(".cloudfront.net/")&&!this.viewOptions.imageLoadTimestamp||FancyProductDesigner.proxyFileServer||i.searchParams.append("t",n),"object"==typeof i&&(i=i.toString()),fabric.loadSVGFromURL(i,((t,n)=>{var i=t?fabric.util.groupSVGElements(t,n):null;if(d.fill)d.svgFill||(d.svgFill=d.fill),delete d.fill;else if(!d.fill&&!d.svgFill){if(t){a.colors=[];for(var s=0;s<t.length;++s){var o=t[s].fill.length>0?tinycolor(t[s].fill).toHexString():"transparent";a.colors.push(o)}a.svgFill=a.colors}d.svgFill=a.svgFill}e(i,d,!0,{svgFill:a.svgFill})}))}else{let n,i=Date.now().toString();t.includes("data:image/")?n=t:(n=o(t)?new URL(FancyProductDesigner.proxyFileServer+t):t,this.viewOptions.imageLoadTimestamp&&!FancyProductDesigner.proxyFileServer&&n.searchParams.append("t",i),"object"==typeof n&&(n=n.toString())),new fabric.Image.fromURL(n,(function(t){t=""===t.getSrc()?null:t,e(t,d,!1)}),{crossOrigin:"anonymous"})}}else if(e.toLowerCase().includes("text")){var u;t=t.replace(/\\n/g,"\n"),a.text=a.text?a.text:t,d._initialText=a.hasOwnProperty("_initialText")?a._initialText:a.text,d.originParams={...a},a.originParams&&a.originParams.text&&(d.originParams.text=d._initialText),u=a.curved?new fabric.IText(t.replace(/(?:\r\n|\r|\n)/g,""),d):a.textBox?new fabric.Textbox(t,d):new fabric.IText(t,d),(d.textPlaceholder||d.numberPlaceholder)&&(d.textPlaceholder&&(this.textPlaceholder=u,d.removable=!1,d.editable=!1),d.numberPlaceholder&&(this.numberPlaceholder=u,d.removable=!1,d.editable=!1)),this.add(u),this.setElementOptions(d,u),u.originParams=s(u.toJSON(),u.originParams),u.originParams.z=u.getZIndex(),this.fire("elementAdd",{element:u})}},fabric.Canvas.prototype.deselectElement=function(e=!0){this.currentBoundingObject&&(this.remove(this.currentBoundingObject),this.fire("boudingBoxToggle",{boundingBox:this.currentBoundingObject,state:!1}),this.currentBoundingObject=null),e&&this.discardActiveObject(),this.currentElement=null,this.renderAll().calcOffset(),this.fire("elementSelect",{element:null})},fabric.Canvas.prototype.resetSize=function(){const e=this.wrapperEl.parentNode.clientWidth;let t=e<this.viewOptions.stageWidth?e/this.viewOptions.stageWidth:1,n=t;this.responsiveScale=t;let i=this.viewOptions.stageHeight;if("auto"!==this.viewOptions.canvasHeight&&this.viewOptions.canvasHeight.includes("px")&&(i=parseInt(this.viewOptions.canvasHeight),this.responsiveScale=t*(i/this.viewOptions.stageHeight),n=1),!isNaN(this.viewOptions.maxCanvasHeight)&&1!==this.viewOptions.maxCanvasHeight){const e=window.innerHeight*parseFloat(this.viewOptions.maxCanvasHeight);i*n>e&&(this.responsiveScale=t*(e/this.viewOptions.stageHeight),i=e)}return this.responsiveScale=parseFloat(Number(this.responsiveScale.toFixed(7))),this.responsiveScale=Math.min(this.responsiveScale,1),this.viewOptions.responsive||(this.responsiveScale=1,t=n=1),this.setDimensions({width:t*this.viewOptions.stageWidth,height:this.viewOptions.stageHeight*this.responsiveScale}).setZoom(this.responsiveScale).calcOffset().renderAll(),this.fire("sizeUpdate",{responsiveScale:this.responsiveScale,canvasHeight:i*n}),this.responsiveScale},fabric.Canvas.prototype.setResZoom=function(e){this.deselectElement();var t=new fabric.Point(.5*this.getWidth(),.5*this.getHeight());this.zoomToPoint(t,e*this.responsiveScale),1==e&&this.resetZoom()},fabric.Canvas.prototype.resetZoom=function(){this.deselectElement(),this.zoomToPoint(new fabric.Point(0,0),this.responsiveScale),this.absolutePan(new fabric.Point(0,0))},fabric.Canvas.prototype.getElementByTitle=function(e){const t=this.getObjects();for(var n=0;n<t.length;++n)if(t[n].title===e)return t[n]},fabric.Canvas.prototype.getElementByID=function(e){const t=this.getObjects();for(var n=0;n<t.length;++n)if(t[n].id==e)return t[n];return!1},fabric.Canvas.prototype.reset=function(e=!0){this.elements=[],this.clear(),e&&this.wrapperEl.remove(),this.fire("clear")},fabric.Canvas.prototype.removeElement=function(e){"string"==typeof e&&(e=this.getElementByTitle(e)),this.deselectElement(),e.toggleUploadZone&&e.toggleUploadZone(),this.remove(e),this.fire("elementRemove",{element:e})},fabric.Canvas.prototype.getElementByReplace=function(e){const t=this.getObjects();for(var n=0;n<t.length;++n){const i=t[n];if(i.replace===e)return i}return null},fabric.Canvas.prototype.setElementOptions=function(e,t){if(!(t=void 0===t?this.getActiveObject():t)||void 0===e)return!1;"string"==typeof t&&(t=this.getElementByTitle(t));const n=t.getType();if("image"==n&&!t._isInitial&&!t._addToUZ&&1===t.scaleX){let n=null;if(r(t.resizeToW)&&r(t.resizeToH)){if(t.boundingBox){const e=t.getBoundingBoxCoords();n=E(t.width,t.height,e.width,e.height,t.scaleMode)}else if(this.viewOptions.fitImagesInCanvas){const e=3*t.cornerSize;(t.width*t.scaleX+e>this.viewOptions.stageWidth||t.height*t.scaleY+e>this.viewOptions.stageHeight)&&(n=E(t.width,t.height,this.viewOptions.stageWidth-e,this.viewOptions.stageHeight-e))}}else{let e=t.resizeToW,i=t.resizeToH;e=isNaN(e)?parseFloat(e)/100*this.viewOptions.stageWidth:parseInt(e),i=isNaN(i)?parseFloat(i)/100*this.viewOptions.stageHeight:parseInt(i),n=E(t.width,t.height,e,i,t.scaleMode)}null!==n&&(e=s(e,{scaleX:n,scaleY:n}))}if(Boolean(t._addToUZ)){e.z=-1;let n=this.getElementByTitle(t._addToUZ),i=1;"image"==t.getType()&&(i=E(t.width,t.height,n.width*n.scaleX,n.height*n.scaleY,n.scaleMode)),(e=s(e,{boundingBox:t._addToUZ,boundingBoxMode:"clipping",scaleX:i,scaleY:i,autoCenter:!0,removable:!0,zChangeable:!1,autoSelect:!1,copyable:!1,hasUploadZone:!0,z:this.getElementByTitle(t._addToUZ).getZIndex(),rotatable:n.rotatable,draggable:n.draggable,resizable:n.resizable,price:n.price?n.price:e.price,replace:t._addToUZ,lockUniScaling:n.lockUniScaling,uniScalingUnlockable:n.uniScalingUnlockable,advancedEditing:n.advancedEditing,originX:n.originX,originY:n.originY,angle:n.angle})).originParams=s(e.originParams,{boundingBox:e.boundingBox,replace:e.replace,rotatable:e.rotatable,draggable:e.draggable,resizable:e.resizable,lockUniScaling:e.lockUniScaling,uniScalingUnlockable:e.uniScalingUnlockable,price:e.price,scaleX:e.scaleX,scaleY:e.scaleY,hasUploadZone:!0,autoCenter:!0,originX:e.originX,originY:e.originY,angle:e.angle}),delete e[""],delete t._addToUZ}if(e.topped&&(e.zChangeable=!1),t.checkEditable(e)&&(e.isEditable=e.evented=e.selectable=!0),e.uploadZone&&!this.viewOptions.editorMode||(e.draggable&&(e.lockMovementX=e.lockMovementY=!1),e.rotatable&&(e.lockRotation=!1,e.hasRotatingPoint=!0),e.resizable&&(e.lockScalingX=e.lockScalingY=!1),(e.resizable||e.rotatable||e.removable)&&(e.hasControls=!0)),e.uploadZone&&(this.viewOptions.editorMode||(e.uploadZoneMovable&&(e.lockMovementX=e.lockMovementY=!1),e.uploadZoneRemovable&&(e.removable=!0,e.copyable=!1,e.hasControls=!0)),e.borderColor="transparent",e.excludeFromExport=!0),e.fixed&&h(e.replace)&&(e.replace=t.title),e.replace&&""!=e.replace){let n=this.getElementByReplace(e.replace);null!==n&&n!==t&&(e.z=n.getZIndex(),e.left=t.originParams.left=n.left,e.top=t.originParams.top=n.top,e.autoCenter=!1,this.viewOptions.applyFillWhenReplacing&&(e.fill=n.fill),this.removeElement(n))}if("string"==typeof e.text){let n=e.text;n=n.replace(FancyProductDesigner.forbiddenTextChars,""),this.initialElementsLoaded&&t.chargeAfterEditing&&(t._isPriced||(t._isPriced=!0),t._initialText===n&&t._isPriced&&(t._isPriced=!1))}if("text"===n){if(e.hasOwnProperty("textDecoration")&&(e.underline="underline"===e.textDecoration),void 0!==e.letterSpacing&&(e.charSpacing=100*e.letterSpacing),e.fontSize&&e.fontSize<t.minFontSize?e.fontSize=t.minFontSize:e.fontSize&&e.fontSize>t.maxFontSize&&(e.fontSize=t.maxFontSize),e.text){let e=t.text;"uppercase"===t.textTransform?e=e.toUpperCase():"lowercase"===t.textTransform&&(e=e.toLowerCase()),t.set("text",e)}if(e.textTransform){let n=t.text;"uppercase"===e.textTransform?n=n.toUpperCase():"lowercase"===e.textTransform&&(n=n.toLowerCase()),t.set("text",n)}if((e.shadowColor||e.shadowBlur||e.shadowOffsetX||e.shadowOffsetY)&&!t.shadow){let n={color:e.shadowColor?e.shadowColor:"rgba(0,0,0,0)"};t.setShadow(n)}t.shadow&&e.hasOwnProperty("shadowColor")&&(e.shadowColor?t.shadow.color=e.shadowColor:t.setShadow(null)),t.shadow&&(e.shadowBlur&&(t.shadow.blur=e.shadowBlur),e.shadowOffsetX&&(t.shadow.offsetX=e.shadowOffsetX),e.shadowOffsetY&&(t.shadow.offsetY=e.shadowOffsetY))}if(delete e.paths,t.setOptions(e),"i-text"==t.type&&t.widthFontSize&&t.text.length>0){let e;e=t.width>t.widthFontSize?t.fontSize*(t.widthFontSize/(t.width+1)):t.fontSize*(t.widthFontSize/(t.width-1)),e<t.minFontSize?e=t.minFontSize:e>t.maxFontSize&&(e=t.maxFontSize),e=parseInt(e),t.set("fontSize",e)}if(e.autoCenter&&t.centerElement(),void 0!==e.fill||void 0!==e.svgFill){const n=void 0!==e.svgFill?e.svgFill:e.fill;t.changeColor(n),t.pattern=void 0}void 0!==e.pattern&&t.setPattern(e.pattern),e.filter,t.canvas&&e.z>=0&&(t.moveTo(e.z),this._bringToppedElementsToFront()),t.curved&&(e.curveRadius&&t.setCurvedTextPath(),e.text&&(t.set("text",t.text.replace(/(?:\r\n|\r|\n)/g,"")),t.setCurvedTextPosition())),t.uploadZone?t.evented=0!==t.opacity:t.isEditable&&!this.viewOptions.editorMode&&(t.evented=!e.locked);for(var i=this.getObjects(),a=0;a<i.length;++a){var o=i[a];o.uploadZone&&o.title==e.replace&&(o.opacity=0,o.evented=!1)}t.setCoords(),this.renderAll().calcOffset(),this.fire("elementModify",{element:t,options:e}),t._checkContainment(),e.autoSelect&&t.isEditable&&!this.editorMode&&this.wrapperEl.offsetParent&&setTimeout((()=>{this.setActiveObject(t)}),200)},fabric.Canvas.prototype.duplicateElement=function(e){var t=e.getElementJSON();t.top=t.top+30,t.left=t.left+30,this.viewOptions.editorMode||(t.autoSelect=!0),this.addElement(e.getType(),e.source,"Copy "+e.title,t)},fabric.Canvas.prototype.getUploadZone=function(e){const t=this.getObjects();for(var n=0;n<t.length;++n)if(t[n].uploadZone&&t[n].title==e)return t[n]};class C extends EventTarget{static relevantOptions=["stageWidth","stageHeight","selectedColor","boundingBoxColor","outOfBoundaryColor","cornerIconColor","customAdds","elementParameters","imageParameters","textParameters","customImageParameters","customTextParameters","maxPrice","optionalView","designCategories","printingBox","output","layouts","usePrintingBoxAsBounding","threeJsPreviewModel","editorMode","imageLoadTimestamp","fitImagesInCanvas","inCanvasTextEditing","applyFillWhenReplacing","disableTextEmojis","cornerControlsStyle","responsive","canvasHeight","maxCanvasHeight","boundingBoxProps","highlightEditableObjects","multiSelection","multiSelectionColor","mobileGesturesBehaviour","smartGuides","snapGridSize"];totalPrice=0;truePrice=0;additionalPrice=0;viewData;onCreatedCallback;title;thumbnail;options;canvasElem=null;fabricCanvas=null;constructor(t,n={},i,a={}){super(),this.viewData=n,this.onCreatedCallback=i,this.title=n.title,this.thumbnail=n.thumbnail,this.options=n.options,fabric.Canvas.prototype.snapGridSize=this.options.snapGridSize,fabric.Canvas.prototype.snapToObjects=this.options.smartGuides;const o=this.options.selectedColor;fabric.Object.prototype.borderColor=o,fabric.Object.prototype.cornerColor=o,fabric.Object.prototype.cornerIconColor=this.options.cornerIconColor,a=s({containerClass:"fpd-view-stage fpd-hidden",selection:this.options.multiSelection,selectionBorderColor:this.options.multiSelectionColor,selectionColor:tinycolor(this.options.multiSelectionColor).setAlpha(.1).toRgbString(),hoverCursor:"pointer",controlsAboveOverlay:!0,centeredScaling:!0,allowTouchScrolling:!0,preserveObjectStacking:!0},a),this.fabricOptions=a,this.canvasElem=document.createElement("canvas"),t.append(this.canvasElem),this.fabricCanvas=new fabric.Canvas(this.canvasElem,a),this.fabricCanvas.viewOptions=this.options,this.fabricCanvas.setDimensions({width:this.options.stageWidth,height:this.options.stageHeight}),this.fabricCanvas.on({imageFail:({url:t})=>{e(`\n                    <p>The image with the URL<br /><i style='font-size: 10px;'>${t}</i><br />can not be loaded into the canvas.</p>\n                    <p><b>Troubleshooting</b>\n                        <ul>\n                            <li>The URL is not correct!</li>\n                            <li>The image has been blocked by <a href='https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS' target='_blank'>CORS policy</a>. You need to host the image under the same protocol and domain or enable 'Access-Control-Allow-Origin' on the server where you host the image. <a href='http://enable-cors.org/' target='_blank'>Read more about it here.</a><\n                            /li>\n                        </ul>\n                    </p>\n                `)}})}init(){this.loadElements(this.viewData.elements,this.#e.bind(this))}loadElements(e,t){this.fabricCanvas.initialElementsLoaded&&this.fabricCanvas.reset(!1),this.fabricCanvas.offHistory(),this.fabricCanvas.addElements(e,t)}#e(){this.onCreatedCallback(this),this.dispatchEvent(new CustomEvent("priceChange",{detail:{elementPrice:0,truePrice:this.truePrice}}))}toDataURL(e,t="transparent",n={},i=null,s=!0){e=void 0===e?function(){}:e,n.onlyExportable=void 0!==n.onlyExportable&&n.onlyExportable,n.multiplier=void 0===n.multiplier?1:n.multiplier,n.enableRetinaScaling=void 0!==n.enableRetinaScaling&&n.enableRetinaScaling;let a=["_ruler_hor","_ruler_ver"],o=[],r=this.options.highlightEditableObjects;this.options.highlightEditableObjects="transparent",this.fabricCanvas.getObjects().forEach((e=>{(-1!==a.indexOf(e.id)||e.excludeFromExport&&n.onlyExportable)&&(e.visible=!1,o.push(e))})),s&&this.fabricCanvas.deselectElement();let l=fabric.devicePixelRatio;fabric.devicePixelRatio=1,this.fabricCanvas.setDimensions({width:this.options.stageWidth,height:this.options.stageHeight}).setZoom(1),this.fabricCanvas.setBackgroundColor(t,(()=>{i&&(this.fabricCanvas.add(i),i.center(),i.bringToFront()),e(this.fabricCanvas.toDataURL(n)),i&&this.fabricCanvas.remove(i),this.fabricCanvas.wrapperEl.offsetParent&&this.fabricCanvas.resetSize(),this.fabricCanvas.setBackgroundColor("transparent",(()=>{this.fabricCanvas.renderAll()}));for(var t=0;t<o.length;++t)o[t].visible=!0;this.fabricCanvas.renderAll(),fabric.devicePixelRatio=l,this.options.highlightEditableObjects=r}))}}window.FancyProductDesigner=C;const w=e=>{let t=e.url;e.params&&(t+="?"+new URLSearchParams(e.params).toString());const n=new XMLHttpRequest;return n.responseType="json",n.open("GET",t),n.onreadystatechange=t=>{4==n.readyState&&200==n.status?e.onSuccess&&e.onSuccess(n.response):200!==n.status&&e.onError&&e.onError(n)},n.send(),n};class I extends EventTarget{langJSON=null;constructor(){super()}loadLangJSON(e=null,t=(()=>{})){!1!==e?"object"==typeof e?(this.langJSON=e,t.call(this)):w({url:e,onSuccess:e=>{this.langJSON=e,t.call(this)},onError:n=>{alert('Language JSON "'+e+'" could not be loaded or is not valid. Make sure you set the correct URL in the options and the JSON is valid!'),t.call(this)}}):t.call(this)}translateElement(e){let t="";if(this.langJSON){let n="";n=e.getAttribute("placeholder")?e.getAttribute("placeholder"):e.getAttribute("title")?e.getAttribute("title"):e.dataset.title?e.dataset.title:e.innerText;let i=n.toLowerCase().split("."),s=this.langJSON[i[0]];s?(t=s[i[1]],void 0===t&&(console.log("FPD label not found: "+e.dataset.defaulttext),t=e.dataset.defaulttext)):t=e.dataset.defaulttext}else t=e.dataset.defaulttext;return e.getAttribute("placeholder")?(e.setAttribute("placeholder",t),e.innerText=""):e.getAttribute("title")?e.setAttribute("title",t):e.dataset.title?e.dataset.title=t:e.innerText=t,t}getTranslation(e,t,n=""){return this.langJSON&&(e=this.langJSON[e])&&e[t]?e[t]:n}}class S extends HTMLElement{placeholder="";value="";searchable=!1;inputElem=null;listElem=null;constructor(){super()}connectedCallback(){this.innerHTML='<input type="text" class="fpd-dropdown-current"/> <div class="fpd-dropdown-arrow"><span class="fpd-icon-arrow-dropdown"></span></div> <div class="fpd-dropdown-list"> <div class="fpd-scroll-area"></div> </div> ',this.inputElem=this.querySelector("input.fpd-dropdown-current"),this.listElem=this.querySelector(".fpd-dropdown-list"),this.addEventListener("click",(()=>{this.#t(),this.classList.toggle("fpd-active")})),this.querySelector(".fpd-dropdown-arrow").addEventListener("click",(e=>{e.stopPropagation(),this.#t(),this.classList.toggle("fpd-active")})),this.inputElem.addEventListener("keyup",(e=>{if(this.searchable){const t=e.currentTarget.value;this.listElem.querySelectorAll(".fpd-item").forEach((e=>{0==t.length?e.classList.remove("fpd-hidden"):e.classList.toggle("fpd-hidden",!e.innerText.toLowerCase().includes(t.toLowerCase()))}))}})),window.addEventListener("scroll",(()=>{this.#t()})),this.inputElem.setAttribute("placeholder",this.getAttribute("placeholder")||""),this.#t()}static get observedAttributes(){return["searchable","placeholder","value"]}attributeChangedCallback(e,t,n){t!==n&&(this.inputElem&&("placeholder"===e?this.inputElem.setAttribute("placeholder",n):"value"===e&&(this.inputElem.value=n)),"searchable"===e&&(this.searchable=this.hasAttribute("searchable")))}#t(){const e=this.getBoundingClientRect();this.listElem.style.width=e.width+"px",this.listElem.style.left=e.left+"px",this.listElem.style.top=e.top+e.height+"px"}}customElements.define("fpd-dropdown",S);class D extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-navigation fpd-scrollbar-hidden"></div> <div class="fpd-module-content"></div> <div class="fpd-secondary-content"> <div class="fpd-upload-zone-panel"> <div class="fpd-upload-zone-content"></div> <div class="fpd-bottom-nav fpd-module-tabs"> <div class="fpd-add-image" data-module="images"> <span class="fpd-icon-photo"></span> </div> <div class="fpd-add-text" data-module="text"> <span class="fpd-icon-text-secondary"></span> </div> <div class="fpd-add-design" data-module="designs"> <span class="fpd-icon-design-library"></span> </div> </div> </div> </div> <div class="fpd-close"> <span class="fpd-icon-close"></span> </div> <div class="fpd-draggable-dialog fpd-container fpd-shadow-2"> <div class="fpd-dialog-head"> <div class="fpd-dialog-drag-handle"> <div> <span class="fpd-icon-drag"></span><span class="fpd-dialog-title"></span> </div> </div> <div class="fpd-close-dialog"> <span class="fpd-icon-close"></span> </div> </div> </div> '}}customElements.define("fpd-main-bar",D);class O extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-grid" data-defaulttext="Swap Product" data-title="modules.products"> <fpd-dropdown class="fpd-product-categories" searchable></fpd-dropdown> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-contain fpd-padding"> </div> </div> </div>'}}customElements.define("fpd-module-products",O);class T extends EventTarget{currentCategoryIndex=0;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-products"),t.append(this.container),e.addEventListener("productsSet",(e=>{const t=this.container.querySelector(".fpd-dropdown-list > .fpd-scroll-area");t.innerHTML="",this.fpdInstance.products&&this.fpdInstance.products.length>0&&(void 0!==this.fpdInstance.products[0].category&&this.fpdInstance.products.length>1&&(this.container.classList.add("fpd-categories-enabled"),this.fpdInstance.products.forEach(((e,n)=>{const i=document.createElement("span");i.className="fpd-item",i.dataset.index=n,i.innerText=e.category,i.addEventListener("click",(e=>{this.selectCategory(e.currentTarget.dataset.index)})),t.append(i)}))),this.#n(),this.selectCategory(0))})),e.addEventListener("productAdd",((e,t,n,i)=>{i==this.currentCategoryIndex&&this.#i(t)}))}#n(){if(this.fpdInstance.mainOptions.editorMode)return;let e=this.fpdInstance.products[0],t=void 0===e;void 0!==e&&(t=!!(!e.hasOwnProperty("category")&&this.fpdInstance.products.length<2||e.hasOwnProperty("category")&&e.products.length<2&&this.fpdInstance.products.length<2)),this.fpdInstance.container.classList.toggle("fpd-products-module-hidden",t)}#i(t,n){let i=t[0].productThumbnail?t[0].productThumbnail:t[0].thumbnail,s=t[0].productTitle?t[0].productTitle:t[0].title;const a=document.createElement("div");a.className="fpd-item fpd-hover-thumbnail",a.dataset.title=s,a.dataset.source=i,a.dataset.index=n,a.addEventListener("click",(t=>{if(t.preventDefault(),this.fpdInstance.mainOptions.swapProductConfirmation){var i=e(this.fpdInstance.translator.getTranslation("modules","products_confirm_replacement"),!1,"confirm",this.fpdInstance.container);const t=i.querySelector(".fpd-confirm");t.innerText=this.fpdInstance.translator.getTranslation("modules","products_confirm_button"),l(t,["click"],(()=>{this.fpdInstance.selectProduct(n,this.currentCategoryIndex),i.remove()}))}else this.fpdInstance.selectProduct(Number(t.currentTarget.dataset.index),this.currentCategoryIndex)})),this.container.querySelector(".fpd-grid").append(a);const o=document.createElement("picture");o.dataset.img=i,a.append(o),this.fpdInstance.lazyBackgroundObserver.observe(o)}selectCategory(e=0){if(this.currentCategoryIndex=e,this.container.querySelector(".fpd-grid").innerHTML="",this.fpdInstance.products&&this.fpdInstance.products.length>0){let t;void 0!==this.fpdInstance.products[0].category?(t=this.fpdInstance.products[e].products,this.container.querySelector(".fpd-dropdown-current").value=this.fpdInstance.products[e].category):t=this.fpdInstance.products.products,t.forEach(((e,t)=>{this.#i(e,t)}))}}}class L extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-text-secondary" data-defaulttext="Add Text" data-title="modules.text"> <div class="fpd-add-text"> <textarea data-defaulttext="Enter some text" placeholder="modules.text_input_placeholder"></textarea> <div class="fpd-btn"> <span data-defaulttext="Add Text">modules.text_add_btn</span> <span class="fpd-price"></span> </div> </div> <div class="fpd-text-templates fpd-scroll-area"> <div class="fpd-grid fpd-padding"></div> </div> </div>'}}customElements.define("fpd-module-text",L);class P extends EventTarget{constructor(e,t){if(super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-text"),t.append(this.container),this.container.querySelector(".fpd-btn").addEventListener("click",(t=>{let n=this.container.querySelector("textarea"),i=n.value;if(e.currentViewInstance&&i.length>0){const t=e.currentViewInstance.options;let n=s(t.customTextParameters,{textBox:!0,resizable:!0,isCustom:!0,_addToUZ:e.currentViewInstance.currentUploadZone,_calcWidth:!0});e.currentViewInstance.fabricCanvas.addElement("text",i,i,n)}n.value=""})),l(this.container.querySelector("textarea"),["input","change"],(t=>{const n=e.currentViewInstance.options;let i=t.currentTarget.value,s=n.customTextParameters.maxLength,a=n.customTextParameters.maxLines;i=i.replace(FancyProductDesigner.forbiddenTextChars,""),e.mainOptions.disableTextEmojis&&(i=i.replace(FPDEmojisRegex,""),i=i.replace(String.fromCharCode(65039),"")),0!=s&&i.length>s&&(i=i.substr(0,s)),0!=a&&i.split("\n").length>a&&(i=i.replace(/([\s\S]*)\n/,"$1")),t.currentTarget.value=i})),l(e,["viewSelect","secondaryModuleCalled"],(t=>{if(!e.currentViewInstance)return;const n=e.currentViewInstance.options;let i=null;if(e.currentViewInstance.currentUploadZone&&this.container.parentNode.classList.contains("fpd-upload-zone-content")){const t=e.currentViewInstance.fabricCanvas.getUploadZone(e.currentViewInstance.currentUploadZone);a(t,"price")&&(i=t.price)}const s=a(n,"customTextParameters.price",0);null==i&&s&&(i=s);const o=this.container.querySelector(".fpd-btn > .fpd-price");o&&(o.innerHTML=i?" - "+e.formatPrice(i):"")})),Array.isArray(e.mainOptions.textTemplates)){var n=this.container.querySelector(".fpd-text-templates .fpd-grid");e.mainOptions.textTemplates.forEach((t=>{var i=t.properties,a="font-family:"+(i.fontFamily?i.fontFamily:"Arial");a+="; text-align:"+(i.textAlign?i.textAlign:"left");const o=document.createElement("div");o.className="fpd-item",o.addEventListener("click",(n=>{if(e.currentViewInstance){const n=e.currentViewInstance.options;let i={...t.properties};i.isCustom=!0,i.textBox=!0,i.resizable=!0,i._addToUZ=e.currentViewInstance.currentUploadZone,i._calcWidth=!0;let a=s(n.customTextParameters,i);e.currentViewInstance.fabricCanvas.addElement("text",t.text,t.text,a)}}));const r=document.createElement("div");r.setAttribute("style",a),r.innerHTML=t.text.replace(/(?:\r\n|\r|\n)/g,"<br>"),o.append(r),n.append(o)}))}}}class k extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-design-library" data-defaulttext="Add Designs" data-title="modules.designs"> <div class="fpd-head"> <div class="fpd-input-back-search"> <div class="fpd-back fpd-btn"> <span class="fpd-icon-back"></span> </div> <div class="fpd-input-search"> <input type="text"/> <span class="fpd-icon-magnify"></span> </div> </div> </div> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-contain fpd-padding"></div> </div> </div>'}}customElements.define("fpd-module-designs",k);class F extends EventTarget{#s="";#a=!1;#o=[];#r=null;#l=null;constructor(e,t,n=null){super(),this.#s=e.translator.getTranslation("modules","designs_search_in").toUpperCase(),this.fpdInstance=e,this.#l=n,this.container=document.createElement("fpd-module-designs"),t.append(this.container),n&&(this.container.dataset.dynamicDesignsId=n),this.headElem=this.container.querySelector(".fpd-head"),this.gridElem=this.container.querySelector(".fpd-grid"),this.headElem.querySelector(".fpd-input-search input").addEventListener("keyup",(e=>{const t=e.currentTarget,n=this.gridElem.querySelectorAll(".fpd-item");if(""==t.value)for(let e of n)e.classList.remove("fpd-hidden");else{const e=t.value.toLowerCase().trim();for(let t of n)t.classList.add("fpd-hidden"),t.dataset.search.includes(e)&&t.classList.remove("fpd-hidden")}})),l(this.headElem.querySelector(".fpd-back"),"click",(e=>{this.gridElem.querySelectorAll(".fpd-category").length>0&&this.#o.pop();let t,n=this.fpdInstance.designs;this.#o.forEach((e=>{t=n[e],n=t.category})),this.#r=n,n&&this.#c(this.#r,t),void 0===t&&this.toggleCategories()})),l(e,"designsSet",(t=>{const n=e.designs;Array.isArray(n)&&0!==n.length&&(n[0].hasOwnProperty("source")?(this.container.classList.add("fpd-single-cat"),this.#d(n)):n.length>1||n[0].category?(this.#a=!0,this.toggleCategories()):1===n.length&&n[0].designs&&(this.container.classList.add("fpd-single-cat"),this.#d(n[0].designs)))})),l(e,"viewSelect",(()=>{this.toggleCategories()}))}#c(e,t){this.gridElem.innerHTML="",this.headElem.querySelector(".fpd-input-search input").value="",this.container.classList.remove("fpd-designs-active"),this.container.classList.add("fpd-categories-active"),e.forEach(((e,t)=>{this.#p(e)})),t&&(this.headElem.querySelector(".fpd-input-search input").setAttribute("placeholder",this.#s+" "+t.title.toUpperCase()),this.container.classList.add("fpd-head-visible"))}#p(e){const t=document.createElement("div");if(t.className="fpd-category fpd-item",t.dataset.title=e.title,t.dataset.search=e.title.toLowerCase(),e.thumbnail){const n=document.createElement("picture");n.dataset.img=e.thumbnail,t.append(n),this.fpdInstance.lazyBackgroundObserver.observe(n);const i=document.createElement("span");i.innerText=e.title,t.append(i)}else t.innerHTML="<span>"+e.title+"</span>";t.addEventListener("click",(e=>{let t=e.currentTarget,n=Array.from(this.gridElem.querySelectorAll(".fpd-item")).indexOf(t),i=this.#r[n];i.category?(this.#o.push(n),this.#r=i.category,this.#c(this.#r,i)):this.#d(i.designs,i.parameters),this.headElem.querySelector(".fpd-input-search input").setAttribute("placeholder",this.#s+" "+t.dataset.search.toUpperCase())})),this.gridElem.append(t)}#d(e,t={}){this.gridElem.innerHTML="",this.headElem.querySelector(".fpd-input-search input").value="",this.container.classList.remove("fpd-categories-active"),this.container.classList.add("fpd-designs-active","fpd-head-visible"),e.forEach((e=>{e.parameters=s(t,e.parameters),this.#u(e)}))}#u(e){e.thumbnail=void 0===e.thumbnail?e.source:e.thumbnail;const t=g({url:e.source,thumbnailUrl:e.thumbnail,title:e.title,price:m(this.fpdInstance,this.container,e.parameters.price)});t.dataset.search=e.title.toLowerCase(),t.parameters=e.parameters,t.addEventListener("click",(e=>{const t=e.currentTarget;this.fpdInstance.addCanvasDesign(t.dataset.source,t.dataset.title,t.parameters)})),this.gridElem.append(t),this.fpdInstance.lazyBackgroundObserver.observe(t.querySelector("picture"))}toggleCategories(){if(!this.#a)return;this.#o=[],this.container.classList.remove("fpd-head-visible","fpd-single-cat"),this.#r=this.fpdInstance.designs,this.#c(this.#r);let e=[];if(this.#l&&(e=this.fpdInstance.mainOptions.dynamicDesigns[this.#l].categories),this.fpdInstance.currentViewInstance){const t=this.fpdInstance.currentElement;e=t&&t.uploadZone&&t.designCategories?this.fpdInstance.currentElement.designCategories:this.fpdInstance.currentViewInstance.options.designCategories}var t=this.container.querySelectorAll(".fpd-category");if(e.length>0){let n=[];for(let i of t)e.includes(i.dataset.title)?(i.classList.remove("fpd-hidden"),n.push(i)):i.classList.add("fpd-hidden");1===n.length&&(this.container.classList.add("fpd-single-cat"),n[0].click())}else for(let e of t)e.classList.remove("fpd-hidden")}}class _ extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-design-library" data-defaulttext="Text to Image" data-title="modules.text_to_image"> <div class="fpd-head"> <textarea></textarea> <div class="fpd-btn"> <span data-defaulttext="Generate">modules.text_to_image_generate</span> </div> </div> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover"></div> </div> </div>'}}customElements.define("fpd-module-text-to-image",_);class A extends EventTarget{#h="https://radykal.dep/fpd-js/server/php/sd-api.php";#f=!1;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-text-to-image"),t.append(this.container),this.inputElem=this.container.querySelector(".fpd-head textarea"),this.gridElem=this.container.querySelector(".fpd-grid"),this.container.querySelector(".fpd-head .fpd-btn").addEventListener("click",(e=>{const t=e.currentTarget;if(!h(this.inputElem.value)&&!this.#f){this.#f=!0,t.classList.add("fpd-loading");let e={action:"text2img",prompt:this.inputElem.value,numOfImg:2};fetch(this.#h,{method:"POST",redirect:"follow",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{(e=JSON.parse(e))&&e.output&&this.#g(e.output),this.#f=!1,t.classList.remove("fpd-loading")})).catch((e=>{this.#f=!1,t.classList.remove("fpd-loading")}))}}))}#g(e=[]){e.forEach((e=>{const t=document.createElement("div");t.className="fpd-item",t.dataset.source=e,t.innerHTML='<picture data-img="'+e+'"></picture><span class="fpd-price"></span>',this.gridElem.append(t),t.addEventListener("click",(e=>{const t=e.currentTarget;this.fpdInstance._addCanvasDesign(t.dataset.source,t.dataset.title,t.dataset.parameters)})),this.fpdInstance.lazyBackgroundObserver.observe(t.querySelector("picture"))}))}}class B extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-photo" data-defaulttext="Add Image" data-title="modules.images"> <div class="fpd-module-tabs"> <div data-context="upload" class="fpd-active"> <span class="fpd-icon-cloud-upload"></span> </div> <div data-context="facebook" class="fpd-hidden" title="Facebook"> <span class="fpd-icon-facebook"></span> </div> <div data-context="instagram" class="fpd-hidden" title="Instagram"> <span class="fpd-icon-instagram"></span> </div> <div data-context="pixabay" class="fpd-hidden" title="Pixabay"> <span class="fpd-icon-pixabay"></span> </div> <div data-context="qr-code" title="QR-Code"> <span class="fpd-icon-qrcode"></span> </div> </div> <div class="fpd-module-tabs-content"> <div data-context="upload" class="fpd-active"></div> <div data-context="facebook"></div> <div data-context="instagram"></div> <div data-context="pixabay"></div> <div data-context="qr-code"></div> </div> </div>'}}customElements.define("fpd-module-images",B);class M extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-upload-image"> <span data-defaulttext="Drop images here">modules.upload_zone</span> <span class="fpd-btn" data-defaulttext="Browse File">modules.browse_file</span> <span class="fpd-price"></span> </div> <input type="file" multiple="multiple" class="fpd-upload-input fpd-hidden" name="files[]" accept="image/jpeg,image/jpg,image/png,image/svg+xml,application/pdf"/> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover fpd-photo-grid"></div> </div>'}}customElements.define("fpd-module-uploads",M);const j=(e="",t=!0)=>{let n=document.body.querySelector(".fpd-snackbar-wrapper");n||(n=document.createElement("div"),n.className="fpd-snackbar-wrapper",document.body.append(n));const i=document.createElement("div");return i.className="fpd-snackbar fpd-shadow-1",i.innerHTML="<p>"+e+"</p>",i.addEventListener("click",(e=>{i.remove()})),n.append(i),t&&setTimeout((function(){i.remove()}),5e3),i};class q extends EventTarget{#m;#v=0;#b=!1;#y=[];#E=0;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-uploads"),t.append(this.container),this.gridElem=this.container.querySelector(".fpd-grid");const n=this.container.querySelector(".fpd-upload-image");this.#m=e.mainOptions.allowedImageTypes,this.#m.includes("jpeg")&&!this.#m.includes("jpg")&&this.#m.push("jpg");const i=this.container.querySelector(".fpd-upload-input");let s=[];if(this.#m.forEach((e=>{"pdf"==e?s.push("application/pdf"):("svg"==e&&(e+="+xml"),s.push("image/"+e))})),i.setAttribute("accept",s.join()),l(n,"click",(async e=>{e.preventDefault(),i.click()})),l(i,"change",(e=>{this.#x(e.currentTarget.files)})),l(n,["dragover","dragleave"],(e=>{e.stopPropagation(),e.preventDefault(),e.currentTarget.classList.toggle("fpd-hover","dragover"===e.type)})),l(n,"drop",(e=>{e.stopPropagation(),e.preventDefault();const t=e.target.files||e.dataTransfer.files;this.#x(t)})),l(e,"productCreate",(e=>{this.#b=!1})),f&&window.localStorage.getItem("fpd_uploaded_images")){const e=JSON.parse(window.localStorage.getItem("fpd_uploaded_images"));e.forEach((t=>{this.#C(t.url,t.title);var n=new Image;n.src=t.url,n.onerror=function(){var t=null;e.forEach((function(e,i){e.url==n.src&&(t=i)})),null!=t&&(e.splice(t,1),window.localStorage.setItem("fpd_uploaded_images",JSON.stringify(e)))}}))}}#x(t){if(this.fpdInstance.mainOptions.uploadAgreementModal){var n=e(this.fpdInstance.translator.getTranslation("modules","images_agreement"),!1,"confirm",this.fpdInstance.container);const i=n.querySelector(".fpd-confirm");i.innerText=this.fpdInstance.translator.getTranslation("modules","images_confirm_button"),l(i,["click"],(()=>{this.#w(t),n.remove()}))}else this.#w(t)}#w(e){this.#v=0,this.#E=e.length;for(var t=0;t<this.fpdInstance.viewInstances.length;++t)this.fpdInstance.getElements(t).forEach((e=>{e.uploadZone&&this.#y.push({uz:e.title,viewIndex:t})}));this.fpdInstance.loadingCustomImage=!0,Array.from(e).forEach(((e,t)=>{this.#m.includes(e.name.split(".").pop().toLowerCase().split("?")[0])&&this.#I(e,0==t)})),this.container.querySelector(".fpd-upload-image").classList.remove("fpd-hover")}#I(e,t){const n=1024*this.fpdInstance.mainOptions.customImageParameters.maxSize*1024;if(e.size>n)return j(this.fpdInstance.translator.getTranslation("misc","maximum_size_info").replace("%filename",e.name).replace("%mb",this.fpdInstance.mainOptions.customImageParameters.maxSize)),void(this.fpdInstance.loadingCustomImage=!1);"application/pdf"===e.type?this.#S(e,t):this.#D(e,t)}#D(t,n=!1){const i=this.fpdInstance.mainOptions,s=new FileReader;s.onload=s=>{const a=s.currentTarget.result;if("image/jpeg"===t.type&&i.customImageParameters.minDPI){const n=new JpegMeta.JpegFile(atob(a.replace(/^.*?,/,"")),t.name);let s=null;if(n.tiff&&n.tiff.XResolution&&n.tiff.XResolution.value){var o=n.tiff.XResolution.value.den;s=n.tiff.XResolution.value.num/o}else n.jfif&&n.jfif.Xdensity&&n.jfif.Xdensity.value&&(s=n.jfif.Xdensity.value);if(null!==s){if(console.log(t.name+" Real Resolution: "+s),s<i.customImageParameters.minDPI){let t=this.fpdInstance.translator.getTranslation("misc","minimum_dpi_info");return t=t.replace("%dpi",i.customImageParameters.minDPI),e(t,!1,"",this.fpdInstance.container),this.fpdInstance.loadingCustomImage=!1,!1}}else console.log(t.name+": Resolution is not accessible.")}const r=this.#C(a,t.name);if(FancyProductDesigner.uploadsToServer){if(!i.fileServerURL)return r.remove(),void alert("You need to set the fileServerURL in the option, otherwise file uploading does not work!");r.classList.add("fpd-loading"),r.insertAdjacentHTML("beforeend",'<div class="fpd-loading-bar"><div class="fpd-loading-progress"></div></div>')}var l=new Image;l.onload=e=>{const i=e.currentTarget;let s=i.height,a=i.width;if(this.fpdInstance.currentViewInstance.options.customImageParameters,v(this.fpdInstance,a,s))if(FancyProductDesigner.uploadsToServer){var o=new FormData;o.append("images[]",t);const e=new XMLHttpRequest;e.responseType="json",e.onreadystatechange=t=>{if(e.readyState===XMLHttpRequest.DONE){const t=e.status;if(0===t||t>=200&&t<400){const t=e.response;t.image_src&&(this.#O(t.image_src,t.filename),r.dataset.source=t.image_src,r.classList.remove("fpd-loading"),r.querySelector(".fpd-loading-bar").remove(),this.#T(r,n),this.#v++,r.xhr=null),this.fpdInstance.loadingCustomImage=!1}}},e.upload.onprogress=e=>{let t=e.total,n=e.loaded,i=parseInt(100*n/t);r.querySelector(".fpd-loading-progress").style.width=i+"%"},e.upload.onerror=e=>{this.fpdInstance.loadingCustomImage=!1,r.remove(),j("Upload failed. Please try again or check your web console!")},e.open("POST",this.fpdInstance.mainOptions.fileServerURL),e.send(o),r.xhr=e}else this.#O(i,t.name),this.#T(r,n),this.#v++;else r.remove(),this.fpdInstance.currentViewInstance.currentUploadZone=null},l.src=a},s.readAsDataURL(t)}#S(e,t=!1){this.fpdInstance.mainOptions;const n=j(this.fpdInstance.translator.getTranslation("modules","images_pdf_upload_info"),!1),i=new FormData;i.append("pdf",e);const s=new XMLHttpRequest;s.responseType="json",s.onreadystatechange=e=>{if(s.readyState===XMLHttpRequest.DONE){const e=s.status;if(0===e||e>=200&&e<400){const e=s.response;this.#E--,e.pdf_images.forEach(((e,t)=>{const n=this.#C(e.image_url,e.filename);this.#T(n,0==t),this.#O(e.image_url,e.filename),this.#v++})),n.remove(),this.#E++,this.fpdInstance.loadingCustomImage=!1}}},s.upload.onerror=()=>{this.fpdInstance.loadingCustomImage=!1,n.remove(),j("Upload failed. Please try again or check your web console!")},s.open("POST",this.fpdInstance.mainOptions.fileServerURL),s.send(i)}#O(e,t){if(f){var n=window.localStorage.getItem("fpd_uploaded_images")?JSON.parse(window.localStorage.getItem("fpd_uploaded_images")):[],i={url:e,title:t};n.push(i),window.localStorage.setItem("fpd_uploaded_images",JSON.stringify(n))}}#C(e,t){const n=g({url:e,title:t,price:m(this.fpdInstance,this.container),removable:!0});return this.#L(n,e),this.gridElem.append(n),this.fpdInstance.lazyBackgroundObserver.observe(n.querySelector("picture")),l(n,["click"],(e=>{this.fpdInstance.loadingCustomImage||this.fpdInstance._addGridItemToCanvas(e.currentTarget,{},void 0,!1)})),l(n.querySelector(".fpd-delete"),"click",(e=>{e.stopPropagation(),e.preventDefault();const t=Array.from(this.gridElem.children).indexOf(n);if(!n.classList.contains("fpd-loading")){var i=JSON.parse(window.localStorage.getItem("fpd_uploaded_images"));i.splice(t,1),window.localStorage.setItem("fpd_uploaded_images",JSON.stringify(i)),n.xhr&&n.xhr.abort(),n.remove()}})),n}#T(e,t){if(!this.#b&&this.fpdInstance.mainOptions.autoFillUploadZones){const t=this.#y[this.#v]?this.#y[this.#v]:null;t&&this.fpdInstance._addGridItemToCanvas(e,{_addToUZ:t.uz},t.viewIndex,!1)}else t&&this.fpdInstance._addGridItemToCanvas(e,{},void 0,!1);this.#v==this.#E-1&&(this.#b=!0)}#L(e,t){const n=this.fpdInstance.mainOptions.imageQualityRatings;if(n&&"object"==typeof n){let i=n.low?n.low:null,s=n.mid?n.mid:null,a=n.high?n.high:null,o="fpd-icon-star",r="fpd-icon-star-outline";const l=new Image;l.onload=()=>{const t=document.createElement("div");let n;if(t.className="fpd-image-quality-ratings",e.append(t),i&&2==i.length){const e=l.width<Number(i[0])||l.height<Number(i[1])?r:o,s=document.createElement("span");s.className=e,t.append(s),e==o&&(n=this.fpdInstance.translator.getTranslation("misc","image_quality_rating_low"))}if(s&&2==s.length){const e=l.width<Number(s[0])||l.height<Number(s[1])?r:o,i=document.createElement("span");i.className=e,t.append(i),e==o&&(n=this.fpdInstance.translator.getTranslation("misc","image_quality_rating_mid"))}if(a&&2==a.length){const e=l.width<Number(a[0])||l.height<Number(a[1])?r:o,i=document.createElement("span");i.className=e,t.append(i),e==o&&(n=this.fpdInstance.translator.getTranslation("misc","image_quality_rating_high"))}n&&(t.dataset.qualityLabel=n)},l.src=t}}}class z extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-head"> <div class="fpd-facebook-login"> <fb:login-button data-max-rows="1" data-show-faces="false" data-scope="user_photos"> </fb:login-button> </div> <fpd-dropdown class="fpd-facebook-albums" placeholder="Select An Album" searchable></fpd-dropdown> </div> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover fpd-photo-grid"></div> </div>'}}customElements.define("fpd-module-facebook-images",z);class N extends EventTarget{constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-facebook-images"),t.append(this.container),this.dropdown=this.container.querySelector("fpd-dropdown"),this.dropdownList=this.container.querySelector(".fpd-dropdown-list > .fpd-scroll-area"),this.gridElem=this.container.querySelector(".fpd-grid"),this.#P()}#P(){const e=document.createElement("script");e.src="//connect.facebook.com/en_US/sdk.js",e.addEventListener("load",(()=>{FB.init({appId:this.fpdInstance.mainOptions.facebookAppId,autoLogAppEvents:!0,xfbml:!0,version:"v16.0"}),FB.getLoginStatus(this.#k.bind(this)),FB.Event.subscribe("auth.statusChange",this.#k.bind(this))})),document.body.appendChild(e)}#k(e){"connected"===e.status&&(c(this.container,["fpd-facebook-logged-in"]),FB.api("/me/albums?fields=name,count,id",(e=>{const t=e.data;t&&t.forEach((e=>{const t=document.createElement("span");t.className="fpd-item",t.dataset.albumid=e.id,t.innerText=e.name,t.addEventListener("click",(e=>{this.dropdown.setAttribute("value",e.currentTarget.innerText),this.#F(e.currentTarget.dataset.albumid)})),this.dropdownList.append(t)})),d(this.dropdown,["fpd-on-loading"])})))}#F(e){this.gridElem.innerHTML="",c(this.dropdown,["fpd-on-loading"]),FB.api("/"+e+"?fields=count",(t=>{const n=t.count;FB.api("/"+e+"?fields=photos.limit("+n+").fields(source,images)",(e=>{d(this.dropdown,["fpd-on-loading"]),e.error||e.photos.data.forEach((e=>{const t=e.images[0]?e.images[0].source:e.source,n=e.images[e.images.length-1]?e.images[e.images.length-1].source:e.source,i=g({url:t,thumbnailUrl:n,title:e.id,price:m(this.fpdInstance,this.container)});l(i,["click"],(e=>{this.fpdInstance.loadingCustomImage||this.fpdInstance._addGridItemToCanvas(e.currentTarget)})),this.gridElem.append(i),this.fpdInstance.lazyBackgroundObserver.observe(i.querySelector("picture"))})),this.fpdInstance.toggleSpinner(!1)}))}))}}class U extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover fpd-photo-grid"></div> </div>'}}customElements.define("fpd-module-instagram-images",U);class H extends EventTarget{accessToken=null;nextStack=null;loadingStack=!1;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-instagram-images"),t.append(this.container),this.gridElem=this.container.querySelector(".fpd-grid");const n=this.container.querySelector(".fpd-scroll-area");n.addEventListener("scroll",(e=>{let t=n.scrollHeight;n.clientHeight+n.scrollTop+100>t&&(null===this.nextStack||this.loadingStack||this.#_(this.nextStack,!1))}))}authenticate(){const e=this.fpdInstance.mainOptions;if(f()){const e=window.localStorage.getItem("fpd_insta_access_token");if(!h(e))return this.accessToken=e,void this.#_()}let t=(window.screen.width-700)/2,n=(window.screen.height-500)/2,i={app_id:e.instagramClientId,redirect_uri:e.instagramRedirectUri,scope:"user_profile,user_media",response_type:"code"},s=new URLSearchParams(i).toString();var a=window.open("https://api.instagram.com/oauth/authorize?"+s,"","width=700,height=500,left="+t+",top="+n),o=setInterval((()=>{a.closed&&clearInterval(o);try{if(a.location&&a.location.href){var e=new URL(a.location.href).searchParams.get("code");e&&(e=e.replace("#_",""),this.#A(e),a.close())}}catch(e){}}),500)}#A(e){const t=this.fpdInstance.mainOptions;this.fpdInstance.toggleSpinner(!0),w({url:t.instagramTokenUri,params:{code:e,client_app_id:t.instagramClientId,redirect_uri:t.instagramRedirectUri},onSuccess:e=>{e.access_token?(f()&&window.localStorage.setItem("fpd_insta_access_token",e.access_token),this.accessToken=e.access_token,this.#_()):e.error_message&&this.fpdInstance.toggleSpinner(!1)},onError:e=>{this.fpdInstance.toggleSpinner(!1)}})}#_(e="https://graph.instagram.com/me/media",t=!0){this.loadingStack=!0,this.fpdInstance.toggleSpinner(!0);let n={url:e,onSuccess:e=>{e.data&&(this.nextStack=e.paging&&e.paging.next?e.paging.next:null,e.data.forEach((e=>{if("VIDEO"!==e.media_type){const t=g({url:e.media_url,thumbnailUrl:e.thumbnail_url?e.thumbnail_url:e.media_url,title:e.id,price:m(this.fpdInstance,this.container)});l(t,["click"],(e=>{this.fpdInstance.loadingCustomImage||this.fpdInstance._addGridItemToCanvas(e.currentTarget)})),this.gridElem.append(t),this.fpdInstance.lazyBackgroundObserver.observe(t.querySelector("picture"))}}))),this.fpdInstance.toggleSpinner(!1),this.loadingStack=!1},onError:e=>{e.response&&e.response.error&&e.response.error.code&&f()&&190==e.response.error.code&&(window.localStorage.removeItem("fpd_insta_access_token"),this.accessToken=null,this.authenticate()),this.fpdInstance.toggleSpinner(!1),this.loadingStack=!1}};t&&(this.gridElem.innerHTML="",n.params={fields:"id,caption,media_url,media_type",access_token:this.accessToken}),w(n)}}class R extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-loader-wrapper"> <div class="fpd-loader"> <div class="fpd-loader-circle"></div> </div> </div> <div class="fpd-head"> <a href="https://pixabay.com/" target="_blank" class="fpd-pixabay-logo"> </a> <div class="fpd-input-search"> <input type="text" data-defaulttext="Search in Pixabay library" placeholder="modules.pixabay_search"/> <span class="fpd-icon-magnify"></span> </div> </div> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover fpd-photo-grid"></div> </div>'}}customElements.define("fpd-module-pixabay-images",R);class V extends EventTarget{loadingStack=!1;currentQuery="";pixabayPage=1;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-pixabay-images"),t.append(this.container),this.gridElem=this.container.querySelector(".fpd-grid"),this.loader=this.container.querySelector(".fpd-loader-wrapper");const n=this.container.querySelector(".fpd-scroll-area");n.addEventListener("scroll",(e=>{let t=n.scrollHeight;n.clientHeight+n.scrollTop+100>t&&(this.loadingStack||(this.pixabayPage++,this.loadImages(void 0,!1)))})),l(this.container.querySelector("input"),["keypress"],(e=>{13==e.which&&(this.pixabayPage=1,this.loadImages(e.currentTarget.value))}))}loadImages(e,t=!0){if(this.currentQuery===e)return!1;const n=this.fpdInstance.mainOptions;this.loadingStack=!0,this.currentQuery=void 0===e?this.currentQuery:e;var i=n.pixabayHighResImages?"&response_group=high_resolution":"",s="https://pixabay.com/api/?safesearch=true&key="+n.pixabayApiKey+"&page="+this.pixabayPage+"&per_page=40&min_width="+n.customImageParameters.minW+"&min_height="+n.customImageParameters.minH+i+"&q="+encodeURIComponent(this.currentQuery)+"&lang="+n.pixabayLang;t&&(this.gridElem.innerHTML=""),d(this.loader,["fpd-hidden"]),w({url:s,onSuccess:e=>{c(this.loader,["fpd-hidden"]),e.hits.length>0&&e.hits.forEach((e=>{const t=g({url:e.imageURL?e.imageURL:e.webformatURL,thumbnailUrl:e.webformatURL,title:e.id?e.id:e.id_hash,price:m(this.fpdInstance,this.container)});l(t,["click"],(e=>{this.fpdInstance.loadingCustomImage||this.fpdInstance._addGridItemToCanvas(e.currentTarget)})),this.gridElem.append(t),this.fpdInstance.lazyBackgroundObserver.observe(t.querySelector("picture"))})),this.loadingStack=!1},onError:e=>{c(this.loader,["fpd-hidden"])}})}}class Z extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-scroll-area"> <input type="text" data-defaulttext="Enter a URL, some text..." placeholder="modules.qr_code_input"/> <div class="fpd-qr-code-colors"> <div class="fpd-qr-code-color-dark"></div> <div class="fpd-qr-code-color-light"></div> </div> <span class="fpd-add-qr-code fpd-btn" data-defaulttext="Add QR-Code">modules.qr_code_add_btn</span> <div class="fpd-qr-code-wrapper fpd-hidden"></div> </div> '}}customElements.define("fpd-module-qr-code",Z);class G extends EventTarget{constructor(e,t){super(),this.fpdInstance=e,this.darkColor="#000",this.lightColor="#fff",this.container=document.createElement("fpd-module-qr-code"),t.append(this.container);const n=this.container.querySelector(".fpd-qr-code-color-dark");n.style.backgroundColor="#000",new Picker({parent:n,popup:"bottom",alpha:!1,color:this.darkColor,onChange:e=>{this.darkColor=tinycolor(e.rgbaString).toHexString(),n.style.backgroundColor=this.darkColor}});const i=this.container.querySelector(".fpd-qr-code-color-light");i.style.backgroundColor=this.lightColor,new Picker({parent:i,popup:"bottom",alpha:!1,color:this.lightColor,onChange:e=>{this.lightColor=tinycolor(e.rgbaString).toHexString(),i.style.backgroundColor=this.lightColor}});const s=this.container.querySelector(".fpd-qr-code-wrapper");l(this.container.querySelector(".fpd-btn"),"click",(t=>{s.innerHTML="";const n=this.container.querySelector('input[type="text"]').value;n&&n.length>0&&(new QRCode(s,{text:this.container.querySelector('input[type="text"]').value,width:256,height:256,colorDark:this.darkColor,colorLight:this.lightColor,correctLevel:QRCode.CorrectLevel.H}),s.querySelector("img").onload=t=>{const i={_addToUZ:e.currentViewInstance.currentUploadZone};e._addCanvasImage(t.currentTarget.src,"QR-Code: "+n,i),this.container.querySelector('input[type="text"]').value=""})}))}}class W extends EventTarget{constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-images"),t.append(this.container);const n=Array.from(this.container.querySelectorAll(".fpd-module-tabs > div")),i=Array.from(this.container.querySelectorAll(".fpd-module-tabs-content > div"));let s=null,a=null;l(n,"click",(e=>{const t=e.currentTarget;d(n,["fpd-active"]),d(i,["fpd-active"]),c(t,["fpd-active"]),c(i.find((e=>e.dataset.context==t.dataset.context)),["fpd-active"]),"instagram"==t.dataset.context&&s&&!s.accessToken?s.authenticate():"pixabay"==t.dataset.context&&a&&a.loadImages()}));const o=e.mainOptions;new q(e,i.find((e=>"upload"==e.dataset.context))),l(e,["viewSelect","secondaryModuleCalled"],(t=>{const n=m(e,this.container),i=this.container.querySelectorAll(".fpd-price");i&&(p(i,["fpd-hidden"],!Boolean(n)),i.forEach((e=>{e.innerHTML=n})))})),h(o.facebookAppId)||(new N(e,i.find((e=>"facebook"==e.dataset.context))),n.find((e=>"facebook"==e.dataset.context)).classList.remove("fpd-hidden")),h(o.instagramClientId)||(s=new H(e,i.find((e=>"instagram"==e.dataset.context))),n.find((e=>"instagram"==e.dataset.context)).classList.remove("fpd-hidden")),h(o.pixabayApiKey)||(a=new V(e,i.find((e=>"pixabay"==e.dataset.context))),n.find((e=>"pixabay"==e.dataset.context)).classList.remove("fpd-hidden")),new G(e,i.find((e=>"qr-code"==e.dataset.context))),n.filter((e=>!e.classList.contains("fpd-hidden"))).length<2&&this.container.classList.add("fpd-hide-tabs")}}class X extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-layers" data-defaulttext="Manage Layers" data-title="modules.manage_layers"> <div class="fpd-scroll-area"> <div class="fpd-list"></div> </div> </div>'}}customElements.define("fpd-module-manage-layers",X);const Y=e=>{let t=!1,n=null;const i=document.createElement("div");i.className="fpd-colorpicker-wrapper";const s=new Picker({parent:i,popup:!1,alpha:!1,color:e.initialColor?e.initialColor:"#fff",onChange:i=>{const s=tinycolor(i.rgbaString).toHexString();t&&e.onMove&&e.onMove(s),"number"==typeof n&&clearTimeout(n),n=setTimeout((()=>{t&&e.onChange&&e.onChange(s),t=!0}),500)}});if(void 0!==window.EyeDropper){const e=s.domElement.querySelector(".picker_sample"),t=document.createElement("span");t.className="fpd-icon-color",e.append(t),l(e,"click",(e=>{(new EyeDropper).open().then((e=>{s.setColor(e.sRGBHex)})).catch((e=>{console.log(e)}))}))}if(e.palette&&Array.isArray(e.palette)){const t=$({colors:e.palette,colorNames:e.colorNames,onChange:t=>{e.onChange&&e.onChange(t)}});i.append(t)}return i},J=e=>{const t=document.createElement("div");t.className="fpd-scroll-area",(e.enablePicker||e.subPalette)&&c(t,["fpd-has-subpanel"]);const n=document.createElement("div");let i;return n.className="fpd-color-palette",t.append(n),e.colors&&Array.isArray(e.colors)&&e.colors.forEach(((t,s)=>{let a=t;if(e.colorNames){const n=e.colorNames[t.replace("#","").toLowerCase()];n&&(a=n.toUpperCase())}const o=document.createElement("span");o.className="fpd-item",o.style.backgroundColor=t,o.setAttribute("aria-label",a),n.append(o),e.enablePicker||e.subPalette||c(o,["fpd-tooltip"]),l(o,"click",(a=>{if(a.stopPropagation(),e.enablePicker||e.subPalette){i&&(i.remove(),i=null);const a=o.classList.contains("fpd-active");a||(i=e.enablePicker?Y({initialColor:t,colorNames:e.colorNames,palette:e.palette,onMove:t=>{e.onMove&&e.onMove(t,s)},onChange:t=>{o.style.backgroundColor=t,e.onChange&&e.onChange(t,s)}}):J({colors:e.palette,colorNames:e.colorNames,onChange:t=>{o.style.backgroundColor=t,e.onChange&&e.onChange(t,s)}}),n.append(i)),d(n,["fpd-sub-show"]),d(n.querySelectorAll(".fpd-item"),["fpd-active"]),a||(c(n,["fpd-sub-show"]),c(o,["fpd-active"]))}else e.onChange&&e.onChange(t)}))})),t},$=J,Q=(e,t)=>{if(!t.colors)return;const n=document.createElement("div");if(n.className="fpd-color-panel",1===t.colors.length){const i=Y({initialColor:t.colors[0],colorNames:e.mainOptions.hexNames,palette:e.mainOptions.colorPickerPalette,onMove:e=>{t.onMove&&t.onMove(e)},onChange:e=>{t.onChange&&t.onChange(e)}});n.append(i)}else{const i=$({colors:t.colors,colorNames:e.mainOptions.hexNames,palette:e.mainOptions.colorPickerPalette,onChange:e=>{t.onChange&&t.onChange(e)}});if(n.append(i),t.patterns){const e=(e=>{const t=document.createElement("div");t.className="fpd-scroll-area";const n=document.createElement("div");return n.className="fpd-patterns-wrapper",t.append(n),e.images&&Array.isArray(e.images)&&e.images.forEach(((t,i)=>{const s=t.replace(/^.*[\\\/]/,"").replace(/\.[^/.]+$/,"").replace("_"," ").toUpperCase(),a=document.createElement("span");a.className="fpd-item fpd-tooltip",a.style.backgroundImage=`url("${t}")`,a.setAttribute("aria-label",s),n.append(a),l(a,"click",(n=>{e.onChange&&e.onChange(t)}))})),t})({images:t.patterns,onChange:e=>{t.onPatternChange&&t.onPatternChange(e)}});n.append(e)}}return n};class K extends EventTarget{#B=null;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-manage-layers"),t.append(this.container),this.listElem=this.container.querySelector(".fpd-list"),l(e,"viewSelect",(()=>{this.#M()})),l(e,["elementAdd","elementRemove"],(t=>{e.productCreated&&this.#M()})),l(e,"elementColorChange",(t=>{if(e.productCreated){const e=t.detail.element,n=this.listElem.querySelector('.fpd-list-row[id="'+e.id+'"]');n&&n.querySelector(".fpd-current-color")&&(n.querySelector(".fpd-current-color").style.backgroundColor=e.fill)}}))}#M(){this.listElem.innerHTML="",this.fpdInstance.getElements(this.fpdInstance.currentViewIndex).forEach((e=>{e.checkEditable()&&this.#j(e)})),this.#B&&this.#B.dispose();let e=0;this.#B=AreaSortable("vertical",{container:this.listElem,handle:"fpd-icon-reorder",item:"fpd-list-row",placeholder:"fpd-sortable-placeholder",activeItem:"fpd-sortable-dragged",closestItem:"fpd-sortable-closest",autoscroll:!0,animationMs:0,onStart:t=>{const n=window.pageYOffset||document.documentElement.scrollTop||0;window.onscroll=()=>{window.scrollTo({top:n})},e=t.offsetTop},onChange:e=>{const t=this.fpdInstance.currentViewInstance.fabricCanvas,n=t.getElementByID(e.id);let i=this.listElem.querySelector(".fpd-sortable-closest"),s=t.getElementByID(i?i.id:e.id).getZIndex();i||s++,t.setElementOptions({z:s},n)},onEnd:e=>{window.onscroll=()=>{}}})}#j(e){const t=document.createElement("div");t.className="fpd-list-row",t.id=e.id;let n=document.createElement("span"),i=null;if(!e.uploadZone&&e.hasColorSelection()){i=b(e,this.fpdInstance);const s=(e=>{let t=e.fill;return"string"==typeof t?t:"object"==typeof t?t.source?(t=t.source.src,"url("+t+")"):t[0]:!0===e.colors&&"group"===e.type?tinycolor(e.getObjects()[0].fill):!1===t&&e.colors&&e.colors[0]?e.colors[0]:void 0})(e);n.style.background=s,n.className="fpd-current-color",t.colors=i}const s=document.createElement("div");s.className="fpd-cell-0",s.append(n),t.append(s);let a=e.title;"text"===e.getType()&&e.editable&&(a=document.createElement("textarea"),a.innerText=e.text,l(a,"keyup",(t=>{t.stopPropagation();let n=t.target.value;n=n.replace(FancyProductDesigner.forbiddenTextChars,""),this.fpdInstance.mainOptions.disableTextEmojis&&(n=n.replace(FPDEmojisRegex,""),n=n.replace(String.fromCharCode(65039),"")),this.fpdInstance.currentViewInstance.fabricCanvas.setElementOptions({text:n},e)})),e.on({"editing:exited":()=>{a.value=e.text}}));const o=document.createElement("div");o.className="fpd-cell-1",o.append(a),t.append(o);const r=document.createElement("div");if(r.className="fpd-cell-2",t.append(r),e.uploadZone){c(t,["fpd-add-layer"]);const e=document.createElement("span");e.className="fpd-icon-add",r.append(e)}else{if(e.zChangeable){const e=document.createElement("span");e.className="fpd-icon-reorder",r.append(e)}const n=e.locked?"fpd-icon-locked-full":"fpd-icon-unlocked",i=document.createElement("span");i.className="fpd-lock-element",i.innerHTML=`<span class="${n}"></span>`,r.append(i),l(i,"click",(n=>{n.stopPropagation(),d(t,["fpd-show-colors"]),e.evented=!e.evented,e.locked=!e.evented;const i=n.currentTarget.querySelector("span");p(i,["fpd-icon-unlocked"],e.evented),p(i,["fpd-icon-locked-full"],!e.evented),p(t,["fpd-locked"],!e.evented)})),p(t,["fpd-locked"],e.locked)}let u,h=e.removable||e.__editorMode;if(e.uploadZone&&(h=e.uploadZoneRemovable),h){const t=document.createElement("span");t.className="fpd-remove-element",t.innerHTML='<span class="fpd-icon-remove"></span>',r.append(t),l(t,"click",(t=>{t.stopPropagation(),this.fpdInstance.currentViewInstance.fabricCanvas.removeElement(e)}))}if(this.listElem.append(t),i){if(u=document.createElement("div"),"group"===e.type&&e.getObjects().length>1){let t;t=Array.isArray(e.colors)&&e.colors.length>1?$({colors:i,colorNames:this.fpdInstance.mainOptions.hexNames,palette:e.colors,subPalette:!0,onChange:(t,n)=>{this.#q(e,n,t)}}):$({colors:i,enablePicker:!0,colorNames:this.fpdInstance.mainOptions.hexNames,palette:this.fpdInstance.mainOptions.colorPickerPalette,onMove:(t,n)=>{e.changeObjectColor(n,t)},onChange:(t,n)=>{this.#q(e,n,t)}}),u.append(t)}else u=Q(this.fpdInstance,{colors:i,patterns:Array.isArray(e.patterns)&&(e.isSVG()||"text"===e.getType())?e.patterns:null,onMove:t=>{this.#z(e,t)},onChange:t=>{this.#N(e,t)},onPatternChange:n=>{t.querySelector(".fpd-current-color").style.backgroundImage=`url("${n}")`,this.fpdInstance.currentViewInstance.fabricCanvas.setElementOptions({pattern:n},e)}});c(u,["fpd-cell-full"]),t.append(u),l(t.querySelector(".fpd-current-color"),"click",(e=>{const n=!t.classList.contains("fpd-show-colors");d(this.listElem.querySelectorAll(".fpd-list-row"),["fpd-show-colors"]),p(t,["fpd-show-colors"],n)}))}l(t,"click",(e=>{const t=e.currentTarget;if(t.classList.contains("fpd-locked")||"TEXTAREA"==e.target.nodeName)return;const n=this.fpdInstance.getElementByID(t.id);n&&n.canvas.setActiveObject(n).renderAll()}))}#z(e,t){"png"!==e.isColorizable()&&e.changeColor(t)}#N(e,t){const n=this.listElem.querySelector('.fpd-list-row[id="'+e.id+'"]');n&&n.querySelector(".fpd-current-color")&&(n.querySelector(".fpd-current-color").style.backgroundColor=e.fill),this.fpdInstance.currentViewInstance.fabricCanvas.setElementOptions({fill:t},e)}#q(e,t,n){const i=e.changeObjectColor(t,n);this.fpdInstance.currentViewInstance.fabricCanvas.setElementOptions({fill:i},e)}}class ee extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-save" data-defaulttext="Saved Designs" data-title="modules.save_load"> <div class="fpd-save-design"> <input type="text" data-defaulttext="Optional: Enter a title" placeholder="modules.save_load_input_placeholder"> <div class="fpd-btn"> <span data-defaulttext="Save Design">modules.save_load_add_btn</span> </div> </div> <div class="fpd-saved-designs fpd-scroll-area"> <div class="fpd-grid"></div> </div> </div>'}}customElements.define("fpd-module-save-load",ee);class te extends EventTarget{constructor(e,t){if(super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-save-load"),t.append(this.container),this.inputElem=this.container.querySelector("input"),this.gridElem=this.container.querySelector(".fpd-grid"),l(this.container.querySelector(".fpd-btn"),"click",(t=>{const n=E(this.fpdInstance.currentViewInstance.options.stageWidth,this.fpdInstance.currentViewInstance.options.stageHeight,300,300,"cover");e.viewInstances[0].toDataURL((e=>{const t=this.fpdInstance.getProduct(),n={thumbnail:e,product:t,title:this.inputElem.value||""};if(t&&this.fpdInstance.mainOptions.saveActionBrowserStorage){let e=this.#U();e||(e=[]),this.#H(n),e.push(n),window.localStorage.setItem(this.fpdInstance.container.id,JSON.stringify(e)),j(this.fpdInstance.translator.getTranslation("misc","product_saved"))}t&&this.fpdInstance.dispatchEvent(new CustomEvent("actionSave",{detail:n}))}),"transparent",{multiplier:n,format:"png"})})),this.fpdInstance.mainOptions.saveActionBrowserStorage){let e=this.#U();e&&e.length>0&&e.forEach((e=>{this.#H(e)}))}}#U(){return!!f()&&JSON.parse(window.localStorage.getItem(this.fpdInstance.container.id))}#H({thumbnail:e,product:t,title:n=""}){const i=g({url:e,title:n,removable:!0,disablePrice:!0,disableDraggable:!0});this.fpdInstance.lazyBackgroundObserver.observe(i.querySelector("picture")),i.product=t,this.gridElem.append(i),l(i,"click",(e=>{this.fpdInstance.loadProduct(i.product),this.fpdInstance.currentProductIndex=-1})),l(i.querySelector(".fpd-delete"),"click",(i=>{i.stopPropagation();const s=i.currentTarget.parentNode,a=Array.from(this.gridElem.querySelectorAll(".fpd-item")).indexOf(s);if(this.fpdInstance.mainOptions.saveActionBrowserStorage){let e=this.#U();e.splice(a,1),window.localStorage.setItem(this.fpdInstance.container.id,JSON.stringify(e))}this.fpdInstance.dispatchEvent(new CustomEvent("actionSave",{detail:{title:n,thumbnail:e,product:t}})),s.remove()}))}}class ne extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-text-layers" data-defaulttext="Text Layers" data-title="modules.text_layers"> <div class="fpd-scroll-area"> <div class="fpd-list"></div> </div> </div>'}}customElements.define("fpd-module-text-layers",ne);class ie extends EventTarget{constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-text-layers"),t.append(this.container),this.listElem=this.container.querySelector(".fpd-list"),l(e,"viewSelect",(()=>{this.#M()})),l(e,["elementAdd","elementRemove"],(t=>{e.productCreated&&this.#M()})),l(e,["elementModify","textLinkApply"],(t=>{if(e.productCreated){const{element:e,options:n}=t.detail,i=this.listElem.querySelector('.fpd-list-row[id="'+e.id+'"]');i&&(n.fontSize&&(i.querySelector('[data-control="fontSize"]').value=n.fontSize),n.fontFamily&&i.querySelector("fpd-dropdown").setAttribute("value",n.fontFamily),n.text&&(i.querySelector(".fpd-text-input").value=n.text))}})),l(e,"elementColorChange",(t=>{if(e.productCreated){const e=t.detail.element,n=this.listElem.querySelector('.fpd-list-row[id="'+e.id+'"]');n&&(n.querySelector(".fpd-current-color").style.backgroundColor=e.fill)}}))}#M(){this.listElem.innerHTML="",this.fpdInstance.getElements(this.fpdInstance.currentViewIndex).forEach((e=>{e.checkEditable()&&"text"==e.getType()&&this.#j(e)}))}#R(e,t,n){const i=document.createElement("fpd-dropdown");i.searchable=!0,t.append(i);const s=i.querySelector(".fpd-dropdown-list > .fpd-scroll-area");return e.forEach(((e,t)=>{"object"==typeof e&&(e=e.name);const a=document.createElement("span");a.className="fpd-item",a.family=e,a.style.fontFamily=e,a.innerText=e,a.addEventListener("click",(t=>{i.setAttribute("value",t.currentTarget.innerText),this.fpdInstance.currentViewInstance.fabricCanvas.setElementOptions({fontFamily:e},n)})),s.append(a)})),i}#j(e){const t=document.createElement("div");t.className="fpd-list-row",t.id=e.id,this.listElem.append(t);const n=document.createElement("div");n.className="fpd-cell-full",n.innerText=e.title.replace(/(\r\n|\n|\r)/gm," "),t.append(n);const i=document.createElement("div");let s;i.className="fpd-cell-full",t.append(i),1===e.maxLines?(s=document.createElement("input"),s.value=e.text,i.append(s)):(s=document.createElement("textarea"),s.value=e.text,i.append(s)),s.className="fpd-text-input";const a=document.createElement("span");a.className="fpd-clear-text",a.innerText=this.fpdInstance.translator.getTranslation("modules","text_layers_clear"),i.append(a),l(a,"click",(t=>{t.stopPropagation(),this.fpdInstance.currentViewInstance.fabricCanvas.setElementOptions({text:""},e),s.value=""})),e.on({"editing:exited":()=>{s.value=e.text}}),l(s,"keyup",(t=>{t.stopPropagation();let n=t.target.value;n=n.replace(FancyProductDesigner.forbiddenTextChars,""),this.fpdInstance.mainOptions.disableTextEmojis&&(n=n.replace(FPDEmojisRegex,""),n=n.replace(String.fromCharCode(65039),"")),this.fpdInstance.currentViewInstance.fabricCanvas.setElementOptions({text:n},e)}));const o=Array.isArray(this.fpdInstance.mainOptions.fonts)?this.fpdInstance.mainOptions.fonts:[];if(o.length){const n=document.createElement("div");n.className="fpd-cell-1",t.append(n),this.#R(o,n,e).setAttribute("value",e.fontFamily)}if(e.resizable||e.__editorMode){const n=document.createElement("div");n.className="fpd-cell-2",t.append(n);const i=document.createElement("input");i.className="fpd-tooltip",i.setAttribute("aria-label",this.fpdInstance.translator.getTranslation("toolbar","font_size")),i.type="number",i.value=e.fontSize,i.dataset.control="fontSize",i.min=e.minFontSize,i.max=e.maxFontSize,n.append(i),l(i,"change",(t=>{this.fpdInstance.currentViewInstance.fabricCanvas.setElementOptions({fontSize:parseInt(t.currentTarget.value)},e),i.value=e.fontSize}))}if(e.hasColorSelection()){const n=document.createElement("div");n.className="fpd-cell-full",t.append(n);const i=b(e,this.fpdInstance),s=Q(this.fpdInstance,{colors:i,patterns:Array.isArray(e.patterns)&&(e.isSVG()||"text"===e.getType())?e.patterns:null,onMove:t=>{e.changeColor(t)},onChange:t=>{this.fpdInstance.currentViewInstance.fabricCanvas.setElementOptions({fill:t},e)},onPatternChange:t=>{this.fpdInstance.currentViewInstance.fabricCanvas.setElementOptions({pattern:t},e)}});n.append(s)}}}class se extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-layout" data-defaulttext="Layouts" data-title="modules.layouts"> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-contain fpd-padding"></div> </div> </div>'}}customElements.define("fpd-module-layouts",se);class ae extends EventTarget{#V=0;#Z=0;#G=!1;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-layouts"),t.append(this.container),this.gridElem=this.container.querySelector(".fpd-grid"),l(e,"productCreate",(t=>{const n=e.currentViews[0].options.layouts;"string"==typeof n?w({url:this.fpdInstance.mainOptions.layouts,onSuccess:e=>{this.layoutsData=e,this.#W()},onError:()=>{alert("Layouts JSON could not be loaded. Please check that your URL is correct! URL: "+this.fpdInstance.mainOptions.layouts)}}):Array.isArray(n)&&(this.layoutsData=n)})),l(this.fpdInstance,"beforeElementAdd",this.#X.bind(this))}#X(e){const t=e.detail.element;if(this.#G){this.#V++;const e=t.title+"<br>"+String(this.#V)+"/"+this.#Z;this.fpdInstance.mainLoader.querySelector(".fpd-loader-text").innerHTML=e}}#W(){this.gridElem.innerHTML="",Array.isArray(this.layoutsData)&&this.layoutsData.forEach((t=>{const n=g({url:t.thumbnail,title:t.title,disablePrice:!0,disableDraggable:!0});l(n,"click",(n=>{if(!this.fpdInstance.productCreated)return;var i=e(this.fpdInstance.translator.getTranslation("modules","layouts_confirm_replacement"),!1,"confirm",this.fpdInstance.container);const s=i.querySelector(".fpd-confirm");s.innerText=this.fpdInstance.translator.getTranslation("modules","layouts_confirm_button"),l(s,"click",(()=>{this.#V=0,this.#Z=t.elements.length,this.fpdInstance.globalCustomElements=[],this.fpdInstance.mainOptions.replaceInitialElements&&(this.fpdInstance.globalCustomElements=this.fpdInstance.getCustomElements()),this.fpdInstance.toggleSpinner(!0),this.#G=!0,this.fpdInstance.currentViewInstance.loadElements(t.elements,(()=>{this.#G=!1,this.fpdInstance.toggleSpinner(!1),this.fpdInstance.dispatchEvent(new CustomEvent("layoutElementsAdded",{detail:{elements:t.elements}}))})),i.remove()}))})),this.gridElem.append(n),this.fpdInstance.lazyBackgroundObserver.observe(n.querySelector("picture"))}))}}class oe extends EventTarget{constructor(e,t,n){let i;if(super(),"products"===n)i=new T(e,t);else if("text"===n)i=new P(e,t);else if("text-to-image"===n)i=new A(e,t);else if(n.includes("designs")){let a=null;if(n.includes("designs_")&&!h(e.mainOptions.dynamicDesigns)){if(a=n.split("_").pop(),!a||!e.mainOptions.dynamicDesigns[a])return;{var s=e.mainOptions.dynamicDesigns[a];const t={};t["data-dynamic-designs-id"]=a,!h(s.icon)&&s.icon.includes(".svg")&&(this.configs={icon:s.icon,defaultText:s.name,attrs:t})}}i=new F(e,t,a)}else"images"===n?i=new W(e,t):"manage-layers"===n?i=new K(e,t):"save-load"===n?i=new te(e,t):"text-layers"===n?i=new ie(e,t):"layouts"===n&&(i=new ae(e,t));if(FancyProductDesigner.additionalModules&&!i){const s=FancyProductDesigner.additionalModules[n];s&&(i=new s(e,t))}if(i&&(this.moduleInstance=i,e["moduleInstance_"+n]=i,!n.includes("designs_"))){const e=i.container.querySelector("div");this.configs={icon:e.dataset.moduleicon,langId:e.dataset.title,langKeys:e.dataset.title.split("."),defaultText:e.dataset.defaulttext}}}}class re extends EventTarget{#Y=null;#J=null;#$=!1;#Q=0;#K=0;#ee=0;#te=0;#ne=!1;#ie=!1;contentElem=null;navElem=null;currentModuleKey="";constructor(e){super(),this.fpdInstance=e;const t=e.container;if(this.container=document.createElement("fpd-main-bar"),e.mainOptions.mainBarContainer&&!1===e.mainOptions.modalMode){const n=document.querySelector(e.mainOptions.mainBarContainer);n?(d(t,["fpd-off-canvas","fpd-topbar"]),c(t,["fpd-main-bar-container-enabled","fpd-sidebar"]),c(n,["fpd-container","fpd-main-bar-container","fpd-sidebar"]),n.append(this.container)):(console.log("DOM element for mainbar container not found."),t.append(this.container))}else t.append(this.container);if(this.contentElem=this.container.querySelector(".fpd-module-content"),this.navElem=this.container.querySelector(".fpd-navigation"),this.secContent=this.container.querySelector(".fpd-secondary-content"),this.currentModules=e.mainOptions.mainBarModules,this.#Y=document.querySelector(this.fpdInstance.mainOptions.modalMode?".fpd-modal-product-designer":"body"),this.#J=document.querySelector(".fpd-draggable-dialog"),this.#Y.append(this.#J),l(this.#J,["mousedown","touchstart"],this.#se.bind(this)),l(this.#J,["mouseup","touchend"],this.#ae.bind(this)),l(document,["mousemove","touchmove"],this.#oe.bind(this)),l(this.#J.querySelector(".fpd-close-dialog"),["click","touchstart"],this.#re.bind(this)),l(this.container.querySelector(".fpd-close"),["click","touchmove"],this.#re.bind(this)),l(e,"viewSelect",this.#le.bind(this)),t.classList.contains("fpd-off-canvas")){let e=0,t=0;this.contentElem.addEventListener("touchstart",(t=>{e=t.touches[0].pageX,c(this.container,["fpd-is-dragging"])})),this.contentElem.addEventListener("touchmove",(n=>{n.preventDefault();let i=n.touches[0].pageX;t=e-i,t=Math.abs(t)<0?0:Math.abs(t),this.contentElem.style.left=-t+"px",this.contentElem.previousElementSibling.style.left=this.contentElem.clientWidth-t+"px"})),this.contentElem.addEventListener("touchend",(e=>{Math.abs(t)>100?this.toggleContentDisplay(!1):(this.contentElem.style.left="0px",this.contentElem.previousElementSibling.style.left=this.contentElem.clientWidth+"px"),t=0,d(this.container,["fpd-is-dragging"])}))}this.updateContentWrapper(),this.setup(this.currentModules)}#se(e){this.#J.querySelector(".fpd-dialog-drag-handle").contains(e.target)&&(e.preventDefault(),this.#$=!0,this.#Q=e.touches?event.touches[0].clientX:e.clientX,this.#K=e.touches?event.touches[0].clientY:e.clientY,this.#ee=this.#Q-this.#J.offsetLeft,this.#te=this.#K-this.#J.offsetTop)}#oe(e){if(!this.#$)return;const t=this.#Y.clientWidth<window.innerWidth?window.innerWidth:this.#Y.clientWidth,n=this.#Y.clientHeight<window.innerHeight?window.innerHeight:this.#Y.clientHeight,i=t-this.#J.clientWidth,s=n-this.#J.clientHeight,a=e.touches?event.touches[0].clientX:e.clientX;let o=(e.touches?event.touches[0].clientY:e.clientY)-this.#te,r=a-this.#ee;r<0&&(r=0),o<0&&(o=0),r>i&&(r=i),o>s&&(o=s),this.#J.style.top=o+"px",this.#J.style.left=r+"px"}#ae(e){this.#$=!1}#ce(e){e.stopPropagation(),this.fpdInstance.deselectElement(),this.fpdInstance.currentViewInstance&&(this.fpdInstance.currentViewInstance.currentUploadZone=null),e.currentTarget.classList.contains("fpd-active")&&this.contentClosable?this.toggleContentDisplay(!1):this.callModule(e.currentTarget.dataset.module,e.currentTarget.dataset.dynamicDesignsId)}#re(e){e.preventDefault(),this.fpdInstance.currentViewInstance&&this.fpdInstance.currentViewInstance.currentUploadZone&&this.fpdInstance.currentViewInstance.fabricCanvas.deselectElement(),this.toggleContentDisplay(!1)}#le(){const e=this.fpdInstance.currentViewInstance,t=e.options.customAdds;p(document.querySelectorAll('.fpd-nav-item[data-module^="designs"]'),["fpd-disabled"],!t.designs),p(document.querySelectorAll('.fpd-nav-item[data-module="images"]'),["fpd-disabled"],!t.uploads),p(document.querySelectorAll('.fpd-nav-item[data-module="text-to-image"]'),["fpd-disabled"],!t.uploads),p(document.querySelectorAll('.fpd-nav-item[data-module="drawing"]'),["fpd-disabled"],!t.drawing),p(document.querySelectorAll('.fpd-nav-item[data-module="text"]'),["fpd-disabled"],!t.texts),p(document.querySelectorAll('.fpd-nav-item[data-module="names-numbers"]'),["fpd-disabled"],!e.textPlaceholder&&!e.numberPlaceholder),this.toggleContentDisplay(!1)}callModule(e,t=null){let n;if(d(this.secContent,["fpd-active"]),d(this.contentElem,["fpd-hidden"]),d(this.navElem.querySelectorAll(".fpd-nav-item"),["fpd-active"]),d(Array.from(this.contentElem.children),["fpd-active"]),t)n=c(this.navElem.querySelector('.fpd-nav-item[data-dynamic-designs-id="'+t+'"]'),["fpd-active"]),c(this.contentElem.querySelector('[data-dynamic-designs-id="'+t+'"]'),["fpd-active"]);else{n=c(this.navElem.querySelector('.fpd-nav-item[data-module="'+e+'"]'),["fpd-active"]);const t=this.contentElem.querySelector("fpd-module-"+e);c(t,["fpd-active"]),"text"==e&&t.querySelector("textarea").focus()}this.toggleContentDisplay(),this.currentModuleKey=e}callSecondary(e){d(this.navElem.querySelectorAll(".fpd-nav-item"),["fpd-active"]),c(this.contentElem,["fpd-hidden"]),c(this.secContent,["fpd-active"]),c(this.secContent.querySelector(".fpd-"+e),["fpd-active"]),c(this.fpdInstance.container,["fpd-secondary-visible"]),this.fpdInstance.dispatchEvent(new CustomEvent("secondaryModuleCalled",{detail:{moduleName:e}}))}get contentClosable(){const e=this.fpdInstance.container;return this.#ie||this.#ne||e.classList.contains("fpd-layout-small")}toggleContentDisplay(e=!0){const t=this.fpdInstance.container;d(t,["fpd-secondary-visible"]),p(t,["fpd-module-visible"],e),this.contentClosable&&(e||d(this.navElem.querySelectorAll(".fpd-nav-item"),["fpd-active"])),this.#ie?(!e&&this.currentModuleKey.length&&this.fpdInstance.deselectElement(),this.contentElem.style.removeProperty("left"),this.contentElem.previousElementSibling.style.removeProperty("left"),this.contentElem.style.height=this.fpdInstance.mainWrapper.container.clientHeight+"px",this.container.classList.toggle("fpd-show",e)):this.#ne&&(e&&(this.#J.querySelector(".fpd-dialog-title").innerText=this.navElem.querySelector(".fpd-nav-item.fpd-active .fpd-label").innerText),this.#J.classList.toggle("fpd-show",e)),e||(this.currentModuleKey="")}updateContentWrapper(){const e=this.fpdInstance.container;this.toggleContentDisplay(!1),this.#ie=!1,this.#ne=!1,d(this.navElem.querySelectorAll(".fpd-nav-item"),["fpd-active"]),e.classList.contains("fpd-off-canvas")?(this.#ie=!0,this.container.append(this.contentElem)):e.classList.contains("fpd-sidebar")?this.container.append(this.contentElem):(this.#ne=!0,this.#J.append(this.contentElem))}toggleUploadZonePanel(e=!0,t={}){if(!this.fpdInstance.loadingCustomImage)if(p(this.secContent,["fpd-active"],e),e){p(this.uploadZoneNavItems.find((e=>e.classList.contains("fpd-add-image"))),["fpd-hidden"],!Boolean(t.uploads)),p(this.uploadZoneNavItems.find((e=>e.classList.contains("fpd-add-text"))),["fpd-hidden"],!Boolean(t.texts)),p(this.uploadZoneNavItems.find((e=>e.classList.contains("fpd-add-design"))),["fpd-hidden"],!Boolean(t.designs)),this.fpdInstance.UZmoduleInstance_designs&&this.fpdInstance.UZmoduleInstance_designs.toggleCategories();const e=this.uploadZoneNavItems.find((e=>!e.classList.contains("fpd-hidden")));e&&e.click(),this.callSecondary("upload-zone-panel")}else this.fpdInstance.currentViewInstance.currentUploadZone=null}setup(e=[]){let t=this.fpdInstance.mainOptions.initialActiveModule?this.fpdInstance.mainOptions.initialActiveModule:"";const n=this.container.querySelector(".fpd-navigation");this.currentModules.length<=1&&!this.fpdInstance.container.classList.contains("fpd-topbar")?(t=this.currentModules[0]?this.currentModules[0]:"",n.classList.add("fpd-hidden")):this.fpdInstance.container.classList.contains("fpd-sidebar")&&""==t?t=this.currentModules[0]?this.currentModules[0]:"":n.classList.remove("fpd-hidden"),n.innerHTML=this.contentElem.innerHTML="",FancyProductDesigner.additionalModules&&Object.keys(FancyProductDesigner.additionalModules).forEach((t=>{e.push(t)})),e.forEach((e=>{let t="";const i=new oe(this.fpdInstance,this.contentElem,e);if(!i.moduleInstance)return;const s=document.createElement("div");s.classList.add("fpd-nav-item"),s.dataset.module=e,s.addEventListener("click",this.#ce.bind(this)),n.appendChild(s);let a=document.createElement("span");if(i.configs.icon.includes(".svg")?(o={url:i.configs.icon,onSuccess:e=>{a.innerHTML=e},onError:e=>{console.log(e)}},fetch(o.url).then((e=>{e.ok?e.text().then((e=>{o.onSuccess&&o.onSuccess(e)})):e.text().then((e=>{o.onError&&o.onError(e)}))}))):(a.classList.add("fpd-nav-icon"),a.classList.add(i.configs.icon)),s.append(a),i.configs.langKeys){const e=i.configs.langKeys;t=this.fpdInstance.translator.getTranslation(e[0],e[1],this.fpdInstance.mainOptions.langJson,i.configs.defaultText)}else i.configs.defaultText&&(t=i.configs.defaultText);var o;const r=document.createElement("span");if(r.className="fpd-label",r.innerText=t,s.append(r),i.configs.attrs)for(const[e,t]of Object.entries(i.configs.attrs))s.setAttribute(e,t)}));const i=n.querySelector(`[data-module="${t}"]`);!this.contentClosable&&i&&i.click(),this.uploadZoneContent=this.secContent.querySelector(".fpd-upload-zone-content"),this.uploadZoneNavItems=Array.from(this.secContent.querySelectorAll(".fpd-upload-zone-panel .fpd-bottom-nav > div"));const s=new oe(this.fpdInstance,this.uploadZoneContent,"images");this.fpdInstance.UZmoduleInstance_images=s.moduleInstance;const a=new oe(this.fpdInstance,this.uploadZoneContent,"text");this.fpdInstance.UZmoduleInstance_text=a.moduleInstance;const o=new oe(this.fpdInstance,this.uploadZoneContent,"designs");this.fpdInstance.UZmoduleInstance_designs=o.moduleInstance,l(this.uploadZoneNavItems,"click",(e=>{d(this.uploadZoneNavItems,["fpd-active"]),c(e.currentTarget,["fpd-active"]),d(Array.from(this.uploadZoneContent.children),["fpd-active"]),c(this.uploadZoneContent.querySelector("fpd-module-"+e.currentTarget.dataset.module),["fpd-active"])}))}}class le extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-product-stage"></div>'}}customElements.define("fpd-main-wrapper",le);class ce{constructor(e){this.container=document.createElement("fpd-main-wrapper"),e.container.append(this.container)}}n(561);class de extends EventTarget{constructor(e){super(),this.container=document.createElement("fpd-actions-bar"),e.container.append(this.container)}}class pe extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<span class="fpd-view-prev"> <span class="fpd-icon-forward"></span> </span> <div class="fpd-views-selection"></div> <span class="fpd-view-next"> <span class="fpd-icon-forward"></span> </span> '}}customElements.define("fpd-views-wrapper",pe);class ue extends EventTarget{constructor(e){super(),this.container=document.createElement("fpd-views-wrapper"),e.container.classList.contains("fpd-views-outside")&&!e.mainOptions.modalMode?e.container.after(this.container):e.mainWrapper.container.append(this.container)}}class he extends EventTarget{#de=0;constructor(e){super(),this.fpdInstance=e}init(){if(this.fpdInstance.mainOptions.modalMode){this.fpdInstance.mainOptions.maxCanvasHeight=.85,this.fpdInstance.mainOptions.fabricCanvasOptions.allowTouchScrolling=!1;let e=!1;c(document.body,["fpd-modal-mode-active"]),d(this.fpdInstance.container,["fpd-off-canvas","fpd-topbar"]),c(this.fpdInstance.container,["fpd-sidebar"]);const t=document.createElement("div");t.className="fpd-modal-product-designer fpd-modal-overlay fpd-fullscreen",document.body.append(t);const n=document.createElement("div");n.className="fpd-modal-inner",n.append(this.fpdInstance.container),t.append(n);const i=document.querySelector(this.fpdInstance.mainOptions.modalMode);l(i,"click",(n=>{n.preventDefault(),c(document.body,["fpd-overflow-hidden","fpd-modal-designer-visible"]),c(t,["fpd-show"]),this.fpdInstance.selectView(0),this.fpdInstance.currentViewInstance&&(this.fpdInstance.currentViewInstance.fabricCanvas.resetZoom(),e||this.fpdInstance.doAutoSelect()),e=!0,this.fpdInstance.dispatchEvent(new CustomEvent("modalDesignerOpen"))}))}this.#pe(),this.#ue(),this.#he(),this.fpdInstance.container.classList.add("fpd-container"),this.fpdInstance.container.classList.add("fpd-wrapper");const e=document.createElement("div");e.innerHTML='<div class="fpd-loader-wrapper"> <div class="fpd-loader"> <div class="fpd-loader-circle"></div> <span class="fpd-loader-text" data-defaulttext="Initializing Product Designer">misc.initializing</span> </div> </div>',this.fpdInstance.container.appendChild(e.firstChild.cloneNode(!0)),this.fpdInstance.mainLoader=this.fpdInstance.container.querySelector(".fpd-loader-wrapper"),this.fpdInstance.actionsBar=new de(this.fpdInstance),this.fpdInstance.mainBar=new re(this.fpdInstance),this.fpdInstance.mainWrapper=new ce(this.fpdInstance),this.fpdInstance.productStage=this.fpdInstance.mainWrapper.container.querySelector(".fpd-product-stage"),this.fpdInstance.viewsWrapper=new ue(this.fpdInstance),Array.from(this.fpdInstance.container.querySelectorAll("[data-defaulttext]")).forEach((e=>{this.fpdInstance.translator.translateElement(e,this.fpdInstance.mainOptions.langJson)})),this.dispatchEvent(new CustomEvent("ready")),window.addEventListener("resize",this.#pe.bind(this))}#pe(){const e=this.fpdInstance.mainOptions.responsiveBreakpoints;this.#de=window.innerWidth,this.#de<e.small?(this.fpdInstance.container.classList.remove("fpd-layout-medium"),this.fpdInstance.container.classList.remove("fpd-layout-large"),this.fpdInstance.container.classList.add("fpd-layout-small")):this.#de<e.medium?(this.fpdInstance.container.classList.remove("fpd-layout-small"),this.fpdInstance.container.classList.remove("fpd-layout-large"),this.fpdInstance.container.classList.add("fpd-layout-medium")):(this.fpdInstance.container.classList.remove("fpd-layout-medium"),this.fpdInstance.container.classList.remove("fpd-layout-small"),this.fpdInstance.container.classList.add("fpd-layout-large"))}#ue(){const e=document.body;let t;t=document.createElement("div"),t.className="fpd-thumbnail-preview fpd-shadow-1 fpd-hidden",t.innerHTML="<picture></picture>";const n=document.createElement("div");n.className="fpd-preview-title",t.append(n),e.append(t),l(e,["mouseover","mouseout","mousemove","click"],(e=>{if(this.fpdInstance.draggedPlaceholder)return void t.classList.add("fpd-hidden");const i=e.target;if(i.classList.contains("fpd-hover-thumbnail")&&t.classList.contains("fpd-hidden")&&"mouseover"===e.type&&i.dataset.source){t.querySelector(".fpd-price")&&t.querySelector(".fpd-price").remove(),t.querySelector(".fpd-image-quality-ratings")&&t.querySelector(".fpd-image-quality-ratings").remove(),t.querySelector("picture").style.backgroundImage=`url("${i.dataset.source}")`,i.dataset.title&&(n.innerText=i.dataset.title),p(n,["fpd-hidden"],!i.dataset.title),p(t,["fpd-title-enabled"],i.dataset.title);const e=i.querySelector(".fpd-price");e&&t.append(e.cloneNode(!0));const s=i.querySelector(".fpd-image-quality-ratings");if(s){const e=s.cloneNode(!0),n=document.createElement("span");n.className="fpd-image-quality-rating-label",n.innerText=s.dataset.qualityLabel,e.prepend(n),t.append(e)}t.classList.remove("fpd-hidden")}if(t.classList.contains("fpd-hidden")||"mousemove"!==e.type&&"mouseover"!==e.type)"mouseout"!==e.type&&"click"!=e.type||t.classList.add("fpd-hidden");else{const n=e.pageX+10+t.offsetWidth>window.innerWidth?window.innerWidth-t.offsetWidth:e.pageX+10;t.style.left=n+"px",t.style.top=e.pageY+10+"px"}}))}#he(){const e=document.body,t=document.createElement("div");t.className="fpd-main-tooltip",e.append(t),this.fpdInstance.mainTooltip=t,e.addEventListener("mouseover",(e=>{const n=e.target;if(n.classList.contains("fpd-tooltip")){const e=n.getAttribute("aria-label");t.innerHTML=e;const i=5,{x:s,y:a,width:o,height:r}=n.getBoundingClientRect();let l=Math.floor(a-t.clientHeight-i),c=Math.floor(s+o/2-t.clientWidth/2);l<0&&(l=Math.floor(a+r+i)),c<0?c=0:c>window.outerWidth-t.clientWidth&&(c=window.outerWidth-t.clientWidth-i),t.style.left=`${c}px`,t.style.top=`${l}px`,t.classList.add("fpd-show")}else t.classList.remove("fpd-show")})),e.addEventListener("touchstart",(e=>{t.classList.remove("fpd-show")}))}}class fe{constructor(e){const t=document.querySelector(e.mainOptions.editorMode);t&&(c(t,["fpd-editor-box-wrapper","fpd-container"]),this.titleElem=document.createElement("div"),this.titleElem.className="fpd-eb-title",t.append(this.titleElem),this.gridElem=document.createElement("div"),this.gridElem.className="fpd-eb-grid",t.append(this.gridElem),e.mainOptions.editorBoxParameters.forEach((e=>{const t=document.createElement("div");t.innerHTML="<span>"+e+'</span><input type="text" readonly data-prop="'+e+'" />',this.gridElem.append(t)}))),l(e,["elementSelect","elementChange"],(n=>{t&&(e.currentElement?(this.titleElem.innerText=e.currentElement.title,e.mainOptions.editorBoxParameters.forEach((t=>{let n=e.currentElement[t];if(void 0!==n){n="number"==typeof n?n.toFixed(2):n,n="object"==typeof n&&n.source?n.source.src:n,"fill"===t&&"group"===e.currentElement.type&&(n=e.currentElement.svgFill);const i=this.gridElem.querySelector('input[data-prop="'+t+'"]');i&&(i.value=n)}}))):this.titleElem.innerText="",p(this.gridElem,["fpd-hidden"],!e.currentElement))}))}}class ge extends EventTarget{static forbiddenTextChars=/<|>/g;static proxyFileServer="";static uploadsToServer=!0;static additionalModules={};container=null;mainOptions={};currentViewInstance=null;currentViewIndex=0;products=[];designs=[];modalContainer=document.body;currentCategoryIndex=0;currentProductIndex=0;viewInstances=[];currentViews=null;currentElement=null;productCreated=!1;colorLinkGroups={};globalCustomElements=[];doUnsavedAlert=!1;currentPrice=0;singleProductPrice=0;pricingRulesPrice=0;loadingCustomImage=!1;lazyBackgroundObserver=null;draggedPlaceholder=null;mouseOverCanvas=!1;#fe=0;#ge=0;#me=!1;constructor(e,t={}){if(super(),!e)return void console.log("No DOM element found for FPD.");this.lazyBackgroundObserver=new IntersectionObserver(((e,t)=>{e.forEach((e=>{e.isIntersecting&&(u(e.target),this.lazyBackgroundObserver.unobserve(e.target))}))})),this.container=e,this.container.instance=this,this.mainOptions=y.merge(y.defaults,t);let n={};Object.keys(this.mainOptions.hexNames).forEach((e=>{n[e.toLowerCase()]=this.mainOptions.hexNames[e]})),this.mainOptions.hexNames=n,this.translator=new I,this.translator.loadLangJSON(this.mainOptions.langJson,this.#ve.bind(this))}#ve(){this.uiManager=new he(this),this.uiManager.addEventListener("ready",(e=>{this.#be()})),this.uiManager.init()}#be(){((e,t)=>{const n=e.mainOptions.fonts;if(n&&n.length>0&&"object"==typeof n[0]){n.sort(((e,t)=>{let n=e.name.toUpperCase(),i=t.name.toUpperCase();return n<i?-1:n>i?1:0}));let a=[],o=[],r=0;const l=document.createElement("style");l.id="fpd-fonts",e.container.before(l),n.forEach((e=>{if(e.hasOwnProperty("url"))if("google"==e.url)a.push(e.name+":400,400i,700,700i");else{let t=e.name;t+=":n4",e.variants&&(t+=","+Object.keys(e.variants).toString()),o.push(t),l.append((e=>{let t="";if(e.hasOwnProperty("url")){let n=e.name,i=-1!==e.url.search(".woff")?"woff":"TrueType",s=FancyProductDesigner.proxyFileServer+e.url;if(n+=":n4",t+='@font-face {font-family:"'+e.name+'"; font-style: normal; font-weight: normal; src:url("'+s+'") format("'+i+'");}\n',e.variants){for(const n in e.variants){let a={n7:"font-style: normal; font-weight: bold;",i4:"font-style: italic; font-weight: normal;",i7:"font-style: italic; font-weight: bold;"};s=FancyProductDesigner.proxyFileServer+e.variants[n],t+='@font-face {font-family:"'+e.name+'"; '+a[n]+' src:url("'+s+'") format("'+i+'");}\n'}n+=","+Object.keys(e.variants).toString()}}return t})(e))}}));var i=function(e,n,i){"inactive"==e&&console.log(n+" font could not be loaded."),r==a.length+o.length-1&&t(),r++},s={fontactive:function(e,t){i("active",e)},fontinactive:function(e,t){i("inactive",e)},timeout:3e3};a.length>0&&(s.google={families:a}),o.length>0&&(s.custom={families:o}),"undefined"!=typeof WebFont&&(a.length>0||o.length>0)?WebFont.load(s):t()}else t()})(this,(()=>{setTimeout((()=>{this.dispatchEvent(new CustomEvent("uiSet")),this.#ye()}),1)}))}#ye(){this.dispatchEvent(new CustomEvent("ready")),this.mainOptions.productsJSON&&("object"==typeof this.mainOptions.productsJSON?this.setupProducts(this.mainOptions.productsJSON):w({url:this.mainOptions.productsJSON,onSuccess:e=>{this.setupProducts(e)},onError:()=>{alert("Products JSON could not be loaded. Please check that your URL is correct! URL: "+this.mainOptions.productsJSON)}})),this.mainOptions.designsJSON&&("object"==typeof this.mainOptions.productsJSON?this.setupDesigns(this.mainOptions.designsJSON):w({url:this.mainOptions.designsJSON,onSuccess:e=>{this.setupDesigns(e)},onError:()=>{alert("Design JSON could not be loaded. Please check that your URL is correct! URL: "+this.mainOptions.designsJSON)}})),this.mainOptions.keyboardControl&&l(document,"keydown",(e=>{if(this.currentViewInstance&&this.currentViewInstance.fabricCanvas){const t=this.currentViewInstance,n=e.target.nodeName,i=t.fabricCanvas.getActiveObject();if(i&&!["TEXTAREA","INPUT"].includes(n)){switch(e.which){case 8:i.removable&&t.fabricCanvas.removeElement(i);break;case 37:i.draggable&&t.fabricCanvas.setElementParameters({left:i.left-1});break;case 38:i.draggable&&t.fabricCanvas.setElementParameters({top:i.top-1});break;case 39:i.draggable&&t.fabricCanvas.setElementParameters({left:i.left+1});break;case 40:i.draggable&&t.fabricCanvas.setElementParameters({top:i.top+1});break;default:return}e.preventDefault()}}}));let e=0;window.addEventListener("resize",(t=>{window.innerWidth===e||this.#me||(e=window.innerWidth,this.currentViewInstance&&this.currentViewInstance.fabricCanvas.resetSize(),this.currentElement&&!["INPUT","TEXTAREA"].includes(document.activeElement)&&this.deselectElement())})),l(this,["productCreate","layoutElementsAdded"],this.#Ee.bind(this));let t=!1;if(l(document.body,"mousedown",(e=>{})),l(document.body,["focusin","blur"],(e=>{["TEXTAREA","INPUT"].includes(e.target.nodeName)&&(this.#me="focusin"==e.type)}),!0),l(document.body,["mouseup","touchend"],(e=>{let n=Array.from(document.querySelectorAll(".fpd-container"));Boolean(n.find((t=>t.contains(e.target))))||!this.mainOptions.deselectActiveOnOutside||t||this.deselectElement(),t=!1}),!0),this.mainOptions.dragDropImagesToUploadZones){let e=null;l(document.body,["mousedown","touchstart"],(t=>{if(1==t.which){const n=t.target;n.classList.contains("fpd-draggable")&&(e=n,this.draggedPlaceholder=document.createElement("div"),this.draggedPlaceholder.className="fpd-dragged-image fpd-shadow-1 fpd-hidden",this.draggedPlaceholder.style.backgroundImage=`url("${n.querySelector("picture").dataset.img}")`,document.body.append(this.draggedPlaceholder))}})),l(document.body,["mousemove"],(t=>{this.draggedPlaceholder&&(this.draggedPlaceholder.style.left=t.pageX-.5*e.offsetWidth+"px",this.draggedPlaceholder.style.top=t.pageY-.5*e.offsetHeight+"px",d(this.draggedPlaceholder,["fpd-hidden"]),setTimeout((()=>{this.draggedPlaceholder&&c(this.draggedPlaceholder,["fpd-animate"])}),1),t.stopPropagation(),t.preventDefault())})),l(document.body,["mouseup"],(t=>{this.draggedPlaceholder&&(this.draggedPlaceholder.remove(),this.draggedPlaceholder=null),!this.loadingCustomImage&&e&&this.mouseOverCanvas&&this._addGridItemToCanvas(e,this.mouseOverCanvas.uploadZone?{_addToUZ:this.mouseOverCanvas.title}:{}),e=null,this.mouseOverCanvas=!1}))}"string"==typeof this.mainOptions.editorMode&&new fe(this)}#Ee(){const e=this.globalCustomElements.concat(this.fixedElements);if(!e.length)return;let t=0;const n=e=>{const t=this.viewInstances[e.viewIndex];if(t){const n=e.element;let i=Object.keys(this.mainOptions.elementParameters);i="text"===n.getType()?i.concat(Object.keys(this.mainOptions.textParameters)):i.concat(Object.keys(this.mainOptions.imageParameters));let s=n.getElementJSON(!1,i);s._printingBox&&delete s.boundingBox,t.fabricCanvas.addElement(n.getType(),n.source,n.title,s)}else i()},i=()=>{t++,t<e.length?n(e[t]):this.removeEventListener("elementAdd",i)};l(this,"elementAdd",i),e[0]&&n(e[0])}#xe(e){var t=this.products.findIndex((t=>t.category===e));return-1!==t&&t}setupProducts(e=[]){this.products=[],e.forEach((e=>{e.hasOwnProperty("category")?e.products.forEach((t=>{this.addProduct(t,e.category)})):this.addProduct(e)})),this.mainOptions.loadFirstProductInStage&&e.length>0?this.selectProduct(0):this.toggleSpinner(!1),this.dispatchEvent(new CustomEvent("productsSet"))}setupDesigns(e){this.designs=e,this.dispatchEvent(new CustomEvent("designsSet"))}addProduct(e,t){var n=this.#xe(t);void 0===t?this.products.push(e):(!1===n&&(n=this.products.length,this.products[n]={category:t,products:[]}),this.products[n].products.push(e)),this.dispatchEvent(new CustomEvent("productAdd",{detail:{views:e,category:t,catIndex:n}}))}selectProduct(e,t){let n;this.currentCategoryIndex=void 0===t?this.currentCategoryIndex:t,n=this.products&&this.products.length&&this.products[0].category?this.products[this.currentCategoryIndex].products:instance.products,this.currentProductIndex=e,e<0?this.currentProductIndex=0:e>n.length-1&&(this.currentProductIndex=n.length-1);const i=n[this.currentProductIndex];this.dispatchEvent(new CustomEvent("productSelect",{detail:{product:i}})),this.loadProduct(i,this.mainOptions.replaceInitialElements)}loadProduct(e,t=!1,n=!1){e&&(this.toggleSpinner(!0),this.productCreated=!1,this.colorLinkGroups={},this.globalCustomElements=[],t?this.globalCustomElements=this.getCustomElements():this.doUnsavedAlert=!1,this.fixedElements=this.getFixedElements(),this.reset(),n&&e.forEach(((e,t)=>{e.options=y.merge(this.mainOptions,e.options)})),this.currentViews=e,this.#fe=this.#ge=0,e.forEach(((e,t)=>{this.#fe+=e.elements.length})),l(this,"viewCreate",this.#Ce),e&&this.addView(e[0]))}addView(e){const n=ge.proxyFileServer?ge.proxyFileServer+e.thumbnail:e.thumbnail,i=document.createElement("div");i.className="fpd-shadow-1 fpd-item",i.title=e.title,i.innerHTML='<picture style="background-image: url('+n+');"></picture>',this.viewsWrapper.container.querySelector(".fpd-views-selection").append(i),l(i,"click",(e=>{const t=Array.from(this.viewsWrapper.container.querySelectorAll(".fpd-views-selection > div")).indexOf(i);this.selectView(t)}));let a={};C.relevantOptions.forEach((e=>{let n=this.mainOptions[e];a[e]=t(n)?{...n}:n})),e.options=t(e.options)?s(a,e.options):a;let o=new C(this.productStage,e,this.#we.bind(this),this.mainOptions.fabricCanvasOptions);o.fabricCanvas.on({"mouse:move":e=>{this.mouseOverCanvas=!e.target||e.target},"mouse:out":e=>{this.mouseOverCanvas=!1},beforeElementAdd:e=>{if(!this.productCreated){this.#ge++;const t=e.title+"<br>"+String(this.#ge)+"/"+this.#fe;this.mainLoader.querySelector(".fpd-loader-text").innerHTML=t}this.dispatchEvent(new CustomEvent("beforeElementAdd",{detail:{element:e}}))},elementAdd:({element:e})=>{if(e){if(this.productCreated&&"image"==e.getType()&&e.isCustom&&(this.toggleSpinner(!1),j(this.translator.getTranslation("misc","image_added"))),e.replace&&e.replaceInAllViews&&this.viewInstances.forEach(((t,n)=>{this.currentViewIndex!=n&&t.fabricCanvas.getElementByReplace(e.replace)&&!e._replaceAdded&&t.fabricCanvas.addElement(e.getType(),e.source,e.title,{...e.originParams,_replaceAdded:!0})})),e.colorLinkGroup&&e.colorLinkGroup.length>0&&!this.mainOptions.editorMode){var t=this.getViewIndexByWrapper(o.fabricCanvas.wrapperEl);if(this.colorLinkGroups.hasOwnProperty(e.colorLinkGroup)){if(this.colorLinkGroups[e.colorLinkGroup].elements.push({id:e.id,viewIndex:t}),"object"==typeof e.colors){const t=this.mainOptions.replaceColorsInColorGroup?e.colors:this.colorLinkGroups[e.colorLinkGroup].colors.concat(e.colors);this.colorLinkGroups[e.colorLinkGroup].colors=(e=>{for(var t=e.concat(),n=0;n<t.length;++n)for(var i=n+1;i<t.length;++i)t[n]===t[i]&&t.splice(i--,1);return t})(t)}}else this.colorLinkGroups[e.colorLinkGroup]={elements:[{id:e.id,viewIndex:t}],colors:[]},"object"==typeof e.colors&&(this.colorLinkGroups[e.colorLinkGroup].colors=e.colors)}this.productCreated&&this.mainOptions.hideDialogOnAdd&&this.mainBar&&this.mainBar.toggleContentDisplay(!1),this.dispatchEvent(new CustomEvent("elementAdd",{detail:{element:e}})),this.dispatchEvent(new CustomEvent("viewCanvasUpdate",{detail:{viewInstance:o}}))}else this.toggleSpinner(!1)},elementRemove:({element:e})=>{this.dispatchEvent(new CustomEvent("elementRemove",{detail:{element:e}})),this.dispatchEvent(new CustomEvent("viewCanvasUpdate",{detail:{viewInstance:o}}))},elementSelect:({element:e})=>{if(this.currentElement=e,this.#Ie(),e&&!e._ignore&&this.currentViewInstance){if(e.uploadZone&&!this.mainOptions.editorMode){let t=s(this.currentViewInstance.options.customAdds,e.customAdds||{});return void setTimeout((()=>{this.currentViewInstance.currentUploadZone=e.title,this.mainBar.toggleUploadZonePanel(!0,t)}),100)}this.currentViewInstance.currentUploadZone&&this.mainBar.toggleUploadZonePanel(!1)}this.dispatchEvent(new CustomEvent("elementSelect"))},elementCheckContainemt:({target:e,boundingBoxMode:t})=>{"inside"===t&&this.#Ie()},elementColorChange:({element:e,colorLinking:t})=>{if(this.productCreated&&t&&e.colorLinkGroup&&e.colorLinkGroup.length>0){const t=this.colorLinkGroups[e.colorLinkGroup];t&&t.elements&&t.elements.forEach((t=>{if(e.id,t.id){const n=this.viewInstances[t.viewIndex].fabricCanvas.getElementByID(t.id);n&&n.changeColor(e.fill,!1)}}))}this.dispatchEvent(new CustomEvent("elementColorChange",{detail:{element:e,colorLinking:t}})),this.dispatchEvent(new CustomEvent("viewCanvasUpdate",{detail:{viewInstance:o}}))},elementChange:({element:e,type:t})=>{this.#Ie(),this.dispatchEvent(new CustomEvent("elementChange",{detail:{type:t,element:e}}))},elementModify:({element:e,options:t})=>{this.applyTextLinkGroup(e,t),this.dispatchEvent(new CustomEvent("elementModify",{detail:{options:t,element:e}}))},"text:changed":({target:e})=>{this.applyTextLinkGroup(e,{text:e.text})}}),o.init()}#Ce(){this.viewInstances.length<this.currentViews.length?this.addView(this.currentViews[this.viewInstances.length]):(this.removeEventListener("viewCreate",this.#Ce),this.toggleSpinner(!1),this.selectView(0),!this.mainOptions.editorMode&&this.currentViewInstance&&this.currentViewInstance.fabricCanvas.wrapperEl.offsetParent&&this.doAutoSelect(),this.productCreated=!0,this.dispatchEvent(new CustomEvent("productCreate")))}doAutoSelect(){let e=null;this.currentViewInstance.fabricCanvas.getObjects().forEach((t=>{t.autoSelect&&!t.hasUploadZone&&(e=t)})),e&&setTimeout((()=>{this.currentViewInstance.fabricCanvas.setActiveObject(e)}),500)}#we(e){e.fabricCanvas.wrapperEl.parentNode&&(this.viewInstances.push(e),e.fabricCanvas.on("sizeUpdate",(({canvasHeight:e})=>{let t=e+"px";this.productStage.style.height=t,this.container.classList.contains("fpd-sidebar")&&(this.mainBar.container.style.height=t)})),this.dispatchEvent(new CustomEvent("viewCreate",{detail:{viewInstance:e}})),e.fabricCanvas.onHistory(),e.fabricCanvas.clearHistory())}#Ie(){const e=this.currentElement;if(this.productCreated&&e&&!e.uploadZone&&!e.__editorMode){if(e.isOut&&"inside"===e.boundingBoxMode){const e=this.translator.getTranslation("misc","out_of_bounding_box");this.mainTooltip.innerHTML=e,this.mainTooltip.classList.add("fpd-show")}else this.mainOptions.imageSizeTooltip&&"image"===e.getType()?(this.mainTooltip.innerText=parseInt(e.width*e.scaleX)+" x "+parseInt(e.height*e.scaleY),this.mainTooltip.classList.add("fpd-show")):this.mainTooltip.classList.remove("fpd-show");if(this.mainTooltip.classList.contains("fpd-show")){const t=e.oCoords,n=this.currentViewInstance.fabricCanvas.wrapperEl.getBoundingClientRect();this.mainTooltip.style.left=n.left+t.mt.x-this.mainTooltip.clientWidth/2+"px",this.mainTooltip.style.top=n.top+t.mt.y-this.mainTooltip.clientHeight-20+"px"}}else this.mainTooltip.classList.remove("fpd-show")}applyTextLinkGroup(e,t={}){if(e&&!h(e.textLinkGroup)){const n=this.mainOptions.textLinkGroupProps||[];this.viewInstances.forEach((i=>{i.fabricCanvas.getObjects().forEach((s=>{s!==e&&"text"===s.getType()&&s.textLinkGroup===e.textLinkGroup&&(t.text&&(s.set("text",e.text),this.dispatchEvent(new CustomEvent("textLinkApply",{detail:{element:s,options:{text:e.text}}}))),Object.keys(t).filter((e=>n.includes(e))).forEach((t=>{s.set(t,e[t]),this.dispatchEvent(new CustomEvent("textLinkApply",{detail:{element:s,options:{[t]:e[t]}}}))})),i.fabricCanvas.renderAll())}))}))}}getViewIndexByWrapper(e){return Array.from(this.productStage.querySelectorAll(".fpd-view-stage")).indexOf(e)}toggleSpinner(e=!0,t=""){return this.mainLoader.querySelector(".fpd-loader-text").innerText=t,this.mainLoader.classList.toggle("fpd-hidden",!e),this.mainLoader}selectView(e=0){if(this.viewInstances.length<=0)return;this.currentViewInstance&&this.currentViewInstance.fabricCanvas&&this.currentViewInstance.fabricCanvas.resetZoom(),this.currentViewIndex=e,e<0?this.currentViewIndex=0:e>this.viewInstances.length-1&&(this.currentViewIndex=this.viewInstances.length-1),this.currentViewInstance&&this.currentViewInstance.fabricCanvas&&this.currentViewInstance.fabricCanvas.clearHistory(),this.currentViewInstance=this.viewInstances[this.currentViewIndex],this.deselectElement();const t=this.productStage.querySelectorAll(".fpd-view-stage");c(t,["fpd-hidden"]),d(t.item(this.currentViewIndex),["fpd-hidden"]),this.currentViewInstance.fabricCanvas.resetSize(),this.dispatchEvent(new CustomEvent("viewSelect"))}getElements(e,t="all",n=!0){e=void 0===e||isNaN(e)?-1:e,n&&this.deselectElement();let i=[];if(-1===e)for(var s=0;s<this.viewInstances.length;++s)i=i.concat(this.viewInstances[s].fabricCanvas.getObjects());else{if(!this.viewInstances[e])return[];i=this.viewInstances[e].fabricCanvas.getObjects()}if(i=i.filter((e=>!e._ignore)),"text"===t){let e=[];return i.forEach((t=>{"text"===t.getType(t)&&e.push(t)})),e}if("image"===t){let e=[];return i.forEach((function(t){"image"===t.getType()&&e.push(t)})),e}return i}getCustomElements(e="all",t=-1,n=!0){let i=[];return this.getElements(t,e,n).forEach((e=>{if(e.isCustom){const t=this.getViewIndexByWrapper(e.canvas.wrapperEl);i.push({element:e,viewIndex:t})}})),i}getFixedElements(e="all",t=-1,n=!0){let i=[];return this.getElements(t,e,n).forEach((e=>{if(e.fixed){const t=this.getViewIndexByWrapper(e.canvas.wrapperEl);i.push({element:e,viewIndex:t})}})),i}getElementByID(e,t){return t=void 0===t?this.currentViewIndex:t,this.viewInstances[t]?this.viewInstances[t].fabricCanvas.getElementByID(e):null}reset(){null!==this.currentViews&&(this.removeEventListener("viewCreate",this.#Ce),this.deselectElement(),this.currentViewInstance&&this.currentViewInstance.fabricCanvas.resetZoom(),this.currentViewIndex=this.currentPrice=this.singleProductPrice=this.pricingRulesPrice=0,this.currentViewInstance=this.currentViews=this.currentElement=null,this.viewInstances.forEach((e=>{e.fabricCanvas.clear()})),this.productStage.innerHTML="",this.viewsWrapper.container.querySelector(".fpd-views-selection").innerHTML="",this.viewInstances=[],this.dispatchEvent(new CustomEvent("clear")),this.dispatchEvent(new CustomEvent("priceChange")))}deselectElement(){this.currentViewInstance&&this.currentViewInstance.fabricCanvas&&(this.currentViewInstance.fabricCanvas.deselectElement(),this.currentElement=null)}formatPrice(e){const t=this.mainOptions.priceFormat;if(e&&"object"==typeof t){const i=t.thousandSep,s=t.decimalSep;let a=e.toString().split("."),o=a[0],r=a[1],l="";if(void 0!==o){for(var n=o.length-1;n>=0;n--)l+=o.charAt(n);for(l=l.replace(/(\d{3})/g,"$1"+i),l.slice(-i.length)==i&&(l=l.slice(0,-i.length)),o="",n=l.length-1;n>=0;n--)o+=l.charAt(n);void 0!==r&&r.length>0&&(1==r.length&&(r+="0"),o+=s+r)}return o=t.currency.replace("%d",o.toString()),o}return e&&(e=t.priceFormat.replace("%d",e)),e}addCustomImage(e,t,n={},i){i=void 0===i?this.currentViewIndex:i;const a=new Image;a.crossOrigin="anonymous",a.src=e,this.toggleSpinner(!0,this.translator.getTranslation("misc","loading_image")),c(this.viewsWrapper.container,["fpd-disabled"]),a.onload=()=>{this.loadingCustomImage=!1;let o=a.height,r=a.width,l=this.currentViewInstance.options.customImageParameters;if(!v(this,r,o))return this.toggleSpinner(!1),!1;let c={isCustom:!0};a.src.includes(".svg")&&!l.colors&&(c.colors=!0);let p=s(l,c);p=s(p,n),this.viewInstances[i].fabricCanvas.addElement("image",e,t,p,i),d(this.viewsWrapper.container,["fpd-disabled"])},a.onerror=()=>{d(this.viewsWrapper.container,["fpd-disabled"]),j("Image could not be loaded!")}}_addGridItemToCanvas(e,t={},n,i=!0){if(!this.currentViewInstance)return;n=void 0===n?this.currentViewIndex:n;const a=s({_addToUZ:this.currentViewInstance.currentUploadZone},t);this._addCanvasImage(e.dataset.source,e.dataset.title,a,n,i)}_addCanvasImage(e,t,n={},i,s=!0){this.currentViewInstance&&(i=void 0===i?this.currentViewIndex:i,ge.uploadsToServer&&s?this._downloadRemoteImage(e,t,n):(this.loadingCustomImage=!0,this.addCustomImage(e,t,n,i)))}_downloadRemoteImage(e,t,n={}){if(!this.mainOptions.fileServerURL)return void alert("You need to set the fileServerURL in the option, otherwise file uploading does not work!");this.loadingCustomImage=!0,this.toggleSpinner(!0,this.translator.getTranslation("misc","loading_image")),c(this.viewsWrapper.container,["fpd-disabled"]);const i=new FormData;i.append("url",e);const s=e=>{d(this.viewsWrapper.container,["fpd-disabled"]),this.toggleSpinner(!1),j(e)};(e=>{let t=e.url,n={Accept:"application/json"};!e.body instanceof FormData&&(n["Content-Type"]="application/json"),fetch(t,{method:"POST",redirect:"follow",headers:n,body:e.body instanceof FormData?e.body:JSON.stringify(e.body)}).then((e=>e.json())).then((t=>{e.onSuccess&&e.onSuccess(t)})).catch((t=>{e.onError&&e.onError(t)}))})({url:this.mainOptions.fileServerURL,body:i,onSuccess:e=>{e&&e.image_src?this.addCustomImage(e.image_src,e.filename?e.filename:t,n):s(e.error)},onError:s})}addCanvasDesign(e,t,n={},i){this.currentViewInstance&&(this.toggleSpinner(!0,this.translator.getTranslation("misc","loading_image")),(n=s(this.currentViewInstance.options.customImageParameters,n)).isCustom=!0,this.currentViewInstance.currentUploadZone&&(n._addToUZ=this.currentViewInstance.currentUploadZone),this.currentViewInstance.fabricCanvas.addElement("image",e,t,n,i))}toggleResponsive(e){return e=void 0===e?this.container.classList.contains("fpd-not-responsive"):e,p(this.container,["fpd-not-responsive"],!e),this.viewInstances.forEach(((t,n)=>{t.options.responsive=e,n==this.currentViewIndex&&t.fabricCanvas.resetSize()})),e}getProduct(e=!1,t=!1){let n=!1,i="all"==this.mainOptions.customizationRequiredRule?"every":"some";if(n=this.viewInstances[i]((e=>e.isCustomized)),t&&!n)return j(this.translator.getTranslation("misc","customization_required_info")),!1;this.deselectElement(),this.currentViewInstance.fabricCanvas.resetZoom(),this.doUnsavedAlert=!1;let s=[];if(this.getElements().forEach((e=>{e.isOut&&"inside"===e.boundingBoxMode&&!e.__editorMode&&(j(e.title+": "+this.translator.getTranslation("misc","out_of_bounding_box")),s=!1)})),!1===s)return!1;for(var a=0;a<this.viewInstances.length;++a){let t=this.viewInstances[a],n=t.options,i=t.fabricCanvas.getObjects(),l=[];for(var o=0;o<i.length;++o){const t=i[o];if(void 0!==t.title&&void 0!==t.source){var r={title:t.title,source:t.source,parameters:t.getElementJSON(),type:t.getType()};if(n.printingBox&&n.printingBox.hasOwnProperty("left")&&n.printingBox.hasOwnProperty("top")){let e=t.getPointByOrigin("left","top");r.printingBoxCoords={left:e.x-n.printingBox.left,top:e.y-n.printingBox.top}}e?t.isEditable&&l.push(r):l.push(r)}}const c={title:t.title,thumbnail:t.thumbnail,elements:l,options:n,names_numbers:t.names_numbers,mask:t.mask,locked:t.locked};0==a&&this.currentViews[0].hasOwnProperty("productTitle")&&(c.productTitle=this.currentViews[0].productTitle),s.push(c)}return s}}window.FancyProductDesigner=ge,window.FPDEmojisRegex=/(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC69\uDC6E\uDC70-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD26\uDD30-\uDD39\uDD3D\uDD3E\uDDD1-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])?|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDEEB\uDEEC\uDEF4-\uDEF8]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD4C\uDD50-\uDD6B\uDD80-\uDD97\uDDC0\uDDD0-\uDDE6])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267B\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEF8]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD4C\uDD50-\uDD6B\uDD80-\uDD97\uDDC0\uDDD0-\uDDE6])\uFE0F/g})()})();