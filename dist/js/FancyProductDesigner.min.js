function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function createPngDataTable(){for(var t=new Int32Array(256),e=0;e<256;e++){for(var i=e,n=0;n<8;n++)i=1&i?3988292384^i>>>1:i>>>1;t[e]=i}return t}function calcCrc(t){var e=-1;pngDataTable=pngDataTable||createPngDataTable();for(var i=0;i<t.length;i++)e=pngDataTable[255&(e^t[i])]^e>>>8;return-1^e}var pngDataTable=void 0,PNG="image/png",JPEG="image/jpeg",b64PhysSignature1="AAlwSFlz",b64PhysSignature2="AAAJcEhZ",b64PhysSignature3="AAAACXBI",_P="p".charCodeAt(0),_H="H".charCodeAt(0),_Y="Y".charCodeAt(0),_S="s".charCodeAt(0);function changeDpiBlob(o,a){var e=o.slice(0,33);return new Promise(function(i,t){var n=new FileReader;n.onload=function(){var t=new Uint8Array(n.result),e=o.slice(33),t=changeDpiOnArray(t,a,o.type);i(new Blob([t,e],{type:o.type}))},n.readAsArrayBuffer(e)})}function changeDpiDataUrl(t,e){for(var i=(t=t.split(","))[0],t=t[1],n=void 0,o=void 0,a=!1,r=(-1!==i.indexOf(PNG)&&(n=PNG,0<=(r=detectPhysChunkFromDataUrl(t))?(o=4*Math.ceil((r+28)/3),a=!0):o=44),-1!==i.indexOf(JPEG)&&(n=JPEG,o=24),t.substring(0,o)),t=t.substring(o),s=atob(r),l=new Uint8Array(s.length),h=0;h<l.length;h++)l[h]=s.charCodeAt(h);return o=changeDpiOnArray(l,e,n,a),[i,",",btoa(String.fromCharCode.apply(String,_toConsumableArray(o))),t].join("")}function detectPhysChunkFromDataUrl(t){var e=t.indexOf(b64PhysSignature1);return-1===(e=-1===e?t.indexOf(b64PhysSignature2):e)?t.indexOf(b64PhysSignature3):e}function searchStartOfPhys(t){for(var e=t.length-1;4<=e;e--)if(9===t[e-4]&&t[e-3]===_P&&t[e-2]===_H&&t[e-1]===_Y&&t[e]===_S)return e-3}function changeDpiOnArray(t,e,i,n){var o;return i===JPEG?(t[13]=1,t[14]=e>>8,t[15]=255&e,t[16]=e>>8,t[17]=255&e,t):i===PNG?(e*=39.3701,(i=new Uint8Array(13))[0]=_P,i[1]=_H,i[2]=_Y,i[3]=_S,i[4]=e>>>24,i[5]=e>>>16,i[6]=e>>>8,i[7]=255&e,i[8]=i[4],i[9]=i[5],i[10]=i[6],i[11]=i[7],i[12]=1,e=calcCrc(i),(o=new Uint8Array(4))[0]=e>>>24,o[1]=e>>>16,o[2]=e>>>8,o[3]=255&e,n?(e=searchStartOfPhys(t),t.set(i,e),t.set(o,e+13),t):((n=new Uint8Array(4))[0]=0,n[1]=0,n[2]=0,n[3]=9,(e=new Uint8Array(54)).set(t,0),e.set(n,33),e.set(i,37),e.set(o,50),e)):void 0}if(!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.download=e()}(this,function(){return function e(t,i,n){function o(t){return String(t)}var a=window,r="application/octet-stream",s=n||r,n=!i&&!n&&t,l=document.createElement("a"),h=a.Blob||a.MozBlob||a.WebKitBlob||o,u=i||"download",h=h.call?h.bind(a):Blob;if("true"===String(this)&&(s=(t=[t,s])[0],t=t[1]),n&&n.length<2048){var d,u=n.split("/").pop().split("?")[0];if(l.href=n,-1!==l.href.indexOf(n))return(d=new XMLHttpRequest).open("GET",n,!0),d.responseType="blob",d.onload=function(t){e(t.target.response,u,r)},setTimeout(function(){d.send()},0),d}if(/^data\:[\w+\-]+\/[\w+\-]+[,;]/.test(t)){if(!(2096103.424<t.length&&h!==o))return navigator.msSaveBlob?navigator.msSaveBlob(c(t),u):p(t);s=(t=c(t)).type||r}function c(t){for(var e=(t=t.split(/[:;,]/))[1],i=("base64"==t[2]?atob:decodeURIComponent)(t.pop()),n=i.length,o=0,a=new Uint8Array(n);o<n;++o)a[o]=i.charCodeAt(o);return new h([a],{type:e})}function p(t,e){var i;return"download"in l?(l.href=t,l.setAttribute("download",u),l.className="download-js-link",l.innerHTML="downloading...",l.style.display="none",document.body.appendChild(l),setTimeout(function(){l.click(),document.body.removeChild(l),!0===e&&setTimeout(function(){a.URL.revokeObjectURL(l.href)},250)},66),!0):/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent)?(t=t.replace(/^data:([\w\/\-\+]+)/,r),window.open(t)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0):(i=document.createElement("iframe"),document.body.appendChild(i),e||(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,r)),i.src=t,void setTimeout(function(){document.body.removeChild(i)},333))}if(i=t instanceof h?t:new h([t],{type:s}),navigator.msSaveBlob)return navigator.msSaveBlob(i,u);if(a.URL)p(a.URL.createObjectURL(i),!0);else{if("string"==typeof i||i.constructor===o)try{return p("data:"+s+";base64,"+a.btoa(i))}catch(t){return p("data:"+s+","+encodeURIComponent(i))}(n=new FileReader).onload=function(t){p(this.result)},n.readAsDataURL(i)}return!0}}),this.JpegMeta)throw Error("Library included multiple times");var JpegMeta={stringIsClean:function(t){for(var e=0;e<t.length;e++)if(t.charCodeAt(e)<32)return!1;return!0},parseNum:function(t,e,i,n){var o,a,r=">"===t;for(void 0===i&&(i=0),void 0===n&&(n=e.length-i),o=r?i:i+n-1;r?o<i+n:i<=o;r?o++:o--)a=(a<<=8)+e.charCodeAt(o);return a},parseSnum:function(t,e,i,n){var o,a,r,s=">"===t;for(void 0===i&&(i=0),void 0===n&&(n=e.length-i),o=s?i:i+n-1;s?o<i+n:i<=o;s?o++:o--)a=(a<<=8)+((r=void 0===r?128==(128&e.charCodeAt(o)):r)?255&~e.charCodeAt(o):e.charCodeAt(o));return r?-1*(a+1):a},Rational:function(t,e){return this.num=t,this.den=e||1,this}};JpegMeta.Rational.prototype.toString=function(){return 0===this.num||1===this.den?""+this.num:1===this.num?this.num+" / "+this.den:this.num/this.den},JpegMeta.Rational.prototype.asFloat=function(){return this.num/this.den},JpegMeta.MetaGroup=function(t,e){return this.fieldName=t,this.description=e,this.metaProps={},this},JpegMeta.MetaGroup.prototype._addProperty=function(t,e,i){this[(t=new JpegMeta.MetaProp(t,e,i)).fieldName]=t,this.metaProps[t.fieldName]=t},JpegMeta.MetaGroup.prototype.toString=function(){return"[MetaGroup "+this.description+"]"},JpegMeta.MetaProp=function(t,e,i){return this.fieldName=t,this.description=e,this.value=i,this},JpegMeta.MetaProp.prototype.toString=function(){return""+this.value},this.JpegMeta.JpegFile=function(t,e){var i,n,o,a=this._SOS,r=(this.metaGroups={},this._binary_data=t,this.filename=e,0);if(this._binary_data.slice(0,2)!==this._SOI_MARKER)throw new Error("Doesn't look like a JPEG file. First two bytes are "+this._binary_data.charCodeAt(0)+","+this._binary_data.charCodeAt(1)+".");for(r+=2;r<this._binary_data.length&&(o=this._binary_data.charCodeAt(r++),n=this._binary_data.charCodeAt(r++),i=r,o==this._DELIM)&&n!==a;){for(r+=JpegMeta.parseNum(">",this._binary_data,r,2);r<this._binary_data.length;)if(this._binary_data.charCodeAt(r++)==this._DELIM&&0!=this._binary_data.charCodeAt(r++)){r-=2;break}(o=this._markers[n]?(this._markers[n][0],this._markers[n][1]):void 0)&&this[o](n,i+2,r-i-2)}if(void 0===this.general)throw Error("Invalid JPEG file.");return this},this.JpegMeta.JpegFile.prototype.toString=function(){return"[JpegFile "+this.filename+" "+this.general.type+" "+this.general.pixelWidth+"x"+this.general.pixelHeight+" Depth: "+this.general.depth+"]"},this.JpegMeta.JpegFile.prototype._SOI_MARKER="ÿØ",this.JpegMeta.JpegFile.prototype._DELIM=255,this.JpegMeta.JpegFile.prototype._EOI=217,this.JpegMeta.JpegFile.prototype._SOS=218,this.JpegMeta.JpegFile.prototype._sofHandler=function(t,e){if(void 0!==this.general)throw Error("Unexpected multiple-frame image");this._addMetaGroup("general","General"),this.general._addProperty("depth","Depth",JpegMeta.parseNum(">",this._binary_data,e,1)),this.general._addProperty("pixelHeight","Pixel Height",JpegMeta.parseNum(">",this._binary_data,e+1,2)),this.general._addProperty("pixelWidth","Pixel Width",JpegMeta.parseNum(">",this._binary_data,e+3,2)),this.general._addProperty("type","Type",this._markers[t][2])},this.JpegMeta.JpegFile.prototype._commentHandler=function(t,e,i){var n,o;for(i--,n=++e,o="";n<e+i;)o+=String.fromCharCode(this._binary_data.charCodeAt(n)),n++;this._addMetaGroup("comment","Comment"),this.comment._addProperty("comment","Comment",o)},this.JpegMeta.JpegFile.prototype._JFIF_IDENT="JFIF\0",this.JpegMeta.JpegFile.prototype._JFXX_IDENT="JFXX\0",this.JpegMeta.JpegFile.prototype._EXIF_IDENT="Exif\0",this.JpegMeta.JpegFile.prototype._types={1:["BYTE",1],2:["ASCII",1],3:["SHORT",2],4:["LONG",4],5:["RATIONAL",8],6:["SBYTE",1],7:["UNDEFINED",1],8:["SSHORT",2],9:["SLONG",4],10:["SRATIONAL",8],11:["FLOAT",4],12:["DOUBLE",8]},this.JpegMeta.JpegFile.prototype._tifftags={256:["Image width","ImageWidth"],257:["Image height","ImageLength"],258:["Number of bits per component","BitsPerSample"],259:["Compression scheme","Compression",{1:"uncompressed",6:"JPEG compression"}],262:["Pixel composition","PhotmetricInerpretation",{2:"RGB",6:"YCbCr"}],274:["Orientation of image","Orientation",{1:"Normal",2:"Reverse?",3:"Upside-down",4:"Upside-down Reverse",5:"90 degree CW",6:"90 degree CW reverse",7:"90 degree CCW",8:"90 degree CCW reverse"}],277:["Number of components","SamplesPerPixel"],284:["Image data arrangement","PlanarConfiguration",{1:"chunky format",2:"planar format"}],530:["Subsampling ratio of Y to C","YCbCrSubSampling"],531:["Y and C positioning","YCbCrPositioning",{1:"centered",2:"co-sited"}],282:["X Resolution","XResolution"],283:["Y Resolution","YResolution"],296:["Resolution Unit","ResolutionUnit",{2:"inches",3:"centimeters"}],273:["Image data location","StripOffsets"],278:["Number of rows per strip","RowsPerStrip"],279:["Bytes per compressed strip","StripByteCounts"],513:["Offset to JPEG SOI","JPEGInterchangeFormat"],514:["Bytes of JPEG Data","JPEGInterchangeFormatLength"],301:["Transfer function","TransferFunction"],318:["White point chromaticity","WhitePoint"],319:["Chromaticities of primaries","PrimaryChromaticities"],529:["Color space transformation matrix coefficients","YCbCrCoefficients"],532:["Pair of black and white reference values","ReferenceBlackWhite"],306:["Date and time","DateTime"],270:["Image title","ImageDescription"],271:["Make","Make"],272:["Model","Model"],305:["Software","Software"],315:["Person who created the image","Artist"],316:["Host Computer","HostComputer"],33432:["Copyright holder","Copyright"],34665:["Exif tag","ExifIfdPointer"],34853:["GPS tag","GPSInfoIfdPointer"]},this.JpegMeta.JpegFile.prototype._exiftags={36864:["Exif Version","ExifVersion"],40960:["FlashPix Version","FlashpixVersion"],40961:["Color Space","ColorSpace"],37121:["Meaning of each component","ComponentsConfiguration"],37122:["Compressed Bits Per Pixel","CompressedBitsPerPixel"],40962:["Pixel X Dimension","PixelXDimension"],40963:["Pixel Y Dimension","PixelYDimension"],37500:["Manufacturer notes","MakerNote"],37510:["User comments","UserComment"],40964:["Related audio file","RelatedSoundFile"],36867:["Date Time Original","DateTimeOriginal"],36868:["Date Time Digitized","DateTimeDigitized"],37520:["DateTime subseconds","SubSecTime"],37521:["DateTimeOriginal subseconds","SubSecTimeOriginal"],37522:["DateTimeDigitized subseconds","SubSecTimeDigitized"],33434:["Exposure time","ExposureTime"],33437:["FNumber","FNumber"],34850:["Exposure program","ExposureProgram"],34852:["Spectral sensitivity","SpectralSensitivity"],34855:["ISO Speed Ratings","ISOSpeedRatings"],34856:["Optoelectric coefficient","OECF"],37377:["Shutter Speed","ShutterSpeedValue"],37378:["Aperture Value","ApertureValue"],37379:["Brightness","BrightnessValue"],37380:["Exposure Bias Value","ExposureBiasValue"],37381:["Max Aperture Value","MaxApertureValue"],37382:["Subject Distance","SubjectDistance"],37383:["Metering Mode","MeteringMode"],37384:["Light Source","LightSource"],37385:["Flash","Flash"],37386:["Focal Length","FocalLength"],37396:["Subject Area","SubjectArea"],41483:["Flash Energy","FlashEnergy"],41484:["Spatial Frequency Response","SpatialFrequencyResponse"],41486:["Focal Plane X Resolution","FocalPlaneXResolution"],41487:["Focal Plane Y Resolution","FocalPlaneYResolution"],41488:["Focal Plane Resolution Unit","FocalPlaneResolutionUnit"],41492:["Subject Location","SubjectLocation"],41493:["Exposure Index","ExposureIndex"],41495:["Sensing Method","SensingMethod"],41728:["File Source","FileSource"],41729:["Scene Type","SceneType"],41730:["CFA Pattern","CFAPattern"],41985:["Custom Rendered","CustomRendered"],41986:["Exposure Mode","Exposure Mode"],41987:["White Balance","WhiteBalance"],41988:["Digital Zoom Ratio","DigitalZoomRatio"],41989:["Focal length in 35 mm film","FocalLengthIn35mmFilm"],41990:["Scene Capture Type","SceneCaptureType"],41991:["Gain Control","GainControl"],41992:["Contrast","Contrast"],41993:["Saturation","Saturation"],41994:["Sharpness","Sharpness"],41995:["Device settings description","DeviceSettingDescription"],41996:["Subject distance range","SubjectDistanceRange"],42016:["Unique image ID","ImageUniqueID"],40965:["Interoperability tag","InteroperabilityIFDPointer"]},this.JpegMeta.JpegFile.prototype._gpstags={0:["GPS tag version","GPSVersionID"],1:["North or South Latitude","GPSLatitudeRef"],2:["Latitude","GPSLatitude"],3:["East or West Longitude","GPSLongitudeRef"],4:["Longitude","GPSLongitude"],5:["Altitude reference","GPSAltitudeRef"],6:["Altitude","GPSAltitude"],7:["GPS time (atomic clock)","GPSTimeStamp"],8:["GPS satellites usedd for measurement","GPSSatellites"],9:["GPS receiver status","GPSStatus"],10:["GPS mesaurement mode","GPSMeasureMode"],11:["Measurement precision","GPSDOP"],12:["Speed unit","GPSSpeedRef"],13:["Speed of GPS receiver","GPSSpeed"],14:["Reference for direction of movement","GPSTrackRef"],15:["Direction of movement","GPSTrack"],16:["Reference for direction of image","GPSImgDirectionRef"],17:["Direction of image","GPSImgDirection"],18:["Geodetic survey data used","GPSMapDatum"],19:["Reference for latitude of destination","GPSDestLatitudeRef"],20:["Latitude of destination","GPSDestLatitude"],21:["Reference for longitude of destination","GPSDestLongitudeRef"],22:["Longitude of destination","GPSDestLongitude"],23:["Reference for bearing of destination","GPSDestBearingRef"],24:["Bearing of destination","GPSDestBearing"],25:["Reference for distance to destination","GPSDestDistanceRef"],26:["Distance to destination","GPSDestDistance"],27:["Name of GPS processing method","GPSProcessingMethod"],28:["Name of GPS area","GPSAreaInformation"],29:["GPS Date","GPSDateStamp"],30:["GPS differential correction","GPSDifferential"]},this.JpegMeta.JpegFile.prototype._iptctags={0:["Record Version","recordVersion"],3:["Object Type Reference","objectType"],4:["Object Attribute Reference","objectAttribute"],5:["Object Name","objectName"],7:["Edit Status","editStatus"],8:["Editorial Update","editorialUpdate"],10:["Urgency","urgency"],12:["Subject Reference","subjectRef"],15:["Category","category"],20:["Supplemental Category","supplCategory"],22:["Fixture Identifier","fixtureID"],25:["Keywords","keywords"],26:["Content Location Code","contentLocCode"],27:["Content Location Name","contentLocName"],30:["Release Date","releaseDate"],35:["Release Time","releaseTime"],37:["Expiration Date","expirationDate"],38:["Expiration Time","expirationTime"],40:["Special Instructions","specialInstructions"],42:["Action Advised","actionAdvised"],45:["Reference Service","refService"],47:["Reference Date","refDate"],50:["Reference Number","refNumber"],55:["Date Created","dateCreated"],60:["Time Created","timeCreated"],62:["Digital Creation Date","digitalCreationDate"],63:["Digital Creation Time","digitalCreationTime"],65:["Originating Program","originatingProgram"],70:["Program Version","programVersion"],75:["Object Cycle","objectCycle"],80:["By-line","byline"],85:["By-line Title","bylineTitle"],90:["City","city"],92:["Sub-location","sublocation"],95:["Province/State","state"],100:["Country Code","countryCode"],101:["Country Name","countryName"],103:["Original Transmission Reference","origTransRef"],105:["Headline","headline"],110:["Credit","credit"],115:["Source","source"],116:["Copyright Notice","copyrightNotice"],118:["Contact","contact"],120:["Caption/Abstract","caption"],122:["Writer/Editor","writerEditor"],125:["Rasterized Caption","rasterizedCaption"],130:["Image Type","imageType"],131:["Image Orientation","imageOrientation"],135:["Language Identifier","languageID"],150:["Audio Type","audioType"],151:["Audio Sampling Rate","audioSamplingRate"],152:["Audio Sampling Resolution","audioSamplingRes"],153:["Audio Duration","audioDuration"],154:["Audio Outcue","audioOutcue"],200:["Preview File Format","previewFileFormat"],201:["Preview File Format Version","previewFileFormatVer"],202:["Preview Data","previewData"]},this.JpegMeta.JpegFile.prototype._markers={192:["SOF0","_sofHandler","Baseline DCT"],193:["SOF1","_sofHandler","Extended sequential DCT"],194:["SOF2","_sofHandler","Progressive DCT"],195:["SOF3","_sofHandler","Lossless (sequential)"],197:["SOF5","_sofHandler","Differential sequential DCT"],198:["SOF6","_sofHandler","Differential progressive DCT"],199:["SOF7","_sofHandler","Differential lossless (sequential)"],200:["JPG",null,"Reserved for JPEG extensions"],201:["SOF9","_sofHandler","Extended sequential DCT"],202:["SOF10","_sofHandler","Progressive DCT"],203:["SOF11","_sofHandler","Lossless (sequential)"],205:["SOF13","_sofHandler","Differential sequential DCT"],206:["SOF14","_sofHandler","Differential progressive DCT"],207:["SOF15","_sofHandler","Differential lossless (sequential)"],196:["DHT",null,"Define Huffman table(s)"],204:["DAC",null,"Define arithmetic coding conditioning(s)"],208:["RST0",null,"Restart with modulo 8 count �0�"],209:["RST1",null,"Restart with modulo 8 count �1�"],210:["RST2",null,"Restart with modulo 8 count �2�"],211:["RST3",null,"Restart with modulo 8 count �3�"],212:["RST4",null,"Restart with modulo 8 count �4�"],213:["RST5",null,"Restart with modulo 8 count �5�"],214:["RST6",null,"Restart with modulo 8 count �6�"],215:["RST7",null,"Restart with modulo 8 count �7�"],216:["SOI",null,"Start of image"],217:["EOI",null,"End of image"],218:["SOS",null,"Start of scan"],219:["DQT",null,"Define quantization table(s)"],220:["DNL",null,"Define number of lines"],221:["DRI",null,"Define restart interval"],222:["DHP",null,"Define hierarchical progression"],223:["EXP",null,"Expand reference component(s)"],224:["APP0","_app0Handler","Reserved for application segments"],225:["APP1","_app1Handler"],226:["APP2",null],227:["APP3",null],228:["APP4",null],229:["APP5",null],230:["APP6",null],231:["APP7",null],232:["APP8",null],233:["APP9",null],234:["APP10",null],235:["APP11",null],236:["APP12",null],237:["IPTC","_iptcHandler","IPTC Photo Metadata"],238:["APP14",null],239:["APP15",null],240:["JPG0",null],241:["JPG1",null],242:["JPG2",null],243:["JPG3",null],244:["JPG4",null],245:["JPG5",null],246:["JPG6",null],247:["JPG7",null],248:["JPG8",null],249:["JPG9",null],250:["JPG10",null],251:["JPG11",null],252:["JPG12",null],253:["JPG13",null],254:["COM","_commentHandler","Comment"],1:["JPG13",null]},this.JpegMeta.JpegFile.prototype._addMetaGroup=function(t,e){return this[(t=new JpegMeta.MetaGroup(t,e)).fieldName]=t,this.metaGroups[t.fieldName]=t},this.JpegMeta.JpegFile.prototype._parseIfd=function(t,e,i,n,o,a,r){for(var s,l,h,u,d,c,p,f,g,m=JpegMeta.parseNum(t,e,i+n,2),y=this._addMetaGroup(a,r),v=0;v<m;v++)if(l=JpegMeta.parseNum(t,e,s=i+n+2+12*v,2),u=JpegMeta.parseNum(t,e,s+2,2),c=JpegMeta.parseNum(t,e,s+4,4),p=JpegMeta.parseNum(t,e,s+8,4),void 0!==this._types[u]){if(h=this._types[u][0],p=(d=this._types[u][1])*c<=4?s+8:i+p,"UNDEFINED"==h)P=void 0;else if("ASCII"==h)P=(P=e.slice(p,p+c)).split("\0")[0],JpegMeta.stringIsClean(P)||(P="");else{for(var P=new Array,S=0;S<c;S++,p+=d)"BYTE"!=h&&"SHORT"!=h&&"LONG"!=h||P.push(JpegMeta.parseNum(t,e,p,d)),"SBYTE"!=h&&"SSHORT"!=h&&"SLONG"!=h||P.push(JpegMeta.parseSnum(t,e,p,d)),"RATIONAL"==h&&(f=JpegMeta.parseNum(t,e,p,4),g=JpegMeta.parseNum(t,e,p+4,4),P.push(new JpegMeta.Rational(f,g))),"SRATIONAL"==h&&(f=JpegMeta.parseSnum(t,e,p,4),g=JpegMeta.parseSnum(t,e,p+4,4),P.push(new JpegMeta.Rational(f,g))),P.push();1===c&&(P=P[0])}o.hasOwnProperty(l)?y._addProperty(o[l][1],o[l][0],P):console.log("WARNING(jpegmeta.js): Unknown tag: ",l)}},this.JpegMeta.JpegFile.prototype._jfifHandler=function(t,e){if(void 0!==this.jfif)throw Error("Multiple JFIF segments found");this._addMetaGroup("jfif","JFIF"),this.jfif._addProperty("version_major","Version Major",this._binary_data.charCodeAt(e+5)),this.jfif._addProperty("version_minor","Version Minor",this._binary_data.charCodeAt(e+6)),this.jfif._addProperty("version","JFIF Version",this.jfif.version_major.value+"."+this.jfif.version_minor.value),this.jfif._addProperty("units","Density Unit",this._binary_data.charCodeAt(e+7)),this.jfif._addProperty("Xdensity","X density",JpegMeta.parseNum(">",this._binary_data,e+8,2)),this.jfif._addProperty("Ydensity","Y Density",JpegMeta.parseNum(">",this._binary_data,e+10,2)),this.jfif._addProperty("Xthumbnail","X Thumbnail",JpegMeta.parseNum(">",this._binary_data,e+12,1)),this.jfif._addProperty("Ythumbnail","Y Thumbnail",JpegMeta.parseNum(">",this._binary_data,e+13,1))},this.JpegMeta.JpegFile.prototype._app0Handler=function(t,e){this._binary_data.slice(e,e+5)==this._JFIF_IDENT?this._jfifHandler(t,e):this._JFXX_IDENT},this.JpegMeta.JpegFile.prototype._app1Handler=function(t,e){this._binary_data.slice(e,e+5)==this._EXIF_IDENT&&this._exifHandler(t,e+6)},JpegMeta.JpegFile.prototype._exifHandler=function(t,e){if(void 0!==this.exif)throw new Error("Multiple JFIF segments found");var i,n=this._binary_data.slice(e,e+2);if("II"===n)i="<";else{if("MM"!==n)throw new Error("Malformed TIFF meta-data. Unknown endianess: "+n);i=">"}if(42!==(n=JpegMeta.parseNum(i,this._binary_data,e+2,2)))throw new Error("Malformed TIFF meta-data. Bad magic: "+n);n=JpegMeta.parseNum(i,this._binary_data,e+4,4),this._parseIfd(i,this._binary_data,e,n,this._tifftags,"tiff","TIFF"),this.tiff.ExifIfdPointer&&this._parseIfd(i,this._binary_data,e,this.tiff.ExifIfdPointer.value,this._exiftags,"exif","Exif"),this.tiff.GPSInfoIfdPointer&&(this._parseIfd(i,this._binary_data,e,this.tiff.GPSInfoIfdPointer.value,this._gpstags,"gps","GPS"),this.gps.GPSLatitude&&(n=this.gps.GPSLatitude.value[0].asFloat()+1/60*this.gps.GPSLatitude.value[1].asFloat()+1/3600*this.gps.GPSLatitude.value[2].asFloat(),"S"===this.gps.GPSLatitudeRef.value&&(n=-n),this.gps._addProperty("latitude","Dec. Latitude",n)),this.gps.GPSLongitude)&&(i=this.gps.GPSLongitude.value[0].asFloat()+1/60*this.gps.GPSLongitude.value[1].asFloat()+1/3600*this.gps.GPSLongitude.value[2].asFloat(),"W"===this.gps.GPSLongitudeRef.value&&(i=-i),this.gps._addProperty("longitude","Dec. Longitude",i))},this.JpegMeta.JpegFile.prototype._iptcHandler=function(t,e,i){this._addMetaGroup("iptc","IPTC");for(var n,o,a,r=JpegMeta.parseNum("<",this._binary_data,e+4,1),s=0;s<i;s++)if(2==JpegMeta.parseNum("<",this._binary_data,o=e+s,1)&&(a=JpegMeta.parseNum("<",this._binary_data,o+1,1),tag_desc=this._iptctags[a])){for(r=0,n=2;n<i&&28!=JpegMeta.parseNum("<",this._binary_data,o+n,1)&&2!=JpegMeta.parseNum("<",this._binary_data,o+n+1,1);)n++,r++;r&&(a=(a=this._binary_data.slice(e+s+2,e+s+2+r)).replace("\0","").trim(),this.iptc._addProperty(tag_desc[1],tag_desc[0],a),s+=r-1)}},function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):t(jQuery)}(function(a){"use strict";Number.isNaN=Number.isNaN||function(t){return"number"==typeof t&&t!=t};var t,r="rangeslider",s=0,l=((t=document.createElement("input")).setAttribute("type","range"),"text"!==t.type),h={polyfill:!0,orientation:"horizontal",rangeClass:"rangeslider",disabledClass:"rangeslider--disabled",activeClass:"rangeslider--active",horizontalClass:"rangeslider--horizontal",verticalClass:"rangeslider--vertical",fillClass:"rangeslider__fill",handleClass:"rangeslider__handle",startEvent:["mousedown","touchstart","pointerdown"],moveEvent:["mousemove","touchmove","pointermove"],endEvent:["mouseup","touchend","pointerup"]},u={orientation:{horizontal:{dimension:"width",direction:"left",directionStyle:"left",coordinate:"x"},vertical:{dimension:"height",direction:"top",directionStyle:"bottom",coordinate:"y"}}};function i(n,t){var e=function(){for(var t,e=[],i=n.parentNode;(t=i)&&(0===t.offsetWidth||0===t.offsetHeight||!1===t.open);)e.push(i),i=i.parentNode;return e}(),i=e.length,o=[],a=n[t];function r(t){void 0!==t.open&&(t.open=!t.open)}if(i){for(var s=0;s<i;s++)o[s]=e[s].style.cssText,e[s].style.setProperty?e[s].style.setProperty("display","block","important"):e[s].style.cssText+=";display: block !important",e[s].style.height="0",e[s].style.overflow="hidden",e[s].style.visibility="hidden",r(e[s]);for(var a=n[t],l=0;l<i;l++)e[l].style.cssText=o[l],r(e[l])}return a}function n(t,e){return t=parseFloat(t),Number.isNaN(t)?e:t}function o(t){return t.charAt(0).toUpperCase()+t.substr(1)}function d(t,e){if(this.$window=a(window),this.$document=a(document),this.$element=a(t),this.options=a.extend({},h,e),this.polyfill=this.options.polyfill,this.orientation=this.$element[0].getAttribute("data-orientation")||this.options.orientation,this.onInit=this.options.onInit,this.onSlide=this.options.onSlide,this.onSlideEnd=this.options.onSlideEnd,this.DIMENSION=u.orientation[this.orientation].dimension,this.DIRECTION=u.orientation[this.orientation].direction,this.DIRECTION_STYLE=u.orientation[this.orientation].directionStyle,this.COORDINATE=u.orientation[this.orientation].coordinate,this.polyfill&&l)return!1;this.identifier="js-"+r+"-"+s++,this.startEvent=this.options.startEvent.join("."+this.identifier+" ")+"."+this.identifier,this.moveEvent=this.options.moveEvent.join("."+this.identifier+" ")+"."+this.identifier,this.endEvent=this.options.endEvent.join("."+this.identifier+" ")+"."+this.identifier,this.toFixed=(this.step+"").replace(".","").length-1,this.$fill=a('<div class="'+this.options.fillClass+'" />'),this.$handle=a('<div class="'+this.options.handleClass+'" />'),this.$range=a('<div class="'+this.options.rangeClass+" "+this.options[this.orientation+"Class"]+'" id="'+this.identifier+'" />').insertAfter(this.$element).prepend(this.$fill,this.$handle),this.$element.css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",opacity:"0"}),this.handleDown=a.proxy(this.handleDown,this),this.handleMove=a.proxy(this.handleMove,this),this.handleEnd=a.proxy(this.handleEnd,this),this.init();var i,n,o=this;this.$window.on("resize."+this.identifier,(i=function(){!function(t){var e=Array.prototype.slice.call(arguments,2);setTimeout(function(){return t.apply(null,e)},300)}(function(){o.update(!1,!1)},300)},n=20,function(){var t;return i.debouncing||(t=Array.prototype.slice.apply(arguments),i.lastReturnVal=i.apply(window,t),i.debouncing=!0),clearTimeout(i.debounceTimeout),i.debounceTimeout=setTimeout(function(){i.debouncing=!1},n),i.lastReturnVal})),this.$document.on(this.startEvent,"#"+this.identifier+":not(."+this.options.disabledClass+")",this.handleDown),this.$element.on("change."+this.identifier,function(t,e){e&&e.origin===o.identifier||(e=t.target.value,t=o.getPositionFromValue(e),o.setPosition(t))})}return d.prototype.init=function(){this.update(!0,!1),this.onInit&&"function"==typeof this.onInit&&this.onInit()},d.prototype.update=function(t,e){(t=t||!1)&&(this.min=n(this.$element[0].getAttribute("min"),0),this.max=n(this.$element[0].getAttribute("max"),100),this.value=n(this.$element[0].value,Math.round(this.min+(this.max-this.min)/2)),this.step=n(this.$element[0].getAttribute("step"),1)),this.handleDimension=i(this.$handle[0],"offset"+o(this.DIMENSION)),this.rangeDimension=i(this.$range[0],"offset"+o(this.DIMENSION)),this.maxHandlePos=this.rangeDimension-this.handleDimension,this.grabPos=this.handleDimension/2,this.position=this.getPositionFromValue(this.value),this.$element[0].disabled?this.$range.addClass(this.options.disabledClass):this.$range.removeClass(this.options.disabledClass),this.setPosition(this.position,e)},d.prototype.handleDown=function(t){var e,i;t.preventDefault(),t.button&&0!==t.button||(this.$document.on(this.moveEvent,this.handleMove),this.$document.on(this.endEvent,this.handleEnd),this.$range.addClass(this.options.activeClass),-1<(" "+t.target.className+" ").replace(/[\n\t]/g," ").indexOf(this.options.handleClass))||(t=this.getRelativePosition(t),e=this.$range[0].getBoundingClientRect()[this.DIRECTION],e=this.getPositionFromNode(this.$handle[0])-e,i="vertical"===this.orientation?this.maxHandlePos-(t-this.grabPos):t-this.grabPos,this.setPosition(i),e<=t&&t<e+this.handleDimension&&(this.grabPos=t-e))},d.prototype.handleMove=function(t){t.preventDefault(),t=this.getRelativePosition(t),t="vertical"===this.orientation?this.maxHandlePos-(t-this.grabPos):t-this.grabPos,this.setPosition(t)},d.prototype.handleEnd=function(t){t.preventDefault(),this.$document.off(this.moveEvent,this.handleMove),this.$document.off(this.endEvent,this.handleEnd),this.$range.removeClass(this.options.activeClass),this.$element.trigger("change",{origin:this.identifier}),this.onSlideEnd&&"function"==typeof this.onSlideEnd&&this.onSlideEnd(this.position,this.value)},d.prototype.cap=function(t,e,i){return t<e?e:i<t?i:t},d.prototype.setPosition=function(t,e){var i;void 0===e&&(e=!0),t=this.getValueFromPosition(this.cap(t,0,this.maxHandlePos)),i=this.getPositionFromValue(t),this.$fill[0].style[this.DIMENSION]=i+this.grabPos+"px",this.$handle[0].style[this.DIRECTION_STYLE]=i+"px",this.setValue(t),this.position=i,this.value=t,e&&this.onSlide&&"function"==typeof this.onSlide&&this.onSlide(i,t)},d.prototype.getPositionFromNode=function(t){for(var e=0;null!==t;)e+=t.offsetLeft,t=t.offsetParent;return e},d.prototype.getRelativePosition=function(t){var e=o(this.COORDINATE),i=this.$range[0].getBoundingClientRect()[this.DIRECTION],n=0;return void 0!==t.originalEvent["client"+e]?n=t.originalEvent["client"+e]:t.originalEvent.touches&&t.originalEvent.touches[0]&&void 0!==t.originalEvent.touches[0]["client"+e]?n=t.originalEvent.touches[0]["client"+e]:t.currentPoint&&void 0!==t.currentPoint[this.COORDINATE]&&(n=t.currentPoint[this.COORDINATE]),n-i},d.prototype.getPositionFromValue=function(t){return t=(t-this.min)/(this.max-this.min),Number.isNaN(t)?0:t*this.maxHandlePos},d.prototype.getValueFromPosition=function(t){return t/=this.maxHandlePos||1,t=this.step*Math.round(t*(this.max-this.min)/this.step)+this.min,Number(t.toFixed(this.toFixed))},d.prototype.setValue=function(t){t===this.value&&""!==this.$element[0].value||this.$element.val(t).trigger("input",{origin:this.identifier})},d.prototype.destroy=function(){this.$document.off("."+this.identifier),this.$window.off("."+this.identifier),this.$element.off("."+this.identifier).removeAttr("style").removeData("plugin_"+r),this.$range&&this.$range.length&&this.$range[0].parentNode.removeChild(this.$range[0])},a.fn[r]=function(i){var n=Array.prototype.slice.call(arguments,1);return this.each(function(){var t=a(this),e=t.data("plugin_"+r);e||t.data("plugin_"+r,e=new d(this,i)),"string"==typeof i&&e[i].apply(e,n)})},"rangeslider.js is available in jQuery context e.g $(selector).rangeslider(options);"}),function(){function G(t,e,i){return t.call.apply(t.bind,arguments)}function O(e,i,t){var n;if(e)return 2<arguments.length?(n=Array.prototype.slice.call(arguments,2),function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,n),e.apply(i,t)}):function(){return e.apply(i,arguments)};throw Error()}function f(t,e,i){return(f=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?G:O).apply(null,arguments)}var s=Date.now||function(){return+new Date};function j(t,e){this.a=t,this.m=e||t,this.c=this.m.document}var L=!!window.FontFace;function l(t,e,i,n){if(e=t.c.createElement(e),i)for(var o in i)i.hasOwnProperty(o)&&("style"==o?e.style.cssText=i[o]:e.setAttribute(o,i[o]));return n&&e.appendChild(t.c.createTextNode(n)),e}function h(t,e,i){(t=(t=t.c.getElementsByTagName(e)[0])||document.documentElement).insertBefore(i,t.lastChild)}function i(t){t.parentNode&&t.parentNode.removeChild(t)}function g(t,e,i){e=e||[],i=i||[];for(var n=t.className.split(/\s+/),o=0;o<e.length;o+=1){for(var a=!1,r=0;r<n.length;r+=1)if(e[o]===n[r]){a=!0;break}a||n.push(e[o])}for(e=[],o=0;o<n.length;o+=1){for(a=!1,r=0;r<i.length;r+=1)if(n[o]===i[r]){a=!0;break}a||e.push(n[o])}t.className=e.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function a(t,e){for(var i=t.className.split(/\s+/),n=0,o=i.length;n<o;n++)if(i[n]==e)return!0;return!1}function C(t){var e;return"string"==typeof t.f?t.f:"https:"==("about:"==(e=t.m.location.protocol)?t.a.location.protocol:e)?"https:":"http:"}function D(t,e,i){function n(){r&&o&&(r(a),r=null)}e=l(t,"link",{rel:"stylesheet",href:e,media:"all"});var o=!1,a=null,r=i||null;L?(e.onload=function(){o=!0,n()},e.onerror=function(){o=!0,a=Error("Stylesheet failed to load"),n()}):setTimeout(function(){o=!0,n()},0),h(t,"head",e)}function n(t,e,i,n){var o,a,r=t.c.getElementsByTagName("head")[0];return r?(o=l(t,"script",{src:e}),a=!1,o.onload=o.onreadystatechange=function(){a||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a=!0,i&&i(null),o.onload=o.onreadystatechange=null,"HEAD"==o.parentNode.tagName&&r.removeChild(o))},r.appendChild(o),setTimeout(function(){a||(a=!0,i&&i(Error("Script load timeout")))},n||5e3),o):null}function F(){this.a=0,this.c=null}function E(t){return t.a++,function(){t.a--,o(t)}}function T(t,e){t.c=e,o(t)}function o(t){0==t.a&&t.c&&(t.c(),t.c=null)}function r(t){this.a=t||"-"}function A(t,e){this.c=t,this.f=4,this.a="n",(t=(e||"n4").match(/^([nio])([1-9])$/i))&&(this.a=t[1],this.f=parseInt(t[2],10))}function u(t){var e=[];t=t.split(/,\s*/);for(var i=0;i<t.length;i++){var n=t[i].replace(/['"]/g,"");-1!=n.indexOf(" ")||/^\d/.test(n)?e.push("'"+n+"'"):e.push(n)}return e.join(",")}function m(t){return t.a+t.f}function d(t){var e="normal";return"o"===t.a?e="oblique":"i"===t.a&&(e="italic"),e}function H(t,e){this.c=t,this.f=t.m.document.documentElement,this.h=e,this.a=new r("-"),this.j=!1!==e.events,this.g=!1!==e.classes}function y(t){var e,i,n;t.g&&(e=a(t.f,t.a.c("wf","active")),i=[],n=[t.a.c("wf","loading")],e||i.push(t.a.c("wf","inactive")),g(t.f,i,n)),v(t,"inactive")}function v(t,e,i){t.j&&t.h[e]&&(i?t.h[e](i.c,m(i)):t.h[e]())}function k(){this.c={}}function c(t,e){this.c=t,this.f=e,this.a=l(this.c,"span",{"aria-hidden":"true"},this.f)}function p(t){h(t.c,"body",t.a)}function P(t){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+u(t.c)+";font-style:"+d(t)+";font-weight:"+t.f+"00;"}function S(t,e,i,n,o,a){this.g=t,this.j=e,this.a=n,this.c=i,this.f=o||3e3,this.h=a||void 0}function b(t,e,i,n,o,a,r){this.v=t,this.B=e,this.c=i,this.a=n,this.s=r||"BESbswy",this.f={},this.w=o||3e3,this.u=a||null,this.o=this.j=this.h=this.g=null,this.g=new c(this.c,this.s),this.h=new c(this.c,this.s),this.j=new c(this.c,this.s),this.o=new c(this.c,this.s),t=P(t=new A(this.a.c+",serif",m(this.a))),this.g.a.style.cssText=t,t=P(t=new A(this.a.c+",sans-serif",m(this.a))),this.h.a.style.cssText=t,t=P(t=new A("serif",m(this.a))),this.j.a.style.cssText=t,t=P(t=new A("sans-serif",m(this.a))),this.o.a.style.cssText=t,p(this.g),p(this.h),p(this.j),p(this.o)}r.prototype.c=function(t){for(var e=[],i=0;i<arguments.length;i++)e.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return e.join(this.a)},S.prototype.start=function(){var o=this.c.m.document,a=this,r=s(),t=new Promise(function(i,n){!function e(){var t;s()-r>=a.f?n():o.fonts.load(d(t=a.a)+" "+t.f+"00 300px "+u(t.c),a.h).then(function(t){1<=t.length?i():setTimeout(e,25)},function(){n()})}()}),e=new Promise(function(t,e){setTimeout(e,a.f)});Promise.race([e,t]).then(function(){a.g(a.a)},function(){a.j(a.a)})};var _={D:"serif",C:"sans-serif"},e=null;function w(){var t;return null===e&&(t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),e=!!t&&(parseInt(t[1],10)<536||536===parseInt(t[1],10)&&parseInt(t[2],10)<=11)),e}function I(t,e,i){for(var n in _)if(_.hasOwnProperty(n)&&e===t.f[_[n]]&&i===t.f[_[n]])return 1}function M(t,e){setTimeout(f(function(){i(this.g.a),i(this.h.a),i(this.j.a),i(this.o.a),e(this.a)},t),0)}function J(t,e,i){this.c=t,this.a=e,this.f=0,this.o=this.j=!1,this.s=i}b.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.o.a.offsetWidth,this.A=s(),function t(e){var i=e.g.a.offsetWidth,n=e.h.a.offsetWidth;i===e.f.serif&&n===e.f["sans-serif"]||w()&&I(e,i,n)?s()-e.A>=e.w?w()&&I(e,i,n)&&(null===e.u||e.u.hasOwnProperty(e.a.c))?M(e,e.v):M(e,e.B):setTimeout(f(function(){t(this)},e),50):M(e,e.v)}(this)};var R=null;function x(t){0==--t.f&&t.j&&(t.o?((t=t.a).g&&g(t.f,[t.a.c("wf","active")],[t.a.c("wf","loading"),t.a.c("wf","inactive")]),v(t,"active")):y(t.a))}function $(t){this.j=t,this.a=new k,this.h=0,this.f=this.g=!0}function B(t,e){this.c=t,this.a=e}function U(t,e){this.c=t,this.a=e}function V(t,e,i){this.c=t||e+"//fonts.googleapis.com/css",this.a=[],this.f=[],this.g=i||""}function W(t){this.f=t,this.a=[],this.c={}}J.prototype.g=function(t){var e=this.a;e.g&&g(e.f,[e.a.c("wf",t.c,m(t).toString(),"active")],[e.a.c("wf",t.c,m(t).toString(),"loading"),e.a.c("wf",t.c,m(t).toString(),"inactive")]),v(e,"fontactive",t),this.o=!0,x(this)},J.prototype.h=function(t){var e,i,n,o=this.a;o.g&&(e=a(o.f,o.a.c("wf",t.c,m(t).toString(),"active")),i=[],n=[o.a.c("wf",t.c,m(t).toString(),"loading")],e||i.push(o.a.c("wf",t.c,m(t).toString(),"inactive")),g(o.f,i,n)),v(o,"fontinactive",t),x(this)},$.prototype.load=function(t){this.c=new j(this.j,t.context||this.j),this.g=!1!==t.events,this.f=!1!==t.classes;var e,n=this,i=new H(this.c,t),o=t,a=[],t=o.timeout,a=((e=i).g&&g(e.f,[e.a.c("wf","loading")]),v(e,"loading"),function(t,e,i){var n,o,a=[];for(n in e)e.hasOwnProperty(n)&&(o=t.c[n])&&a.push(o(e[n],i));return a}(n.a,o,n.c)),r=new J(n.c,i,t);for(n.h=a.length,i=0,o=a.length;i<o;i++)a[i].load(function(t,e,i){var h=r,u=t,d=e,c=i,p=0==--(t=n).h;(t.f||t.g)&&setTimeout(function(){var t=c||null,e=d||{};if(0===u.length&&p)y(h.a);else{h.f+=u.length,p&&(h.j=p);for(var i=[],n=0;n<u.length;n++){var o,a=u[n],r=e[a.c],s=h.a,l=a;s.g&&g(s.f,[s.a.c("wf",l.c,m(l).toString(),"loading")]),v(s,"fontloading",l),s=(R=(s=null)===R?!!window.FontFace&&(l=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),o=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor),l?42<parseInt(l[1],10):!o):R)?new S(f(h.g,h),f(h.h,h),h.c,a,h.s,r):new b(f(h.g,h),f(h.h,h),h.c,a,h.s,t,r),i.push(s)}for(n=0;n<i.length;n++)i[n].start()}},0)})},B.prototype.load=function(r){var s,t,e=this,l=e.a.projectId,i=e.a.version;l?(s=e.c.m,n(this.c,(t=l,C(e.c)+"//"+(e.a.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"")+"/"+t+".js"+(i?"?v="+i:"")),function(t){t?r([]):(s["__MonotypeConfiguration__"+l]=function(){return e.a},function t(){if(s["__mti_fntLst"+l]){var e,i=s["__mti_fntLst"+l](),n=[];if(i)for(var o=0;o<i.length;o++){var a=i[o].fontfamily;null!=i[o].fontStyle&&null!=i[o].fontWeight?(e=i[o].fontStyle+i[o].fontWeight,n.push(new A(a,e))):n.push(new A(a))}r(n)}else setTimeout(function(){t()},50)}())}).id="__MonotypeAPIScript__"+l):r([])},U.prototype.load=function(t){for(var e=this.a.urls||[],i=this.a.families||[],n=this.a.testStrings||{},o=new F,a=0,r=e.length;a<r;a++)D(this.c,e[a],E(o));for(var s=[],a=0,r=i.length;a<r;a++)if((e=i[a].split(":"))[1])for(var l=e[1].split(","),h=0;h<l.length;h+=1)s.push(new A(e[0],l[h]));else s.push(new A(e[0]));T(o,function(){t(s,n)})};var Y={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},X={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},q={i:"i",italic:"i",n:"n",normal:"n"},z=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function K(t,e){this.c=t,this.a=e}var Q={Arimo:!0,Cousine:!0,Tinos:!0};function Z(t,e){this.c=t,this.a=e}function tt(t,e){this.c=t,this.f=e,this.a=[]}K.prototype.load=function(t){for(var e=new F,i=this.c,n=new V(this.a.api,C(i),this.a.text),o=this.a.families,a=n,r=o,s=r.length,l=0;l<s;l++){var h=r[l].split(":"),u=(3==h.length&&a.f.push(h.pop()),"");2==h.length&&""!=h[1]&&(u=":"),a.a.push(h.join(u))}for(var d=new W(o),c=d,p=c.f.length,f=0;f<p;f++){var g=c.f[f].split(":"),m=g[0].replace(/\+/g," "),y=["n4"];if(2<=g.length){var v,P,S=g[1],b=[];if(S)for(var _=(S=S.split(",")).length,w=0;w<_;w++)(P=(P=S[w]).match(/^[\w-]+$/)&&null!=(v=z.exec(P.toLowerCase()))?[P=null==(P=v[2])||""==P?"n":q[P],v=null==(v=v[1])||""==v?"4":X[v]||(isNaN(v)?"4":v.substr(0,1))].join(""):"")&&b.push(P);0<b.length&&(y=b),3==g.length&&(b=[],0<(g=(g=g[2])?g.split(","):b).length)&&(g=Y[g[0]])&&(c.c[m]=g)}for(c.c[m]||(g=Y[m])&&(c.c[m]=g),g=0;g<y.length;g+=1)c.a.push(new A(m,y[g]))}D(i,function(t){if(0==t.a.length)throw Error("No fonts to load!");if(-1!=t.c.indexOf("kit="))return t.c;for(var e=t.a.length,i=[],n=0;n<e;n++)i.push(t.a[n].replace(/ /g,"+"));return e=t.c+"?family="+i.join("%7C"),0<t.f.length&&(e+="&subset="+t.f.join(",")),0<t.g.length&&(e+="&text="+encodeURIComponent(t.g)),e}(n),E(e)),T(e,function(){t(d.a,d.c,Q)})},Z.prototype.load=function(r){var t=this.a.id,s=this.c.m;t?n(this.c,(this.a.api||"https://use.typekit.net")+"/"+t+".js",function(t){if(t)r([]);else if(s.Typekit&&s.Typekit.config&&s.Typekit.config.fn){t=s.Typekit.config.fn;for(var e=[],i=0;i<t.length;i+=2)for(var n=t[i],o=t[i+1],a=0;a<o.length;a++)e.push(new A(n,o[a]));try{s.Typekit.load({events:!1,classes:!1,async:!0})}catch(t){}r(e)}},2e3):r([])},tt.prototype.load=function(l){var t=this.f.id,e=this.c.m,h=this;t?(e.__webfontfontdeckmodule__||(e.__webfontfontdeckmodule__={}),e.__webfontfontdeckmodule__[t]=function(t,e){for(var i,n,o,a=0,r=e.fonts.length;a<r;++a){var s=e.fonts[a];h.a.push(new A(s.name,(o=n=i=void 0,i=4,n="n",o=null,(s="font-weight:"+s.weight+";font-style:"+s.style)&&((o=s.match(/(normal|oblique|italic)/i))&&o[1]&&(n=o[1].substr(0,1).toLowerCase()),o=s.match(/([1-9]00|normal|bold)/i))&&o[1]&&(/bold/i.test(o[1])?i=7:/[1-9]00/.test(o[1])&&(i=parseInt(o[1].substr(0,1),10))),n+i)))}l(h.a)},n(this.c,C(this.c)+(this.f.api||"//f.fontdeck.com/s/css/js/")+((e=this.c).m.location.hostname||e.a.location.hostname)+"/"+t+".js",function(t){t&&l([])})):l([])};var t=new $(window),N=(t.a.c.custom=function(t,e){return new U(e,t)},t.a.c.fontdeck=function(t,e){return new tt(e,t)},t.a.c.monotype=function(t,e){return new B(e,t)},t.a.c.typekit=function(t,e){return new Z(e,t)},t.a.c.google=function(t,e){return new K(e,t)},{load:f(t.load,t)});"function"==typeof define&&define.amd?define(function(){return N}):"undefined"!=typeof module&&module.exports?module.exports=N:(window.WebFont=N,window.WebFontConfig&&t.load(window.WebFontConfig))}();
(()=>{var i={423:()=>{var t,i;fabric.Canvas.prototype.initialize=(t=fabric.Canvas.prototype.initialize,function(...e){return t.call(this,...e),this._historyInit(),this}),fabric.Canvas.prototype.dispose=(i=fabric.Canvas.prototype.dispose,function(...e){return i.call(this,...e),this._historyDispose(),this}),fabric.Canvas.prototype._historyNext=function(){return JSON.stringify(this.toDatalessJSON(this.extraProps))},fabric.Canvas.prototype._historyEvents=function(){return{"object:added":this._historySaveAction,"object:removed":this._historySaveAction,"object:modified":this._historySaveAction,"object:skewing":this._historySaveAction}},fabric.Canvas.prototype._historyInit=function(){this.historyUndo=[],this.historyRedo=[],this.extraProps=["selectable","editable"],this.historyNextState=this._historyNext(),this.on(this._historyEvents())},fabric.Canvas.prototype._historyDispose=function(){this.off(this._historyEvents())},fabric.Canvas.prototype._historySaveAction=function(){var e;this.historyProcessing||(e=this.historyNextState,this.historyUndo.push(e),this.historyNextState=this._historyNext(),this.fire("history:append",{json:e}))},fabric.Canvas.prototype.undo=function(e){this.historyProcessing=!0;var t=this.historyUndo.pop();t?(this.historyRedo.push(this._historyNext()),this.historyNextState=t,this._loadHistory(t,"history:undo",e)):this.historyProcessing=!1},fabric.Canvas.prototype.redo=function(e){this.historyProcessing=!0;var t=this.historyRedo.pop();t?(this.historyUndo.push(this._historyNext()),this.historyNextState=t,this._loadHistory(t,"history:redo",e)):this.historyProcessing=!1},fabric.Canvas.prototype._loadHistory=function(e,t,i){var s=this;this.loadFromJSON(e,function(){s.renderAll(),s.fire(t),s.historyProcessing=!1,i&&"function"==typeof i&&i()})},fabric.Canvas.prototype.clearHistory=function(){this.historyUndo=[],this.historyRedo=[],this.fire("history:clear")},fabric.Canvas.prototype.onHistory=function(){this.historyProcessing=!1,this._historySaveAction()},fabric.Canvas.prototype.offHistory=function(){this.historyProcessing=!0}},561:()=>{class e extends HTMLElement{constructor(){super()}connectedCallback(){}}customElements.define("fpd-actions-bar",e)}},s={};function X(e){var t=s[e];return void 0!==t||(t=s[e]={exports:{}},i[e](t,t.exports,X)),t.exports}(()=>{"use strict";const d=(e="",t=!1,i="",s=document.body)=>{s===document.body&&s.classList.add("fpd-overflow-hidden"),"prompt"===i?e=`
            <input type="text" placeholder="${e}" />
            <span class="fpd-btn"></span>
        `:"confirm"===i&&(e=`
            <div class="fpd-confirm-msg">${e}</div>
            <span class="fpd-btn fpd-confirm"></span>
        `);e=`
        <div class="fpd-modal-wrapper fpd-shadow-3">
            <div class="fpd-modal-close">
                <span class="fpd-icon-close"></span>
            </div>
            <div class="fpd-modal-content">${e}</div>
        </div>
    `;const n=document.createElement("div");return n.className="fpd-modal-internal fpd-modal-overlay "+(t?"fpd-fullscreen":""),n.innerHTML=e,n.dataset.type=i,s.append(n),r(n.querySelector(".fpd-modal-close"),["click"],e=>{n.remove()}),n},n=e=>"[object Object]"===Object.prototype.toString.call(e),c=(e,t)=>{var i={...e,...t};if(Object.keys(t).length)for(const s of Object.keys(i))n(i[s])&&e[s]&&t[s]&&(i[s]=c(e[s],t[s]));return i},l=e=>/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e),p=e=>0===e||"string"==typeof e&&"0"===e,r=(e,t=[],i=()=>{})=>{(t="string"==typeof t?[t]:t).forEach(t=>{!(e instanceof HTMLElement)&&Array.from(e).length?e.forEach(e=>{e.addEventListener(t,i)}):e.addEventListener(t,i)})},h=(t=[],e=[])=>(t&&(t instanceof HTMLElement?e.forEach(e=>{t.classList.add(e)}):t.forEach(t=>{e.forEach(e=>{t.classList.add(e)})})),t),u=(t=[],e=[])=>(t&&(t instanceof HTMLElement?e.forEach(e=>{t.classList.remove(e)}):t.forEach(t=>{e.forEach(e=>{t.classList.remove(e)})})),t),m=e=>void 0===e||null==e||("string"==typeof e?!e.trim().length:Array.isArray(e)?!e.length:"object"==typeof e&&!Object.keys(e).length),o=()=>{var t=!0;try{window.localStorage.length,window.localStorage.setItem("fpd-storage","just-testing")}catch(e){t=!1}return t},s=(e={})=>{if(e.url){var t=document.createElement("div");t.className="fpd-item",t.dataset.source=e.url,e.title&&(t.dataset.title=e.title);const i=document.createElement("picture");if(i.dataset.img=e.thumbnailUrl||e.url,t.append(i),e.price){const i=document.createElement("span");i.className="fpd-price",i.innerHTML=e.price,t.append(i)}if(e.removable){const e=document.createElement("span");e.className="fpd-delete fpd-icon-remove",t.append(e)}return t}};class a{static defaults={imageLoadTimestamp:!1,stageWidth:900,stageHeight:600,editorMode:!1,editorBoxParameters:["left","top","angle","fill","width","height","fontSize","price"],fonts:[{name:"Arial"},{name:"Lobster",url:"google"}],facebookAppId:"",instagramClientId:"",instagramRedirectUri:"",instagramTokenUri:"",zoomStep:.2,maxZoom:3,hexNames:{},selectedColor:"#f5f5f5",boundingBoxColor:"#2185d0",outOfBoundaryColor:"#990000",replaceInitialElements:!1,customImageAjaxSettings:{url:"php/custom-image-handler.php",data:{saveOnServer:0,uploadsDir:"./uploads",uploadsDirURL:"http://yourdomain.com/uploads"}},improvedResizeQuality:!1,responsive:!0,cornerIconColor:"#000000",langJSON:"lang/default.json",colorPickerPalette:[],actions:{top:[],right:[],bottom:[],left:[]},mainBarModules:["products","images","text","designs","manage-layers"],initialActiveModule:"",maxValues:{},watermark:!1,priceFormat:{currency:"&#36;%d",decimalSep:".",thousandSep:","},mainBarContainer:!1,modalMode:!1,keyboardControl:!0,deselectActiveOnOutside:!0,uploadZonesTopped:!0,loadFirstProductInStage:!0,unsavedProductAlert:!1,hideDialogOnAdd:!0,toolbarPlacement:"smart",snapGridSize:[50,50],fabricCanvasOptions:{},namesNumbersDropdown:[],namesNumbersEntryPrice:0,colorSelectionPlacement:"",colorSelectionDisplayType:"grid",bulkVariationsPlacement:"",bulkVariations:{},toolbarDynamicContext:"body",boundingBoxProps:{strokeWidth:1},fitImagesInCanvas:!1,maxPrice:-1,inCanvasTextEditing:!0,openTextInputOnSelect:!1,designCategories:[],optionalView:!1,saveActionBrowserStorage:!0,pricingRules:[],uploadAgreementModal:!1,imageEditorSettings:{masks:[]},printingBox:null,printingBox:{},autoOpenInfo:!1,guidedTour:null,replaceColorsInColorGroup:!1,allowedImageTypes:["jpeg","png","svg","pdf"],pixabayApiKey:"",pixabayHighResImages:!1,pixabayLang:"en",openModalInDesigner:!1,imageSizeTooltip:!1,highlightEditableObjects:"",applyFillWhenReplacing:!0,layouts:[],dynamicViewsOptions:{unit:"mm",formats:[],pricePerArea:0,minWidth:0,minHeight:0,maxWidth:1e4,maxHeight:1e4},disableTextEmojis:!1,smartGuides:!1,usePrintingBoxAsBounding:!1,productsJSON:null,designsJSON:null,customizationRequiredRule:"any",swapProductConfirmation:!1,setTextboxWidth:!1,textLinkGroupProps:[],textTemplates:[],multiSelection:!1,maxCanvasHeight:.8,mobileGesturesBehaviour:"none",imageQualityRatings:null,splitMultiSVG:!1,cornerControlsStyle:"advanced",downloadFilename:"Product",autoFillUploadZones:!1,dragDropImagesToUploadZones:!1,responsiveBreakpoints:{small:768,medium:1024},dynamicDesigns:{},elementParameters:{objectCaching:!1,z:-1,price:0,colors:!1,removable:!1,draggable:!1,rotatable:!1,resizable:!1,copyable:!1,zChangeable:!1,boundingBox:!1,boundingBoxMode:"clipping",autoCenter:!1,replace:"",replaceInAllViews:!1,autoSelect:!1,topped:!1,colorPrices:{},colorLinkGroup:!1,patterns:[],sku:"",excludeFromExport:!1,showInColorSelection:!1,locked:!1,uniScalingUnlockable:!1,fixed:!1,originX:"center",originY:"center",cornerSize:24,fill:!1,lockUniScaling:!0,pattern:!1,top:0,left:0,angle:0,flipX:!1,flipY:!1,opacity:1,scaleX:1,scaleY:1},textParameters:{maxLength:0,curved:!1,curvable:!1,curveSpacing:10,curveRadius:80,curveReverse:!1,maxLines:0,textBox:!1,textPlaceholder:!1,numberPlaceholder:!1,letterSpacing:0,chargeAfterEditing:!1,minFontSize:1,textTransform:"none",widthFontSize:0,maxFontSize:200,shadowColor:"",shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,textLinkGroup:"",strokeColors:[],editable:!0,fontFamily:"Arial",fontSize:18,lineHeight:1,fontWeight:"normal",fontStyle:"normal",textDecoration:"normal",padding:10,textAlign:"left",stroke:null,strokeWidth:0,charSpacing:0},imageParameters:{uploadZone:!1,filter:null,scaleMode:"fit",resizeToW:0,resizeToH:0,advancedEditing:!1,uploadZoneMovable:!1,uploadZoneRemovable:!1,padding:0,minScaleLimit:.01},customImageParameters:{minW:100,minH:100,maxW:1500,maxH:1500,minDPI:72,maxSize:10},customTextParameters:{},customAdds:{designs:!0,uploads:!0,texts:!0,drawing:!0},qrCodeProps:{autoCenter:!0,draggable:!0,removable:!0,resizable:!0}};static merge(e={},t={}){return c(e,t)}static getParameterKeys(){var e=Object.keys(this.defaults.elementParameters),t=Object.keys(this.defaults.imageParameters),i=Object.keys(this.defaults.textParameters);return(e=e.concat(t)).concat(i)}}window.FPDOptions=a,X(423);const g=e=>"text"===e||"i-text"===e||"curvedText"===e||"textbox"===e?"text":"image",f=(e,t,i,s,n="fit")=>{var a=1,o=0!==(i="number"!=typeof i?0:i),r=0!==(s="number"!=typeof s?0:s),a="cover"===n?i-e<s-t?o?Math.max(i/e,s/t):1:r?Math.max(i/e,s/t):1:t<e?o?Math.min(i/e,s/t):1:r?Math.min(i/e,s/t):1;return parseFloat(a.toFixed(10))};class v extends EventTarget{fabricOptions={};options={};canvasElem=null;fabricCanvas=null;elements=[];initialElementsLoaded=!1;undos=[];redos=[];responsiveScale=1;isCustomized=!1;constructor(e,t={},i={}){super(),this.fabricOptions=t,this.options=i,this.canvasElem=document.createElement("canvas"),e.append(this.canvasElem),this.fabricCanvas=new fabric.Canvas(this.canvasElem,t),this.fabricCanvas.setDimensions({width:this.options.stageWidth,height:this.options.stageHeight})}addElements(i,e){let t=0;const s=()=>{if(++t<i.length){const e=i[t];n(e)||this.addElement(e.type,e.source,e.title,e.parameters)}else this.undos=[],this.redos=[],this.dispatchEvent(new CustomEvent("undoRedoSet")),this.removeEventListener("elementAdd",s),void 0!==e&&e.call(e,this),this.initialElementsLoaded=!0},n=e=>{if(void 0===e.type||void 0===e.source||void 0===e.title){var t=i.indexOf(e);if(-1!==t)return console.log("Element index "+t+" from elements removed, its not a valid element object!","info"),s(),!0}else this.elements.push(e);return!1};var a=i[0];a?(r(this,"elementAdd",s),n(a)||this.addElement(a.type,a.source,a.title,a.parameters)):(void 0!==e&&e.call(e,instance),this.initialElementsLoaded=!0)}addElement(a,s,e,o={}){if(void 0!==a&&void 0!==s&&void 0!==e){var t;this.dispatchEvent(new CustomEvent("beforeElementAdd",{detail:{type:a,source:s,title:e,params:o}})),"text"===a&&(s=(s=s.replace(/(<([^>]+)>)/gi,"")).replace(FancyProductDesigner.forbiddenTextChars,""),e=e.replace(/(<([^>]+)>)/gi,"")),"string"==typeof o.fill||Array.isArray(o.fill)||(o.fill=!1),r="text"===g(a)?c(this.options.elementParameters,this.options.textParameters):c(this.options.elementParameters,this.options.imageParameters),(o=c(r,o)).colors&&"string"==typeof o.colors&&0==o.colors.indexOf("#")&&(r=o.colors.replace(/\s+/g,"").split(","),o.colors=r),o._isInitial=!this.initialElementsLoaded,"text"===g(a)&&(r=o.colors[0]||"#000000",o.fill=o.fill||r);let n={source:s,title:e,id:String((new Date).getTime()),cornerColor:this.options.selectedColor,cornerIconColor:this.options.cornerIconColor};if(this.options.editorMode?(o.__editorMode=this.options.editorMode,n.selectable=n.evented=!0):n=c(n,{selectable:!1,lockRotation:!0,hasRotatingPoint:!1,lockScalingX:!0,lockScalingY:!0,lockMovementX:!0,lockMovementY:!0,hasControls:!1,evented:!1,lockScalingFlip:!0}),(n=c(o,n)).isCustom&&(this.isCustomized=!0),this.options.usePrintingBoxAsBounding&&!n.boundingBox&&((t,i)=>{if(t&&"object"==typeof t){let e=!0;for(var s=0;s<i.length;++s)if(!t.hasOwnProperty(i[s])){e=!1;break}return e}return!1})(this.options.printingBox,["left","top","width","height"])&&(n.boundingBox={x:this.options.printingBox.left-1,y:this.options.printingBox.top-1,width:this.options.printingBox.width+1,height:this.options.printingBox.height+1}),"image"==a||"path"==a||"group"==a){n.crossOrigin="",n.lockUniScaling=!this.options.editorMode&&!n.uniScalingUnlockable,-1===s.search("<svg ")&&(r=s.split("?"),s=n.source=r[0]);const a=(e,t,i,s={})=>{e?(t.originParams=c(t,s),e.setOptions(t),this.fabricCanvas.add(e),this.setElementParameters(t,e,!1),e.originParams.angle=e.angle,e.originParams.z=this.getZIndex(e),e._isInitial||e._ignore||this.#e({element:e,parameters:t,interaction:"add"})):this.dispatchEvent(new CustomEvent("imageFail",{detail:{url:t.source}})),this.dispatchEvent(new CustomEvent("elementAdd",{detail:{element:e}}))};if(void 0===s||0===s.length)console.log("No image source set for: "+e);else if(-1!==s.search("<svg"))fabric.loadSVGFromString(s,(e,t)=>{t=fabric.util.groupSVGElements(e,t);if(n.fill)n.svgFill||(n.svgFill=n.fill),delete n.fill;else if(!n.fill&&!n.svgFill){if(e){o.colors=[];for(var i=0;i<e.length;++i){var s=0<e[i].fill.length?tinycolor(e[i].fill).toHexString():"transparent";o.colors.push(s)}o.svgFill=o.colors}n.svgFill=o.svgFill}delete n.clippingRect,delete n.boundingBox,delete n.originParams,delete n.colors,delete n.svgFill,delete n.width,delete n.height,delete n.originX,delete n.originY,delete n.objectCaching,a(t,n,0,{svgFill:o.svgFill})});else if(s.split(".").includes("svg")){let e=Date.now().toString(),t=this.options._loadFromScript||"",i=l(s)?new URL(t+s):s;!s.includes(".cloudfront.net/")&&!this.options.imageLoadTimestamp||this.options._loadFromScript||i.searchParams.append("t",e),"object"==typeof i&&(i=i.toString()),fabric.loadSVGFromURL(i,(e,t)=>{t=e?fabric.util.groupSVGElements(e,t):null;if(n.fill)n.svgFill||(n.svgFill=n.fill),delete n.fill;else if(!n.fill&&!n.svgFill){if(e){o.colors=[];for(var i=0;i<e.length;++i){var s=0<e[i].fill.length?tinycolor(e[i].fill).toHexString():"transparent";o.colors.push(s)}o.svgFill=o.colors}n.svgFill=o.svgFill}a(t,n,0,{svgFill:o.svgFill})})}else{var i,r=Date.now().toString(),e=this.options._loadFromScript||"";-1==s.indexOf("data:image/")?(i=l(s)?new URL(e+s):s,this.options.imageLoadTimestamp&&!this.options._loadFromScript&&i.searchParams.append("t",r),"object"==typeof i&&(i=i.toString())):i=s,new fabric.Image.fromURL(i,function(e){e=""===e.getSrc()?null:e,a(e,n)},{crossOrigin:"anonymous"})}}else"text"===g(a)?(s=s.replace(/\\n/g,"\n"),o.text=o.text||s,n._initialText=o.hasOwnProperty("_initialText")?o._initialText:o.text,n=c(n,{spacing:o.curveSpacing,radius:o.curveRadius,reverse:o.curveReverse,originParams:{...o}}),o.originParams&&o.originParams.text&&(n.originParams.text=n._initialText),o.curved&&void 0!==fabric.CurvedText?(e=n.text,t=new fabric.CurvedText(s,n),n.text=e):(o.textBox?(n.lockUniScaling=!this.options.editorMode,this.options.setTextboxWidth&&(n.lockUniScaling=!1,n.lockScalingX=!1),n.lockScalingY=!0,(t=new fabric.Textbox(s,n)).setControlVisible("bl",!0)):t=new fabric.IText(s,n),this.options.inCanvasTextEditing||t.on({"editing:entered":function(){this.exitEditing()}})),(n.textPlaceholder||n.numberPlaceholder)&&(n.textPlaceholder&&(this.textPlaceholder=t,n.removable=!1,n.editable=!1),n.numberPlaceholder)&&(this.numberPlaceholder=t,n.removable=!1,n.editable=!1),this.fabricCanvas.add(t),this.setElementParameters(n,t,!1),t.originParams=c(t.toJSON(),t.originParams),delete t.originParams.clipTo,t.originParams.z=this.getZIndex(t),t._isInitial||t._ignore||this.#e({element:t,parameters:n,interaction:"add"}),this.dispatchEvent(new CustomEvent("elementAdd",{detail:{element:t}}))):console.log("Sorry. This type of element is not allowed!")}}setElementParameters(e,t,i=!0){if(!(t=void 0===t?this.fabricCanvas.getActiveObject():t)||void 0===e)return!1;"string"==typeof t&&(t=this.getElementByTitle(t));var s,n,a,o=g(t.type);i&&this.initialElementsLoaded&&(i=this.getElementJSON(),t._tempFill&&(i.fill=t._tempFill,t._tempFill=void 0),t._ignore||this.#e({element:t,parameters:i,interaction:"modify"})),"image"!=g(t.type)||t._isInitial||t._addToUZ||1!==t.scaleX||(s=null,p(t.resizeToW)&&p(t.resizeToH)?t.boundingBox?(i=this.getBoundingBoxCoords(t),s=f(t.width,t.height,i.width,i.height,t.scaleMode)):this.options.fitImagesInCanvas&&(i=3*t.cornerSize,t.width*t.scaleX+i>this.options.stageWidth||t.height*t.scaleY+i>this.options.stageHeight)&&(s=f(t.width,t.height,this.options.stageWidth-i,this.options.stageHeight-i)):(i=t.resizeToW,n=t.resizeToH,i=isNaN(i)?parseFloat(i)/100*this.options.stageWidth:parseInt(i),n=isNaN(n)?parseFloat(n)/100*this.options.stageHeight:parseInt(n),s=f(t.width,t.height,i,n,t.scaleMode)),null!==s&&(e=c(e,{scaleX:s,scaleY:s}))),t._addToUZ&&""!=t._addToUZ&&(e.z=-1,i=this.getElementByTitle(t._addToUZ),s=1,"image"==g(t.type)&&(s=f(t.width,t.height,i.width*i.scaleX,i.height*i.scaleY,i.scaleMode)),(e=c(e,{boundingBox:t._addToUZ,boundingBoxMode:"clipping",scaleX:s,scaleY:s,autoCenter:!0,removable:!0,zChangeable:!1,autoSelect:!1,copyable:!1,hasUploadZone:!0,z:this.getZIndex(this.getElementByTitle(t._addToUZ)),rotatable:i.rotatable,draggable:i.draggable,resizable:i.resizable,price:i.price||e.price,replace:t._addToUZ,lockUniScaling:i.lockUniScaling,uniScalingUnlockable:i.uniScalingUnlockable,advancedEditing:i.advancedEditing,originX:i.originX,originY:i.originY,angle:i.angle})).originParams=c(e.originParams,{boundingBox:e.boundingBox,replace:e.replace,rotatable:e.rotatable,draggable:e.draggable,resizable:e.resizable,lockUniScaling:e.lockUniScaling,uniScalingUnlockable:e.uniScalingUnlockable,price:e.price,scaleX:e.scaleX,scaleY:e.scaleY,hasUploadZone:!0,autoCenter:!0,originX:e.originX,originY:e.originY,angle:e.angle}),delete e[""],delete t._addToUZ),e.topped&&(e.zChangeable=!1),(n=e)&&("object"==typeof n.colors||!0===n.colors||1==n.colors||n.removable||n.draggable||n.resizable||n.rotatable||n.zChangeable||n.advancedEditing||n.editable||n.uploadZone||n.colorLinkGroup&&0<n.colorLinkGroup.length||n.__editorMode)&&(e.isEditable=e.evented=e.selectable=!0),(!e.uploadZone||this.options.editorMode)&&(e.draggable&&(e.lockMovementX=e.lockMovementY=!1),e.rotatable&&(e.lockRotation=!1,e.hasRotatingPoint=!0),e.resizable&&(e.lockScalingX=e.lockScalingY=!1),e.resizable||e.rotatable||e.removable)&&(e.hasControls=!0),e.uploadZone&&(this.options.editorMode||(e.uploadZoneMovable&&(e.lockMovementX=e.lockMovementY=!1),e.uploadZoneRemovable&&(e.removable=!0,e.copyable=!1,e.hasControls=!0)),"3.0.0"!==fabric.version&&(e.lockRotation=!0,e.hasRotatingPoint=!1),e.excludeFromExport=!0),e.fixed&&m(e.replace)&&(e.replace=t.title),e.replace&&""!=e.replace&&null!==(s=this.getElementByReplace(e.replace))&&s!==t&&(e.z=this.getZIndex(s),e.left=t.originParams.left=s.left,e.top=t.originParams.top=s.top,e.autoCenter=!1,this.options.applyFillWhenReplacing&&(e.fill=s.fill),this.removeElement(s)),"string"==typeof e.text&&(a=(a=e.text).replace(FancyProductDesigner.forbiddenTextChars,""),this.options.disableTextEmojis&&(a=(a=a.replace(FPDEmojisRegex,"")).replace(String.fromCharCode(65039),"")),0!=t.maxLength&&a.length>t.maxLength&&(a=a.substr(0,t.maxLength),t.selectionStart=t.maxLength),0!=t.maxLines&&("textbox"==t.type&&t.__lineHeights?a=_maxTextboxLines(t,a):a.split("\n").length>t.maxLines&&(a=a.replace(/([\s\S]*)\n/,"$1"),t.exitEditing())),t.set("text",a),e.text=a,this.initialElementsLoaded)&&t.chargeAfterEditing&&(t._isPriced||(t._isPriced=!0),t._initialText===a)&&t._isPriced&&(t._isPriced=!1),"text"===o&&(e.hasOwnProperty("textDecoration")&&(e.underline="underline"===e.textDecoration),void 0!==e.letterSpacing&&(e.charSpacing=100*e.letterSpacing),e.fontSize&&e.fontSize<t.minFontSize?e.fontSize=t.minFontSize:e.fontSize&&e.fontSize>t.maxFontSize&&(e.fontSize=t.maxFontSize),e.text&&("uppercase"===t.textTransform?a=a.toUpperCase():"lowercase"===t.textTransform&&(a=a.toLowerCase()),t.set("text",a),e.text=a),e.textTransform&&(a=t.text,"uppercase"===e.textTransform?a=a.toUpperCase():"lowercase"===e.textTransform&&(a=a.toLowerCase()),t.set("text",a),e.text=a),(e.shadowColor||e.shadowBlur||e.shadowOffsetX||e.shadowOffsetY)&&!t.shadow&&(i={color:e.shadowColor||"rgba(0,0,0,0)"},t.setShadow(i)),t.shadow&&e.hasOwnProperty("shadowColor")&&(e.shadowColor?t.shadow.color=e.shadowColor:t.setShadow(null)),t.shadow)&&(e.shadowBlur&&(t.shadow.blur=e.shadowBlur),e.shadowOffsetX&&(t.shadow.offsetX=e.shadowOffsetX),e.shadowOffsetY)&&(t.shadow.offsetY=e.shadowOffsetY),delete e.paths,t.setOptions(e),"i-text"==t.type&&t.widthFontSize&&0<t.text.length&&((s=t.width>t.widthFontSize?t.fontSize*(t.widthFontSize/(t.width+1)):t.fontSize*(t.widthFontSize/(t.width-1)))<t.minFontSize?s=t.minFontSize:s>t.maxFontSize&&(s=t.maxFontSize),s=parseInt(s),e.fontSize=s,t.set("fontSize",s)),t.boundingBox&&"clipping"===e.boundingBoxMode||e.hasUploadZone,e.autoCenter,void 0===e.fill&&void 0===e.svgFill||(void 0!==e.svgFill?e.svgFill:e.fill,t.pattern=void 0),e.pattern,e.filter,t.canvas&&0<=e.z&&t.moveTo(e.z),t.curved&&(e.curveRadius&&t.set("radius",e.curveRadius),e.curveSpacing&&t.set("spacing",e.curveSpacing),void 0!==e.curveReverse)&&t.set("reverse",e.curveReverse),t.uploadZone?t.evented=0!==t.opacity:t.isEditable&&!this.options.editorMode&&(t.evented=!e.locked),"basic"==this.options.cornerControlsStyle&&t.lockScalingX&&t.lockScalingY;for(var r=this.fabricCanvas.getObjects(),d=0;d<r.length;++d){var l=r[d];l.uploadZone&&l.title==e.replace&&(l.opacity=0,l.evented=!1)}t.setCoords(),this.fabricCanvas.renderAll().calcOffset(),e.autoSelect&&t.isEditable&&!this.options.editorMode&&$(this.fabricCanvas.getElement()).is(":visible")&&setTimeout(function(){this.stage.setActiveObject(t),this.fabricCanvas.renderAll()},350)}removeElement(e){var t;(e="string"==typeof e?instance.getElementByTitle(e):e)._ignore||((t=instance.getElementJSON(e)).z=instance.getZIndex(e),this.#e({element:e,parameters:t,interaction:"remove"})),this.deselectElement(),setTimeout(function(){this.fabricCanvas.remove(e),_elementHasUploadZone(e),$this.trigger("elementRemove",[e])},1)}getElementByReplace(e){for(var t=this.fabricCanvas.getObjects(),i=0;i<t.length;++i){var s=t[i];if(s.replace===e)return s}return null}getBoundingBoxCoords(e){if(e.boundingBox||e.uploadZone){if("object"==typeof e.boundingBox)return!!(e.boundingBox.hasOwnProperty("x")&&e.boundingBox.hasOwnProperty("y")&&e.boundingBox.width&&e.boundingBox.height)&&{left:e.boundingBox.x,top:e.boundingBox.y,width:e.boundingBox.width,height:e.boundingBox.height};for(var t=this.fabricCanvas.getObjects(),i=0;i<t.length;++i){var s,n=t[i];if(e.boundingBox==n.title)return{left:(s=n.getPointByOrigin("left","top")).x,top:s.y,width:n.width*n.scaleX,height:n.height*n.scaleY,angle:n.angle||0,cp:n.getCenterPoint()}}}return!1}getZIndex(e){return e=void 0===e?this.fabricCanvas.getActiveObject():e,this.fabricCanvas.getObjects().indexOf(e)}getElementByTitle(e){for(var t=this.fabricCanvas.getObjects(),i=0;i<t.length;++i)if(t[i].title===e)return t[i]}getElementByID(e){for(var t=this.fabricCanvas.getObjects(),i=0;i<t.length;++i)if(t[i].id==e)return t[i];return!1}reset(e=!0){this.undos=[],this.redos=[],instance.elements=[],instance.totalPrice=instance.truePrice=instance.additionalPrice=0,instance.stage.clear(),e&&instance.stage.wrapperEl.remove(),$this.trigger("clear"),$this.trigger("priceChange",[0,0])}#e(e,t,i=0){}}class b extends EventTarget{static relevantOptions=["stageWidth","stageHeight","customAdds","elementParameters","imageParameters","textParameters","customImageParameters","customTextParameters","maxPrice","optionalView","designCategories","printingBox","output","layouts","usePrintingBoxAsBounding","threeJsPreviewModel","editorMode","imageLoadTimestamp","_loadFromScript","fitImagesInCanvas","setTextboxWidth","inCanvasTextEditing","applyFillWhenReplacing","disableTextEmojis","cornerControlsStyle","responsive","maxCanvasHeight"];viewData;onCreatedCallback;title;thumbnail;options;fpdCanvas=null;canvasElem=null;fabricCanvas=null;responsiveScale=1;constructor(e,t={},i,s={}){super(),this.viewData=t,this.onCreatedCallback=i,this.title=t.title,this.thumbnail=t.thumbnail,this.options=t.options;i="rgba(84,223,230,1.00)",t=c({containerClass:"fpd-view-stage fpd-hidden",selection:this.options.multiSelection,selectionBorderColor:i,selectionColor:i,hoverCursor:"pointer",controlsAboveOverlay:!0,centeredScaling:!0,allowTouchScrolling:!0,preserveObjectStacking:!0},s);this.fpdCanvas=new v(e,t,this.options),r(this.fpdCanvas,"imageFail",e=>{d(`
                    <p>The image with the URL<br /><i style='font-size: 10px;'>${e.detail.url}</i><br />can not be loaded into the canvas.</p>
                    <p><b>Troubleshooting</b>
                        <ul>
                            <li>The URL is not correct!</li>
                            <li>The image has been blocked by <a href='https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS' target='_blank'>CORS policy</a>. You need to host the image under the same protocol and domain or enable 'Access-Control-Allow-Origin' on the server where you host the image. <a href='http://enable-cors.org/' target='_blank'>Read more about it here.</a><
                            /li>
                        </ul>
                    </p>
                `)}),this.canvasElem=this.fpdCanvas.canvasElem,this.fabricCanvas=this.fpdCanvas.fabricCanvas}init(){this.loadElements(this.viewData.elements,this.#t.bind(this))}loadElements(e,t){this.fpdCanvas.initialElementsLoaded&&this.fpdCanvas.reset(!1),this.fpdCanvas.addElements(e,t)}resetSize(){const e=this.fabricCanvas.wrapperEl.clientWidth;if(this.responsiveScale=e<this.options.stageWidth?e/this.options.stageWidth:1,!isNaN(this.options.maxCanvasHeight)&&1!==this.options.maxCanvasHeight){const e=window.innerHeight*parseFloat(this.options.maxCanvasHeight);this.options.stageHeight>this.options.stageWidth&&this.options.stageHeight*this.responsiveScale>e&&(this.responsiveScale=e/this.options.stageHeight)}return this.responsiveScale=parseFloat(Number(this.responsiveScale.toFixed(7))),this.responsiveScale=Math.min(this.responsiveScale,1),this.options.responsive||(this.responsiveScale=1),this.fabricCanvas.setDimensions({width:e,height:this.options.stageHeight*this.responsiveScale}).setZoom(this.responsiveScale).calcOffset().renderAll(),this.dispatchEvent(new CustomEvent("sizeUpdate",{detail:{}})),this.responsiveScale}#t(){this.onCreatedCallback(this)}}window.FancyProductDesigner=b;const y=t=>{let e=t.url;t.params&&(e+="?"+new URLSearchParams(t.params).toString());const i=new XMLHttpRequest;return i.responseType="json",i.open("GET",e),i.onreadystatechange=e=>{4==i.readyState&&200==i.status?t.onSuccess&&t.onSuccess(i.response):200!==i.status&&t.onError&&t.onError(i)},i.send(),i};class i extends EventTarget{langJSON=null;constructor(){super()}loadLangJSON(t=null,i=()=>{}){!1!==t?"object"==typeof t?(this.langJSON=t,i.call(this)):y({url:t,onSuccess:e=>{this.langJSON=e,i.call(this)},onError:e=>{alert('Language JSON "'+t+'" could not be loaded or is not valid. Make sure you set the correct URL in the options and the JSON is valid!'),i.call(this)}}):i.call(this)}translateElement(e){let t="";var i,s;return this.langJSON&&(i=(e.getAttribute("placeholder")?e.getAttribute("placeholder"):e.getAttribute("title")?e.getAttribute("title"):e.dataset.title||e.innerText).split("."),s=this.langJSON[i[0]])&&void 0!==(t=s[i[1]])||(t=e.dataset.defaulttext),e.getAttribute("placeholder")?(e.setAttribute("placeholder",t),e.innerText=""):e.getAttribute("title")?e.setAttribute("title",t):e.dataset.title?e.dataset.title=t:e.innerText=t,t}getTranslation(e,t,i=""){return this.langJSON&&(e=this.langJSON[e])&&e[t]?e[t]:i}}class e extends HTMLElement{placeholder="";value="";searchable=!1;constructor(){super(),this.innerHTML='<input type="text" class="fpd-dropdown-current"/> <div class="fpd-dropdown-arrow"><span class="fpd-icon-arrow-dropdown"></span></div> <div class="fpd-dropdown-list"> <div class="fpd-scroll-area"></div> </div> '}connectedCallback(){this.addEventListener("click",()=>{this.classList.toggle("fpd-active")}),this.querySelector("input.fpd-dropdown-current").addEventListener("keyup",e=>{if(this.searchable){const t=e.currentTarget.value;this.querySelectorAll(".fpd-dropdown-list .fpd-item").forEach(e=>{0==t.length?e.classList.remove("fpd-hidden"):e.classList.toggle("fpd-hidden",!e.innerText.toLowerCase().includes(t.toLowerCase()))})}})}static get observedAttributes(){return["searchable","placeholder","value"]}attributeChangedCallback(e,t,i){t!==i&&("placeholder"===e?this.querySelector("input.fpd-dropdown-current").setAttribute("placeholder",i):"value"===e?this.querySelector("input.fpd-dropdown-current").value=i:"searchable"===e&&(this.searchable=this.hasAttribute("searchable")))}}customElements.define("fpd-dropdown",e);class t extends HTMLElement{constructor(){super()}connectedCallback(){var e=document.createElement("template");e.innerHTML='<div class="fpd-navigation fpd-scrollbar-hidden"></div> <div class="fpd-module-content"></div> <div class="fpd-close-off-canvas"> <span class="fpd-icon-close"></span> </div> <div class="fpd-draggable-dialog fpd-container fpd-shadow-2"> <div class="fpd-dialog-head"> <div class="fpd-dialog-drag-handle"> <div> <span class="fpd-icon-drag"></span><span class="fpd-dialog-title"></span> </div> </div> <div class="fpd-close-dialog"> <span class="fpd-icon-close"></span> </div> </div> </div> ',this.append(e.content.cloneNode(!0))}}customElements.define("fpd-main-bar",t);class x extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-grid" data-defaulttext="Swap Product" data-title="modules.products"> <fpd-dropdown class="fpd-product-categories" searchable></fpd-dropdown> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-contain fpd-padding"> </div> </div> </div>'}}customElements.define("fpd-module-products",x);class w extends EventTarget{currentCategoryIndex=0;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-products"),t.append(this.container),e.addEventListener("productsSet",e=>{const s=this.container.querySelector(".fpd-dropdown-list > .fpd-scroll-area");s.innerHTML="",this.fpdInstance.products&&0<this.fpdInstance.products.length&&(void 0!==this.fpdInstance.products[0].category&&1<this.fpdInstance.products.length&&(this.container.classList.add("fpd-categories-enabled"),this.fpdInstance.products.forEach((e,t)=>{var i=document.createElement("span");i.className="fpd-item",i.dataset.index=t,i.innerText=e.category,i.addEventListener("click",e=>{this.selectCategory(e.currentTarget.dataset.index)}),s.append(i)})),this.#i(),this.selectCategory(0))}),e.addEventListener("productAdd",(e,t,i,s)=>{s==this.currentCategoryIndex&&this.#s(t)})}#i(){if(!this.fpdInstance.mainOptions.editorMode){let e=this.fpdInstance.products[0],t=void 0===e;void 0!==e&&(t=!!(!e.hasOwnProperty("category")&&this.fpdInstance.products.length<2||e.hasOwnProperty("category")&&e.products.length<2&&this.fpdInstance.products.length<2)),this.fpdInstance.container.classList.toggle("fpd-products-module-hidden",t)}}#s(e,i){var t=e[0].productThumbnail||e[0].thumbnail,e=e[0].productTitle||e[0].title,s=document.createElement("div"),e=(s.className="fpd-item",s.dataset.title=e,s.dataset.source=t,s.dataset.index=i,s.addEventListener("click",e=>{if(e.preventDefault(),this.fpdInstance.mainOptions.swapProductConfirmation){var t=d(this.fpdInstance.translator.getTranslation("modules","products_confirm_replacement"),!1,"confirm",this.fpdInstance.container);const e=t.querySelector(".fpd-confirm");e.innerText=this.fpdInstance.translator.getTranslation("modules","products_confirm_button"),r(e,["click"],()=>{this.fpdInstance.selectProduct(i,this.currentCategoryIndex),t.remove()})}else this.fpdInstance.selectProduct(Number(e.currentTarget.dataset.index),this.currentCategoryIndex)}),this.container.querySelector(".fpd-grid").append(s),document.createElement("picture"));e.dataset.img=t,s.append(e),this.fpdInstance.lazyBackgroundObserver.observe(e)}selectCategory(t=0){if(this.currentCategoryIndex=t,this.container.querySelector(".fpd-grid").innerHTML="",this.fpdInstance.products&&0<this.fpdInstance.products.length){let e;void 0!==this.fpdInstance.products[0].category?(e=this.fpdInstance.products[t].products,this.container.querySelector(".fpd-dropdown-current").value=this.fpdInstance.products[t].category):e=this.fpdInstance.products.products,e.forEach((e,t)=>{this.#s(e,t)})}}}class S extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-text-secondary" data-defaulttext="Add Text" data-title="modules.text"> <div class="fpd-add-text"> <textarea data-defaulttext="Enter some text" placeholder="modules.text_input_placeholder"></textarea> <div class="fpd-textbox-wrapper"> <span class="fpd-section-title" data-defaulttext="Optional: Enter a fixed width"> modules.enter_textbox_width </span> <input type="number" class="fpd-textbox-width" value="" step="1" min="0"> </div> <div class="fpd-btn"> <span data-defaulttext="Add Text">modules.text_add_btn</span> <span class="fpd-price"></span> </div> </div> <div class="fpd-text-templates fpd-scroll-area"> <div class="fpd-grid"></div> </div> </div>'}}customElements.define("fpd-module-text",S);class E extends EventTarget{#n;constructor(n,e){var a;super(),this.fpdInstance=n,this.container=document.createElement("fpd-module-text"),e.append(this.container),Boolean(n.mainOptions.setTextboxWidth)||this.container.querySelector(".fpd-textbox-wrapper").classList.add("fpd-hidden"),this.container.querySelector(".fpd-btn").addEventListener("click",e=>{let t=this.container.querySelector("textarea"),i=t.value;if(n.currentViewInstance&&0<i.length){const e=this.container.querySelector(".fpd-textbox-width"),t=parseInt(e.value);e.value="";var s=c(currentViewOptions.customTextParameters,{isCustom:!0,_addToUZ:n.currentViewInstance.currentUploadZone});isNaN(t)||(s.textBox=!0,s.width=t,s.resizable=!0),n.addElement("text",i,i,s)}t.value=""}),r(this.container.querySelector("textarea"),["input","change"],e=>{let t=e.currentTarget.value,i=this.#n?this.#n.customTextParameters.maxLength:0,s=this.#n?this.#n.customTextParameters.maxLines:0;t=t.replace(FancyProductDesigner.forbiddenTextChars,""),n.mainOptions.disableTextEmojis&&(t=(t=t.replace(FPDEmojisRegex,"")).replace(String.fromCharCode(65039),"")),0!=i&&t.length>i&&(t=t.substr(0,i)),0!=s&&t.split("\n").length>s&&(t=t.replace(/([\s\S]*)\n/,"$1")),e.currentTarget.value=t}),Array.isArray(n.mainOptions.textTemplates)&&(a=this.container.querySelector(".fpd-text-templates .fpd-grid"),n.mainOptions.textTemplates.forEach(e=>{var t=e.properties,i="font-family:"+(t.fontFamily||"Arial"),t=(i+="; text-align:"+(t.textAlign||"left"),document.createElement("div")),s=(t.className="fpd-item",t.dataset.props=JSON.stringify(e.properties),t.dataset.text=e.text,t.addEventListener("click",e=>{n.currentViewInstance&&((e=JSON.parse(e.currentTarget.dataset.props)).isCustom=!0,e._addToUZ=n.currentViewInstance.currentUploadZone,e=c(currentViewOptions.customTextParameters,e),n.addElement("text",this.dataset.text,this.dataset.text,e))}),document.createElement("div"));s.setAttribute("style",i),s.innerHTML=e.text.replace(/(?:\r\n|\r|\n)/g,"<br>"),t.append(s),a.append(t)})),n.addEventListener("viewSelect",e=>{})}}class I extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-design-library" data-defaulttext="Add Designs" data-title="modules.designs"> <div class="fpd-head"> <div class="fpd-input-back-search"> <div class="fpd-back fpd-btn"> <span class="fpd-icon-back"></span> </div> <div class="fpd-input-search"> <input type="text"/> <span class="fpd-icon-magnify"></span> </div> </div> </div> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-contain"></div> </div> </div>'}}customElements.define("fpd-module-designs",I);class C extends EventTarget{#a="";#o=!1;#r=[];#d=null;#l=null;constructor(i,e,t=null){super(),this.#a=i.translator.getTranslation("modules","designs_search_in").toUpperCase(),this.fpdInstance=i,this.#l=t,this.container=document.createElement("fpd-module-designs"),e.append(this.container),t&&(this.container.dataset.dynamicDesignsId=t),this.headElem=this.container.querySelector(".fpd-head"),this.gridElem=this.container.querySelector(".fpd-grid"),this.headElem.querySelector(".fpd-input-search input").addEventListener("keyup",e=>{var t=e.currentTarget,i=this.gridElem.querySelectorAll(".fpd-item");if(""==t.value)for(var s of i)s.classList.remove("fpd-hidden");else{const e=t.value.toLowerCase().trim();for(var n of i)n.classList.add("fpd-hidden"),n.dataset.search.includes(e)&&n.classList.remove("fpd-hidden")}}),this.headElem.querySelector(".fpd-back").addEventListener("click",e=>{0<this.gridElem.querySelectorAll(".fpd-category").length&&this.#r.pop();let t,i=this.fpdInstance.designs;this.#r.forEach(e=>{t=i[e],i=t.category}),(this.#d=i)&&this.#c(this.#d,t),void 0===t&&this.toggleCategories()}),i.addEventListener("designsSet",e=>{var t=i.designs;Array.isArray(t)&&0!==t.length&&(t[0].hasOwnProperty("source")?(this.container.classList.add("fpd-single-cat"),this.#p(t)):1<t.length||t[0].category?(this.#o=!0,this.toggleCategories()):1===t.length&&t[0].designs&&(this.container.classList.add("fpd-single-cat"),this.#p(t[0].designs)))})}#c(e,t){this.gridElem.innerHTML="",this.gridElem.classList.remove("fpd-padding"),this.headElem.querySelector(".fpd-input-search input").value="",this.container.classList.remove("fpd-designs-active"),this.container.classList.add("fpd-categories-active"),e.forEach((e,t)=>{this.#h(e)}),t&&(this.headElem.querySelector(".fpd-input-search input").setAttribute("placeholder",this.#a+" "+t.title.toUpperCase()),this.container.classList.add("fpd-head-visible"))}#h(e){var t,i=document.createElement("div");i.className="fpd-category fpd-item",i.dataset.search=e.title.toLowerCase(),e.thumbnail?((t=document.createElement("picture")).dataset.img=e.thumbnail,i.append(t),this.fpdInstance.lazyBackgroundObserver.observe(t),(t=document.createElement("span")).innerText=e.title,i.append(t)):i.innerHTML="<span>"+e.title+"</span>",i.addEventListener("click",e=>{var e=e.currentTarget,t=Array.from(this.gridElem.querySelectorAll(".fpd-item")).indexOf(e),i=this.#d[t];i.category?(this.#r.push(t),this.#d=i.category,this.#c(this.#d,i)):this.#p(i.designs,i.parameters),this.headElem.querySelector(".fpd-input-search input").setAttribute("placeholder",this.#a+" "+e.dataset.search.toUpperCase())}),this.gridElem.append(i)}#p(e,t={}){this.gridElem.innerHTML="",this.gridElem.classList.add("fpd-padding"),this.headElem.querySelector(".fpd-input-search input").value="",this.container.classList.remove("fpd-categories-active"),this.container.classList.add("fpd-designs-active","fpd-head-visible"),e.forEach(e=>{e.parameters=c(t,e.parameters),this.#u(e)})}#u(e){e.thumbnail=void 0===e.thumbnail?e.source:e.thumbnail;var t=s({url:e.source,thumbnailUrl:e.thumbnail,title:e.title,price:this.fpdInstance.formatPrice(e.parameters.price)});t.dataset.search=e.title.toLowerCase(),t.dataset.parameters=e.parameters,t.addEventListener("click",e=>{e=e.currentTarget;this.fpdInstance._addCanvasDesign(e.dataset.source,e.dataset.title,e.dataset.parameters)}),this.gridElem.append(t),this.fpdInstance.lazyBackgroundObserver.observe(t.querySelector("picture"))}toggleCategories(){if(this.#o){this.#r=[],this.container.classList.remove("fpd-head-visible","fpd-single-cat"),this.#d=this.fpdInstance.designs,this.#c(this.#d);let e=[];this.#l&&(e=this.fpdInstance.mainOptions.dynamicDesigns[this.#l].categories),this.fpdInstance.currentViewInstance&&(t=this.fpdInstance.currentViewInstance.currentElement,e=(t&&t.uploadZone&&t.designCategories?this.fpdInstance.currentViewInstance.currentElement:this.fpdInstance.currentViewInstance.options).designCategories);var t,i=this.container.querySelectorAll(".fpd-category");if(0<e.length){const t=[];for(var s of i)e.includes(s.dataset.search)?(s.classList.remove("fpd-hidden"),t.push(s)):s.classList.add("fpd-hidden");1===t.length&&(this.container.classList.add("fpd-single-cat"),t[0].click())}else for(var n of i)n.classList.remove("fpd-hidden")}}}class T extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-design-library" data-defaulttext="Text to Image" data-title="modules.text_to_image"> <div class="fpd-head"> <textarea></textarea> <div class="fpd-btn"> <span data-defaulttext="Generate">modules.text_to_image_generate</span> </div> </div> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover"></div> </div> </div>'}}customElements.define("fpd-module-text-to-image",T);class L extends EventTarget{#g="https://radykal.dep/fpd-js/server/php/sd-api.php";#m=!1;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-text-to-image"),t.append(this.container),this.inputElem=this.container.querySelector(".fpd-head textarea"),this.gridElem=this.container.querySelector(".fpd-grid"),this.container.querySelector(".fpd-head .fpd-btn").addEventListener("click",e=>{const t=e.currentTarget;m(this.inputElem.value)||this.#m||(this.#m=!0,t.classList.add("fpd-loading"),e={action:"text2img",prompt:this.inputElem.value,numOfImg:2},fetch(this.#g,{method:"POST",redirect:"follow",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{e=JSON.parse(e),console.log(e),e&&e.output&&this.#f(e.output),this.#m=!1,t.classList.remove("fpd-loading")}).catch(e=>{this.#m=!1,t.classList.remove("fpd-loading")}))})}#f(e=[]){e.forEach(e=>{var t=document.createElement("div");t.className="fpd-item",t.dataset.source=e,t.innerHTML='<picture data-img="'+e+'"></picture><span class="fpd-price"></span>',this.gridElem.append(t),t.addEventListener("click",e=>{e=e.currentTarget;this.fpdInstance._addCanvasDesign(e.dataset.source,e.dataset.title,e.dataset.parameters)}),this.fpdInstance.lazyBackgroundObserver.observe(t.querySelector("picture"))})}}class O extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div data-moduleicon="fpd-icon-photo" data-defaulttext="Add Image" data-title="modules.images"> <div class="fpd-module-tabs"> <div data-context="upload" class="fpd-active"> <span class="fpd-icon-cloud-upload"></span> </div> <div data-context="facebook" class="fpd-hidden" title="Facebook"> <span class="fpd-icon-facebook"></span> </div> <div data-context="instagram" class="fpd-hidden" title="Instagram"> <span class="fpd-icon-instagram"></span> </div> <div data-context="pixabay" class="fpd-hidden" title="Pixabay"> <span class="fpd-icon-pixabay"></span> </div> </div> <div class="fpd-module-tabs-content"> <div data-context="upload" class="fpd-active"></div> <div data-context="facebook"></div> <div data-context="instagram"></div> <div data-context="pixabay"></div> </div> </div>'}}customElements.define("fpd-module-images",O);class P extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-upload-zone"> <div> <span class="fpd-icon-file-upload"></span> <span data-defaulttext="Click or drop images here">modules.upload_zone</span> <span class="fpd-price"></span> </div> </div> <input type="file" multiple="multiple" class="fpd-upload-input fpd-hidden" name="files[]" accept="image/jpeg,image/jpg,image/png,image/svg+xml,application/pdf"/> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover fpd-photo-grid"></div> </div>'}}customElements.define("fpd-module-uploads",P);const k=(e="",t=!0)=>{let i=document.body.querySelector(".fpd-snackbar-wrapper");i||((i=document.createElement("div")).className="fpd-snackbar-wrapper",document.body.append(i));const s=document.createElement("div");return s.className="fpd-snackbar fpd-shadow-1",s.innerHTML="<p>"+e+"</p>",s.addEventListener("click",e=>{s.remove()}),i.append(s),t&&setTimeout(function(){s.remove()},5e3),s};class _ extends EventTarget{#v;#b=0;#y=!1;#x=[];#w=0;constructor(t,e){super();var i=(this.fpdInstance=t).mainOptions.customImageAjaxSettings,i=(this.postUrl=i.url,this.uploadsDir=i.data&&i.data.uploadsDir?i.data.uploadsDir:"",this.uploadsDirURL=i.data&&i.data.uploadsDirURL?i.data.uploadsDirURL:"",this.container=document.createElement("fpd-module-uploads"),e.append(this.container),this.gridElem=this.container.querySelector(".fpd-grid"),this.container.querySelector(".fpd-upload-zone"));this.#v=t.mainOptions.allowedImageTypes,this.#v.includes("jpeg")&&!this.#v.includes("jpg")&&this.#v.push("jpg");const s=this.container.querySelector(".fpd-upload-input");let n=[];if(this.#v.forEach(e=>{"pdf"==e?n.push("application/pdf"):("svg"==e&&(e+="+xml"),n.push("image/"+e))}),s.setAttribute("accept",n.join()),r(i,"click",async e=>{e.preventDefault(),s.click()}),r(s,"change",e=>{this.#I(e.currentTarget.files)}),r(i,["dragover","dragleave"],e=>{e.stopPropagation(),e.preventDefault(),e.currentTarget.classList.toggle("fpd-hover","dragover"===e.type)}),r(i,"drop",e=>{e.stopPropagation(),e.preventDefault();e=e.target.files||e.dataTransfer.files;this.#I(e)}),r(t,"productCreate",e=>{this.#y=!1}),o,window.localStorage.getItem("fpd_uploaded_images")){const t=JSON.parse(window.localStorage.getItem("fpd_uploaded_images"));t.forEach(e=>{this.#E(e.url,e.title);var s=new Image;s.src=e.url,s.onerror=function(){var i=null;t.forEach(function(e,t){e.url==s.src&&(i=t)}),null!=i&&(t.splice(i,1),window.localStorage.setItem("fpd_uploaded_images",JSON.stringify(t)))}})}}#I(e){var t,i;this.fpdInstance.mainOptions.uploadAgreementModal?((i=(t=d(this.fpdInstance.translator.getTranslation("modules","images_agreement"),!1,"confirm",this.fpdInstance.container)).querySelector(".fpd-confirm")).innerText=this.fpdInstance.translator.getTranslation("modules","images_confirm_button"),r(i,["click"],()=>{this.#S(e),t.remove()})):this.#S(e)}#S(e){this.#b=0,this.#w=e.length,this.fpdInstance.loadingCustomImage=!0,Array.from(e).forEach((e,t)=>{this.#v.includes(e.name.split(".").pop().toLowerCase().split("?")[0])&&this.#C(e,0==t)}),this.container.querySelector(".fpd-upload-zone").classList.remove("fpd-hover")}#C(e,t){var i=1024*this.fpdInstance.mainOptions.customImageParameters.maxSize*1024;e.size>i?(k(this.fpdInstance.translator.getTranslation("misc","maximum_size_info").replace("%filename",e.name).replace("%mb",this.fpdInstance.mainOptions.customImageParameters.maxSize)),this.fpdInstance.loadingCustomImage=!1):"application/pdf"===e.type?this.#T(e,t):this.#L(e,t)}#L(n,a=!1){const o=this.fpdInstance.mainOptions,e=o.customImageAjaxSettings,r=e.data&&e.data.saveOnServer?1:0,t=new FileReader;t.onload=t=>{t=t.currentTarget.result;if("image/jpeg"===n.type&&o.customImageParameters.minDPI){const a=new JpegMeta.JpegFile(atob(t.replace(/^.*?,/,"")),n.name);let e=null;if(a.tiff&&a.tiff.XResolution&&a.tiff.XResolution.value?(i=a.tiff.XResolution.value.den,e=a.tiff.XResolution.value.num/i):a.jfif&&a.jfif.Xdensity&&a.jfif.Xdensity.value&&(e=a.jfif.Xdensity.value),null!==e){if(console.log(n.name+" Real Resolution: "+e),e<o.customImageParameters.minDPI){let e=this.fpdInstance.translator.getTranslation("misc","minimum_dpi_info");return e=e.replace("%dpi",o.customImageParameters.minDPI),d(e,!1,"",this.fpdInstance.container),this.fpdInstance.loadingCustomImage=!1}}else console.log(n.name+": Resolution is not accessible.")}const s=this.#E(t,n.name);r&&(s.classList.add("fpd-loading"),s.insertAdjacentHTML("beforeend",'<div class="fpd-loading-bar"><div class="fpd-loading-progress"></div></div>'));var i=new Image;i.onload=e=>{var e=e.currentTarget,t=e.height,i=e.width;if(this.fpdInstance.currentViewInstance.options.customImageParameters,((t,e,i)=>{console.log(e);var s=t.currentViewInstance,n=s.options.customImageParameters;if(e>n.maxW||e<n.minW||i>n.maxH||i<n.minH){t.loadingCustomImage=!1,console.log(t.mainBar),t.mainBar&&(t.mainBar.toggleContentDisplay(!1),s.currentUploadZone)&&t.mainBar.toggleUploadZonePanel(!1);let e=t.translator.getTranslation("misc","uploaded_image_size_alert");return e=e.replace("%minW",n.minW).replace("%minH",n.minH).replace("%maxW",n.maxW).replace("%maxH",n.maxH),d(e),!1}return!0})(this.fpdInstance,i,t))if(r){i=new FormData;i.append("uploadsDir",this.uploadsDir),i.append("uploadsDirURL",this.uploadsDirURL),i.append("images[]",n);const d=new XMLHttpRequest;d.responseType="json",d.onreadystatechange=e=>{if(d.readyState===XMLHttpRequest.DONE){const e=d.status;if(0===e||200<=e&&e<400){const e=d.response;e.image_src&&(this.#O(e.image_src,e.filename),s.dataset.source=e.image_src,s.classList.remove("fpd-loading"),s.querySelector(".fpd-loading-bar").remove(),this.#P(s,a),this.#b++,s.xhr=null),this.fpdInstance.loadingCustomImage=!1}}},d.upload.onprogress=e=>{var t=e.total,e=e.loaded,e=parseInt(100*e/t);s.querySelector(".fpd-loading-progress").style.width=e+"%"},d.upload.onerror=e=>{this.fpdInstance.loadingCustomImage=!1,s.remove(),k("Upload failed. Please try again or check your web console!")},d.open("POST",this.postUrl),d.send(i),s.xhr=d}else this.#O(e,n.name),this.#P(s,a),this.#b++;else s.remove(),this.fpdInstance.currentViewInstance.currentUploadZone=null},i.src=t},t.readAsDataURL(n)}#T(e,t=0){this.fpdInstance.mainOptions;const i=k(this.fpdInstance.translator.getTranslation("modules","images_pdf_upload_info"),!1),s=new FormData,n=(s.append("uploadsDir",this.uploadsDir),s.append("uploadsDirURL",this.uploadsDirURL),s.append("pdf",e),new XMLHttpRequest);n.responseType="json",n.onreadystatechange=e=>{if(n.readyState===XMLHttpRequest.DONE){const e=n.status;if(0===e||200<=e&&e<400){const e=n.response;this.#w--,e.pdf_images.forEach((e,t)=>{var i=this.#E(e.image_url,e.filename);this.#P(i,0==t),this.#O(e.image_url,e.filename),this.#b++}),i.remove(),this.#w++,this.fpdInstance.loadingCustomImage=!1}}},n.upload.onerror=()=>{this.fpdInstance.loadingCustomImage=!1,i.remove(),k("Upload failed. Please try again or check your web console!")},n.open("POST",this.postUrl),n.send(s)}#O(e,t){o;var i=window.localStorage.getItem("fpd_uploaded_images")?JSON.parse(window.localStorage.getItem("fpd_uploaded_images")):[];i.push({url:e,title:t}),window.localStorage.setItem("fpd_uploaded_images",JSON.stringify(i))}#E(e,t){const i=s({url:e,title:t,price:this.fpdInstance.formatPrice(this.fpdInstance.currentViewInstance.options.customImageParameters.price),removable:!0});return this.gridElem.append(i),this.fpdInstance.lazyBackgroundObserver.observe(i.querySelector("picture")),r(i,["click"],e=>{this.fpdInstance.loadingCustomImage||this.fpdInstance._addGridItemToCanvas(e.currentTarget)}),r(i.querySelector(".fpd-delete"),"click",e=>{e.stopPropagation(),e.preventDefault();var t,e=Array.from(this.gridElem.children).indexOf(i);i.classList.contains("fpd-loading")||((t=JSON.parse(window.localStorage.getItem("fpd_uploaded_images"))).splice(e,1),window.localStorage.setItem("fpd_uploaded_images",JSON.stringify(t)),i.xhr&&i.xhr.abort(),i.remove())}),i}#P(e,t){if(!this.#y&&this.fpdInstance.mainOptions.autoFillUploadZones){const t=this.#x[this.#b]||null;t&&this.fpdInstance._addGridItemToCanvas(e,{_addToUZ:t.uz},t.viewIndex)}else t&&this.fpdInstance._addGridItemToCanvas(e);this.#b==this.#w-1&&(this.#y=!0)}#k(s,e){var n,a,o,r,d,t=this.fpdInstance.mainOptions.imageQualityRatings;t&&"object"==typeof t&&(n=t.low||null,a=t.mid||null,o=t.high||null,r="fpd-icon-star",d="fpd-icon-star-outline",(t=new Image).onload=function(){var e,t,i=s.append('<div class="fpd-image-quality-ratings"></div>').children(".fpd-image-quality-ratings");n&&2==n.length&&(t=this.width<Number(n[0])||this.height<Number(n[1])?d:r,i.append('<span class="'+t+'"></span>'),t==r)&&(e=fpdInstance.getTranslation("misc","image_quality_rating_low")),a&&2==a.length&&(t=this.width<Number(a[0])||this.height<Number(a[1])?d:r,i.append('<span class="'+t+'"></span>'),t==r)&&(e=fpdInstance.getTranslation("misc","image_quality_rating_mid")),(e=o&&2==o.length&&(t=this.width<Number(o[0])||this.height<Number(o[1])?d:r,i.append('<span class="'+t+'"></span>'),t==r)?fpdInstance.getTranslation("misc","image_quality_rating_high"):e)&&i.data("quality-label",e)},t.src=e)}}class H extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-head"> <div class="fpd-facebook-login"> <fb:login-button data-max-rows="1" data-show-faces="false" data-scope="user_photos"> </fb:login-button> </div> <fpd-dropdown class="fpd-facebook-albums" placeholder="Select An Album" searchable></fpd-dropdown> </div> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover fpd-photo-grid"></div> </div>'}}customElements.define("fpd-module-facebook-images",H);class M extends EventTarget{constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-facebook-images"),t.append(this.container),this.dropdown=this.container.querySelector("fpd-dropdown"),this.dropdownList=this.container.querySelector(".fpd-dropdown-list"),this.gridElem=this.container.querySelector(".fpd-grid"),this.#_()}#_(){var e=document.createElement("script");e.src="//connect.facebook.com/en_US/sdk.js",e.addEventListener("load",()=>{FB.init({appId:this.fpdInstance.mainOptions.facebookAppId,autoLogAppEvents:!0,xfbml:!0,version:"v16.0"}),FB.getLoginStatus(this.#D.bind(this)),FB.Event.subscribe("auth.statusChange",this.#D.bind(this))}),document.body.appendChild(e)}#D(e){"connected"===e.status&&(h(this.container,["fpd-facebook-logged-in"]),FB.api("/me/albums?fields=name,count,id",e=>{e.data.forEach(e=>{var t=document.createElement("span");t.className="fpd-item",t.dataset.albumid=e.id,t.innerText=e.name,t.addEventListener("click",e=>{this.dropdown.setAttribute("value",e.currentTarget.innerText),this.#U(e.currentTarget.dataset.albumid)}),this.dropdownList.append(t)}),u(this.dropdown,["fpd-on-loading"])}))}#U(t){this.gridElem.innerHTML="",h(this.dropdown,["fpd-on-loading"]),FB.api("/"+t+"?fields=count",e=>{e=e.count;FB.api("/"+t+"?fields=photos.limit("+e+").fields(source,images)",e=>{u(this.dropdown,["fpd-on-loading"]),e.error||e.photos.data.forEach(e=>{var t=(e.images[0]||e).source,i=(e.images[e.images.length-1]?e.images[e.images.length-1]:e).source,t=s({url:t,thumbnailUrl:i,title:e.id,price:this.fpdInstance.formatPrice(this.fpdInstance.currentViewInstance.options.customImageParameters.price)});r(t,["click"],e=>{this.fpdInstance.loadingCustomImage||this.fpdInstance._addGridItemToCanvas(e.currentTarget)}),this.gridElem.append(t),this.fpdInstance.lazyBackgroundObserver.observe(t.querySelector("picture"))}),this.fpdInstance.toggleSpinner(!1)})})}}class A extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover fpd-photo-grid"></div> </div>'}}customElements.define("fpd-module-instagram-images",A);class z extends EventTarget{accessToken=null;nextStack=null;loadingStack=!1;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-instagram-images"),t.append(this.container),this.gridElem=this.container.querySelector(".fpd-grid");const i=this.container.querySelector(".fpd-scroll-area");i.addEventListener("scroll",e=>{var t=i.scrollHeight;i.clientHeight+i.scrollTop+100>t&&(null===this.nextStack||this.loadingStack||this.#M(this.nextStack,!1))})}authenticate(){const e=this.fpdInstance.mainOptions;if(o()){const e=window.localStorage.getItem("fpd_insta_access_token");if(!m(e))return this.accessToken=e,void this.#M()}var t=(window.screen.width-700)/2,i=(window.screen.height-500)/2,s={app_id:e.instagramClientId,redirect_uri:e.instagramRedirectUri,scope:"user_profile,user_media",response_type:"code"},s=new URLSearchParams(s).toString(),n=window.open("https://api.instagram.com/oauth/authorize?"+s,"","width=700,height=500,left="+t+",top="+i),a=setInterval(()=>{n.closed&&clearInterval(a);try{var e;n.location&&n.location.href&&(e=new URL(n.location.href).searchParams.get("code"))&&(e=e.replace("#_",""),this.#A(e),n.close())}catch(e){}},500)}#A(e){var t=this.fpdInstance.mainOptions;this.fpdInstance.toggleSpinner(!0),y({url:t.instagramTokenUri,params:{code:e,client_app_id:t.instagramClientId,redirect_uri:t.instagramRedirectUri},onSuccess:e=>{e.access_token?(o()&&window.localStorage.setItem("fpd_insta_access_token",e.access_token),this.accessToken=e.access_token,this.#M()):e.error_message&&(console.log(e),this.fpdInstance.toggleSpinner(!1))},onError:e=>{console.log(e),this.fpdInstance.toggleSpinner(!1)}})}#M(e="https://graph.instagram.com/me/media",t=!0){this.loadingStack=!0,this.fpdInstance.toggleSpinner(!0);e={url:e,onSuccess:e=>{e.data&&(this.nextStack=e.paging&&e.paging.next?e.paging.next:null,e.data.forEach(e=>{"VIDEO"!==e.media_type&&(e=s({url:e.media_url,thumbnailUrl:e.thumbnail_url||e.media_url,title:e.id,price:this.fpdInstance.formatPrice(this.fpdInstance.currentViewInstance.options.customImageParameters.price)}),r(e,["click"],e=>{this.fpdInstance.loadingCustomImage||this.fpdInstance._addGridItemToCanvas(e.currentTarget)}),this.gridElem.append(e),this.fpdInstance.lazyBackgroundObserver.observe(e.querySelector("picture")))})),this.fpdInstance.toggleSpinner(!1),this.loadingStack=!1},onError:e=>{e.response&&e.response.error&&e.response.error.code&&o()&&190==e.response.error.code&&(window.localStorage.removeItem("fpd_insta_access_token"),this.accessToken=null,this.authenticate()),this.fpdInstance.toggleSpinner(!1),this.loadingStack=!1}};t&&(this.gridElem.innerHTML="",e.params={fields:"id,caption,media_url,media_type",access_token:this.accessToken}),y(e)}}class U extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<div class="fpd-loader-wrapper"> <div class="fpd-loader"> <div class="fpd-loader-circle"></div> </div> </div> <div class="fpd-head"> <a href="https://pixabay.com/" target="_blank" class="fpd-pixabay-logo"> </a> <div class="fpd-input-search"> <input type="text" data-defaulttext="Search in Pixabay library" placeholder="modules.pixabay_search"/> <span class="fpd-icon-magnify"></span> </div> </div> <div class="fpd-scroll-area"> <div class="fpd-grid fpd-grid-cover fpd-photo-grid"></div> </div>'}}customElements.define("fpd-module-pixabay-images",U);class F extends EventTarget{loadingStack=!1;currentQuery="";pixabayPage=1;constructor(e,t){super(),this.fpdInstance=e,this.container=document.createElement("fpd-module-pixabay-images"),t.append(this.container),this.gridElem=this.container.querySelector(".fpd-grid"),this.loader=this.container.querySelector(".fpd-loader-wrapper");const i=this.container.querySelector(".fpd-scroll-area");i.addEventListener("scroll",e=>{var t=i.scrollHeight;i.clientHeight+i.scrollTop+100>t&&(this.loadingStack||(this.pixabayPage++,this.loadImages(void 0,!1)))}),r(this.container.querySelector("input"),["keypress"],e=>{13==e.which&&(this.pixabayPage=1,this.loadImages(e.currentTarget.value))})}loadImages(e,t=!0){if(this.currentQuery===e)return!1;var i=this.fpdInstance.mainOptions,e=(this.loadingStack=!0,this.currentQuery=void 0===e?this.currentQuery:e,i.pixabayHighResImages?"&response_group=high_resolution":""),e="https://pixabay.com/api/?safesearch=true&key="+i.pixabayApiKey+"&page="+this.pixabayPage+"&per_page=40&min_width="+i.customImageParameters.minW+"&min_height="+i.customImageParameters.minH+e+"&q="+encodeURIComponent(this.currentQuery)+"&lang="+i.pixabayLang;t&&(this.gridElem.innerHTML=""),u(this.loader,["fpd-hidden"]),y({url:e,onSuccess:e=>{h(this.loader,["fpd-hidden"]),0<e.hits.length&&e.hits.forEach(e=>{e=s({url:e.imageURL||e.webformatURL,thumbnailUrl:e.webformatURL,title:e.id||e.id_hash,price:this.fpdInstance.formatPrice(this.fpdInstance.currentViewInstance.options.customImageParameters.price)});r(e,["click"],e=>{this.fpdInstance.loadingCustomImage||this.fpdInstance._addGridItemToCanvas(e.currentTarget)}),this.gridElem.append(e),this.fpdInstance.lazyBackgroundObserver.observe(e.querySelector("picture"))}),this.loadingStack=!1},onError:e=>{h(this.loader,["fpd-hidden"])}})}}class q extends EventTarget{constructor(n,e){super(),this.fpdInstance=n,this.container=document.createElement("fpd-module-images"),e.append(this.container);const i=Array.from(this.container.querySelectorAll(".fpd-module-tabs > div")),s=Array.from(this.container.querySelectorAll(".fpd-module-tabs-content > div"));let a=null,o=null;r(i,"click",e=>{const t=e.currentTarget;u(i,["fpd-active"]),u(s,["fpd-active"]),h(t,["fpd-active"]),h(s.find(e=>e.dataset.context==t.dataset.context),["fpd-active"]),"instagram"==t.dataset.context&&a&&!a.accessToken?a.authenticate():"pixabay"==t.dataset.context&&o&&o.loadImages()});e=n.mainOptions;new _(n,s.find(e=>"upload"==e.dataset.context)),r(n,["viewSelect","secondaryModuleCalled"],i=>{if(n.currentViewInstance){let e=n.currentViewInstance.options,t=null;if(n.currentViewInstance.currentUploadZone){const i=n.currentViewInstance.getUploadZone(n.currentViewInstance.currentUploadZone);i&&i.price&&(t=i.price)}null==t&&e.customImageParameters&&e.customImageParameters.price&&(t=n.formatPrice(e.customImageParameters.price));var s=this.container.querySelector(".fpd-upload-zone .fpd-price");s&&(s.innerHTML=t||"")}}),m(e.facebookAppId)||(new M(n,s.find(e=>"facebook"==e.dataset.context)),i.find(e=>"facebook"==e.dataset.context).classList.remove("fpd-hidden")),m(e.instagramClientId)||(a=new z(n,s.find(e=>"instagram"==e.dataset.context)),i.find(e=>"instagram"==e.dataset.context).classList.remove("fpd-hidden")),m(e.pixabayApiKey)||(o=new F(n,s.find(e=>"pixabay"==e.dataset.context)),i.find(e=>"pixabay"==e.dataset.context).classList.remove("fpd-hidden")),i.filter(e=>!e.classList.contains("fpd-hidden")).length<2&&this.container.classList.add("fpd-hide-tabs")}}class B extends EventTarget{constructor(t,i,s){let n;if(super(),"products"===s)n=new w(t,i);else if("text"===s)n=new E(t,i);else if("text-to-image"===s)n=new L(t,i);else if(s.includes("designs")){let e=null;if(s.includes("designs_")&&!m(t.mainOptions.dynamicDesigns)){if(!(e=s.split("_").pop())||!t.mainOptions.dynamicDesigns[e])return;{var a=t.mainOptions.dynamicDesigns[e];const i={};i["data-dynamic-designs-id"]=e,!m(a.icon)&&a.icon.includes(".svg")&&(this.configs={icon:a.icon,defaultText:a.name,attrs:i})}}n=new C(t,i,e)}else"images"===s&&(n=new q(t,i));if(n&&(this.moduleInstance=n,t["moduleInstance_"+s]=n,!s.includes("designs_"))){const t=n.container.querySelector("div");this.configs={icon:t.dataset.moduleicon,langId:t.dataset.title,langKeys:t.dataset.title.split("."),defaultText:t.dataset.defaulttext}}}}class N extends EventTarget{#F=null;#H=null;#z=!1;#q=0;#B=0;#R=0;#N=0;#j=!1;#V=!1;contentElem=null;navElem=null;currentModuleKey="";constructor(e){super();var t=(this.fpdInstance=e).container;if(this.container=document.createElement("fpd-main-bar"),t.append(this.container),this.contentElem=this.container.querySelector(".fpd-module-content"),this.navElem=this.container.querySelector(".fpd-navigation"),this.currentModules=e.mainOptions.mainBarModules,this.#F=document.querySelector(this.fpdInstance.mainOptions.modalMode?".fpd-modal-product-designer":"body"),this.#H=document.querySelector(".fpd-draggable-dialog"),this.#F.append(this.#H),r(this.#H,["mousedown","touchstart"],this.#W.bind(this)),r(this.#H,["mouseup","touchend"],this.#Z.bind(this)),r(document,["mousemove","touchmove"],this.#X.bind(this)),r(this.#H.querySelector(".fpd-close-dialog"),["click","touchstart"],this.#J.bind(this)),r(this.container.querySelector(".fpd-close-off-canvas"),"click",this.#J.bind(this)),r(e,"viewSelect",()=>{this.toggleContentDisplay(!1)}),t.classList.contains("fpd-off-canvas")){let t=0,i=0;this.contentElem.addEventListener("touchstart",e=>{t=e.touches[0].pageX,h(this.container,["fpd-is-dragging"])}),this.contentElem.addEventListener("touchmove",e=>{e.preventDefault();e=e.touches[0].pageX;i=t-e,i=Math.abs(i)<0?0:Math.abs(i),this.contentElem.style.left=-i+"px",this.contentElem.previousElementSibling.style.left=this.contentElem.clientWidth-i+"px"}),this.contentElem.addEventListener("touchend",e=>{100<Math.abs(i)?this.toggleContentDisplay(!1):(this.contentElem.style.left="0px",this.contentElem.previousElementSibling.style.left=this.contentElem.clientWidth+"px"),i=0,u(this.container,["fpd-is-dragging"])})}this.updateContentWrapper(),this.setup(this.currentModules)}#W(e){this.#H.querySelector(".fpd-dialog-drag-handle").contains(e.target)&&(e.preventDefault(),this.#z=!0,this.#q=(e.touches?event.touches[0]:e).clientX,this.#B=(e.touches?event.touches[0]:e).clientY,this.#R=this.#q-this.#H.offsetLeft,this.#N=this.#B-this.#H.offsetTop)}#X(i){if(this.#z){var s=this.#F.clientWidth<window.innerWidth?window.innerWidth:this.#F.clientWidth,n=this.#F.clientHeight<window.innerHeight?window.innerHeight:this.#F.clientHeight,s=s-this.#H.clientWidth,n=n-this.#H.clientHeight,a=(i.touches?event.touches[0]:i).clientX;let e=(i.touches?event.touches[0]:i).clientY-this.#N,t=a-this.#R;t<0&&(t=0),e<0&&(e=0),t>s&&(t=s),e>n&&(e=n),this.#H.style.top=e+"px",this.#H.style.left=t+"px"}}#Z(e){this.#z=!1}#Y(e){e.stopPropagation(),this.fpdInstance.deselectElement(),this.fpdInstance.currentViewInstance&&(this.fpdInstance.currentViewInstance.currentUploadZone=null),e.currentTarget.classList.contains("fpd-active")&&this.contentClosable?this.toggleContentDisplay(!1):this.callModule(e.currentTarget.dataset.module,e.currentTarget.dataset.dynamicDesignsId)}#J(){this.fpdInstance.currentViewInstance&&this.fpdInstance.currentViewInstance.currentUploadZone&&this.fpdInstance.currentViewInstance.deselectElement(),this.toggleContentDisplay(!1)}callModule(e,t=null){let i;u(this.navElem.querySelectorAll(".fpd-nav-item"),["fpd-active"]),u(Array.from(this.contentElem.children),["fpd-active"]),t?(i=h(this.navElem.querySelector('.fpd-nav-item[data-dynamic-designs-id="'+t+'"]'),["fpd-active"]),h(this.contentElem.querySelector('[data-dynamic-designs-id="'+t+'"]'),["fpd-active"])):(i=h(this.navElem.querySelector('.fpd-nav-item[data-module="'+e+'"]'),["fpd-active"]),h(this.contentElem.querySelector("fpd-module-"+e),["fpd-active"])),this.toggleContentDisplay(),this.currentModuleKey=e}get contentClosable(){var e=this.fpdInstance.container;return this.#V||this.#j||e.classList.contains("fpd-layout-small")}callSecondary(){this.callModule("secondary")}toggleContentDisplay(e=!0){var t,i,s;[t=[],i,s=!0]=[this.fpdInstance.container,["fpd-module-visible"],e],t&&(t instanceof HTMLElement?i.forEach(e=>{t.classList.toggle(e,s)}):t.forEach(t=>{i.forEach(e=>{t.classList.toggle(e,s)})})),this.contentClosable&&!e&&u(this.navElem.querySelectorAll(".fpd-nav-item"),["fpd-active"]),this.#V?(!e&&this.currentModuleKey.length&&this.fpdInstance.deselectElement(),this.contentElem.style.removeProperty("left"),this.contentElem.previousElementSibling.style.removeProperty("left"),this.contentElem.style.height=this.fpdInstance.mainWrapper.container.clientHeight+"px",this.container.classList.toggle("fpd-show",e)):this.#j&&(e&&(this.#H.querySelector(".fpd-dialog-title").innerText=this.navElem.querySelector(".fpd-nav-item.fpd-active .fpd-label").innerText),this.#H.classList.toggle("fpd-show",e)),e||(this.currentModuleKey="")}updateContentWrapper(){var e=this.fpdInstance.container;this.toggleContentDisplay(!1),this.#V=!1,this.#j=!1,u(this.navElem.querySelectorAll(".fpd-nav-item"),["fpd-active"]),(e.classList.contains("fpd-off-canvas")?(this.#V=!0,this.container):e.classList.contains("fpd-sidebar")?this.container:(this.#j=!0,this.#H)).append(this.contentElem)}toggleUploadZonePanel(e=!0){this.fpdInstance.loadingCustomImage||(e?this.callSecondary("fpd-upload-zone-adds-panel"):(this.fpdInstance.currentViewInstance.currentUploadZone=null,this.toggleContentDisplay(!1)))}toggleUploadZoneAdds(e){}setup(e=[]){let t=this.fpdInstance.mainOptions.initialActiveModule||"";const a=this.container.querySelector(".fpd-navigation");this.currentModules.length<=1&&!this.fpdInstance.container.classList.contains("fpd-topbar")?(t=this.currentModules[0]||"",a.classList.add("fpd-hidden")):this.fpdInstance.container.classList.contains("fpd-sidebar")&&""==t?t=this.currentModules[0]||"":a.classList.remove("fpd-hidden"),a.innerHTML=this.contentElem.innerHTML="",e.forEach(e=>{let i="";var s=new B(this.fpdInstance,this.contentElem,e);if(s.moduleInstance){var n=document.createElement("div");n.classList.add("fpd-nav-item"),n.dataset.module=e,n.addEventListener("click",this.#Y.bind(this)),a.appendChild(n);let t=document.createElement("span");if(s.configs.icon.includes(".svg")?fetch(s.configs.icon).then(e=>e.text()).then(e=>{t.innerHTML=e}).catch(e=>{}):(t.classList.add("fpd-nav-icon"),t.classList.add(s.configs.icon)),n.append(t),s.configs.langKeys){const e=s.configs.langKeys;i=this.fpdInstance.translator.getTranslation(e[0],e[1],this.fpdInstance.mainOptions.langJson,s.configs.defaultText)}else s.configs.defaultText&&(i=s.configs.defaultText);e=document.createElement("span");if(e.className="fpd-label",e.innerText=i,n.append(e),s.configs.attrs)for(const[e,i]of Object.entries(s.configs.attrs))n.setAttribute(e,i)}}),this.contentClosable||a.querySelector(`[data-module="${t}"]`).click()}}class D extends HTMLElement{constructor(){super()}connectedCallback(){var e=document.createElement("template");e.innerHTML='<div class="fpd-snap-line-h"></div> <div class="fpd-snap-line-v"></div> <div class="fpd-product-stage"></div>',this.append(e.content.cloneNode(!0))}}customElements.define("fpd-main-wrapper",D);class R{constructor(e){this.container=document.createElement("fpd-main-wrapper"),e.container.append(this.container)}}X(561);class j extends EventTarget{constructor(e){super(),this.container=document.createElement("fpd-actions-bar"),e.container.append(this.container)}}class V extends HTMLElement{constructor(){super()}connectedCallback(){this.innerHTML='<span class="fpd-view-prev"> <span class="fpd-icon-forward"></span> </span> <div class="fpd-views-selection"></div> <span class="fpd-view-next"> <span class="fpd-icon-forward"></span> </span> '}}customElements.define("fpd-views-wrapper",V);class W extends EventTarget{constructor(e){super(),this.container=document.createElement("fpd-views-wrapper"),e.container.classList.contains("fpd-views-outside")||e.mainOptions.modalMode?e.container.after(this.container):e.mainWrapper.container.append(this.container)}}class Z extends EventTarget{#G=0;constructor(e){super(),this.fpdInstance=e}init(){this.#$(),this.fpdInstance.container.classList.add("fpd-container"),this.fpdInstance.container.classList.add("fpd-wrapper");var e=document.createElement("div");e.innerHTML='<div class="fpd-loader-wrapper"> <div class="fpd-loader"> <div class="fpd-loader-circle"></div> <span class="fpd-loader-text" data-defaulttext="Initializing Product Designer">misc.initializing</span> </div> </div>',this.fpdInstance.container.appendChild(e.firstChild.cloneNode(!0)),this.fpdInstance.mainLoader=this.fpdInstance.container.querySelector(".fpd-loader-wrapper"),this.fpdInstance.actionsBar=new j(this.fpdInstance),this.fpdInstance.mainBar=new N(this.fpdInstance),this.fpdInstance.mainWrapper=new R(this.fpdInstance),this.fpdInstance.productStage=this.fpdInstance.mainWrapper.container.querySelector(".fpd-product-stage"),this.fpdInstance.viewsWrapper=new W(this.fpdInstance),Array.from(this.fpdInstance.container.querySelectorAll("[data-defaulttext]")).forEach(e=>{this.fpdInstance.translator.translateElement(e,this.fpdInstance.mainOptions.langJson)}),this.dispatchEvent(new CustomEvent("ready")),window.addEventListener("resize",this.#$.bind(this))}#$(){var e=this.fpdInstance.mainOptions.responsiveBreakpoints;this.#G=window.innerWidth,this.#G<e.small?(this.fpdInstance.container.classList.remove("fpd-layout-medium"),this.fpdInstance.container.classList.remove("fpd-layout-large"),this.fpdInstance.container.classList.add("fpd-layout-small")):this.#G<e.medium?(this.fpdInstance.container.classList.remove("fpd-layout-small"),this.fpdInstance.container.classList.remove("fpd-layout-large"),this.fpdInstance.container.classList.add("fpd-layout-medium")):(this.fpdInstance.container.classList.remove("fpd-layout-medium"),this.fpdInstance.container.classList.remove("fpd-layout-small"),this.fpdInstance.container.classList.add("fpd-layout-large"))}}class J extends EventTarget{static forbiddenTextChars=/<|>/g;container=null;mainOptions={};currentViewInstance=null;currentViewIndex=0;products=[];designs=[];modalContainer=document.body;currentCategoryIndex=0;currentProductIndex=0;viewInstances=[];currentViews=null;productCreated=!1;colorLinkGroups={};globalCustomElements=[];doUnsavedAlert=!1;loadingCustomImage=!1;lazyBackgroundObserver=null;#K=[];#Q=0;#ee=0;#te=!1;constructor(e,t={}){super(),this.lazyBackgroundObserver=new IntersectionObserver((e,t)=>{e.forEach(e=>{var t,i,s;e.isIntersecting&&(t=e.target,i=null,t&&(t.classList.add("fpd-on-loading"),(s=new Image).src=i||t.dataset.img,s.onload=function(){t.dataset.originwidth=this.width,t.dataset.originheight=this.height,t.classList.remove("fpd-on-loading"),t.style.backgroundImage='url("'+this.src+'")'},s.onerror=function(){t.parentNode.remove()}),this.lazyBackgroundObserver.unobserve(e.target))})}),this.container=e,(this.container.instance=this).mainOptions=a.merge(a.defaults,t),this.currentViewInstance={options:{...this.mainOptions}},this.translator=new i,this.translator.loadLangJSON(this.mainOptions.langJson,this.#ie.bind(this))}#ie(){this.uiManager=new Z(this),this.uiManager.addEventListener("ready",e=>{this.#se()}),this.uiManager.init()}#se(){(class{static parseFontsToEmbed(e,t=""){var i="";if(e.hasOwnProperty("url")){e.name;var s=-1!==e.url.search(".woff")?"woff":"TrueType",n=t?t+e.url:e.url;if(i+='@font-face {font-family:"'+e.name+'"; font-style: normal; font-weight: normal; src:url("'+n+'") format("'+s+'");}\n',e.variants){for(const a in e.variants)n=t+e.variants[a],i+='@font-face {font-family:"'+e.name+'"; '+{n7:"font-style: normal; font-weight: bold;",i4:"font-style: italic; font-weight: normal;",i7:"font-style: italic; font-weight: bold;"}[a]+' src:url("'+n+'") format("'+s+'");}\n';Object.keys(e.variants).toString()}}return i}static load(i,o){var e=i.mainOptions.fonts;if(e&&0<e.length&&"object"==typeof e[0]){e.sort((e,t)=>{e=e.name.toUpperCase(),t=t.name.toUpperCase();return e<t?-1:t<e?1:0});let s=[],n=[],a=0;const d=document.createElement("style");d.id="fpd-fonts",i.container.before(d),e.forEach(e=>{var t;e.hasOwnProperty("url")&&("google"==e.url?s.push(e.name+":400,400i,700,700i"):(t=e.name,t+=":n4",e.variants&&(t+=","+Object.keys(e.variants).toString()),n.push(t),d.append(this.parseFontsToEmbed(e,i.mainOptions._loadFromScript))))});var r=function(e,t,i){"inactive"==e&&console.log(t+" font could not be loaded."),a==s.length+n.length-1&&o(),a++},e={fontactive:function(e,t){r("active",e)},fontinactive:function(e,t){r("inactive",e)},timeout:3e3};0<s.length&&(e.google={families:s}),0<n.length&&(e.custom={families:n}),"undefined"!=typeof WebFont&&(0<s.length||0<n.length)?WebFont.load(e):o()}else o()}}).load(this,()=>{this.#ne()})}#ne(){setTimeout(()=>{this.dispatchEvent(new CustomEvent("uiSet"))},1),this.#ae()}#ae(){this.dispatchEvent(new CustomEvent("ready")),this.mainOptions.productsJSON&&("object"==typeof this.mainOptions.productsJSON?this.setupProducts(this.mainOptions.productsJSON):y({url:this.mainOptions.productsJSON,onSuccess:e=>{this.setupProducts(e)},onError:()=>{alert("Products JSON could not be loaded. Please check that your URL is correct! URL: "+this.mainOptions.productsJSON)}})),this.mainOptions.designsJSON&&("object"==typeof this.mainOptions.productsJSON?this.setupDesigns(this.mainOptions.designsJSON):y({url:this.mainOptions.designsJSON,onSuccess:e=>{this.setupDesigns(e)},onError:()=>{alert("Design JSON could not be loaded. Please check that your URL is correct! URL: "+this.mainOptions.designsJSON)}}));let t=0;r(window,"resize",e=>{window.innerWidth===t||this.#te||(t=window.innerWidth,this.currentViewInstance&&this.currentViewInstance.resetSize())})}#oe(t){var e=this.products.findIndex(e=>e.category===t);return-1!==e&&e}setupProducts(e=[]){this.products=[],e.forEach(t=>{t.hasOwnProperty("category")?t.products.forEach(e=>{this.addProduct(e,t.category)}):this.addProduct(t)}),this.mainOptions.loadFirstProductInStage&&0<e.length?this.selectProduct(0):this.toggleSpinner(!1),this.toggleSpinner(!1),this.dispatchEvent(new CustomEvent("productsSet"))}setupDesigns(e){this.designs=e,this.dispatchEvent(new CustomEvent("designsSet"))}addProduct(e,t){var i=this.#oe(t);(void 0===t?this:(!1===i&&(i=this.products.length,this.products[i]={category:t,products:[]}),this.products[i])).products.push(e),this.dispatchEvent(new CustomEvent("productAdd",{detail:{views:e,category:t,catIndex:i}}))}selectProduct(e,t){this.currentCategoryIndex=void 0===t?this.currentCategoryIndex:t,t=(this.products&&this.products.length&&this.products[0].category?this.products[this.currentCategoryIndex]:instance).products,(this.currentProductIndex=e)<0?this.currentProductIndex=0:e>t.length-1&&(this.currentProductIndex=t.length-1);e=t[this.currentProductIndex];this.dispatchEvent(new CustomEvent("productSelect",{detail:{product:e}})),this.loadProduct(e,this.mainOptions.replaceInitialElements)}loadProduct(e,t=!1,i=!1){e&&(this.toggleSpinner(!0),this.#K=[],this.viewInstances.forEach(e=>{}),this.productCreated=!1,this.colorLinkGroups={},this.globalCustomElements=[],t?this.globalCustomElements=this.getCustomElements():this.doUnsavedAlert=!1,this.fixedElements=this.getFixedElements(),this.reset(),i&&e.forEach((e,t)=>{e.options=a.merge(this.mainOptions,e.options)}),this.currentViews=e,this.#Q=this.#ee=0,e.forEach((e,t)=>{this.#Q+=e.elements.length}),r(this,"viewCreate",this.#re),e)&&this.addView(e[0])}addView(e){const t=this.mainOptions._loadFromScript?this.mainOptions._loadFromScript+e.thumbnail:e.thumbnail,i=document.createElement("div");i.className="fpd-shadow-1 fpd-item fpd-tooltip",i.title=e.title,i.innerHTML='<picture style="background-image: url('+t+');"></picture>',this.viewsWrapper.container.querySelector(".fpd-views-selection").append(i),r(i,"click",e=>{var t=Array.from(this.viewsWrapper.container.querySelectorAll(".fpd-views-selection > div")).indexOf(i);this.selectView(t)});let s={};b.relevantOptions.forEach(e=>{var t=this.mainOptions[e];s[e]=n(t)?{...t}:t}),e.options=n(e.options)?c(s,e.options):s,new b(this.productStage,e,e=>{this.viewInstances.length,this.viewInstances.push(e),r(e,"sizeUpdate",e=>{e=e.currentTarget.fabricCanvas.height+"px";this.productStage.style.height=e,this.container.classList.contains("fpd-sidebar")&&(this.mainBar.container.style.height=e)}),this.dispatchEvent(new CustomEvent("viewCreate",{detail:{viewInstance:e}}))},this.mainOptions.fabricCanvasOptions).init()}toggleSpinner(e=!0,t=""){return this.mainLoader.querySelector(".fpd-loader-text").innerText=t,this.mainLoader.classList.toggle("fpd-hidden",!e),this.mainLoader}selectView(e=0){this.viewInstances.length<=0||(this.currentViewIndex=e,this.currentViewInstance,this.currentViewInstance=this.viewInstances[this.currentViewIndex],this.deselectElement(),e=this.productStage.querySelectorAll(".fpd-view-stage"),h(e,["fpd-hidden"]),u(e.item(this.currentViewIndex),["fpd-hidden"]),this.currentViewInstance.resetSize(),this.dispatchEvent(new CustomEvent("viewSelect")))}getCustomElements(e=0,t,i){return[]}getFixedElements(e=0,t,i){return[]}reset(){this.currentViews}deselectElement(){}formatPrice(n){var a=this.mainOptions.priceFormat;if(n&&"object"==typeof a){var o=a.thousandSep,r=a.decimalSep;let e=n.toString().split("."),t=e[0],i=e[1],s="";if(void 0!==t){for(var d=t.length-1;0<=d;d--)s+=t.charAt(d);for((s=s.replace(/(\d{3})/g,"$1"+o)).slice(-o.length)==o&&(s=s.slice(0,-o.length)),t="",d=s.length-1;0<=d;d--)t+=s.charAt(d);void 0!==i&&0<i.length&&(1==i.length&&(i+="0"),t+=r+i)}return t=a.currency.replace("%d",t.toString())}return n=n&&a.priceFormat.replace("%d",n)}#re(){this.viewInstances.length<this.currentViews.length?this.addView(this.currentViews[this.viewInstances.length]):(this.removeEventListener("viewCreate",this.#re),this.toggleSpinner(!1),this.selectView(0))}_addGridItemToCanvas(e,t=0,i){i=void 0===i?this.currentViewIndex:i,this.currentViewInstance}_addCanvasImage(e,t,i={},s=!1,n){var a;n=void 0===n?this.currentViewIndex:n,this.currentViewInstance&&((a=this.mainOptions.customImageAjaxSettings).data&&a.data.saveOnServer&&s?_downloadRemoteImage(e,t,i):(this.loadingCustomImage=!0,this.addCustomImage(e,t,i,n)),this.productCreated)&&this.mainOptions.hideDialogOnAdd&&this.mainBar&&this.mainBar.toggleDialog(!1)}}window.FancyProductDesigner=J})()})();